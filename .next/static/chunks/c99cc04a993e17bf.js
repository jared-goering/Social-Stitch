(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67034,(e,t,n)=>{var r={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return(n+r)*3/4-r},t.toByteArray=function(e){var t,n,s=l(e),a=s[0],o=s[1],u=new i((a+o)*3/4-o),c=0,h=o>0?a-4:a;for(n=0;n<h;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;return 2===o&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[c++]=255&t),1===o&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t),u},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,s=[],a=0,o=r-i;a<o;a+=16383)s.push(function(e,t,r){for(var i,s=[],a=t;a<r;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[i>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===i&&s.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),s.join("")};for(var n=[],r=[],i="u">typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)n[a]=s[a],r[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}r[45]=62,r[95]=63},72:function(e,t,n){"use strict";var r=n(675),i=n(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return c(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e){var r=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|p(r,i),l=a(s),u=l.write(r,i);return u!==s&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return h(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(A(e,ArrayBuffer)||e&&A(e.buffer,ArrayBuffer)||"u">typeof SharedArrayBuffer&&(A(e,SharedArrayBuffer)||e&&A(e.buffer,SharedArrayBuffer)))return function(e,t,n){var r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),o.prototype),r}(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var c=e.valueOf&&e.valueOf();if(null!=c&&c!==e)return o.from(c,t,n);var f=function(e){if(o.isBuffer(e)){var t=0|d(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}(e);if(f)return f;if("u">typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return u(e),a(e<0?0:0|d(e))}function h(e){for(var t=e.length<0?0:0|d(e.length),n=a(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),!o.TYPED_ARRAY_SUPPORT&&"u">typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,n){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return c(e)},o.allocUnsafeSlow=function(e){return c(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function p(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||A(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return C(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return S(e).length;default:if(i)return r?-1:C(e).length;t=(""+t).toLowerCase(),i=!0}}function f(e,t,n){var i,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=t;s<n;++s)i+=k[e[s]];return i}(this,t,n);case"utf8":case"utf-8":return v(this,t,n);case"ascii":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}(this,t,n);case"latin1":case"binary":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}(this,t,n);case"base64":return i=this,s=t,a=n,0===s&&a===i.length?r.fromByteArray(i):r.fromByteArray(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}(this,t,n);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){var s;if(0===e.length)return -1;if("string"==typeof n?(r=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n*=1)!=s&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(i)return -1;else n=e.length-1;else if(n<0)if(!i)return -1;else n=0;if("string"==typeof t&&(t=o.from(t,r)),o.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return y(e,[t],n,r,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var s,a=1,o=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var c=-1;for(s=n;s<o;s++)if(u(e,s)===u(t,-1===c?0:s-c)){if(-1===c&&(c=s),s-c+1===l)return c*a}else -1!==c&&(s-=s-c),c=-1}else for(n+l>o&&(n=o-l),s=n;s>=0;s--){for(var h=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){h=!1;break}if(h)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(A(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),A(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:+(r<n)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;var n,r=o.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(A(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},o.byteLength=p,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?v(this,0,e):f.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,n,r,i){if(A(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var s=i-r,a=n-t,l=Math.min(s,a),u=this.slice(r,i),c=e.slice(t,n),h=0;h<l;++h)if(u[h]!==c[h]){s=u[h],a=c[h];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},o.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},o.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)};function v(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s,a,o,l,u=e[i],c=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=n)switch(h){case 1:u<128&&(c=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(c=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),i+=h}var d=r,p=d.length;if(p<=4096)return String.fromCharCode.apply(String,d);for(var f="",m=0;m<p;)f+=String.fromCharCode.apply(String,d.slice(m,m+=4096));return f}function b(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function x(e,t,n,r,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(n+r>e.length)throw RangeError("Index out of range")}function w(e,t,n,r,i,s){if(n+r>e.length||n<0)throw RangeError("Index out of range")}function E(e,t,n,r,s){return t*=1,n>>>=0,s||w(e,t,n,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,n,r,23,4),n+4}function _(e,t,n,r,s){return t*=1,n>>>=0,s||w(e,t,n,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,n,r,52,8),n+8}o.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,c,h,d=this.length-t;if((void 0===n||n>d)&&(n=d),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var p=!1;;)switch(r){case"hex":return function(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=t.length;r>s/2&&(r=s/2);for(var a=0;a<r;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[n+a]=l}return a}(this,e,t,n);case"utf8":case"utf-8":return i=t,s=n,N(C(e,this.length-i),this,i,s);case"ascii":return a=t,o=n,N(T(e),this,a,o);case"latin1":case"binary":return function(e,t,n,r){return N(T(t),e,n,r)}(this,e,t,n);case"base64":return l=t,u=n,N(S(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c=t,h=n,N(function(e,t){for(var n,r,i=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i.push(n%256),i.push(r);return i}(e,this.length-c),this,c,h);default:if(p)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),p=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,o.prototype),r},o.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||b(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},o.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||b(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},o.prototype.readUInt8=function(e,t){return e>>>=0,t||b(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||b(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||b(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||b(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||b(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},o.prototype.readInt16BE=function(e,t){e>>>=0,t||b(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||b(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||b(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||b(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||b(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;x(this,e,t,n,i,0)}var s=1,a=0;for(this[t]=255&e;++a<n&&(s*=256);)this[t+a]=e/s&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;x(this,e,t,n,i,0)}var s=n-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||x(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||x(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||x(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||x(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||x(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);x(this,e,t,n,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<n&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+n},o.prototype.writeIntBE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);x(this,e,t,n,i-1,-i)}var s=n-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||x(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||x(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||x(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||x(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||x(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,n){return E(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return E(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return _(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return _(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,r){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var s=i-1;s>=0;--s)e[s+t]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return i},o.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===r&&s<128||"latin1"===r)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,r),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=a[i%l]}return this};var I=/[^+/0-9A-Za-z-_]/g;function C(e,t){t=t||1/0;for(var n,r=e.length,i=null,s=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319||a+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function T(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function S(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(I,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function N(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length)&&!(i>=e.length);++i)t[i+n]=e[i];return i}function A(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var k=function(){for(var e="0123456789abcdef",t=Array(256),n=0;n<16;++n)for(var r=16*n,i=0;i<16;++i)t[r+i]=e[n]+e[i];return t}()},783:function(e,t){t.read=function(e,t,n,r,i){var s,a,o=8*i-r-1,l=(1<<o)-1,u=l>>1,c=-7,h=n?i-1:0,d=n?-1:1,p=e[t+h];for(h+=d,s=p&(1<<-c)-1,p>>=-c,c+=o;c>0;s=256*s+e[t+h],h+=d,c-=8);for(a=s&(1<<-c)-1,s>>=-c,c+=r;c>0;a=256*a+e[t+h],h+=d,c-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),s-=u}return(p?-1:1)*a*Math.pow(2,s-r)},t.write=function(e,t,n,r,i,s){var a,o,l,u=8*s-i-1,c=(1<<u)-1,h=c>>1,d=5960464477539062e-23*(23===i),p=r?0:s-1,f=r?1:-1,m=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+h>=1?t+=d/l:t+=d*Math.pow(2,1-h),t*l>=2&&(a++,l/=2),a+h>=c?(o=0,a=c):a+h>=1?(o=(t*l-1)*Math.pow(2,i),a+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[n+p]=255&o,p+=f,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[n+p]=255&a,p+=f,a/=256,u-=8);e[n+p-f]|=128*m}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}},a=!0;try{r[e](n,n.exports,s),a=!1}finally{a&&delete i[e]}return n.exports}s.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},20613,e=>{"use strict";let t,n,r,i,s,a;var o,l,u,c,h,d,p,f,m,g,y,v,b,x,w,E,_,I,C,T,S,N,A,k,O,R,D,j,P,M,U,L,F,V,q,B,G,z,H,$,K,W,J,Y,X,Q,Z,ee,et,en,er,ei,es,ea,eo,el,eu,ec,eh,ed,ep,ef,em,eg,ey,ev,eb,ex,ew,eE,e_,eI,eC,eT,eS,eN,eA,ek,eO,eR,eD,ej,eP,eM,eU,eL,eF,eV,eq,eB,eG,ez,eH,e$,eK,eW,eJ,eY,eX,eQ,eZ,e0,e1,e2,e5,e6,e4,e3,e8,e7,e9,te,tt,tn,tr,ti,ts,ta,to,tl,tu,tc,th,td,tp,tf,tm,tg,ty,tv,tb,tx,tw,tE,t_,tI,tC,tT,tS,tN,tA,tk,tO,tR,tD,tj,tP,tM,tU,tL,tF,tV,tq,tB=e.i(43476),tG=e.i(71645);let tz=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},tH=(...e)=>e.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim();var t$={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let tK=(0,tG.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:i="",children:s,iconNode:a,...o},l)=>(0,tG.createElement)("svg",{ref:l,...t$,width:t,height:t,stroke:e,strokeWidth:r?24*Number(n)/Number(t):n,className:tH("lucide",i),...!s&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(o)&&{"aria-hidden":"true"},...o},[...a.map(([e,t])=>(0,tG.createElement)(e,t)),...Array.isArray(s)?s:[s]])),tW=(e,t)=>{let n=(0,tG.forwardRef)(({className:n,...r},i)=>(0,tG.createElement)(tK,{ref:i,iconNode:t,className:tH(`lucide-${tz(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,n),...r}));return n.displayName=tz(e),n},tJ=tW("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),tY=tW("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),tX=tW("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),tQ=tW("lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),tZ=tW("image-plus",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]),t0=tW("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);var t1=e.i(47167),t2=e.i(67034);let t5=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},t6=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},t4={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,c=(3&i)<<4|a>>4,h=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(h=64)),r.push(n[u],n[c],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(t5(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):t6(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new t3;let l=i<<2|s>>4;if(r.push(l),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==o){let e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class t3 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let t8=function(e){let t=t5(e);return t4.encodeByteArray(t,!0)},t7=function(e){return t8(e).replace(/\./g,"")},t9=function(e){try{return t4.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},ne=()=>{try{return("u">typeof self?self:"u">typeof window?window:e.g).__FIREBASE_DEFAULTS__||(()=>{if(void 0===t1.default||void 0===t1.default.env)return;let e=t1.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("u"<typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&t9(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},nt=e=>ne()?.emulatorHosts?.[e],nn=e=>{let t=nt(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},nr=()=>ne()?.config,ni=e=>ne()?.[`_${e}`];class ns{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function na(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function no(e){return(await fetch(e,{credentials:"include"})).ok}function nl(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[t7(JSON.stringify({alg:"none",type:"JWT"})),t7(JSON.stringify(s)),""].join(".")}let nu={},nc=!1;function nh(e,t){if("u"<typeof window||"u"<typeof document||!na(window.location.host)||nu[e]===t||nu[e]||nc)return;function n(e){return`__firebase__banner__${e}`}nu[e]=t;let r="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(nu))nu[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(r),t=!1,e||((e=document.createElement("div")).setAttribute("id",r),t=!0),{created:t,element:e}),a=n("text"),o=document.getElementById(a)||document.createElement("span"),l=n("learnmore"),u=document.getElementById(l)||document.createElement("a"),c=n("preprendIcon"),h=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",u.setAttribute("id",l),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline";let n=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;nc=!0,(e=document.getElementById(r))&&e.remove()},e);h.setAttribute("width","24"),h.setAttribute("id",c),h.setAttribute("height","24"),h.setAttribute("viewBox","0 0 24 24"),h.setAttribute("fill","none"),h.style.marginLeft="-6px",t.append(h,o,u,n),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",h.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(h.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function nd(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function np(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}class nf extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,nf.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,nm.prototype.create)}}class nm{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(n=a,r=i,n.replace(ng,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new nf(s,l,i)}}let ng=/\{\$([^}]+)}/g;function ny(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(nv(n)&&nv(s)){if(!ny(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function nv(e){return null!==e&&"object"==typeof e}function nb(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function nx(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function nw(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class nE{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(r=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(r.next=n_),void 0===r.error&&(r.error=n_),void 0===r.complete&&(r.complete=n_);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"u">typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function n_(){}function nI(e){return e&&e._delegate?e._delegate:e}class nC{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let nT="[DEFAULT]";class nS{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new ns;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:nT})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=nT){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=nT){return this.instances.has(e)}getOptions(e=nT){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);let i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===nT?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=nT){return this.component?this.component.multipleInstances?e:nT:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class nN{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new nS(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let nA=[];(o=e_||(e_={}))[o.DEBUG=0]="DEBUG",o[o.VERBOSE=1]="VERBOSE",o[o.INFO=2]="INFO",o[o.WARN=3]="WARN",o[o.ERROR=4]="ERROR",o[o.SILENT=5]="SILENT";let nk={debug:e_.DEBUG,verbose:e_.VERBOSE,info:e_.INFO,warn:e_.WARN,error:e_.ERROR,silent:e_.SILENT},nO=e_.INFO,nR={[e_.DEBUG]:"log",[e_.VERBOSE]:"log",[e_.INFO]:"info",[e_.WARN]:"warn",[e_.ERROR]:"error"},nD=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=nR[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class nj{constructor(e){this.name=e,this._logLevel=nO,this._logHandler=nD,this._userLogHandler=null,nA.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in e_))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?nk[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,e_.DEBUG,...e),this._logHandler(this,e_.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,e_.VERBOSE,...e),this._logHandler(this,e_.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,e_.INFO,...e),this._logHandler(this,e_.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,e_.WARN,...e),this._logHandler(this,e_.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,e_.ERROR,...e),this._logHandler(this,e_.ERROR,...e)}}let nP=new WeakMap,nM=new WeakMap,nU=new WeakMap,nL=new WeakMap,nF=new WeakMap,nV={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return nM.get(e);if("objectStoreNames"===t)return e.objectStoreNames||nU.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return nq(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function nq(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(nq(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&nP.set(t,e)}).catch(()=>{}),nF.set(t,e),t}if(nL.has(e))return nL.get(e);let r=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(nB(this),t),nq(nP.get(this))}:function(...t){return nq(e.apply(nB(this),t))}:function(t,...n){let r=e.call(nB(this),t,...n);return nU.set(r,t.sort?t.sort():[t]),nq(r)};return e instanceof IDBTransaction&&function(e){if(nM.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});nM.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,nV):e}(e);return r!==e&&(nL.set(e,r),nF.set(r,e)),r}let nB=e=>nF.get(e),nG=["get","getKey","getAll","getAllKeys","count"],nz=["put","add","delete","clear"],nH=new Map;function n$(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(nH.get(t))return nH.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=nz.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||nG.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),i&&s.done]))[0]};return nH.set(t,s),s}nV={...a=nV,get:(e,t,n)=>n$(e,t)||a.get(e,t,n),has:(e,t)=>!!n$(e,t)||a.has(e,t)};class nK{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let nW="@firebase/app",nJ="0.14.6",nY=new nj("@firebase/app"),nX="[DEFAULT]",nQ={[nW]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},nZ=new Map,n0=new Map,n1=new Map;function n2(e,t){try{e.container.addComponent(t)}catch(n){nY.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function n5(e,t){e.container.addOrOverwriteComponent(t)}function n6(e){let t=e.name;if(n1.has(t))return nY.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(n1.set(t,e),nZ.values()))n2(n,e);for(let t of n0.values())n2(t,e);return!0}function n4(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function n3(e,t,n=nX){n4(e,t).clearInstance(n)}function n8(e){return void 0!==e.options}function n7(e){return!n8(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function n9(e){return null!=e&&void 0!==e.settings}function re(){n1.clear()}let rt=new nm("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class rn{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new nC("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw rt.create("app-deleted",{appName:this._name})}}function rr(e,t){let n=t9(e.split(".")[1]);null===n?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(n).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(n).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class ri extends rn{constructor(e,t,n,r){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,r):super(e.options,s,r),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&rr(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&rr(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,rh(nW,nJ,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){rc(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw rt.create("server-app-deleted")}}let rs="12.6.0";function ra(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r={name:nX,automaticDataCollectionEnabled:!0,...t},i=r.name;if("string"!=typeof i||!i)throw rt.create("bad-app-name",{appName:String(i)});if(n||(n=nr()),!n)throw rt.create("no-options");let s=nZ.get(i);if(s)if(ny(n,s.options)&&ny(r,s.config))return s;else throw rt.create("duplicate-app",{appName:i});let a=new nN(i);for(let e of n1.values())a.addComponent(e);let o=new rn(n,r,a);return nZ.set(i,o),o}function ro(e,t={}){let n;if(("u">typeof window||np())&&!np())throw rt.create("invalid-server-app-environment");let r=t||{};if(e&&(n8(e)?n=e.options:n7(e)?r=e:n=e),void 0===r.automaticDataCollectionEnabled&&(r.automaticDataCollectionEnabled=!0),n||(n=nr()),!n)throw rt.create("no-options");let i={...r,...n};if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==r.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw rt.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),a=n0.get(s);if(a)return a.incRefCount(r.releaseOnDeref),a;let o=new nN(s);for(let e of n1.values())o.addComponent(e);let l=new ri(n,r,s,o);return n0.set(s,l),l}function rl(e=nX){let t=nZ.get(e);if(!t&&e===nX&&nr())return ra();if(!t)throw rt.create("no-app",{appName:e});return t}function ru(){return Array.from(nZ.values())}async function rc(e){let t=!1,n=e.name;nZ.has(n)?(t=!0,nZ.delete(n)):n0.has(n)&&0>=e.decRefCount()&&(n0.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function rh(e,t,n){let r=nQ[e]??e;n&&(r+=`-${n}`);let i=r.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${r}" with version "${t}":`];i&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),nY.warn(e.join(" "));return}n6(new nC(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}function rd(e,t){if(null!==e&&"function"!=typeof e)throw rt.create("invalid-log-argument");for(let n of nA){let r=null;t&&t.level&&(r=nk[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...i)=>{let s=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(r??t.logLevel)&&e({level:e_[n].toLowerCase(),message:s,args:i,type:t.name})}}}function rp(e){nA.forEach(t=>{t.setLogLevel(e)})}let rf="firebase-heartbeat-store",rm=null;function rg(){return rm||(rm=(function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=nq(a);return r&&a.addEventListener("upgradeneeded",e=>{r(nq(a.result),e.oldVersion,e.newVersion,nq(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(rf)}catch(e){console.warn(e)}}}).catch(e=>{throw rt.create("idb-open",{originalErrorMessage:e.message})})),rm}async function ry(e){try{let t=(await rg()).transaction(rf),n=await t.objectStore(rf).get(rb(e));return await t.done,n}catch(e){if(e instanceof nf)nY.warn(e.message);else{let t=rt.create("idb-get",{originalErrorMessage:e?.message});nY.warn(t.message)}}}async function rv(e,t){try{let n=(await rg()).transaction(rf,"readwrite"),r=n.objectStore(rf);await r.put(t,rb(e)),await n.done}catch(e){if(e instanceof nf)nY.warn(e.message);else{let t=rt.create("idb-set",{originalErrorMessage:e?.message});nY.warn(t.message)}}}function rb(e){return`${e.name}!${e.options.appId}`}class rx{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new rE(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=rw();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){nY.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=rw(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),r_(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),r_(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=t7(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return nY.warn(e),""}}}function rw(){return new Date().toISOString().substring(0,10)}class rE{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await ry(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return rv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return rv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function r_(e){return t7(JSON.stringify({version:2,heartbeats:e})).length}n6(new nC("platform-logger",e=>new nK(e),"PRIVATE")),n6(new nC("heartbeat",e=>new rx(e),"PRIVATE")),rh(nW,nJ,""),rh(nW,nJ,"esm2020"),rh("fire-js",""),e.s(["SDK_VERSION",()=>rs,"_DEFAULT_ENTRY_NAME",()=>nX,"_addComponent",()=>n2,"_addOrOverwriteComponent",()=>n5,"_apps",()=>nZ,"_clearComponents",()=>re,"_components",()=>n1,"_getProvider",()=>n4,"_isFirebaseApp",()=>n8,"_isFirebaseServerApp",()=>n9,"_isFirebaseServerAppSettings",()=>n7,"_registerComponent",()=>n6,"_removeServiceInstance",()=>n3,"_serverApps",()=>n0,"deleteApp",()=>rc,"getApp",()=>rl,"getApps",()=>ru,"initializeApp",()=>ra,"initializeServerApp",()=>ro,"onLog",()=>rd,"registerVersion",()=>rh,"setLogLevel",()=>rp],92953);var rI="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,rC={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function n(){}function r(e,t,n){n||(n=0);let r=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^n&(i^s))+r[0]+0xd76aa478|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[1]+0xe8c7b756|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[2]+0x242070db|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[3]+0xc1bdceee|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[4]+0xf57c0faf|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[5]+0x4787c62a|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[6]+0xa8304613|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[7]+0xfd469501|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[8]+0x698098d8|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[9]+0x8b44f7af|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[10]+0xffff5bb1|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[11]+0x895cd7be|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[12]+0x6b901122|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[13]+0xfd987193|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[14]+0xa679438e|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(a<<22|a>>>10),a=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,a=t+((n=i+(a<<20|a>>>12))^i^s)+r[5]+0xfffa3942|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[11]+0x6d9d6122|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[14]+0xfde5380c|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[1]+0xa4beea44|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[7]+0xf6bb4b60|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[10]+0xbebfbc70|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[13]+0x289b7ec6|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[3]+0xd4ef3085|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[6]+0x4881d05|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[9]+0xd9d4d039|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[15]+0x1fa27cf8|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(a<<23|a>>>9),a=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;let n=[],r=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let n=t-this.blockSize,i=this.C,s=this.h,a=0;for(;a<t;){if(0==s)for(;a<=n;)r(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){r(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){r(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};var s,a={};function o(e){var t;return -128<=e&&e<128?(t=function(e){return new i([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(a,e)?a[e]:a[e]=t(e)):new i([0|e],e<0?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return u;if(e<0)return f(l(-e));let t=[],n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new i(t,0)}var u=o(0),c=o(1),h=o(0x1000000);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function p(e){return -1==e.h}function f(e){let t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(c)}function m(e,t){return e.add(f(t))}function g(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function v(e,t){if(d(t))throw Error("division by zero");if(d(e))return new y(u,u);if(p(e))return t=v(f(e),t),new y(f(t.g),f(t.h));if(p(t))return t=v(e,f(t)),new y(f(t.g),t.h);if(e.g.length>30){if(p(e)||p(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=t;0>=r.l(e);)n=b(n),r=b(r);var i=x(n,1),s=x(r,1);for(r=x(r,2),n=x(n,2);!d(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=x(r,1),n=x(n,1)}return t=m(e,i.j(t)),new y(i,t)}for(i=u;e.l(t)>=0;){for(r=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,r-48),a=(s=l(n)).j(t);p(a)||a.l(e)>0;)n-=r,a=(s=l(n)).j(t);d(s)&&(s=c),i=i.add(s),e=m(e,a)}return new y(i,e)}function b(e){let t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function x(e,t){let n=t>>5;t%=32;let r=e.g.length-n,s=[];for(let i=0;i<r;i++)s[i]=t>0?e.i(i+n)>>>t|e.i(i+n+1)<<32-t:e.i(i+n);return new i(s,e.h)}(s=i.prototype).m=function(){if(p(this))return-f(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){let r=this.i(n);e+=(r>=0?r:0x100000000+r)*t,t*=0x100000000}return e},s.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(p(this))return"-"+f(this).toString(e);let t=l(Math.pow(e,6));var n=this;let r="";for(;;){let i=v(n,t).g,s=(((n=m(n,i.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(d(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},s.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return p(e=m(this,e))?-1:+!d(e)},s.abs=function(){return p(this)?f(this):this},s.add=function(e){let t=Math.max(this.g.length,e.g.length),n=[],r=0;for(let i=0;i<=t;i++){let t=r+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=s>>>16,t&=65535,s&=65535,n[i]=s<<16|t}return new i(n,-0x80000000&n[n.length-1]?-1:0)},s.j=function(e){if(d(this)||d(e))return u;if(p(this))return p(e)?f(this).j(f(e)):f(f(this).j(e));if(p(e))return f(this.j(f(e)));if(0>this.l(h)&&0>e.l(h))return l(this.m()*e.m());let t=this.g.length+e.g.length,n=[];for(var r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){let i=this.i(r)>>>16,s=65535&this.i(r),a=e.i(t)>>>16,o=65535&e.i(t);n[2*r+2*t]+=s*o,g(n,2*r+2*t),n[2*r+2*t+1]+=i*o,g(n,2*r+2*t+1),n[2*r+2*t+1]+=s*a,g(n,2*r+2*t+1),n[2*r+2*t+2]+=i*a,g(n,2*r+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new i(n,0)},s.B=function(e){return v(this,e).h},s.and=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},s.or=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},s.xor=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,eC=rC.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=l,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return f(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let r=l(Math.pow(n,8)),i=u;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),n);s<8?(s=l(Math.pow(n,s)),i=i.j(s).add(l(a))):i=(i=i.j(r)).add(l(a))}return i},eI=rC.Integer=i}).apply(void 0!==rI?rI:"u">typeof self?self:"u">typeof window?window:{});var rT="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,rS={};(function(){var e,t,n=Object.defineProperty,r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof rT&&rT];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var i=r;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&n(i,e,{configurable:!0,writable:!0,value:t})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function l(e,t,n){return e.call.apply(e.bind,arguments)}function u(e,t,n){return(u=l).apply(null,arguments)}function c(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}var d="u">typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function p(e){let t=e.length;if(t>0){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function f(e,t){for(let t=1;t<arguments.length;t++){let r=arguments[t];var n=typeof r;if("array"==(n="object"!=n?n:r?Array.isArray(r)?"array":n:"null")||"object"==n&&"number"==typeof r.length){n=e.length||0;let t=r.length||0;e.length=n+t;for(let i=0;i<t;i++)e[n+i]=r[i]}else e.push(r)}}var m=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new g,e=>e.reset());class g{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let y,v=!1,b=new class{constructor(){this.h=this.g=null}add(e,t){let n=m.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},x=()=>{let e=Promise.resolve(void 0);y=()=>{e.then(w)}};function w(){let e;for(var t;e=null,b.g&&(e=b.g,b.g=b.g.next,b.g||(b.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}m.j(t),m.h<100&&(m.h++,t.next=m.g,m.g=t)}v=!1}function E(){this.u=this.u,this.C=this.C}function _(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}E.prototype.u=!1,E.prototype.dispose=function(){this.u||(this.u=!0,this.N())},E.prototype[Symbol.dispose]=function(){this.dispose()},E.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},_.prototype.h=function(){this.defaultPrevented=!0};var I=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function C(e){return/^[\s\xa0]*$/.test(e)}function T(e,t){_.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}h(T,_),T.prototype.init=function(e,t){let n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&T.Z.h.call(this)},T.prototype.h=function(){T.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var S="closure_listenable_"+(1e6*Math.random()|0),N=0;function A(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++N,this.da=this.fa=!1}function k(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function O(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function R(e){let t={};for(let n in e)t[n]=e[n];return t}let D="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function j(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<D.length;t++)n=D[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function P(e){this.src=e,this.g={},this.h=0}function M(e,t){let n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=s>=0)&&Array.prototype.splice.call(i,s,1),r&&(k(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function U(e,t,n,r){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}P.prototype.add=function(e,t,n,r,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=U(e,t,r,i);return a>-1?(t=e[a],n||(t.fa=!1)):((t=new A(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var L="closure_lm_"+(1e6*Math.random()|0),F={};function V(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");let a=o(i)?!!i.capture:!!i,l=z(e);if(l||(e[L]=l=new P(e)),(n=l.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return G.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)I||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(B(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function q(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[S])M(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(B(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=z(t))?(M(n,e),0==n.h&&(n.src=null,t[L]=null)):k(e)}}}function B(e){return e in F?F[e]:F[e]="on"+e}function G(e,t){if(e.da)e=!0;else{t=new T(t,this);let n=e.listener,r=e.ha||e.src;e.fa&&q(e),e=n.call(r,t)}return e}function z(e){return(e=e[L])instanceof P?e:null}var H="__closure_events_fn_"+(1e9*Math.random()>>>0);function $(e){return"function"==typeof e?e:(e[H]||(e[H]=function(t){return e.handleEvent(t)}),e[H])}function K(){E.call(this),this.i=new P(this),this.M=this,this.G=null}function W(e,t){let n,r;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new _(t,e);else if(t instanceof _)t.target=t.target||e;else{var a=t;j(t=new _(s,e),a)}if(a=!0,i)for(r=i.length-1;r>=0;r--)a=J(n=t.g=i[r],s,!0,t)&&a;if(a=J(n=t.g=e,s,!0,t)&&a,a=J(n,s,!1,t)&&a,i)for(r=0;r<i.length;r++)a=J(n=t.g=i[r],s,!1,t)&&a}function J(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==n){let t=a.listener,n=a.ha||a.src;a.fa&&M(e.i,a),i=!1!==t.call(n,r)&&i}}return i&&!r.defaultPrevented}h(K,E),K.prototype[S]=!0,K.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else(i=o(i)?!!i.capture:!!i,r=$(r),t&&t[S])?(t=t.i,(a=String(n).toString())in t.g&&(r=U(n=t.g[a],r,i,s))>-1&&(k(n[r]),Array.prototype.splice.call(n,r,1),0==n.length&&(delete t.g[a],t.h--))):t&&(t=z(t))&&(n=t.g[n.toString()],t=-1,n&&(t=U(n,r,i,s)),(r=t>-1?n[t]:null)&&q(r))}(this,e,t,n,r)},K.prototype.N=function(){if(K.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let n=e.g[t];for(let e=0;e<n.length;e++)k(n[e]);delete e.g[t],e.h--}}this.G=null},K.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},K.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class Y extends E{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=u(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:a.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function X(e){E.call(this),this.h=e,this.g={}}h(X,E);var Q=[];function Z(e){O(e.g,function(e,t){this.g.hasOwnProperty(t)&&q(e)},e),e.g={}}X.prototype.N=function(){X.Z.N.call(this),Z(this)},X.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ee=a.JSON.stringify,et=a.JSON.parse,en=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function er(){}function ei(){}var es={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ea(){_.call(this,"d")}function eo(){_.call(this,"c")}h(ea,_),h(eo,_);var el={},eu=null;function ec(){return eu=eu||new K}function eh(e){_.call(this,el.Ia,e)}function ed(e){let t=ec();W(t,new eh(t))}function ep(e,t){_.call(this,el.STAT_EVENT,e),this.stat=t}function ef(e){let t=ec();W(t,new ep(t,e))}function em(e,t){_.call(this,el.Ja,e),this.size=t}function eg(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function ey(){this.g=!0}function ev(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var n=s[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<r.length;e++)r[e]=""}}}}return ee(s)}catch(e){return t}}(e,n)+(r?" "+r:"")})}el.Ia="serverreachability",h(eh,_),el.STAT_EVENT="statevent",h(ep,_),el.Ja="timingevent",h(em,_),ey.prototype.ua=function(){this.g=!1},ey.prototype.info=function(){};var eb={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ex={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function ew(){}function eE(e){return encodeURIComponent(String(e))}function e_(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new X(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eI}function eI(){this.i=null,this.g="",this.h=!1}h(ew,er),ew.prototype.g=function(){return new XMLHttpRequest},e=new ew;var eC={},ej={};function eP(e,t,n){e.M=1,e.A=e4(e0(t)),e.u=n,e.R=!0,eM(e,null)}function eM(e,t){e.F=Date.now(),eL(e),e.B=e0(e.A);var n,r,i,s,a,l,c=e.B,h=e.S;Array.isArray(h)||(h=[String(h)]),tu(c.i,"t",h),e.C=0,c=e.j.L,e.h=new eI,e.g=tJ(e.j,c?t:null,!e.u),e.P>0&&(e.O=new Y(u(e.Y,e,e.g),e.P)),t=e.V,c=e.g,h=e.ba;var d="readystatechange";Array.isArray(d)||(d&&(Q[0]=d.toString()),d=Q);for(let e=0;e<d.length;e++){let n=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(let a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=$(r),t&&t[S]?t.K(n,r,o(i)?!!i.capture:!!i,s):V(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(let a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=$(r),t&&t[S]?t.J(n,r,o(i)?!!i.capture:!!i,s):V(t,n,r,!1,i,s)}(c,d[e],h||t.handleEvent,!1,t.h||t);if(!n)break;t.g[n.key]=n}t=e.J?R(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ed(),n=e.i,r=e.v,i=e.B,s=e.l,a=e.S,l=e.u,n.info(function(){if(n.g)if(l){var e="",t=l.split("&");for(let n=0;n<t.length;n++){var o=t[n].split("=");if(o.length>1){let t=o[0];o=o[1];let n=t.split("_");e=n.length>=2&&"type"==n[1]?e+(t+"=")+o+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+r+"\n"+i+"\n"+e})}function eU(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eL(e){e.T=Date.now()+e.H,eF(e,e.H)}function eF(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eg(u(e.aa,e),t)}function eV(e){e.D&&(a.clearTimeout(e.D),e.D=null)}function eq(e){0==e.j.I||e.K||tz(e.j,e)}function eB(e){eV(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,Z(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function eG(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||eW(n.h,e))){if(!e.L&&eW(n.h,e)&&3==n.I){try{var r=n.Ba.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.v){if(n.g)if(n.g.F+3e3<e.F)tG(n),tD(n);else break e;tV(n),ef(18)}}else n.xa=i[1],0<n.xa-n.K&&i[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=eg(u(n.Va,n),6e3));1>=eK(n.h)&&n.ta&&(n.ta=void 0)}else t$(n,11)}else if((e.L||n.g==e)&&tG(n),!C(t))for(i=n.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=n.K))if(n.K=l,o=o[1],2==n.I)if("c"==o[0]){n.M=o[1],n.ba=o[2];let t=o[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));let i=o[4];null!=i&&(n.za=i,n.j.info("SVER="+n.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(n.O=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eJ(s,s.h),s.h=null))}if(r.G){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,e6(r.J,r.G,e))}}if(n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms")),(r=n).na=tW(r,r.L?r.ba:null,r.W),e.L){eY(r.h,e);var a=r.O;a&&(e.H=a),e.D&&(eV(e),eL(e)),r.g=e}else tF(r);n.i.length>0&&tP(n)}else"stop"!=o[0]&&"close"!=o[0]||t$(n,7);else 3==n.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?t$(n,7):tR(n):"noop"!=o[0]&&n.l&&n.l.qa(o),n.A=0)}}ed(4)}catch(e){}}e_.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tN(e)?t.j():this.Y(e)},e_.prototype.Y=function(e){try{if(e==this.g)e:{let p=tN(this.g),f=this.g.ya(),m=this.g.ca();if(!(p<3)&&(3!=p||this.g&&(this.h.h||this.g.la()||tA(this.g)))){this.K||4!=p||7==f||(8==f||m<=0?ed(3):ed(2)),eV(this);var t=this.g.ca();this.X=t;var n=function(e){if(!eU(e))return e.g.la();let t=tA(e.g);if(""===t)return"";let n="",r=t.length,i=4==tN(e.g);if(!e.h.i){if("u"<typeof TextDecoder)return eB(e),eq(e),"";e.h.i=new a.TextDecoder}for(let s=0;s<r;s++)e.h.h=!0,n+=e.h.i.decode(t[s],{stream:!(i&&s==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,r=this.i,i=this.v,s=this.B,o=this.l,l=this.S,r.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+l+"]: "+i+"\n"+s+"\n"+p+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var r,i,s,o,l,u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(u)){var h=u;break t}}h=null}if(e=h)ev(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,eG(this,e);else{this.o=!1,this.m=3,ef(12),eB(this),eq(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;)if((t=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?ej:isNaN(n=Number(t.substring(n,r)))?eC:(r+=1)+n>t.length?ej:(t=t.slice(r,r+n),e.C=r+n,t)}(this,n))==ej){4==p&&(this.m=4,ef(14),e=!1),ev(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eC){this.m=4,ef(15),ev(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}else ev(this.i,this.l,t,null),eG(this,t);if(eU(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=p||0!=n.length||this.h.h||(this.m=1,ef(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.aa&&!d.P&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),tq(d),d.P=!0,ef(11))}}else ev(this.i,this.l,n,"[Invalid Chunked Response]"),eB(this),eq(this)}else ev(this.i,this.l,n,null),eG(this,n);4==p&&eB(this),this.o&&!this.K&&(4==p?tz(this.j,this):(this.o=!1,eL(this)))}else(function(e){let t={};e=(e.g&&tN(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(C(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,ef(12)):(this.m=0,ef(13)),eB(this),eq(this)}}}catch(e){}finally{}},e_.prototype.cancel=function(){this.K=!0,eB(this)},e_.prototype.aa=function(){var e,t;this.D=null;let n=Date.now();n-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(ed(),ef(17)),eB(this),this.m=2,eq(this)):eF(this,this.T-n)};var ez=class{constructor(e,t){this.g=e,this.map=t}};function eH(e){this.l=e||10,e=a.PerformanceNavigationTiming?(e=a.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function e$(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eK(e){return e.h?1:e.g?e.g.size:0}function eW(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eJ(e,t){e.g?e.g.add(t):e.h=t}function eY(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eX(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.G);return t}return p(e.i)}eH.prototype.cancel=function(){if(this.i=eX(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eQ=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eZ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eZ?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e5(this,tc(e.i)),this.m=e.m):e&&(t=String(e).match(eQ))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e3(t[2]||""),this.g=e3(t[3]||"",!0),e2(this,t[4]),this.h=e3(t[5]||"",!0),e5(this,t[6]||"",!0),this.m=e3(t[7]||"")):(this.l=!1,this.i=new ti(null,this.l))}function e0(e){return new eZ(e)}function e1(e,t,n){e.j=n?e3(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e5(e,t,n){var r,i;t instanceof ti?(e.i=t,r=e.i,(i=e.l)&&!r.j&&(ts(r),r.i=null,r.g.forEach(function(e,t){let n=t.toLowerCase();t!=n&&(ta(this,t),tu(this,n,e))},r)),r.j=i):(n||(t=e8(t,tn)),e.i=new ti(t,e.l))}function e6(e,t,n){e.i.set(t,n)}function e4(e){return e6(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e3(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e8(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,e7),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e7(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eZ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e8(t,e9,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e8(t,e9,!0),"@"),e.push(eE(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(e8(n,"/"==n.charAt(0)?tt:te,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",e8(n,tr)),e.join("")},eZ.prototype.resolve=function(e){let t=e0(this),n=!!e.j;n?e1(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var r=e.h;if(n)e2(t,e.u);else if(n=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var i=t.h.lastIndexOf("/");-1!=i&&(r=t.h.slice(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let n=i[t++];"."==n?r&&t==i.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==i.length&&e.push("")):(e.push(n),r=!0)}r=e.join("/")}else r=i}return n?t.h=r:n=""!==e.i.toString(),n?e5(t,tc(e.i)):n=!!e.m,n&&(t.m=e.m),t};var e9=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tn=/[#\?@]/g,tr=/#/g;function ti(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ts(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){let r=e[n].indexOf("="),i,s=null;r>=0?(i=e[n].substring(0,r),s=e[n].substring(r+1)):i=e[n],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function ta(e,t){ts(e),t=th(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function to(e,t){return ts(e),t=th(e,t),e.g.has(t)}function tl(e,t){ts(e);let n=[];if("string"==typeof t)to(e,t)&&(n=n.concat(e.g.get(th(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function tu(e,t,n){ta(e,t),n.length>0&&(e.i=null,e.g.set(th(e,t),p(n)),e.h+=n.length)}function tc(e){let t=new ti;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function th(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function td(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tp(){this.g=new en}function tf(e){this.i=e.Sb||null,this.h=e.ab||!1}function tm(e,t){K.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tg(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function ty(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tv(e)}function tv(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tb(e){let t="";return O(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tx(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tb(n),"string"==typeof e?null!=n&&eE(n):e6(e,t,n))}function tw(e){K.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ti.prototype).add=function(e,t){ts(this),this.i=null,e=th(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},t.forEach=function(e,t){ts(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},t.set=function(e,t){return ts(this),this.i=null,to(this,e=th(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tl(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];let i=eE(n);n=tl(this,n);for(let t=0;t<n.length;t++){let r=i;""!==n[t]&&(r+="="+eE(n[t])),e.push(r)}}return this.i=e.join("&")},h(tf,er),tf.prototype.g=function(){return new tm(this.i,this.h)},h(tm,K),(t=tm.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tv(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||a).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,ty(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tv(this)),this.g&&(this.readyState=3,tv(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tg(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ty(this):tv(this),3==this.readyState&&tg(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,ty(this))},t.Na=function(e){this.g&&(this.response=e,ty(this))},t.ga=function(){this.g&&ty(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tm.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(tw,K);var tE=/^https?$/i,t_=["POST","PUT"];function tI(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tC(e),tS(e)}function tC(e){e.A||(e.A=!0,W(e,"complete"),W(e,"error"))}function tT(e){if(e.h&&void 0!==s){if(e.v&&4==tN(e))setTimeout(e.Ca.bind(e),0);else if(W(e,"readystatechange"),4==tN(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===s){let t=String(e.D).match(eQ)[1]||null;!t&&a.self&&a.self.location&&(t=a.self.location.protocol.slice(0,-1)),n=!tE.test(t?t.toLowerCase():"")}t=n}if(t)W(e,"complete"),W(e,"success");else{e.o=6;try{var i=tN(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tC(e)}}finally{tS(e)}}}}function tS(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let n=e.g;e.g=null,t||W(e,"ready");try{n.onreadystatechange=null}catch(e){}}}function tN(e){return e.g?e.g.readyState:0}function tA(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tk(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tO(e){this.za=0,this.i=[],this.j=new ey,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tk("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tk("baseRetryDelayMs",5e3,e),this.Za=tk("retryDelaySeedMs",1e4,e),this.Ta=tk("forwardChannelMaxRetries",2,e),this.va=tk("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eH(e&&e.concurrentRequestLimit),this.Ba=new tp,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tR(e){if(tj(e),3==e.I){var t=e.V++,n=e0(e.J);if(e6(n,"SID",e.M),e6(n,"RID",t),e6(n,"TYPE","terminate"),tU(e,n),(t=new e_(e,e.j,t)).M=2,t.A=e4(e0(n)),n=!1,a.navigator&&a.navigator.sendBeacon)try{n=a.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&a.Image&&((new Image).src=t.A,n=!0),n||(t.g=tJ(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eL(t)}tK(e)}function tD(e){e.g&&(tq(e),e.g.cancel(),e.g=null)}function tj(e){tD(e),e.v&&(a.clearTimeout(e.v),e.v=null),tG(e),e.h.cancel(),e.m&&("number"==typeof e.m&&a.clearTimeout(e.m),e.m=null)}function tP(e){if(!e$(e.h)&&!e.m){e.m=!0;var t=e.Ea;y||x(),v||(y(),v=!0),b.add(t,e),e.D=0}}function tM(e,t){var n;n=t?t.l:e.V++;let r=e0(e.J);e6(r,"SID",e.M),e6(r,"RID",n),e6(r,"AID",e.K),tU(e,r),e.u&&e.o&&tx(r,e.u,e.o),n=new e_(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tL(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eJ(e.h,n),eP(n,r,t)}function tU(e,t){e.H&&O(e.H,function(e,n){e6(t,n,e)}),e.l&&O({},function(e,n){e6(t,n,e)})}function tL(e,t,n){n=Math.min(e.i.length,n);let r=e.l?u(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?n>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let u=0;u<n;u++){var s=i[u].g;let n=i[u].map;if((s-=t)<0)t=Math.max(0,i[u].g-100),l=!1;else try{s="req"+s+"_";try{var a=n instanceof Map?n:Object.entries(n);for(let[t,n]of a){let r=n;o(n)&&(r=ee(n)),e.push(s+t+"="+encodeURIComponent(r))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){r&&r(n)}}if(l){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,n),a}function tF(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;y||x(),v||(y(),v=!0),b.add(t,e),e.A=0}}function tV(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eg(u(e.Da,e),tH(e,e.A)),e.A++,!0)}function tq(e){null!=e.B&&(a.clearTimeout(e.B),e.B=null)}function tB(e){e.g=new e_(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e6(t,"RID","rpc"),e6(t,"SID",e.M),e6(t,"AID",e.K),e6(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e6(t,"TO",e.ia),e6(t,"TYPE","xmlhttp"),tU(e,t),e.u&&e.o&&tx(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=e4(e0(t)),n.u=null,n.R=!0,eM(n,e)}function tG(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function tz(e,t){var n,r=null;if(e.g==t){tG(e),tq(e),e.g=null;var i=2}else{if(!eW(e.h,t))return;r=t.G,eY(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){r=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;W(i=ec(),new em(i,r)),tP(e)}else tF(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(n=t,!(eK(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=n.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eg(u(e.Ea,e,n),tH(e,e.D)),e.D++,!0)))||2==i&&tV(e)))switch(r&&r.length>0&&((t=e.h).i=t.i.concat(r)),s){case 1:t$(e,5);break;case 4:t$(e,10);break;case 3:t$(e,6);break;default:t$(e,2)}}}function tH(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function t$(e,t){if(e.j.info("Error code "+t),2==t){let t,s,o;var n,r=u(e.bb,e),i=e.Ua;let l=!i;i=new eZ(i||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||e1(i,"https"),e4(i),l?function(e,t){let n=new ey;if(a.Image){let r=new Image;r.onload=c(td,n,"TestLoadImage: loaded",!0,t,r),r.onerror=c(td,n,"TestLoadImage: error",!1,t,r),r.onabort=c(td,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=c(td,n,"TestLoadImage: timeout",!1,t,r),a.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(i.toString(),r):(n=i.toString(),t=new ey,s=new AbortController,o=setTimeout(()=>{s.abort(),td(t,"TestPingServer: timeout",!1,r)},1e4),fetch(n,{signal:s.signal}).then(e=>{clearTimeout(o),e.ok?td(t,"TestPingServer: ok",!0,r):td(t,"TestPingServer: server error",!1,r)}).catch(()=>{clearTimeout(o),td(t,"TestPingServer: error",!1,r)}))}else ef(2);e.I=0,e.l&&e.l.pa(t),tK(e),tj(e)}function tK(e){if(e.I=0,e.ja=[],e.l){let t=eX(e.h);(0!=t.length||0!=e.i.length)&&(f(e.ja,t),f(e.ja,e.i),e.h.i.length=0,p(e.i),e.i.length=0),e.l.oa()}}function tW(e,t,n){var r=n instanceof eZ?e0(n):new eZ(n);if(""!=r.g)t&&(r.g=t+"."+r.g),e2(r,r.u);else{var i=a.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new eZ(null);r&&e1(e,r),t&&(e.g=t),i&&e2(e,i),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&e6(r,n,t),e6(r,"VER",e.ka),tU(e,r),r}function tJ(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tw(e.Aa&&!e.ma?new tf({ab:n}):e.ma)).Fa(e.L),t}function tY(){}function tX(){}function tQ(e,t){K.call(this),this.g=new tO(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!C(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!C(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t1(this)}function tZ(e){ea.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t0(){eo.call(this),this.status=1}function t1(e){this.g=e}(t=tw.prototype).Fa=function(e){this.H=e},t.ea=function(t,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);n=n?n.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=d(u(this.Ca,this));try{this.B=!0,this.g.open(n,String(t),!0),this.B=!1}catch(e){tI(this,e);return}if(t=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,o]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&t instanceof a.FormData,!(Array.prototype.indexOf.call(t_,n,void 0)>=0)||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(e,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tI(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,W(this,"complete"),W(this,"abort"),tS(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tS(this,!0)),tw.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tT(this):this.Xa())},t.Xa=function(){tT(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tN(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),et(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tO.prototype).ka=8,t.I=1,t.connect=function(e,t,n,r){ef(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=tW(this,null,this.W),tP(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new e_(this,this.j,e),s=this.o;if(this.U&&(s?j(s=R(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if((t+=r)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tL(this,i,t),e6(n=e0(this.J),"RID",e),e6(n,"CVER",22),this.G&&e6(n,"X-HTTP-Session-Id",this.G),tU(this,n),s&&(this.R?t="headers="+eE(tb(s))+"&"+t:this.u&&tx(n,this.u,s)),eJ(this.h,i),this.Ra&&e6(n,"TYPE","init"),this.S?(e6(n,"$req",t),e6(n,"SID","null"),i.U=!0,eP(i,n,null)):eP(i,n,t),this.I=2}}else 3==this.I&&(e?tM(this,e):0==this.i.length||e$(this.h)||tM(this))},t.Da=function(){if(this.v=null,tB(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eg(u(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,ef(10),tD(this),tB(this))},t.Va=function(){null!=this.C&&(this.C=null,tD(this),tV(this),ef(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),ef(2)):(this.j.info("Failed to ping google.com"),ef(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tY.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tX.prototype.g=function(e,t){return new tQ(e,t)},h(tQ,K),tQ.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},tQ.prototype.close=function(){tR(this.g)},tQ.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=ee(e),e=n);t.i.push(new ez(t.Ya++,e)),3==t.I&&tP(t)},tQ.prototype.N=function(){this.g.l=null,delete this.j,tR(this.g),delete this.g,tQ.Z.N.call(this)},h(tZ,ea),h(t0,eo),h(t1,tY),t1.prototype.ra=function(){W(this.g,"a")},t1.prototype.qa=function(e){W(this.g,new tZ(e))},t1.prototype.pa=function(e){W(this.g,new t0)},t1.prototype.oa=function(){W(this.g,"b")},tX.prototype.createWebChannel=tX.prototype.g,tQ.prototype.send=tQ.prototype.o,tQ.prototype.open=tQ.prototype.m,tQ.prototype.close=tQ.prototype.close,eD=rS.createWebChannelTransport=function(){return new tX},eR=rS.getStatEventTarget=function(){return ec()},eO=rS.Event=el,ek=rS.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eb.NO_ERROR=0,eb.TIMEOUT=8,eb.HTTP_ERROR=6,eA=rS.ErrorCode=eb,ex.COMPLETE="complete",eN=rS.EventType=ex,ei.EventType=es,es.OPEN="a",es.CLOSE="b",es.ERROR="c",es.MESSAGE="d",K.prototype.listen=K.prototype.J,eS=rS.WebChannel=ei,rS.FetchXmlHttpFactory=tf,tw.prototype.listenOnce=tw.prototype.K,tw.prototype.getLastError=tw.prototype.Ha,tw.prototype.getLastErrorCode=tw.prototype.ya,tw.prototype.getStatus=tw.prototype.ca,tw.prototype.getResponseJson=tw.prototype.La,tw.prototype.getResponseText=tw.prototype.la,tw.prototype.send=tw.prototype.ea,tw.prototype.setWithCredentials=tw.prototype.Fa,eT=rS.XhrIo=tw}).apply(void 0!==rT?rT:"u">typeof self?self:"u">typeof window?window:{});let rN="@firebase/firestore",rA="4.9.2";class rk{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}rk.UNAUTHENTICATED=new rk(null),rk.GOOGLE_CREDENTIALS=new rk("google-credentials-uid"),rk.FIRST_PARTY=new rk("first-party-uid"),rk.MOCK_USER=new rk("mock-user");let rO="12.3.0",rR=new nj("@firebase/firestore");function rD(){return rR.logLevel}function rj(e,...t){if(rR.logLevel<=e_.DEBUG){let n=t.map(rU);rR.debug(`Firestore (${rO}): ${e}`,...n)}}function rP(e,...t){if(rR.logLevel<=e_.ERROR){let n=t.map(rU);rR.error(`Firestore (${rO}): ${e}`,...n)}}function rM(e,...t){if(rR.logLevel<=e_.WARN){let n=t.map(rU);rR.warn(`Firestore (${rO}): ${e}`,...n)}}function rU(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function rL(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,rF(e,r,n)}function rF(e,t,n){let r=`FIRESTORE (${rO}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw rP(r),Error(r)}function rV(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||rF(t,i,r)}let rq={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class rB extends nf{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class rG{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class rz{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class rH{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(rk.UNAUTHENTICATED))}shutdown(){}}class r${constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class rK{constructor(e){this.t=e,this.currentUser=rk.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){rV(void 0===this.o,42304);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new rG;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new rG,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{rj("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(rj("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new rG)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(rj("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(rV("string"==typeof t.accessToken,31837,{l:t}),new rz(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return rV(null===e||"string"==typeof e,2055,{h:e}),new rk(e)}}class rW{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=rk.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class rJ{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new rW(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(rk.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class rY{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rX{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,n9(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){rV(void 0===this.o,3512);let n=e=>{null!=e.error&&rj("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,rj("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{rj("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):rj("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new rY(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(rV("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new rY(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class rQ{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="u">typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function rZ(e,t){return e<t?-1:+(e>t)}function r0(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.charAt(r),i=t.charAt(r);if(n!==i)return r1(n)===r1(i)?rZ(n,i):r1(n)?1:-1}return rZ(e.length,t.length)}function r1(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function r2(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}let r5="__name__";class r6{constructor(e,t,n){void 0===t?t=0:t>e.length&&rL(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&rL(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===r6.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof r6?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=r6.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return rZ(e.length,t.length)}static compareSegments(e,t){let n=r6.isNumericId(e),r=r6.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?r6.extractNumericId(e).compare(r6.extractNumericId(t)):r0(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return eI.fromString(e.substring(4,e.length-2))}}class r4 extends r6{construct(e,t,n){return new r4(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new rB(rq.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new r4(t)}static emptyPath(){return new r4([])}}let r3=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class r8 extends r6{construct(e,t,n){return new r8(e,t,n)}static isValidIdentifier(e){return r3.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r8.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===r5}static keyField(){return new r8([r5])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new rB(rq.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new rB(rq.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new rB(rq.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new rB(rq.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new r8(t)}static emptyPath(){return new r8([])}}class r7{constructor(e){this.path=e}static fromPath(e){return new r7(r4.fromString(e))}static fromName(e){return new r7(r4.fromString(e).popFirst(5))}static empty(){return new r7(r4.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===r4.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return r4.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new r7(new r4(e.slice()))}}function r9(e,t,n){if(!n)throw new rB(rq.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function ie(e){if(!r7.isDocumentKey(e))throw new rB(rq.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function it(e){if(r7.isDocumentKey(e))throw new rB(rq.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function ir(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function ii(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":rL(12329,{type:typeof e})}function is(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new rB(rq.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=ii(e);throw new rB(rq.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function ia(e,t){let n={typeString:e};return t&&(n.value=t),n}function io(e,t){let n;if(!ir(e))throw new rB(rq.INVALID_ARGUMENT,"JSON must be an object");for(let r in t)if(t[r]){let i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}let a=e[r];if(i&&typeof a!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new rB(rq.INVALID_ARGUMENT,n);return!0}class il{static now(){return il.fromMillis(Date.now())}static fromDate(e){return il.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new il(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new rB(rq.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new rB(rq.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?rZ(this.nanoseconds,e.nanoseconds):rZ(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:il._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(io(e,il._jsonSchema))return new il(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}il._jsonSchemaVersion="firestore/timestamp/1.0",il._jsonSchema={type:ia("string",il._jsonSchemaVersion),seconds:ia("number"),nanoseconds:ia("number")};class iu{static fromTimestamp(e){return new iu(e)}static min(){return new iu(new il(0,0))}static max(){return new iu(new il(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ic{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ic(iu.min(),r7.empty(),-1)}static max(){return new ic(iu.max(),r7.empty(),-1)}}class ih{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function id(e){if(e.code!==rq.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;rj("LocalStore","Unexpectedly lost primary lease")}class ip{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&rL(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ip((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof ip?t:ip.resolve(t)}catch(e){return ip.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ip.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ip.reject(t)}static resolve(e){return new ip((t,n)=>{t(e)})}static reject(e){return new ip((t,n)=>{n(e)})}static waitFor(e){return new ip((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=ip.resolve(!1);for(let n of e)t=t.next(e=>e?ip.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new ip((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new ip((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}function im(e){return"IndexedDbTransactionError"===e.name}class ig{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}ig.ce=-1;function iy(e){return 0===e&&1/e==-1/0}function iv(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ib(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ix(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class iw{constructor(e,t){this.comparator=e,this.root=t||i_.EMPTY}insert(e,t){return new iw(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,i_.BLACK,null,null))}remove(e){return new iw(this.comparator,this.root.remove(e,this.comparator).copy(null,null,i_.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new iE(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new iE(this.root,e,this.comparator,!1)}getReverseIterator(){return new iE(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new iE(this.root,e,this.comparator,!0)}}class iE{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class i_{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:i_.RED,this.left=null!=r?r:i_.EMPTY,this.right=null!=i?i:i_.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new i_(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return i_.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return i_.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,i_.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,i_.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw rL(43730,{key:this.key,value:this.value});if(this.right.isRed())throw rL(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw rL(27949);return e+ +!this.isRed()}}i_.EMPTY=null,i_.RED=!0,i_.BLACK=!1,i_.EMPTY=new class{constructor(){this.size=0}get key(){throw rL(57766)}get value(){throw rL(16141)}get color(){throw rL(16727)}get left(){throw rL(29726)}get right(){throw rL(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new i_(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class iI{constructor(e){this.comparator=e,this.data=new iw(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new iC(this.data.getIterator())}getIteratorFrom(e){return new iC(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof iI)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new iI(this.comparator);return t.data=e,t}}class iC{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class iT{constructor(e){this.fields=e,e.sort(r8.comparator)}static empty(){return new iT([])}unionWith(e){let t=new iI(r8.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new iT(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return r2(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class iS extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class iN{constructor(e){this.binaryString=e}static fromBase64String(e){return new iN(function(e){try{return atob(e)}catch(e){throw"u">typeof DOMException&&e instanceof DOMException?new iS("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new iN(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return rZ(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}iN.EMPTY_BYTE_STRING=new iN("");let iA=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ik(e){if(rV(!!e,39018),"string"==typeof e){let t=0,n=iA.exec(e);if(rV(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:iO(e.seconds),nanos:iO(e.nanos)}}function iO(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function iR(e){return"string"==typeof e?iN.fromBase64String(e):iN.fromUint8Array(e)}let iD="server_timestamp",ij="__type__",iP="__previous_value__",iM="__local_write_time__";function iU(e){return(e?.mapValue?.fields||{})[ij]?.stringValue===iD}function iL(e){let t=e.mapValue.fields[iP];return iU(t)?iL(t):t}function iF(e){let t=ik(e.mapValue.fields[iM].timestampValue);return new il(t.seconds,t.nanos)}class iV{constructor(e,t,n,r,i,s,a,o,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u}}let iq="(default)";class iB{constructor(e,t){this.projectId=e,this.database=t||iq}static empty(){return new iB("","")}get isDefaultDatabase(){return this.database===iq}isEqual(e){return e instanceof iB&&e.projectId===this.projectId&&e.database===this.database}}let iG="__type__",iz="__max__",iH={},i$="__vector__",iK="value";function iW(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?iU(e)?4:i9(e)?0x1fffffffffffff:i8(e)?10:11:rL(28295,{value:e})}function iJ(e,t){if(e===t)return!0;let n=iW(e);if(n!==iW(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return iF(e).isEqual(iF(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=ik(e.timestampValue),i=ik(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return iR(e.bytesValue).isEqual(iR(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return iO(e.geoPointValue.latitude)===iO(t.geoPointValue.latitude)&&iO(e.geoPointValue.longitude)===iO(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return iO(e.integerValue)===iO(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=iO(e.doubleValue),r=iO(t.doubleValue);return n===r?iy(n)===iy(r):isNaN(n)&&isNaN(r)}return!1;case 9:return r2(e.arrayValue.values||[],t.arrayValue.values||[],iJ);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(iv(s)!==iv(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!iJ(s[e],a[e])))return!1;return!0;default:return rL(52216,{left:e})}}function iY(e,t){return void 0!==(e.values||[]).find(e=>iJ(e,t))}function iX(e,t){var n,r,i,s,a,o;if(e===t)return 0;let l=iW(e),u=iW(t);if(l!==u)return rZ(l,u);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return rZ(e.booleanValue,t.booleanValue);case 2:let c,h;return c=iO(e.integerValue||e.doubleValue),c<(h=iO(t.integerValue||t.doubleValue))?-1:c>h?1:c===h?0:isNaN(c)?isNaN(h)?0:-1:1;case 3:return iQ(e.timestampValue,t.timestampValue);case 4:return iQ(iF(e),iF(t));case 5:return r0(e.stringValue,t.stringValue);case 6:let d,p;return n=e.bytesValue,r=t.bytesValue,d=iR(n),p=iR(r),d.compareTo(p);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=rZ(n[e],r[e]);if(0!==t)return t}return rZ(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:let f;return i=e.geoPointValue,s=t.geoPointValue,0!==(f=rZ(iO(i.latitude),iO(s.latitude)))?f:rZ(iO(i.longitude),iO(s.longitude));case 9:return iZ(e.arrayValue,t.arrayValue);case 10:let m,g,y,v,b;return a=e.mapValue,o=t.mapValue,m=a.fields||{},g=o.fields||{},y=m[iK]?.arrayValue,v=g[iK]?.arrayValue,0!==(b=rZ(y?.values?.length||0,v?.values?.length||0))?b:iZ(y,v);case 11:return function(e,t){if(e===iH&&t===iH)return 0;if(e===iH)return 1;if(t===iH)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=r0(r[e],s[e]);if(0!==t)return t;let a=iX(n[r[e]],i[s[e]]);if(0!==a)return a}return rZ(r.length,s.length)}(e.mapValue,t.mapValue);default:throw rL(23264,{he:l})}}function iQ(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return rZ(e,t);let n=ik(e),r=ik(t),i=rZ(n.seconds,r.seconds);return 0!==i?i:rZ(n.nanos,r.nanos)}function iZ(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=iX(n[e],r[e]);if(t)return t}return rZ(n.length,r.length)}function i0(e){var t,n;let r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(r=ik(e.timestampValue),`time(${r.seconds},${r.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?iR(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,r7.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=i0(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${i0(e.fields[i])}`;return n+"}"}(e.mapValue):rL(61005,{value:e})}function i1(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function i2(e){return!!e&&"integerValue"in e}function i5(e){return!!e&&"arrayValue"in e}function i6(e){return!!e&&"nullValue"in e}function i4(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function i3(e){return!!e&&"mapValue"in e}function i8(e){return(e?.mapValue?.fields||{})[iG]?.stringValue===i$}function i7(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return ib(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=i7(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=i7(e.arrayValue.values[n]);return t}return{...e}}function i9(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===iz}class se{constructor(e){this.value=e}static empty(){return new se({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!i3(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=i7(t)}setAll(e){let t=r8.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=i7(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());i3(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return iJ(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];i3(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(ib(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new se(i7(this.value))}}class st{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new st(e,0,iu.min(),iu.min(),iu.min(),se.empty(),0)}static newFoundDocument(e,t,n,r){return new st(e,1,t,iu.min(),n,r,0)}static newNoDocument(e,t){return new st(e,2,t,iu.min(),iu.min(),se.empty(),0)}static newUnknownDocument(e,t){return new st(e,3,t,iu.min(),iu.min(),se.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(iu.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=se.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=se.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=iu.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof st&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new st(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class sn{constructor(e,t){this.position=e,this.inclusive=t}}function sr(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?r7.comparator(r7.fromName(a.referenceValue),n.key):iX(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function si(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!iJ(e.position[n],t.position[n]))return!1;return!0}class ss{constructor(e,t="asc"){this.field=e,this.dir=t}}class sa{}class so extends sa{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new sh(e,t,n):"array-contains"===t?new sm(e,n):"in"===t?new sg(e,n):"not-in"===t?new sy(e,n):"array-contains-any"===t?new sv(e,n):new so(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new sd(e,n):new sp(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(iX(t,this.value)):null!==t&&iW(this.value)===iW(t)&&this.matchesComparison(iX(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return rL(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class sl extends sa{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new sl(e,t)}matches(e){return su(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function su(e){return"and"===e.op}function sc(e){for(let t of e.filters)if(t instanceof sl)return!1;return!0}class sh extends so{constructor(e,t,n){super(e,t,n),this.key=r7.fromName(n.referenceValue)}matches(e){let t=r7.comparator(e.key,this.key);return this.matchesComparison(t)}}class sd extends so{constructor(e,t){super(e,"in",t),this.keys=sf("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class sp extends so{constructor(e,t){super(e,"not-in",t),this.keys=sf("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function sf(e,t){return(t.arrayValue?.values||[]).map(e=>r7.fromName(e.referenceValue))}class sm extends so{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return i5(t)&&iY(t.arrayValue,this.value)}}class sg extends so{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&iY(this.value.arrayValue,t)}}class sy extends so{constructor(e,t){super(e,"not-in",t)}matches(e){if(iY(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!iY(this.value.arrayValue,t)}}class sv extends so{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!i5(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>iY(this.value.arrayValue,e))}}class sb{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function sx(e,t=null,n=[],r=[],i=null,s=null,a=null){return new sb(e,t,n,r,i,s,a)}function sw(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof so)return t.field.canonicalString()+t.op.toString()+i0(t.value);if(sc(t)&&su(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>i0(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>i0(e)).join(",")),e.Te=t}return e.Te}function sE(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof so?n instanceof so&&t.op===n.op&&t.field.isEqual(n.field)&&iJ(t.value,n.value):t instanceof sl?n instanceof sl&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void rL(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!si(e.startAt,t.startAt)&&si(e.endAt,t.endAt)}function s_(e){return r7.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class sI{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function sC(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function sT(e){return null!==e.collectionGroup}function sS(e){if(null===e.Ie){let t;e.Ie=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new iI(r8.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new ss(t,r))}),n.has(r8.keyField().canonicalString())||e.Ie.push(new ss(r8.keyField(),r))}return e.Ie}function sN(e){return e.Ee||(e.Ee=function(e,t){if("F"===e.limitType)return sx(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new ss(e.field,t)});let n=e.endAt?new sn(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new sn(e.startAt.position,e.startAt.inclusive):null;return sx(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(e,sS(e))),e.Ee}function sA(e,t){let n=e.filters.concat([t]);return new sI(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function sk(e,t,n){return new sI(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function sO(e,t){return sE(sN(e),sN(t))&&e.limitType===t.limitType}function sR(e){return`${sw(sN(e))}|lt:${e.limitType}`}function sD(e){var t;let n;return`Query(target=${n=(t=sN(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof so?`${t.field.canonicalString()} ${t.op} ${i0(t.value)}`:t instanceof sl?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>i0(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>i0(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function sj(e,t){var n,r,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):r7.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let n of sS(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(n=e,r=t,(!n.startAt||(i=n.startAt,o=sr(i,sS(n),r),i.inclusive?!!(o<=0):!!(o<0)))&&(!n.endAt||(s=n.endAt,l=sr(s,sS(n),r),s.inclusive?!!(l>=0):!!(l>0))))}function sP(e){return(t,n)=>{let r=!1;for(let i of sS(e)){let e=function(e,t,n){var r;let i,s,a=e.field.isKeyField()?r7.comparator(t.key,n.key):(r=e.field,i=t.data.field(r),s=n.data.field(r),null!==i&&null!==s?iX(i,s):rL(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return rL(19790,{direction:e.dir})}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class sM{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ib(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return ix(this.inner)}size(){return this.innerSize}}let sU=new iw(r7.comparator),sL=new iw(r7.comparator);function sF(...e){let t=sL;for(let n of e)t=t.insert(n.key,n);return t}function sV(e){let t=sL;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function sq(){return new sM(e=>e.toString(),(e,t)=>e.isEqual(t))}let sB=new iw(r7.comparator),sG=new iI(r7.comparator);function sz(...e){let t=sG;for(let n of e)t=t.add(n);return t}let sH=new iI(rZ);function s$(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:iy(t)?"-0":t}}function sK(e){return{integerValue:""+e}}class sW{constructor(){this._=void 0}}function sJ(e,t){return e instanceof s1?i2(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class sY extends sW{}class sX extends sW{constructor(e){super(),this.elements=e}}function sQ(e,t){let n=s5(t);for(let t of e.elements)n.some(e=>iJ(e,t))||n.push(t);return{arrayValue:{values:n}}}class sZ extends sW{constructor(e){super(),this.elements=e}}function s0(e,t){let n=s5(t);for(let t of e.elements)n=n.filter(e=>!iJ(e,t));return{arrayValue:{values:n}}}class s1 extends sW{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function s2(e){return iO(e.integerValue||e.doubleValue)}function s5(e){return i5(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class s6{constructor(e,t){this.version=e,this.transformResults=t}}class s4{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new s4}static exists(e){return new s4(void 0,e)}static updateTime(e){return new s4(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function s3(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class s8{}function s7(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new aa(e.key,s4.none()):new at(e.key,e.data,s4.none());{let n=e.data,r=se.empty(),i=new iI(r8.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new an(e.key,r,new iT(i.toArray()),s4.none())}}function s9(e,t,n,r){return e instanceof at?function(e,t,n,r){if(!s3(e.precondition,t))return n;let i=e.value.clone(),s=as(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof an?function(e,t,n,r){if(!s3(e.precondition,t))return n;let i=as(e.fieldTransforms,r,t),s=t.data;return(s.setAll(ar(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):s3(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function ae(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&r2(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof sX&&r instanceof sX||n instanceof sZ&&r instanceof sZ?r2(n.elements,r.elements,iJ):n instanceof s1&&r instanceof s1?iJ(n.Ae,r.Ae):n instanceof sY&&r instanceof sY)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class at extends s8{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class an extends s8{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ar(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function ai(e,t,n){let r=new Map;rV(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let s=0;s<n.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);r.set(a.field,(i=n[s],o instanceof sX?sQ(o,l):o instanceof sZ?s0(o,l):i))}return r}function as(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,function(e,t,n){var r;let i,s,a;return e instanceof sY?(r=t,i={fields:{[ij]:{stringValue:iD},[iM]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},r&&iU(r)&&(r=iL(r)),r&&(i.fields[iP]=r),{mapValue:i}):e instanceof sX?sQ(e,t):e instanceof sZ?s0(e,t):(a=s2(s=sJ(e,t))+s2(e.Ae),i2(s)&&i2(e.Ae)?sK(a):s$(e.serializer,a))}(e,s,t))}return r}class aa extends s8{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ao extends s8{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class al{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){let r,i;e instanceof at?(r=e.value.clone(),i=ai(e.fieldTransforms,t,n.transformResults),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()):e instanceof an?function(e,t,n){if(!s3(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=ai(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(ar(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=s9(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=s9(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=sq();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=s7(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(iu.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),sz())}isEqual(e){return this.batchId===e.batchId&&r2(this.mutations,e.mutations,(e,t)=>ae(e,t))&&r2(this.baseMutations,e.baseMutations,(e,t)=>ae(e,t))}}class au{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){rV(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=sB,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new au(e,t,n,r)}}class ac{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ah{constructor(e,t){this.count=e,this.unchangedNames=t}}function ad(e){if(void 0===e)return rP("GRPC error has no .code"),rq.UNKNOWN;switch(e){case ej.OK:return rq.OK;case ej.CANCELLED:return rq.CANCELLED;case ej.UNKNOWN:return rq.UNKNOWN;case ej.DEADLINE_EXCEEDED:return rq.DEADLINE_EXCEEDED;case ej.RESOURCE_EXHAUSTED:return rq.RESOURCE_EXHAUSTED;case ej.INTERNAL:return rq.INTERNAL;case ej.UNAVAILABLE:return rq.UNAVAILABLE;case ej.UNAUTHENTICATED:return rq.UNAUTHENTICATED;case ej.INVALID_ARGUMENT:return rq.INVALID_ARGUMENT;case ej.NOT_FOUND:return rq.NOT_FOUND;case ej.ALREADY_EXISTS:return rq.ALREADY_EXISTS;case ej.PERMISSION_DENIED:return rq.PERMISSION_DENIED;case ej.FAILED_PRECONDITION:return rq.FAILED_PRECONDITION;case ej.ABORTED:return rq.ABORTED;case ej.OUT_OF_RANGE:return rq.OUT_OF_RANGE;case ej.UNIMPLEMENTED:return rq.UNIMPLEMENTED;case ej.DATA_LOSS:return rq.DATA_LOSS;default:return rL(39323,{code:e})}}(eP=ej||(ej={}))[eP.OK=0]="OK",eP[eP.CANCELLED=1]="CANCELLED",eP[eP.UNKNOWN=2]="UNKNOWN",eP[eP.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",eP[eP.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",eP[eP.NOT_FOUND=5]="NOT_FOUND",eP[eP.ALREADY_EXISTS=6]="ALREADY_EXISTS",eP[eP.PERMISSION_DENIED=7]="PERMISSION_DENIED",eP[eP.UNAUTHENTICATED=16]="UNAUTHENTICATED",eP[eP.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",eP[eP.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",eP[eP.ABORTED=10]="ABORTED",eP[eP.OUT_OF_RANGE=11]="OUT_OF_RANGE",eP[eP.UNIMPLEMENTED=12]="UNIMPLEMENTED",eP[eP.INTERNAL=13]="INTERNAL",eP[eP.UNAVAILABLE=14]="UNAVAILABLE",eP[eP.DATA_LOSS=15]="DATA_LOSS";let ap=new eI([0xffffffff,0xffffffff],0);function af(e){let t=(new TextEncoder).encode(e),n=new eC;return n.update(t),new Uint8Array(n.digest())}function am(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new eI([n,r],0),new eI([i,s],0)]}class ag{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ay(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new ay(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new ay(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=eI.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(eI.fromNumber(n)));return 1===r.compare(ap)&&(r=new eI([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,n]=am(af(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);if(!this.we(r))return!1}return!0}static create(e,t,n){let r=new ag(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.ge)return;let[t,n]=am(af(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);this.Se(r)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class ay extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class av{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,ab.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new av(iu.min(),r,new iw(rZ),sU,sz())}}class ab{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ab(n,t,sz(),sz(),sz())}}class ax{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}}class aw{constructor(e,t){this.targetId=e,this.Ce=t}}class aE{constructor(e,t,n=iN.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class a_{constructor(){this.ve=0,this.Fe=aT(),this.Me=iN.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=sz(),t=sz(),n=sz();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:rL(38017,{changeType:i})}}),new ab(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=aT()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,rV(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class aI{constructor(e){this.Ge=e,this.ze=new Map,this.je=sU,this.Je=aC(),this.He=aC(),this.Ye=new iw(rZ)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:rL(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){let t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){let i=r.target;if(s_(i))if(0===n){let e=new r7(i.path);this.et(t,e,st.newNoDocument(e,iu.min()))}else rV(1===n,20013,{expectedCount:n});else{let r=this._t(t);if(r!==n){let n=this.ut(e),i=n?this.ct(n,e,r):1;0!==i&&(this.it(t),this.Ye=this.Ye.insert(t,2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}ut(e){let t,n,r=e.Ce.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=iR(i).toUint8Array()}catch(e){if(e instanceof iS)return rM("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new ag(t,s,a)}catch(e){return rM(e instanceof ay?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.ge?null:n}ct(e,t,n){return 2*(t.Ce.count!==n-this.Pt(e,t.targetId))}Pt(e,t){let n=this.Ge.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.et(t,n,null),r++)}),r}Tt(e){let t=new Map;this.ze.forEach((n,r)=>{let i=this.ot(r);if(i){if(n.current&&s_(i.target)){let t=new r7(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,st.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.qe())}});let n=sz();this.He.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));let r=new av(e,t,this.Ye,this.je,n);return this.je=sU,this.Je=aC(),this.He=aC(),this.Ye=new iw(rZ),r}Xe(e,t){if(!this.rt(e))return;let n=2*!!this.Et(e,t.key);this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;let r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new a_,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new iI(rZ),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new iI(rZ),this.Je=this.Je.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||rj("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new a_),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function aC(){return new iw(r7.comparator)}function aT(){return new iw(r7.comparator)}let aS={asc:"ASCENDING",desc:"DESCENDING"},aN={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},aA={and:"AND",or:"OR"};class ak{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function aO(e,t){return e.useProto3Json||null==t?t:{value:t}}function aR(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function aD(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function aj(e){let t;return rV(!!e,49232),iu.fromTimestamp(new il((t=ik(e)).seconds,t.nanos))}function aP(e,t){return aM(e,t).canonicalString()}function aM(e,t){let n=new r4(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function aU(e){let t=r4.fromString(e);return rV(a$(t),10190,{key:t.toString()}),t}function aL(e,t){return aP(e.databaseId,t.path)}function aF(e,t){let n=aU(t);if(n.get(1)!==e.databaseId.projectId)throw new rB(rq.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new rB(rq.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new r7(aB(n))}function aV(e,t){return aP(e.databaseId,t)}function aq(e){return new r4(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function aB(e){return rV(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function aG(e,t,n){return{name:aL(e,t),fields:n.value.mapValue.fields}}function az(e){return{fieldPath:e.canonicalString()}}function aH(e){return r8.fromServerFormat(e.fieldPath)}function a$(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class aK{constructor(e,t,n,r,i=iu.min(),s=iu.min(),a=iN.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new aK(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new aK(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new aK(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new aK(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class aW{constructor(e){this.yt=e}}class aJ{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(iO(e.integerValue));else if("doubleValue"in e){let n=iO(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),iy(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=ik(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(iR(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?i9(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):i8(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):rL(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let n=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(n)))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){let n=e.fields||{};this.Ft(t,53);let r=n[iK].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(iO(r)),this.Ot(iK,t),this.Ct(n[iK],t)}Qt(e,t){let n=e.values||[];for(let e of(this.Ft(t,50),n))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),r7.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}aJ.Kt=new aJ;class aY{constructor(){this.Cn=new aX}addToCollectionParentIndex(e,t){return this.Cn.add(t),ip.resolve()}getCollectionParents(e,t){return ip.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return ip.resolve()}deleteFieldIndex(e,t){return ip.resolve()}deleteAllFieldIndexes(e){return ip.resolve()}createTargetIndexes(e,t){return ip.resolve()}getDocumentsMatchingTarget(e,t){return ip.resolve(null)}getIndexType(e,t){return ip.resolve(0)}getFieldIndexes(e,t){return ip.resolve([])}getNextCollectionGroupToUpdate(e){return ip.resolve(null)}getMinOffset(e,t){return ip.resolve(ic.min())}getMinOffsetFromCollectionGroup(e,t){return ip.resolve(ic.min())}updateCollectionGroup(e,t,n){return ip.resolve()}updateIndexEntries(e,t){return ip.resolve()}}class aX{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new iI(r4.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new iI(r4.comparator)).toArray()}}new Uint8Array(0);let aQ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class aZ{static withCacheSize(e){return new aZ(e,aZ.DEFAULT_COLLECTION_PERCENTILE,aZ.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}aZ.DEFAULT_COLLECTION_PERCENTILE=10,aZ.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,aZ.DEFAULT=new aZ(0x2800000,aZ.DEFAULT_COLLECTION_PERCENTILE,aZ.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),aZ.DISABLED=new aZ(-1,0,0);class a0{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new a0(0)}static cr(){return new a0(-1)}}let a1="LruGarbageCollector";function a2([e,t],[n,r]){let i=rZ(e,n);return 0===i?rZ(t,r):i}class a5{constructor(e){this.Ir=e,this.buffer=new iI(a2),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>a2(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class a6{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){rj(a1,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){im(e)?rj(a1,"Ignoring IndexedDB error during garbage collection: ",e):await id(e)}await this.Vr(3e5)})}}class a4{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return ip.resolve(ig.ce);let n=new a5(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(rj("LruGarbageCollector","Garbage collection skipped; disabled"),ip.resolve(aQ)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(rj("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),aQ):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,r,i,s,a,o,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(rj("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),rD()<=e_.DEBUG&&rj("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${r} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),ip.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class a3{constructor(){this.changes=new sM(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,st.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?ip.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class a8{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class a7{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&s9(n.mutation,e,iT.empty(),il.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,sz()).next(()=>t))}getLocalViewOfDocuments(e,t,n=sz()){let r=sq();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=sF();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=sq();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,sz()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=sU,s=sq(),a=sq();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof an)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),s9(a.mutation,t,a.mutation.getFieldMask(),il.now())):s.set(t.key,iT.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new a8(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let n=sq(),r=new iw((e,t)=>e-t),i=sz();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||iT.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||sz()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=sq();l.forEach(e=>{if(!i.has(e)){let r=s7(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return ip.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return r7.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):sT(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):ip.resolve(sq()),a=-1,o=i;return s.next(t=>ip.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?ip.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,sz())).next(e=>({batchId:a,changes:sV(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new r7(t)).next(e=>{let t=sF();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=sF();return this.indexManager.getCollectionParents(e,i).next(a=>ip.forEach(a,a=>{let o=new sI(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,st.newInvalidDocument(r)))});let n=sF();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&s9(s.mutation,r,iT.empty(),il.now()),sj(t,r)&&(n=n.insert(e,r))}),n})}}class a9{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return ip.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:t.id,version:t.version,createTime:aj(t.createTime)}),ip.resolve()}getNamedQuery(e,t){return ip.resolve(this.kr.get(t))}saveNamedQuery(e,t){var n;let r;return this.kr.set(t.name,{name:t.name,query:(r=function(e){var t,n,r,i;let s,a,o,l,u,c=4===(s=aU(e.parent)).length?r4.emptyPath():aB(s),h=e.structuredQuery,d=h.from?h.from.length:0,p=null;if(d>0){rV(1===d,65062);let e=h.from[0];e.allDescendants?p=e.collectionId:c=c.child(e.collectionId)}let f=[];h.where&&(f=(a=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=aH(e.unaryFilter.field);return so.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=aH(e.unaryFilter.field);return so.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=aH(e.unaryFilter.field);return so.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=aH(e.unaryFilter.field);return so.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return rL(61313);default:return rL(60726)}}(t):void 0!==t.fieldFilter?so.create(aH(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return rL(58110);default:return rL(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?sl.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return rL(1026)}}(t.compositeFilter.op)):rL(30097,{filter:t})}(h.where))instanceof sl&&sc(t=a)&&su(t)?a.getFilters():[a]);let m=[];h.orderBy&&(m=h.orderBy.map(e=>new ss(aH(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let g=null;h.limit&&(g=null==(o="object"==typeof(n=h.limit)?n.value:n)?null:o);let y=null;h.startAt&&(l=!!(r=h.startAt).before,y=new sn(r.values||[],l));let v=null;return h.endAt&&(u=!(i=h.endAt).before,v=new sn(i.values||[],u)),new sI(c,p,m,f,g,"F",y,v)}({parent:(n=t.bundledQuery).parent,structuredQuery:n.structuredQuery}),"LAST"===n.limitType?sk(r,r.limit,"L"):r),readTime:aj(t.readTime)}),ip.resolve()}}class oe{constructor(){this.overlays=new iw(r7.comparator),this.qr=new Map}getOverlay(e,t){return ip.resolve(this.overlays.get(t))}getOverlays(e,t){let n=sq();return ip.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.St(e,t,r)}),ip.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),ip.resolve()}getOverlaysForCollection(e,t,n){let r=sq(),i=t.length+1,s=new r7(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return ip.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new iw((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=sq(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=sq(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return ip.resolve(a)}St(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new ac(t,n));let i=this.qr.get(t);void 0===i&&(i=sz(),this.qr.set(t,i)),this.qr.set(t,i.add(n.key))}}class ot{constructor(){this.sessionToken=iN.EMPTY_BYTE_STRING}getSessionToken(e){return ip.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ip.resolve()}}class on{constructor(){this.Qr=new iI(or.$r),this.Ur=new iI(or.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let n=new or(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new or(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){let t=new r7(new r4([])),n=new or(t,e),r=new or(t,e+1),i=[];return this.Ur.forEachInRange([n,r],e=>{this.Gr(e),i.push(e.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new r7(new r4([])),n=new or(t,e),r=new or(t,e+1),i=sz();return this.Ur.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new or(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class or{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return r7.comparator(e.key,t.key)||rZ(e.Yr,t.Yr)}static Kr(e,t){return rZ(e.Yr,t.Yr)||r7.comparator(e.key,t.key)}}class oi{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new iI(or.$r)}checkEmpty(e){return ip.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new al(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Zr=this.Zr.add(new or(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return ip.resolve(s)}lookupMutationBatch(e,t){return ip.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.ei(t+1),r=n<0?0:n;return ip.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return ip.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return ip.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new or(t,0),r=new or(t,1/0),i=[];return this.Zr.forEachInRange([n,r],e=>{let t=this.Xr(e.Yr);i.push(t)}),ip.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new iI(rZ);return t.forEach(e=>{let t=new or(e,0),r=new or(e,1/0);this.Zr.forEachInRange([t,r],e=>{n=n.add(e.Yr)})}),ip.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;r7.isDocumentKey(i)||(i=i.child(""));let s=new or(new r7(i),0),a=new iI(rZ);return this.Zr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Yr)),!0)},s),ip.resolve(this.ti(a))}ti(e){let t=[];return e.forEach(e=>{let n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){rV(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return ip.forEach(t.mutations,r=>{let i=new or(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){let n=new or(t,0),r=this.Zr.firstAfterOrEqual(n);return ip.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ip.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class os{constructor(e){this.ri=e,this.docs=new iw(r7.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return ip.resolve(n?n.document.mutableCopy():st.newInvalidDocument(t))}getEntries(e,t){let n=sU;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():st.newInvalidDocument(e))}),ip.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=sU,s=t.path,a=new r7(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=function(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=r7.comparator(e.documentKey,t.documentKey))?n:rZ(e.largestBatchId,t.largestBatchId)}(new ic(a.readTime,a.key,-1),n)||(r.has(a.key)||sj(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return ip.resolve(i)}getAllFromCollectionGroup(e,t,n,r){rL(9500)}ii(e,t){return ip.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new oa(this)}getSize(e){return ip.resolve(this.size)}}class oa extends a3{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)}),ip.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class oo{constructor(e){this.persistence=e,this.si=new sM(e=>sw(e),sE),this.lastRemoteSnapshotVersion=iu.min(),this.highestTargetId=0,this.oi=0,this._i=new on,this.targetCount=0,this.ai=a0.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),ip.resolve()}getLastRemoteSnapshotVersion(e){return ip.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ip.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ip.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),ip.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new a0(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,ip.resolve()}updateTargetData(e,t){return this.Pr(t),ip.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,ip.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.si.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),ip.waitFor(i).next(()=>r)}getTargetCount(e){return ip.resolve(this.targetCount)}getTargetData(e,t){let n=this.si.get(t)||null;return ip.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),ip.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),ip.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),ip.resolve()}getMatchingKeysForTargetId(e,t){let n=this._i.Hr(t);return ip.resolve(n)}containsKey(e,t){return ip.resolve(this._i.containsKey(t))}}class ol{constructor(e,t){this.ui={},this.overlays={},this.ci=new ig(0),this.li=!1,this.li=!0,this.hi=new ot,this.referenceDelegate=e(this),this.Pi=new oo(this),this.indexManager=new aY,this.remoteDocumentCache=function(e){return new os(e)}(e=>this.referenceDelegate.Ti(e)),this.serializer=new aW(t),this.Ii=new a9(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new oe,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new oi(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){rj("MemoryPersistence","Starting transaction:",e);let r=new ou(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(e,t){return ip.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class ou extends ih{constructor(e){super(),this.currentSequenceNumber=e}}class oc{constructor(e){this.persistence=e,this.Ri=new on,this.Vi=null}static mi(e){return new oc(e)}get fi(){if(this.Vi)return this.Vi;throw rL(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),ip.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),ip.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),ip.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ip.forEach(this.fi,n=>{let r=r7.fromPath(n);return this.gi(e,r).next(e=>{e||t.removeEntry(r,iu.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return ip.or([()=>ip.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class oh{constructor(e,t){this.persistence=e,this.pi=new sM(e=>(function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"})(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new a4(e,t)}(this,t)}static mi(e,t){return new oh(e,t)}Ei(){}di(e){return ip.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return ip.forEach(this.pi,(n,r)=>this.br(e,n,r).next(e=>e?ip.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,r=>this.br(e,r,t).next(e=>{e||(n++,i.removeEntry(r,iu.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),ip.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ip.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ip.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),ip.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(iW(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=iL(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return iR(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var r;let i;return r=t.mapValue,i=0,ib(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw rL(13486,{value:t})}}(e.data.value)),t}br(e,t,n){return ip.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.pi.get(t);return ip.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class od{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(e,t){let n=sz(),r=sz();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new od(e,t.fromCache,n,r)}}class op{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class of{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){let t;return!function(){let t=ne()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:Number((t=nd().match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1")>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ys(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ws(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new op;return this.Ss(e,t,n).next(r=>{if(i.result=r,this.Vs)return this.bs(e,t,n,r.size)})}).next(()=>i.result)}bs(e,t,n,r){return n.documentReadCount<this.fs?(rD()<=e_.DEBUG&&rj("QueryEngine","SDK will not create cache indexes for query:",sD(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ip.resolve()):(rD()<=e_.DEBUG&&rj("QueryEngine","Query:",sD(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(rD()<=e_.DEBUG&&rj("QueryEngine","The SDK decides to create cache indexes for query:",sD(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,sN(t))):ip.resolve())}ys(e,t){if(sC(t))return ip.resolve(null);let n=sN(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=sN(t=sk(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=sz(...r);return this.ps.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.Ds(t,r);return this.Cs(t,s,i,n.readTime)?this.ys(e,sk(t,null,"F")):this.vs(e,s,t,n)}))})))}ws(e,t,n,r){return sC(t)||r.isEqual(iu.min())?ip.resolve(null):this.ps.getDocuments(e,n).next(i=>{let s,a,o=this.Ds(t,i);return this.Cs(t,o,n,r)?ip.resolve(null):(rD()<=e_.DEBUG&&rj("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),sD(t)),this.vs(e,o,t,(s=r.toTimestamp().seconds,a=r.toTimestamp().nanoseconds+1,new ic(iu.fromTimestamp(1e9===a?new il(s+1,0):new il(s,a)),r7.empty(),-1))).next(e=>e))})}Ds(e,t){let n=new iI(sP(e));return t.forEach((t,r)=>{sj(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,n){return rD()<=e_.DEBUG&&rj("QueryEngine","Using full collection scan to execute query:",sD(t)),this.ps.getDocumentsMatchingQuery(e,t,ic.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let om="LocalStore";class og{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new iw(rZ),this.xs=new sM(e=>sw(e),sE),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new a7(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function oy(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=sz();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({Ls:e,removedBatchIds:i,addedBatchIds:s}))})})}function ov(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}async function ob(e,t,n){let r=e.Ms.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!im(e))throw e;rj(om,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ms=e.Ms.remove(t),e.xs.delete(r.target)}function ox(e,t,n){let r=iu.min(),i=sz();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=sN(t),void 0!==(o=e.xs.get(a))?ip.resolve(e.Ms.get(o)):e.Pi.getTargetData(s,a)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Pi.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Fs.getDocumentsMatchingQuery(s,t,n?r:iu.min(),n?i:sz())).next(n=>{var r,s,a;let o;return r=e,s=t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2)),a=n,o=r.Os.get(s)||iu.min(),a.forEach((e,t)=>{t.readTime.compareTo(o)>0&&(o=t.readTime)}),r.Os.set(s,o),{documents:n,Qs:i}})})}class ow{constructor(){this.activeTargetIds=sH}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class oE{constructor(){this.Mo=new ow,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new ow,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class o_{Oo(e){}shutdown(){}}let oI="ConnectivityMonitor";class oC{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){for(let e of(rj(oI,"Network connectivity changed: AVAILABLE"),this.qo))e(0)}ko(){for(let e of(rj(oI,"Network connectivity changed: UNAVAILABLE"),this.qo))e(1)}static v(){return"u">typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let oT=null;function oS(){return null===oT?oT=0x10000000+Math.round(0x80000000*Math.random()):oT++,"0x"+oT.toString(16)}let oN="RestConnection",oA={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ok{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===iq?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(e,t,n,r,i){let s=oS(),a=this.zo(e,t.toUriEncodedString());rj(oN,`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(o,r,i);let{host:l}=new URL(a),u=na(l);return this.Jo(e,a,o,n,u).then(t=>(rj(oN,`Received RPC '${e}' ${s}: `,t),t),t=>{throw rM(oN,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}Ho(e,t,n,r,i,s){return this.Go(e,t,n,r,i)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+rO,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){let n=oA[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class oO{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}let oR="WebChannelConnection";class oD extends ok{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,i){let s=oS();return new Promise((i,a)=>{let o=new eT;o.setWithCredentials(!0),o.listenOnce(eN.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case eA.NO_ERROR:let t=o.getResponseJson();rj(oR,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case eA.TIMEOUT:rj(oR,`RPC '${e}' ${s} timed out`),a(new rB(rq.DEADLINE_EXCEEDED,"Request time out"));break;case eA.HTTP_ERROR:let n=o.getStatus();if(rj(oR,`RPC '${e}' ${s} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,n=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(rq).indexOf(e)>=0?e:rq.UNKNOWN);a(new rB(n,t.message))}else a(new rB(rq.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new rB(rq.UNAVAILABLE,"Connection failed."));break;default:rL(9055,{l_:e,streamId:s,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{rj(oR,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(r);rj(oR,`RPC '${e}' ${s} sending request:`,r),o.send(t,"POST",l,n,15)})}T_(e,t,n){let r=oS(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=eD(),a=eR(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.jo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;let u=i.join("");rj(oR,`Creating RPC '${e}' stream ${r}: ${u}`,o);let c=s.createWebChannel(u,o);this.I_(c);let h=!1,d=!1,p=new oO({Yo:t=>{d?rj(oR,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(rj(oR,`Opening RPC '${e}' stream ${r} transport.`),c.open(),h=!0),rj(oR,`RPC '${e}' stream ${r} sending:`,t),c.send(t))},Zo:()=>c.close()}),f=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return f(c,eS.EventType.OPEN,()=>{d||(rj(oR,`RPC '${e}' stream ${r} transport opened.`),p.o_())}),f(c,eS.EventType.CLOSE,()=>{d||(d=!0,rj(oR,`RPC '${e}' stream ${r} transport closed`),p.a_(),this.E_(c))}),f(c,eS.EventType.ERROR,t=>{d||(d=!0,rM(oR,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),p.a_(new rB(rq.UNAVAILABLE,"The operation could not be completed")))}),f(c,eS.EventType.MESSAGE,t=>{if(!d){let n=t.data[0];rV(!!n,16349);let i=n?.error||n[0]?.error;if(i){rj(oR,`RPC '${e}' stream ${r} received error:`,i);let t=i.status,n=function(e){let t=ej[e];if(void 0!==t)return ad(t)}(t),s=i.message;void 0===n&&(n=rq.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),d=!0,p.a_(new rB(n,s)),c.close()}else rj(oR,`RPC '${e}' stream ${r} received:`,n),p.u_(n)}}),f(a,eO.STAT_EVENT,t=>{t.stat===ek.PROXY?rj(oR,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===ek.NOPROXY&&rj(oR,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{p.__()},0),p}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function oj(){return"u">typeof document?document:null}function oP(e){return new ak(e,!0)}class oM{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&rj("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}let oU="PersistentStream";class oL{constructor(e,t,n,r,i,s,a,o){this.Mi=e,this.S_=n,this.b_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new oM(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===rq.RESOURCE_EXHAUSTED?(rP(t.toString()),rP("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===rq.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{let e=new rB(rq.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return rj(oU,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(rj(oU,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class oF extends oL{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:rL(39313,{state:r}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(rV(void 0===i||"string"==typeof i,58123),iN.fromBase64String(i||"")):(rV(void 0===i||i instanceof t2.Buffer||i instanceof Uint8Array,16193),iN.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new aE(s,a,o,l&&new rB(void 0===l.code?rq.UNKNOWN:ad(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=aF(e,r.document.name),s=aj(r.document.updateTime),a=r.document.createTime?aj(r.document.createTime):iu.min(),o=new se({mapValue:{fields:r.document.fields}}),l=st.newFoundDocument(i,s,a,o);n=new ax(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=aF(e,r.document),s=r.readTime?aj(r.readTime):iu.min(),a=st.newNoDocument(i,s);n=new ax([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=aF(e,r.document);n=new ax([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return rL(11601,{Rt:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new ah(r,i);n=new aw(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return iu.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?iu.min():t.readTime?aj(t.readTime):iu.min()}(e);return this.listener.H_(t,n)}Y_(e){let t,n={};n.database=aq(this.serializer),n.addTarget=function(e,t){var n,r;let i,s,a,o,l,u,c,h=t.target;if((i=s_(h)?{documents:{documents:[aV(e,h.path)]}}:{query:(a={structuredQuery:{}},o=h.path,null!==h.collectionGroup?(s=o,a.structuredQuery.from=[{collectionId:h.collectionGroup,allDescendants:!0}]):(s=o.popLast(),a.structuredQuery.from=[{collectionId:o.lastSegment()}]),a.parent=aV(e,s),(l=function(e){if(0!==e.length)return function e(t){var n;let r;return t instanceof so?function(e){if("=="===e.op){if(i4(e.value))return{unaryFilter:{field:az(e.field),op:"IS_NAN"}};if(i6(e.value))return{unaryFilter:{field:az(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(i4(e.value))return{unaryFilter:{field:az(e.field),op:"IS_NOT_NAN"}};if(i6(e.value))return{unaryFilter:{field:az(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:az(e.field),op:aN[e.op],value:e.value}}}(t):t instanceof sl?1===(r=(n=t).getFilters().map(t=>e(t))).length?r[0]:{compositeFilter:{op:aA[n.op],filters:r}}:rL(54877,{filter:t})}(sl.create(e,"and"))}(h.filters))&&(a.structuredQuery.where=l),(u=function(e){if(0!==e.length)return e.map(e=>({field:az(e.field),direction:aS[e.dir]}))}(h.orderBy))&&(a.structuredQuery.orderBy=u),null!==(c=aO(e,h.limit))&&(a.structuredQuery.limit=c),h.startAt&&(a.structuredQuery.startAt={before:(n=h.startAt).inclusive,values:n.position}),h.endAt&&(a.structuredQuery.endAt={before:!(r=h.endAt).inclusive,values:r.position}),{ft:a,parent:s}).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){i.resumeToken=aD(e,t.resumeToken);let n=aO(e,t.expectedCount);null!==n&&(i.expectedCount=n)}else if(t.snapshotVersion.compareTo(iu.min())>0){i.readTime=aR(e,t.snapshotVersion.toTimestamp());let n=aO(e,t.expectedCount);null!==n&&(i.expectedCount=n)}return i}(this.serializer,e);let r=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return rL(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});r&&(n.labels=r),this.q_(n)}Z_(e){let t={};t.database=aq(this.serializer),t.removeTarget=e,this.q_(t)}}class oV extends oL{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return rV(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,rV(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,n;rV(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(rV(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?aj(e.updateTime):aj(n)).isEqual(iu.min())&&(t=aj(n)),new s6(t,e.transformResults||[])})):[]),i=aj(e.commitTime);return this.listener.na(i,r)}ra(){let e={};e.database=aq(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>(function(e,t){var n,r;let i;if(t instanceof at)i={update:aG(e,t.key,t.value)};else if(t instanceof aa)i={delete:aL(e,t.key)};else if(t instanceof an){let n;i={update:aG(e,t.key,t.data),updateMask:(r=t.fieldMask,n=[],r.fields.forEach(e=>n.push(e.canonicalString())),{fieldPaths:n})}}else{if(!(t instanceof ao))return rL(16599,{Vt:t.type});i={verify:aL(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof sY)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof sX)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof sZ)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof s1)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw rL(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:aR(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:rL(27497)),i})(this.serializer,e))};this.q_(t)}}class oq{}class oB extends oq{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new rB(rq.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Go(e,aM(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===rq.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new rB(rq.UNKNOWN,e.toString())})}Ho(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Ho(e,aM(t,n),r,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===rq.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new rB(rq.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class oG{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(rP(t),this.aa=!1):rj("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let oz="RemoteStore";class oH{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{o0(this)&&(rj(oz,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await oK(e),e.Ra.set("Unknown"),e.Ea.delete(4),await o$(e)}(this))})}),this.Ra=new oG(n,r)}}async function o$(e){if(o0(e))for(let t of e.da)await t(!0)}async function oK(e){for(let t of e.da)await t(!1)}function oW(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),oZ(e)?oQ(e):la(e).O_()&&oY(e,t))}function oJ(e,t){let n=la(e);e.Ia.delete(t),n.O_()&&oX(e,t),0===e.Ia.size&&(n.O_()?n.L_():o0(e)&&e.Ra.set("Unknown"))}function oY(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(iu.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}la(e).Y_(t)}function oX(e,t){e.Va.Ue(t),la(e).Z_(t)}function oQ(e){e.Va=new aI({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),la(e).start(),e.Ra.ua()}function oZ(e){return o0(e)&&!la(e).x_()&&e.Ia.size>0}function o0(e){return 0===e.Ea.size}async function o1(e){e.Ra.set("Online")}async function o2(e){e.Ia.forEach((t,n)=>{oY(e,t)})}async function o5(e,t){e.Va=void 0,oZ(e)?(e.Ra.ha(t),oQ(e)):e.Ra.set("Unknown")}async function o6(e,t,n){if(e.Ra.set("Online"),t instanceof aE&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.Va.removeTarget(r))}(e,t)}catch(n){rj(oz,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await o4(e,n)}else if(t instanceof ax?e.Va.Ze(t):t instanceof aw?e.Va.st(t):e.Va.tt(t),!n.isEqual(iu.min()))try{let t,r=await ov(e.localStore);n.compareTo(r)>=0&&await ((t=e.Va.Tt(n)).targetChanges.forEach((t,r)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(t.resumeToken,n))}}),t.targetMismatches.forEach((t,n)=>{let r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(iN.EMPTY_BYTE_STRING,r.snapshotVersion)),oX(e,t);let i=new aK(r.target,t,n,r.sequenceNumber);oY(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){rj(oz,"Failed to raise snapshot:",t),await o4(e,t)}}async function o4(e,t,n){if(!im(t))throw t;e.Ea.add(1),await oK(e),e.Ra.set("Offline"),n||(n=()=>ov(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{rj(oz,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await o$(e)})}function o3(e,t){return t().catch(n=>o4(e,n,t))}async function o8(e){var t;let n=lo(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;o0(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.Ta.length&&n.L_();break}r=t.batchId,function(e,t){e.Ta.push(t);let n=lo(e);n.O_()&&n.X_&&n.ea(t.mutations)}(e,t)}catch(t){await o4(e,t)}o7(e)&&o9(e)}function o7(e){return o0(e)&&!lo(e).x_()&&e.Ta.length>0}function o9(e){lo(e).start()}async function le(e){lo(e).ra()}async function lt(e){let t=lo(e);for(let n of e.Ta)t.ea(n.mutations)}async function ln(e,t,n){let r=e.Ta.shift(),i=au.from(r,t,n);await o3(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await o8(e)}async function lr(e,t){t&&lo(e).X_&&await async function(e,t){var n;if(function(e){switch(e){case rq.OK:return rL(64938);case rq.CANCELLED:case rq.UNKNOWN:case rq.DEADLINE_EXCEEDED:case rq.RESOURCE_EXHAUSTED:case rq.INTERNAL:case rq.UNAVAILABLE:case rq.UNAUTHENTICATED:return!1;case rq.INVALID_ARGUMENT:case rq.NOT_FOUND:case rq.ALREADY_EXISTS:case rq.PERMISSION_DENIED:case rq.FAILED_PRECONDITION:case rq.ABORTED:case rq.OUT_OF_RANGE:case rq.UNIMPLEMENTED:case rq.DATA_LOSS:return!0;default:return rL(15467,{code:e})}}(n=t.code)&&n!==rq.ABORTED){let n=e.Ta.shift();lo(e).B_(),await o3(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await o8(e)}}(e,t),o7(e)&&o9(e)}async function li(e,t){e.asyncQueue.verifyOperationInProgress(),rj(oz,"RemoteStore received new credentials");let n=o0(e);e.Ea.add(3),await oK(e),n&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await o$(e)}async function ls(e,t){t?(e.Ea.delete(2),await o$(e)):t||(e.Ea.add(2),await oK(e),e.Ra.set("Unknown"))}function la(e){var t,n,r;return e.ma||(t=e.datastore,n=e.asyncQueue,r={Xo:o1.bind(null,e),t_:o2.bind(null,e),r_:o5.bind(null,e),H_:o6.bind(null,e)},t.sa(),e.ma=new oF(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.ma.B_(),oZ(e)?oQ(e):e.Ra.set("Unknown")):(await e.ma.stop(),e.Va=void 0)})),e.ma}function lo(e){var t,n,r;return e.fa||(t=e.datastore,n=e.asyncQueue,r={Xo:()=>Promise.resolve(),t_:le.bind(null,e),r_:lr.bind(null,e),ta:lt.bind(null,e),na:ln.bind(null,e)},t.sa(),e.fa=new oV(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.fa.B_(),await o8(e)):(await e.fa.stop(),e.Ta.length>0&&(rj(oz,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class ll{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new rG,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new ll(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new rB(rq.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function lu(e,t){if(rP("AsyncQueue",`${t}: ${e}`),im(e))return new rB(rq.UNAVAILABLE,`${t}: ${e}`);throw e}class lc{static emptySet(e){return new lc(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||r7.comparator(t.key,n.key):(e,t)=>r7.comparator(e.key,t.key),this.keyedMap=sF(),this.sortedSet=new iw(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof lc)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new lc;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class lh{constructor(){this.ga=new iw(r7.comparator)}track(e){let t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):rL(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class ld{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new ld(e,t,lc.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&sO(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class lp{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class lf{constructor(){this.queries=lm(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new rB(rq.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=lm(),t.forEach((t,n)=>{for(let t of n.Sa)t.onError(e)})}}function lm(){return new sM(e=>sR(e),sO)}async function lg(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.ba()&&t.Da()&&(n=2):(i=new lp,n=+!t.Da());try{switch(n){case 0:i.wa=await e.onListen(r,!0);break;case 1:i.wa=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=lu(n,`Initialization of query '${sD(t.query)}' failed`);return void t.onError(e)}e.queries.set(r,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&lx(e)}async function ly(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?r=+!t.Da():!i.ba()&&t.Da()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function lv(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.Sa)e.Fa(r)&&(n=!0);i.wa=r}}n&&lx(e)}function lb(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.Sa)e.onError(n);e.queries.delete(t)}function lx(e){e.Ca.forEach(e=>{e.next()})}(eU=eM||(eM={})).Ma="default",eU.Cache="cache";class lw{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new ld(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.qa||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=ld.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==eM.Cache}}class lE{constructor(e){this.key=e}}class l_{constructor(e){this.key=e}}class lI{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=sz(),this.mutatedKeys=sz(),this.eu=sP(e),this.tu=new lc(this.eu)}get nu(){return this.Ya}ru(e,t){let n=t?t.iu:new lh,r=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),c=sj(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations),p=!1;u&&c?u.data.isEqual(c.data)?h!==d&&(n.track({type:3,doc:c}),p=!0):this.su(u,c)||(n.track({type:2,doc:c}),p=!0,(o&&this.eu(c,o)>0||l&&0>this.eu(c,l))&&(a=!0)):!u&&c?(n.track({type:0,doc:c}),p=!0):u&&!c&&(n.track({type:1,doc:u}),p=!0,(o||l)&&(a=!0)),p&&(c?(s=s.add(c),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var n,r;let i;return n=e.type,r=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return rL(20277,{Rt:e})}})(n)-i(r)||this.eu(e.doc,t.doc)}),this.ou(n),r=r??!1;let a=t&&!r?this._u():[],o=0===this.Xa.size&&this.current&&!r?1:0,l=o!==this.Za;return(this.Za=o,0!==s.length||l)?{snapshot:new ld(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new lh,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=sz(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});let t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new l_(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new lE(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=sz();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ld.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}let lC="SyncEngine";class lT{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class lS{constructor(e){this.key=e,this.hu=!1}}class lN{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new sM(e=>sR(e),sO),this.Iu=new Map,this.Eu=new Set,this.du=new iw(r7.comparator),this.Au=new Map,this.Ru=new on,this.Vu={},this.mu=new Map,this.fu=a0.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function lA(e,t,n=!0){let r,i=lY(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=await lO(i,t,n,!0),r}async function lk(e,t){let n=lY(e);await lO(n,t,!0,!1)}async function lO(e,t,n,r){var i,s;let a,o=await (i=e.localStore,s=sN(t),i.persistence.runTransaction("Allocate target","readwrite",e=>{let t;return i.Pi.getTargetData(e,s).next(n=>n?(t=n,ip.resolve(t)):i.Pi.allocateTargetId(e).next(n=>(t=new aK(s,n,"TargetPurposeListen",e.currentSequenceNumber),i.Pi.addTargetData(e,t).next(()=>t))))}).then(e=>{let t=i.Ms.get(e.targetId);return(null===t||e.snapshotVersion.compareTo(t.snapshotVersion)>0)&&(i.Ms=i.Ms.insert(e.targetId,e),i.xs.set(s,e.targetId)),e})),l=o.targetId,u=e.sharedClientState.addLocalQueryTarget(l,n);return r&&(a=await lR(e,t,l,"current"===u,o.resumeToken)),e.isPrimaryClient&&n&&oW(e.remoteStore,o),a}async function lR(e,t,n,r,i){e.pu=(t,n,r)=>(async function(e,t,n,r){let i=t.view.ru(n);i.Cs&&(i=await ox(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return lH(e,t.targetId,o.au),o.snapshot})(e,t,n,r);let s=await ox(e.localStore,t,!0),a=new lI(t,s.Qs),o=a.ru(s.documents),l=ab.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);lH(e,n,u.au);let c=new lT(t,n,a);return e.Tu.set(t,c),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),u.snapshot}async function lD(e,t,n){let r=e.Tu.get(t),i=e.Iu.get(r.targetId);i.length>1?(e.Iu.set(r.targetId,i.filter(e=>!sO(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await ob(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&oJ(e.remoteStore,r.targetId),lG(e,r.targetId)}).catch(id)):(lG(e,r.targetId),await ob(e.localStore,r.targetId,!0))}async function lj(e,t){let n=e.Tu.get(t),r=e.Iu.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),oJ(e.remoteStore,n.targetId))}async function lP(e,t,n){var r,i,s;let a=((r=e).remoteStore.remoteSyncer.applySuccessfulWrite=lF.bind(null,r),r.remoteStore.remoteSyncer.rejectFailedWrite=lV.bind(null,r),r);try{let e,r,o,l,u,c=await (i=a.localStore,o=il.now(),l=t.reduce((e,t)=>e.add(t.key),sz()),i.persistence.runTransaction("Locally write mutations","readwrite",n=>{let s=sU,a=sz();return i.Ns.getEntries(n,l).next(e=>{(s=e).forEach((e,t)=>{t.isValidDocument()||(a=a.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(n,s)).next(r=>{e=r;let s=[];for(let n of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=sJ(r.transform,e||null);null!=i&&(null===n&&(n=se.empty()),n.set(r.field,i))}return n||null}(n,e.get(n.key).overlayedDocument);null!=t&&s.push(new an(n.key,t,function e(t){let n=[];return ib(t.fields,(t,r)=>{let i=new r8([t]);if(i3(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new iT(n)}(t.value.mapValue),s4.exists(!0)))}return i.mutationQueue.addMutationBatch(n,o,s,t)}).next(t=>{r=t;let s=t.applyToLocalDocumentSet(e,a);return i.documentOverlayCache.saveOverlays(n,t.batchId,s)})}).then(()=>({batchId:r.batchId,changes:sV(e)})));a.sharedClientState.addPendingMutation(c.batchId),s=c.batchId,(u=a.Vu[a.currentUser.toKey()])||(u=new iw(rZ)),u=u.insert(s,n),a.Vu[a.currentUser.toKey()]=u,await lK(a,c.changes),await o8(a.remoteStore)}catch(t){let e=lu(t,"Failed to persist write");n.reject(e)}}async function lM(e,t){var n;try{let r,i,s=await (n=e.localStore,r=t.snapshotVersion,i=n.Ms,n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{var s,a,o;let l,u,c=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;let h=[];t.targetChanges.forEach((s,a)=>{var o;let l=i.get(a);if(!l)return;h.push(n.Pi.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.Pi.addMatchingKeys(e,s.addedDocuments,a)));let u=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(iN.EMPTY_BYTE_STRING,iu.min()).withLastLimboFreeSnapshotVersion(iu.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),o=u,(0===l.resumeToken.approximateByteSize()||o.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&h.push(n.Pi.updateTargetData(e,u))});let d=sU,p=sz();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&h.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),h.push((s=e,a=c,o=t.documentUpdates,l=sz(),u=sz(),o.forEach(e=>l=l.add(e)),a.getEntries(s,l).next(e=>{let t=sU;return o.forEach((n,r)=>{let i=e.get(n);r.isFoundDocument()!==i.isFoundDocument()&&(u=u.add(n)),r.isNoDocument()&&r.version.isEqual(iu.min())?(a.removeEntry(n,r.readTime),t=t.insert(n,r)):!i.isValidDocument()||r.version.compareTo(i.version)>0||0===r.version.compareTo(i.version)&&i.hasPendingWrites?(a.addEntry(r),t=t.insert(n,r)):rj(om,"Ignoring outdated watch update for ",n,". Current version:",i.version," Watch version:",r.version)}),{ks:t,qs:u}})).next(e=>{d=e.ks,p=e.qs})),!r.isEqual(iu.min())){let t=n.Pi.getLastRemoteSnapshotVersion(e).next(t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,r));h.push(t)}return ip.waitFor(h).next(()=>c.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,d,p)).next(()=>d)}).then(e=>(n.Ms=i,e)));t.targetChanges.forEach((t,n)=>{let r=e.Au.get(n);r&&(rV(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.hu=!0:t.modifiedDocuments.size>0?rV(r.hu,14607):t.removedDocuments.size>0&&(rV(r.hu,42227),r.hu=!1))}),await lK(e,s,t)}catch(e){await id(e)}}function lU(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.Tu.forEach((e,n)=>{let r=n.view.va(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.Sa)e.va(t)&&(n=!0)}),n&&lx(r),i.length&&e.Pu.H_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function lL(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Au.get(t),i=r&&r.key;if(i){let n=new iw(r7.comparator);n=n.insert(i,st.newNoDocument(i,iu.min()));let r=sz().add(i),s=new av(iu.min(),new Map,new iw(rZ),n,r);await lM(e,s),e.du=e.du.remove(i),e.Au.delete(t),l$(e)}else await ob(e.localStore,t,!1).then(()=>lG(e,t,n)).catch(id)}async function lF(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r,i,s,a=t.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(i=(r=t.batch).keys(),s=ip.resolve(),i.forEach(n=>{s=s.next(()=>o.getEntry(e,n)).next(e=>{let i=t.docVersions.get(n);rV(null!==i,48541),0>e.version.compareTo(i)&&(r.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>n.mutationQueue.removeMutationBatch(e,r))).next(()=>o.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=sz();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,a))}));lB(e,r,null),lq(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await lK(e,i)}catch(e){await id(e)}}async function lV(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(rV(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));lB(e,t,n),lq(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await lK(e,i)}catch(e){await id(e)}}function lq(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function lB(e,t,n){let r=e.Vu[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Vu[e.currentUser.toKey()]=r}}function lG(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||lz(e,t)})}function lz(e,t){e.Eu.delete(t.path.canonicalString());let n=e.du.get(t);null!==n&&(oJ(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),l$(e))}function lH(e,t,n){for(let r of n)r instanceof lE?(e.Ru.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Eu.has(r)||(rj(lC,"New document in limbo: "+n),e.Eu.add(r),l$(e))}(e,r)):r instanceof l_?(rj(lC,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||lz(e,r.key)):rL(19791,{wu:r})}function l$(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let n=new r7(r4.fromString(t)),r=e.fu.next();e.Au.set(r,new lS(n)),e.du=e.du.insert(n,r),oW(e.remoteStore,new aK(sN(new sI(n.path)),r,"TargetPurposeLimboResolution",ig.ce))}}async function lK(e,t,n){let r=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,n).then(t=>{if((t||n)&&e.isPrimaryClient){let r=t?!t.fromCache:n?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,r?"current":"not-current")}if(t){r.push(t);let e=od.As(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.H_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>ip.forEach(t,t=>ip.forEach(t.Es,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>ip.forEach(t.ds,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!im(e))throw e;rj(om,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ms.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.Ms=e.Ms.insert(t,i)}}}(e.localStore,i))}async function lW(e,t){if(!e.currentUser.isEqual(t)){rj(lC,"User change. New user:",t.toKey());let n=await oy(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new rB(rq.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await lK(e,n.Ls)}}function lJ(e,t){let n=e.Au.get(t);if(n&&n.hu)return sz().add(n.key);{let n=sz(),r=e.Iu.get(t);if(!r)return n;for(let t of r){let r=e.Tu.get(t);n=n.unionWith(r.view.nu)}return n}}function lY(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=lM.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=lJ.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=lL.bind(null,e),e.Pu.H_=lv.bind(null,e.eventManager),e.Pu.yu=lb.bind(null,e.eventManager),e}class lX{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=oP(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,n;return t=this.persistence,n=new of,new og(t,n,e.initialUser,this.serializer)}Cu(e){return new ol(oc.mi,this.serializer)}Du(e){return new oE}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}lX.provider={build:()=>new lX};class lQ extends lX{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return rV(this.persistence.referenceDelegate instanceof oh,46915),new a6(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?aZ.withCacheSize(this.cacheSizeBytes):aZ.DEFAULT;return new ol(e=>oh.mi(e,t),this.serializer)}}class lZ{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>lU(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=lW.bind(null,this.syncEngine),await ls(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new lf}createDatastore(e){var t;let n=oP(e.databaseInfo.databaseId),r=new oD(e.databaseInfo);return t=e.authCredentials,new oB(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new oH(t,n,e.asyncQueue,e=>lU(this.syncEngine,e,0),oC.v()?new oC:new o_)}createSyncEngine(e,t){var n,r,i,s,a,o;let l;return n=this.localStore,r=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new lN(n,r,i,s,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){rj(oz,"RemoteStore shutting down."),e.Ea.add(5),await oK(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}lZ.provider={build:()=>new lZ};class l0{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):rP("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}let l1="FirestoreClient";class l2{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=rk.UNAUTHENTICATED,this.clientId=rQ.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{rj(l1,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(rj(l1,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new rG;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=lu(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function l5(e,t){e.asyncQueue.verifyOperationInProgress(),rj(l1,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await oy(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function l6(e,t){e.asyncQueue.verifyOperationInProgress();let n=await l4(e);rj(l1,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>li(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>li(t.remoteStore,n)),e._onlineComponents=t}async function l4(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){rj(l1,"Using user provided OfflineComponentProvider");try{await l5(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===rq.FAILED_PRECONDITION||t.code===rq.UNIMPLEMENTED:!("u">typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;rM("Error using user provided cache. Falling back to memory cache: "+t),await l5(e,new lX)}}else rj(l1,"Using default OfflineComponentProvider"),await l5(e,new lQ(void 0));return e._offlineComponents}async function l3(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(rj(l1,"Using user provided OnlineComponentProvider"),await l6(e,e._uninitializedComponentsProvider._online)):(rj(l1,"Using default OnlineComponentProvider"),await l6(e,new lZ))),e._onlineComponents}async function l8(e){let t=await l3(e),n=t.eventManager;return n.onListen=lA.bind(null,t.syncEngine),n.onUnlisten=lD.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=lk.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=lj.bind(null,t.syncEngine),n}function l7(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let l9=new Map,ue="firestore.googleapis.com";class ut{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new rB(rq.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ue,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new rB(rq.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new rB(rq.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=l7(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new rB(rq.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new rB(rq.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new rB(rq.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class un{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ut({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new rB(rq.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new rB(rq.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ut(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new rH;switch(e.type){case"firstParty":return new rJ(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new rB(rq.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=l9.get(this))&&(rj("ComponentProvider","Removing Datastore"),l9.delete(this),e.terminate()),Promise.resolve()}}function ur(e,t,n,r={}){e=is(e,un);let i=na(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${n}`;i&&(no(`https://${o}`),nh("Firestore",!0)),s.host!==ue&&s.host!==o&&rM("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:r};if(!ny(l,a)&&(e._setSettings(l),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=rk.MOCK_USER;else{t=nl(r.mockUserToken,e._app?.options.projectId);let i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new rB(rq.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new rk(i)}e._authCredentials=new r$(new rz(t,n))}}class ui{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new ui(this.firestore,e,this._query)}}class us{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ua(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new us(this.firestore,e,this._key)}toJSON(){return{type:us._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(io(t,us._jsonSchema))return new us(e,n||null,new r7(r4.fromString(t.referencePath)))}}us._jsonSchemaVersion="firestore/documentReference/1.0",us._jsonSchema={type:ia("string",us._jsonSchemaVersion),referencePath:ia("string")};class ua extends ui{constructor(e,t,n){super(e,t,function(e){return new sI(e)}(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new us(this.firestore,null,new r7(e))}withConverter(e){return new ua(this.firestore,e,this._path)}}function uo(e,t,...n){if(e=nI(e),r9("collection","path",t),e instanceof un){let r=r4.fromString(t,...n);return it(r),new ua(e,null,r)}{if(!(e instanceof us||e instanceof ua))throw new rB(rq.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(r4.fromString(t,...n));return it(r),new ua(e.firestore,null,r)}}function ul(e,t,...n){if(e=nI(e),1==arguments.length&&(t=rQ.newId()),r9("doc","path",t),e instanceof un){let r=r4.fromString(t,...n);return ie(r),new us(e,null,new r7(r))}{if(!(e instanceof us||e instanceof ua))throw new rB(rq.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(r4.fromString(t,...n));return ie(r),new us(e.firestore,e instanceof ua?e.converter:null,new r7(r))}}let uu="AsyncQueue";class uc{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new oM(this,"async_queue_retry"),this._c=()=>{let e=oj();e&&rj(uu,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=oj();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=oj();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new rG;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!im(e))throw e;rj(uu,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,rP("INTERNAL UNHANDLED ERROR: ",uh(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let r=ll.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&rL(47125,{Pc:uh(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function uh(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function ud(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class up extends un{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new uc,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new uc(e),this._firestoreClient=void 0,await e}}}function uf(e){if(e._terminated)throw new rB(rq.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,r;let i,s=e._freezeSettings(),a=(t=e._databaseId,n=e._app?.options.appId||"",new iV(t,n,e._persistenceKey,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,l7(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator));e._componentsProvider||s.localCache?._offlineComponentProvider&&s.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new l2(e._authCredentials,e._appCheckCredentials,e._queue,a,e._componentsProvider&&(r=e._componentsProvider,i=r?._online.build(),{_offline:r?._offline.build(i),_online:i}))}(e),e._firestoreClient}class um{constructor(e){this._byteString=e}static fromBase64String(e){try{return new um(iN.fromBase64String(e))}catch(e){throw new rB(rq.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new um(iN.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:um._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(io(e,um._jsonSchema))return um.fromBase64String(e.bytes)}}um._jsonSchemaVersion="firestore/bytes/1.0",um._jsonSchema={type:ia("string",um._jsonSchemaVersion),bytes:ia("string")};class ug{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new rB(rq.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new r8(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class uy{constructor(e){this._methodName=e}}class uv{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new rB(rq.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new rB(rq.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return rZ(this._lat,e._lat)||rZ(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:uv._jsonSchemaVersion}}static fromJSON(e){if(io(e,uv._jsonSchema))return new uv(e.latitude,e.longitude)}}uv._jsonSchemaVersion="firestore/geoPoint/1.0",uv._jsonSchema={type:ia("string",uv._jsonSchemaVersion),latitude:ia("number"),longitude:ia("number")};class ub{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:ub._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(io(e,ub._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new ub(e.vectorValues);throw new rB(rq.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ub._jsonSchemaVersion="firestore/vectorValue/1.0",ub._jsonSchema={type:ia("string",ub._jsonSchemaVersion),vectorValues:ia("object")};let ux=/^__.*__$/;class uw{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new an(e,this.data,this.fieldMask,t,this.fieldTransforms):new at(e,this.data,t,this.fieldTransforms)}}class uE{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new an(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function u_(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw rL(40011,{Ac:e})}}class uI{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new uI({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return uM(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(u_(this.Ac)&&ux.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class uC{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||oP(e)}Cc(e,t,n,r=!1){return new uI({Ac:e,methodName:t,Dc:n,path:r8.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function uT(e){let t=e._freezeSettings(),n=oP(e._databaseId);return new uC(e._databaseId,!!t.ignoreUndefinedProperties,n)}function uS(e,t,n,r,i,s={}){let a,o,l=e.Cc(s.merge||s.mergeFields?2:0,t,n,i);uR("Data must be an object, but it was:",l,r);let u=uk(r,l);if(s.merge)a=new iT(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=uD(t,r,n);if(!l.contains(i))throw new rB(rq.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);uU(e,i)||e.push(i)}a=new iT(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new uw(new se(u),a,o)}class uN extends uy{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof uN}}function uA(e,t){if(uO(e=nI(e)))return uR("Unsupported field value:",t,e),uk(e,t);if(e instanceof uy)return function(e,t){if(!u_(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=uA(i,t.wc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}return function(e,t){var n,r,i;if(null===(e=nI(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return n=t.serializer,"number"==typeof(i=r=e)&&Number.isInteger(i)&&!iy(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER?sK(r):s$(n,r);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=il.fromDate(e);return{timestampValue:aR(t.serializer,n)}}if(e instanceof il){let n=new il(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:aR(t.serializer,n)}}if(e instanceof uv)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof um)return{bytesValue:aD(t.serializer,e._byteString)};if(e instanceof us){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:aP(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof ub)return{mapValue:{fields:{[iG]:{stringValue:i$},[iK]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return s$(t.serializer,e)})}}}}};throw t.Sc(`Unsupported field value: ${ii(e)}`)}(e,t)}function uk(e,t){let n={};return ix(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ib(e,(e,r)=>{let i=uA(r,t.mc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function uO(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof il||e instanceof uv||e instanceof um||e instanceof us||e instanceof uy||e instanceof ub)}function uR(e,t,n){if(!uO(n)||!ir(n)){let r=ii(n);throw"an object"===r?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function uD(e,t,n){if((t=nI(t))instanceof ug)return t._internalPath;if("string"==typeof t)return uP(e,t);throw uM("Field path arguments must be of type string or ",e,!1,void 0,n)}let uj=RegExp("[~\\*/\\[\\]]");function uP(e,t,n){if(t.search(uj)>=0)throw uM(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new ug(...t.split("."))._internalPath}catch(r){throw uM(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function uM(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new rB(rq.INVALID_ARGUMENT,o+e+l)}function uU(e,t){return e.some(e=>e.isEqual(t))}class uL{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new us(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new uF(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(uV("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class uF extends uL{data(){return super.data()}}function uV(e,t){return"string"==typeof t?uP(e,t):t instanceof ug?t._internalPath:t._delegate._internalPath}function uq(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new rB(rq.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class uB{}class uG extends uB{}function uz(e,t,...n){let r=[];for(let i of(t instanceof uB&&r.push(t),function(e){let t=e.filter(e=>e instanceof uK).length,n=e.filter(e=>e instanceof uH).length;if(t>1||t>0&&n>0)throw new rB(rq.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e}class uH extends uG{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new uH(e,t,n)}_apply(e){let t=this._parse(e);return uQ(e._query,t),new ui(e.firestore,e.converter,sA(e._query,t))}_parse(e){let t=uT(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new rB(rq.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){uX(a,s);let t=[];for(let n of a)t.push(uY(r,e,n));o={arrayValue:{values:t}}}else o=uY(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||uX(a,s),o=function(e,t,n,r=!1){return uA(n,e.Cc(r?4:3,t))}(n,t,a,"in"===s||"not-in"===s);return so.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function u$(e,t,n){let r=uV("where",e);return uH._create(r,t,n)}class uK extends uB{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new uK(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:sl.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())uQ(n,e),n=sA(n,e)}(e._query,t),new ui(e.firestore,e.converter,sA(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class uW extends uG{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new uW(e,t)}_apply(e){var t;let n,r=function(e,t,n){if(null!==e.startAt)throw new rB(rq.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new rB(rq.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ss(t,n)}(e._query,this._field,this._direction);return new ui(e.firestore,e.converter,(t=e._query,n=t.explicitOrderBy.concat([r]),new sI(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function uJ(e,t="asc"){let n=uV("orderBy",e);return uW._create(n,t)}function uY(e,t,n){if("string"==typeof(n=nI(n))){if(""===n)throw new rB(rq.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sT(t)&&-1!==n.indexOf("/"))throw new rB(rq.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(r4.fromString(n));if(!r7.isDocumentKey(r))throw new rB(rq.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return i1(e,new r7(r))}if(n instanceof us)return i1(e,n._key);throw new rB(rq.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ii(n)}.`)}function uX(e,t){if(!Array.isArray(e)||0===e.length)throw new rB(rq.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function uQ(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new rB(rq.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new rB(rq.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class uZ{convertValue(e,t="none"){switch(iW(e)){case 0:return null;case 1:return e.booleanValue;case 2:return iO(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(iR(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw rL(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return ib(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){return new ub(e.fields?.[iK].arrayValue?.values?.map(e=>iO(e.doubleValue)))}convertGeoPoint(e){return new uv(iO(e.latitude),iO(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=iL(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(iF(e));default:return null}}convertTimestamp(e){let t=ik(e);return new il(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=r4.fromString(e);rV(a$(n),9688,{name:e});let r=new iB(n.get(1),n.get(3)),i=new r7(n.popFirst(5));return r.isEqual(t)||rP(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function u0(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class u1{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class u2 extends uL{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new u5(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(uV("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new rB(rq.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=u2._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}u2._jsonSchemaVersion="firestore/documentSnapshot/1.0",u2._jsonSchema={type:ia("string",u2._jsonSchemaVersion),bundleSource:ia("string","DocumentSnapshot"),bundleName:ia("string"),bundle:ia("string")};class u5 extends u2{data(e={}){return super.data(e)}}class u6{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new u1(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new u5(this._firestore,this._userDataWriter,n.key,n,new u1(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new rB(rq.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new u5(e._firestore,e._userDataWriter,n.doc.key,n.doc,new u1(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new u5(e._firestore,e._userDataWriter,t.doc.key,t.doc,new u1(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return rL(61501,{type:e})}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new rB(rq.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=u6._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=rQ.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}u6._jsonSchemaVersion="firestore/querySnapshot/1.0",u6._jsonSchema={type:ia("string",u6._jsonSchemaVersion),bundleSource:ia("string","QuerySnapshot"),bundleName:ia("string"),bundle:ia("string")};class u4 extends uZ{constructor(e){super(),this.firestore=e}convertBytes(e){return new um(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new us(this.firestore,null,t)}}function u3(e){e=is(e,ui);let t=is(e.firestore,up),n=uf(t),r=new u4(t);return uq(e._query),(function(e,t,n={}){let r=new rG;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await l8(e),s=e.asyncQueue,o=new lw(t,a=new l0({next:e=>{a.Nu(),s.enqueueAndForget(()=>ly(i,o)),e.fromCache&&"server"===n.source?r.reject(new rB(rq.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(e)},error:e=>r.reject(e)}),{includeMetadataChanges:!0,qa:!0}),lg(i,o)}),r.promise})(n,e._query).then(n=>new u6(t,r,e,n))}function u8(e){return u9(is(e.firestore,up),[new aa(e._key,s4.none())])}function u7(e,t){let n=is(e.firestore,up),r=ul(e),i=u0(e.converter,t);return u9(n,[uS(uT(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,s4.exists(!1))]).then(()=>r)}function u9(e,t){var n;let r;return n=uf(e),r=new rG,n.asyncQueue.enqueueAndForget(async()=>lP(await l3(n).then(e=>e.syncEngine),t,r)),r.promise}new WeakMap,function(e=!0){rO=rs,n6(new nC("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new up(new rK(t.getProvider("auth-internal")),new rX(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new rB(rq.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new iB(e.options.projectId,t)}(i,n),i);return r={useFetchStreams:e,...r},s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),rh(rN,rA,void 0),rh(rN,rA,"esm2020")}();let ce="firebasestorage.googleapis.com",ct="storageBucket";class cn extends nf{constructor(e,t,n=0){super(cr(e),`Firebase Storage: ${t} (${cr(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,cn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return cr(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function cr(e){return"storage/"+e}function ci(){return new cn(eL.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function cs(e){return new cn(eL.INVALID_ARGUMENT,e)}function ca(){return new cn(eL.APP_DELETED,"The Firebase app was deleted.")}function co(e,t){return new cn(eL.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function cl(e){throw new cn(eL.INTERNAL_ERROR,"Internal error: "+e)}(l=eL||(eL={})).UNKNOWN="unknown",l.OBJECT_NOT_FOUND="object-not-found",l.BUCKET_NOT_FOUND="bucket-not-found",l.PROJECT_NOT_FOUND="project-not-found",l.QUOTA_EXCEEDED="quota-exceeded",l.UNAUTHENTICATED="unauthenticated",l.UNAUTHORIZED="unauthorized",l.UNAUTHORIZED_APP="unauthorized-app",l.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",l.INVALID_CHECKSUM="invalid-checksum",l.CANCELED="canceled",l.INVALID_EVENT_NAME="invalid-event-name",l.INVALID_URL="invalid-url",l.INVALID_DEFAULT_BUCKET="invalid-default-bucket",l.NO_DEFAULT_BUCKET="no-default-bucket",l.CANNOT_SLICE_BLOB="cannot-slice-blob",l.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",l.NO_DOWNLOAD_URL="no-download-url",l.INVALID_ARGUMENT="invalid-argument",l.INVALID_ARGUMENT_COUNT="invalid-argument-count",l.APP_DELETED="app-deleted",l.INVALID_ROOT_OPERATION="invalid-root-operation",l.INVALID_FORMAT="invalid-format",l.INTERNAL_ERROR="internal-error",l.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class cu{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=cu.makeFromUrl(e,t)}catch(t){return new cu(e,"")}if(""===n.path)return n;throw new cn(eL.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let n=null,r="([A-Za-z0-9.\\-_]+)",i=RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}let a=t.replace(/[.]/g,"\\."),o=RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),l=t===ce?"(?:storage.googleapis.com|storage.cloud.google.com)":t,u=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:o,indices:{bucket:1,path:3},postModify:s},{regex:RegExp(`^https?://${l}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<u.length;t++){let r=u[t],i=r.regex.exec(e);if(i){let e=i[r.indices.bucket],t=i[r.indices.path];t||(t=""),n=new cu(e,t),r.postModify(n);break}}if(null==n)throw new cn(eL.INVALID_URL,"Invalid URL '"+e+"'.");return n}}class cc{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function ch(e){return"string"==typeof e||e instanceof String}function cd(e){return cp()&&e instanceof Blob}function cp(){return"u">typeof Blob}function cf(e,t,n,r){if(r<t)throw cs(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw cs(`Invalid value for '${e}'. Expected ${n} or less.`)}function cm(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function cg(e){let t=encodeURIComponent,n="?";for(let r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n.slice(0,-1)}(u=eF||(eF={}))[u.NO_ERROR=0]="NO_ERROR",u[u.NETWORK_ERROR=1]="NETWORK_ERROR",u[u.ABORT=2]="ABORT";class cy{constructor(e,t,n,r,i,s,a,o,l,u,c,h=!0,d=!1){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=u,this.connectionFactory_=c,this.retry=h,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){let e=(e,t)=>{if(t)return void e(!1,new cv(!1,null,!0));let n=this.connectionFactory_();this.pendingConnection_=n;let r=e=>{let t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{var t;let i,s,a;null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;let o=n.getErrorCode()===eF.NO_ERROR,l=n.getStatus();!o||(t=this.additionalRetryCodes_,i=l>=500&&l<600,s=-1!==[408,429].indexOf(l),a=-1!==t.indexOf(l),(i||s||a)&&this.retry)?e(!1,new cv(!1,null,n.getErrorCode()===eF.ABORT)):e(!0,new cv(-1!==this.successCodes_.indexOf(l),n))})},t=(e,t)=>{let n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{let e=this.callback_(i,i.getResponse());void 0!==e?n(e):n()}catch(e){r(e)}else if(null!==i){let e=ci();e.serverResponse=i.getErrorText(),r(this.errorCallback_?this.errorCallback_(i,e):e)}else r(t.canceled?this.appDelete_?ca():new cn(eL.CANCELED,"User canceled the upload/download."):new cn(eL.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?t(!1,new cv(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,a=!1,o=0,l=!1;function u(...e){l||(l=!0,t.apply(null,e))}function c(t){i=setTimeout(()=>{i=null,e(d,2===o)},t)}function h(){s&&clearTimeout(s)}function d(e,...t){let n;if(l)return void h();if(e||2===o||a){h(),u.call(null,e,...t);return}r<64&&(r*=2),1===o?(o=2,n=0):n=(r+Math.random())*1e3,c(n)}let p=!1;function f(e){p||(p=!0,h(),!l&&(null!==i?(e||(o=2),clearTimeout(i),c(0)):e||(o=1)))}return c(0),s=setTimeout(()=>{a=!0,f(!0)},n),f}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class cv{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function cb(...e){let t="u">typeof BlobBuilder?BlobBuilder:"u">typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==t){let n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(cp())return new Blob(e);throw new cn(eL.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}let cx="base64",cw="base64url",cE="data_url";class c_{constructor(e,t){this.data=e,this.contentType=t||null}}function cI(e,t){switch(e){case"raw":return new c_(cC(t));case cx:case cw:return new c_(cT(e,t));case cE:return new c_(function(e){let t,n=new cS(e);if(n.base64)return cT(cx,n.rest);var r=n.rest;try{t=decodeURIComponent(r)}catch(e){throw co(cE,"Malformed data URL.")}return cC(t)}(t),new cS(t).contentType)}throw ci()}function cC(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|63&r):(64512&r)==55296?n<e.length-1&&(64512&e.charCodeAt(n+1))==56320?(r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):t.push(239,191,189):(64512&r)==56320?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function cT(e,t){let n;switch(e){case cx:{let n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw co(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case cw:{let n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r)throw co(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}}try{n=function(e){if("u"<typeof atob)throw new cn(eL.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw co(e,"Invalid character found")}let r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return r}class cS{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw co(cE,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){return e.length>=t.length&&e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class cN{constructor(e,t){let n=0,r="";cd(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(!cd(this.data_))return new cN(new Uint8Array(this.data_.buffer,e,t-e),!0);{var n,r,i;let s=(n=this.data_,r=e,i=t,n.webkitSlice?n.webkitSlice(r,i):n.mozSlice?n.mozSlice(r,i):n.slice?n.slice(r,i):null);return null===s?null:new cN(s)}}static getBlob(...e){if(cp()){let t=e.map(e=>e instanceof cN?e.data_:e);return new cN(cb.apply(null,t))}{let t=e.map(e=>ch(e)?cI("raw",e).data:e.data_),n=0;t.forEach(e=>{n+=e.byteLength});let r=new Uint8Array(n),i=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]}),new cN(r,!0)}}uploadData(){return this.data_}}function cA(e){var t;let n;try{n=JSON.parse(e)}catch(e){return null}return"object"!=typeof(t=n)||Array.isArray(t)?null:n}function ck(e){let t=e.lastIndexOf("/",e.length-2);return -1===t?e:e.slice(t+1)}function cO(e,t){return t}class cR{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||cO}}let cD=null;function cj(){if(cD)return cD;let e=[];e.push(new cR("bucket")),e.push(new cR("generation")),e.push(new cR("metageneration")),e.push(new cR("name","fullPath",!0));let t=new cR("name");t.xform=function(e,t){return!ch(t)||t.length<2?t:ck(t)},e.push(t);let n=new cR("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new cR("timeCreated")),e.push(new cR("updated")),e.push(new cR("md5Hash",null,!0)),e.push(new cR("cacheControl",null,!0)),e.push(new cR("contentDisposition",null,!0)),e.push(new cR("contentEncoding",null,!0)),e.push(new cR("contentLanguage",null,!0)),e.push(new cR("contentType",null,!0)),e.push(new cR("metadata","customMetadata",!0)),cD=e}function cP(e,t,n){let r=cA(t);return null===r?null:function(e,t,n){let r={};r.type="file";let i=n.length;for(let e=0;e<i;e++){let i=n[e];r[i.local]=i.xform(r,t[i.server])}return Object.defineProperty(r,"ref",{get:function(){let t=new cu(r.bucket,r.fullPath);return e._makeStorageReference(t)}}),r}(e,r,n)}class cM{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function cU(e){if(!e)throw ci()}function cL(e){return function(t,n){var r,i;let s;return 401===t.getStatus()?s=t.getErrorText().includes("Firebase App Check token is invalid")?new cn(eL.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new cn(eL.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(r=e.bucket,s=new cn(eL.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,s=new cn(eL.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):s=n,s.status=t.getStatus(),s.serverResponse=n.serverResponse,s}}function cF(e){let t=cL(e);return function(n,r){var i;let s=t(n,r);return 404===n.getStatus()&&(i=e.path,s=new cn(eL.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),s.serverResponse=r.serverResponse,s}}class cV{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=eF.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=eF.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=eF.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r,i){if(this.sent_)throw cl("cannot .send() more than once");if(na(e)&&n&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==i)for(let e in i)i.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,i[e].toString());return void 0!==r?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw cl("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw cl("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return -1}}getResponse(){if(!this.sent_)throw cl("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw cl("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class cq extends cV{initXhr(){this.xhr_.responseType="text"}}function cB(){return new cq}class cG extends cV{initXhr(){this.xhr_.responseType="blob"}}function cz(){return new cG}class cH{constructor(e,t){this._service=e,t instanceof cu?this._location=t:this._location=cu.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new cH(e,t)}get root(){let e=new cu(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return ck(this._location.path)}get storage(){return this._service}get parent(){let e=function(e){if(0===e.length)return null;let t=e.lastIndexOf("/");return -1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;let t=new cu(this._location.bucket,e);return new cH(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw new cn(eL.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}}function c$(e,t,n){e._throwIfRoot("uploadBytes");let r=function(e,t,n,r,i){let s,a=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},l=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+l;let u=((s=Object.assign({},i)).fullPath=t.path,s.size=r.size(),s.contentType||(s.contentType=r&&r.type()||"application/octet-stream"),s),c="--"+l+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+function(e,t){let n={},r=t.length;for(let i=0;i<r;i++){let r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}(u,n)+"\r\n--"+l+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h=cN.getBlob(c,r,"\r\n--"+l+"--");if(null===h)throw new cn(eL.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.");let d={name:u.fullPath},p=cm(a,e.host,e._protocol),f=e.maxUploadRetryTime,m=new cM(p,"POST",function(t,r){let i=cP(e,r,n);return cU(null!==i),i},f);return m.urlParams=d,m.headers=o,m.body=h.uploadData(),m.errorHandler=cL(t),m}(e.storage,e._location,cj(),new cN(t,!0),n);return e.storage.makeRequestWithTokens(r,cB).then(t=>({metadata:t,ref:e}))}function cK(e,t){let n=t?.[ct];return null==n?null:cu.makeFromBucketSpec(n,e)}class cW{constructor(e,t,n,r,i,s=!1){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._isUsingEmulator=s,this._bucket=null,this._host=ce,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,null!=r?this._bucket=cu.makeFromBucketSpec(r,this._host):this._bucket=cK(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=cu.makeFromBucketSpec(this._url,e):this._bucket=cK(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){cf("time",0,1/0,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){cf("time",0,1/0,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if(n9(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new cH(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new cc(ca());{let s=function(e,t,n,r,i,s,a=!0,o=!1){let l=cg(e.urlParams),u=e.url+l,c=Object.assign({},e.headers);return t&&(c["X-Firebase-GMPID"]=t),null!==n&&n.length>0&&(c.Authorization="Firebase "+n),c["X-Firebase-Storage-Version"]="webjs/"+(s??"AppManager"),null!==r&&(c["X-Firebase-AppCheck"]=r),new cy(u,e.method,c,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,a,o)}(e,this._appId,n,r,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){let[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}let cJ="@firebase/storage",cY="0.14.0",cX="storage";function cQ(e){var t,n,r,i;let s,a,o,l;return(t=e=nI(e))._throwIfRoot("getDownloadURL"),n=t.storage,r=t._location,i=cj(),s=cm(r.fullServerUrl(),n.host,n._protocol),a=n.maxOperationRetryTime,(o=new cM(s,"GET",function(e,t){let r=cP(n,t,i);return cU(null!==r),function(e,t,n,r){let i=cA(t);if(null===i||!ch(i.downloadTokens))return null;let s=i.downloadTokens;if(0===s.length)return null;let a=encodeURIComponent;return s.split(",").map(t=>{let i=e.bucket,s=e.fullPath;return cm("/b/"+a(i)+"/o/"+a(s),n,r)+cg({alt:"media",token:t})})[0]}(r,t,n.host,n._protocol)},a)).errorHandler=cF(r),l=o,t.storage.makeRequestWithTokens(l,cB).then(e=>{if(null===e)throw new cn(eL.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function cZ(e){var t,n,r;let i,s;return(t=e=nI(e))._throwIfRoot("deleteObject"),n=t.storage,(i=new cM(cm((r=t._location).fullServerUrl(),n.host,n._protocol),"DELETE",function(e,t){},n.maxOperationRetryTime)).successCodes=[200,204],i.errorHandler=cF(r),s=i,t.storage.makeRequestWithTokens(s,cB)}function c0(e,t){var n=e=nI(e);if(!(t&&/^[A-Za-z]+:\/\//.test(t)))return function e(t,n){var r;let i,s,a;if(t instanceof cW){if(null==t._bucket)throw new cn(eL.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+ct+"' property when initializing the app?");let r=new cH(t,t._bucket);return null!=n?e(r,n):r}if(void 0===n)return t;return r=t._location.path,i=n.split("/").filter(e=>e.length>0).join("/"),s=0===r.length?i:r+"/"+i,a=new cu(t._location.bucket,s),new cH(t.storage,a)}(n,t);if(n instanceof cW)return new cH(n,t);throw cs("To use ref(service, url), the first argument must be a Storage instance.")}function c1(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`;let i=na(t);i&&(no(`https://${e.host}/b`),nh("Storage",!0)),e._isUsingEmulator=!0,e._protocol=i?"https":"http";let{mockUserToken:s}=r;s&&(e._overrideAuthToken="string"==typeof s?s:nl(s,e.app.options.projectId))}(e,t,n,r)}function c2(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}n6(new nC(cX,function(e,{instanceIdentifier:t}){return new cW(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t,rs)},"PUBLIC").setMultipleInstances(!0)),rh(cJ,cY,""),rh(cJ,cY,"esm2020"),rh("firebase","12.6.0","app"),e.i(92953);let c5=new nm("auth","Firebase",c2()),c6=new nj("@firebase/auth");function c4(e,...t){c6.logLevel<=e_.ERROR&&c6.error(`Auth (${rs}): ${e}`,...t)}function c3(e,...t){throw he(e,...t)}function c8(e,...t){return he(e,...t)}function c7(e,t,n){return new nm("auth","Firebase",{...c2(),[t]:n}).create(t,{appName:e.name})}function c9(e){return c7(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function he(e,...t){if("string"!=typeof e){let n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return c5.create(e,...t)}function ht(e,t,...n){if(!e)throw he(t,...n)}function hn(e){let t="INTERNAL ASSERTION FAILED: "+e;throw c4(t),Error(t)}function hr(){return"u">typeof self&&self.location?.href||""}function hi(){return"u">typeof self&&self.location?.protocol||null}class hs{constructor(e,t){this.shortDelay=e,this.longDelay=t,function(e,t){e||hn(t)}(t>e,"Short delay should be less than long delay!"),this.isMobile="u">typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(nd())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){let e;return!("u">typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===hi()||"https:"===hi()||"object"==typeof(e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==e.id||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function ha(e,t){var n,r;n=e.emulator,r="Emulator should always be set here",n||hn(r);let{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}class ho{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"u">typeof self&&"fetch"in self?self.fetch:"u">typeof globalThis&&globalThis.fetch?globalThis.fetch:"u">typeof fetch?fetch:void hn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"u">typeof self&&"Headers"in self?self.Headers:"u">typeof globalThis&&globalThis.Headers?globalThis.Headers:"u">typeof Headers?Headers:void hn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"u">typeof self&&"Response"in self?self.Response:"u">typeof globalThis&&globalThis.Response?globalThis.Response:"u">typeof Response?Response:void hn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let hl={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},hu=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],hc=new hs(3e4,6e4);function hh(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function hd(e,t,n,r,i={}){return hp(e,i,async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});let a=nb({key:e.config.apiKey,...s}).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);let l={method:t,headers:o,...i};return"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&na(e.emulatorConfig.host)&&(l.credentials="include"),ho.fetch()(await hm(e,e.config.apiHost,n,a),l)})}async function hp(e,t,n){e._canInitEmulator=!1;let r={...hl,...t};try{let t=new hg(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw hy(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,n]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw hy(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw hy(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw hy(e,"user-disabled",s);let a=r[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw c7(e,a,n);c3(e,a)}}catch(t){if(t instanceof nf)throw t;c3(e,"network-request-failed",{message:String(t)})}}async function hf(e,t,n,r,i={}){let s=await hd(e,t,n,r,i);return"mfaPendingCredential"in s&&c3(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function hm(e,t,n,r){let i=`${t}${n}?${r}`,s=e.config.emulator?ha(e.config,i):`${e.config.apiScheme}://${i}`;return hu.includes(n)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class hg{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(c8(this.auth,"network-request-failed")),hc.get())})}}function hy(e,t,n){let r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);let i=c8(e,t,r);return i.customData._tokenResponse=n,i}function hv(e){return void 0!==e&&void 0!==e.enterprise}class hb{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function hx(e,t){return hd(e,"GET","/v2/recaptchaConfig",hh(e,t))}async function hw(e,t){return hd(e,"POST","/v1/accounts:delete",t)}async function hE(e,t){return hd(e,"POST","/v1/accounts:lookup",t)}function h_(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function hI(e,t=!1){let n=nI(e),r=await n.getIdToken(t),i=hT(r);ht(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");let s="object"==typeof i.firebase?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:r,authTime:h_(hC(i.auth_time)),issuedAtTime:h_(hC(i.iat)),expirationTime:h_(hC(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}}function hC(e){return 1e3*Number(e)}function hT(e){let[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return c4("JWT malformed, contained fewer than 3 sections"),null;try{let e=t9(n);if(!e)return c4("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return c4("Caught error parsing JWT payload as JSON",e?.toString()),null}}function hS(e){let t=hT(e);return ht(t,"internal-error"),ht(void 0!==t.exp,"internal-error"),ht(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function hN(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof nf&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class hA{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class hk{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=h_(this.lastLoginAt),this.creationTime=h_(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function hO(e){var t,n;let r=e.auth,i=await e.getIdToken(),s=await hN(e,hE(r,{idToken:i}));ht(s?.users.length,r,"internal-error");let a=s.users[0];e._notifyReloadListener(a);let o=a.providerUserInfo?.length?hD(a.providerUserInfo):[],l=(t=e.providerData,n=o,[...t.filter(e=>!n.some(t=>t.providerId===e.providerId)),...n]),u=e.isAnonymous,c=!(e.email&&a.passwordHash)&&!l?.length;Object.assign(e,{uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new hk(a.createdAt,a.lastLoginAt),isAnonymous:!!u&&c})}async function hR(e){let t=nI(e);await hO(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function hD(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function hj(e,t){let n=await hp(e,{},async()=>{let n=nb({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=await hm(e,r,"/v1/token",`key=${i}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let o={method:"POST",headers:a,body:n};return e.emulatorConfig&&na(e.emulatorConfig.host)&&(o.credentials="include"),ho.fetch()(s,o)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function hP(e,t){return hd(e,"POST","/v2/accounts:revokeToken",hh(e,t))}class hM{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ht(e.idToken,"internal-error"),ht(void 0!==e.idToken,"internal-error"),ht(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):hS(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ht(0!==e.length,"internal-error");let t=hS(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(ht(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:r,expiresIn:i}=await hj(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new hM;return n&&(ht("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(ht("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(ht("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new hM,this.toJSON())}_performRefresh(){return hn("not implemented")}}function hU(e,t){ht("string"==typeof e||void 0===e,"internal-error",{appName:t})}class hL{constructor({uid:e,auth:t,stsTokenManager:n,...r}){this.providerId="firebase",this.proactiveRefresh=new hA(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new hk(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){let t=await hN(this,this.stsTokenManager.getToken(this.auth,e));return ht(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return hI(this,e)}reload(){return hR(this)}_assign(e){this!==e&&(ht(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new hL({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){ht(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await hO(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(n9(this.auth.app))return Promise.reject(c9(this.auth));let e=await this.getIdToken();return await hN(this,hw(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let n=t.displayName??void 0,r=t.email??void 0,i=t.phoneNumber??void 0,s=t.photoURL??void 0,a=t.tenantId??void 0,o=t._redirectEventId??void 0,l=t.createdAt??void 0,u=t.lastLoginAt??void 0,{uid:c,emailVerified:h,isAnonymous:d,providerData:p,stsTokenManager:f}=t;ht(c&&f,e,"internal-error");let m=hM.fromJSON(this.name,f);ht("string"==typeof c,e,"internal-error"),hU(n,e.name),hU(r,e.name),ht("boolean"==typeof h,e,"internal-error"),ht("boolean"==typeof d,e,"internal-error"),hU(i,e.name),hU(s,e.name),hU(a,e.name),hU(o,e.name),hU(l,e.name),hU(u,e.name);let g=new hL({uid:c,auth:e,email:r,emailVerified:h,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:m,createdAt:l,lastLoginAt:u});return p&&Array.isArray(p)&&(g.providerData=p.map(e=>({...e}))),o&&(g._redirectEventId=o),g}static async _fromIdTokenResponse(e,t,n=!1){let r=new hM;r.updateFromServerResponse(t);let i=new hL({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await hO(i),i}static async _fromGetAccountInfoResponse(e,t,n){let r=t.users[0];ht(void 0!==r.localId,"internal-error");let i=void 0!==r.providerUserInfo?hD(r.providerUserInfo):[],s=!(r.email&&r.passwordHash)&&!i?.length,a=new hM;a.updateFromIdToken(n);let o=new hL({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new hk(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!i?.length}),o}}let hF=new Map;function hV(e){var t,n;t="Expected a class definition",e instanceof Function||hn(t);let r=hF.get(e);return r?(n="Instance stored in cache mismatched with class",r instanceof e||hn(n)):(r=new e,hF.set(e,r)),r}class hq{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function hB(e,t,n){return`firebase:${e}:${t}:${n}`}hq.type="NONE";class hG{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=hB(this.userKey,r.apiKey,i),this.fullPersistenceKey=hB("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await hE(this.auth,{idToken:e}).catch(()=>void 0);return t?hL._fromGetAccountInfoResponse(this.auth,t,e):null}return hL._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new hG(hV(hq),e,n);let r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=r[0]||hV(hq),s=hB(n,e.config.apiKey,e.name),a=null;for(let n of t)try{let t=await n._get(s);if(t){let r;if("string"==typeof t){let n=await hE(e,{idToken:t}).catch(()=>void 0);if(!n)break;r=await hL._fromGetAccountInfoResponse(e,n,t)}else r=hL._fromJSON(e,t);n!==i&&(a=r),i=n;break}}catch{}let o=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch{}}))),new hG(i,e,n)}}function hz(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(hW(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(hH(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(hY(t))return"Blackberry";if(hX(t))return"Webos";if(h$(t))return"Safari";if((t.includes("chrome/")||hK(t))&&!t.includes("edge/"))return"Chrome";if(hJ(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(n?.length===2)return n[1]}return"Other"}function hH(e=nd()){return/firefox\//i.test(e)}function h$(e=nd()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function hK(e=nd()){return/crios\//i.test(e)}function hW(e=nd()){return/iemobile/i.test(e)}function hJ(e=nd()){return/android/i.test(e)}function hY(e=nd()){return/blackberry/i.test(e)}function hX(e=nd()){return/webos/i.test(e)}function hQ(e=nd()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function hZ(e=nd()){return hQ(e)||hJ(e)||hX(e)||hY(e)||/windows phone/i.test(e)||hW(e)}function h0(e,t=[]){let n;switch(e){case"Browser":n=hz(nd());break;case"Worker":n=`${hz(nd())}-${e}`;break;default:n=e}let r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${rs}/${r}`}class h1{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,r)=>{try{let r=e(t);n(r)}catch(e){r(e)}});n.onAbort=t,this.queue.push(n);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function h2(e,t={}){return hd(e,"GET","/v2/passwordPolicy",hh(e,t))}class h5{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class h6{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new h4(this),this.idTokenSubscription=new h4(this),this.beforeStateQueue=new h1(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=c5,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=hV(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await hG.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await hE(this,{idToken:e}),n=await hL._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(n9(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),n=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,i=n?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===i)&&s?.user&&(n=s.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return(ht(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId)?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await hO(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("u"<typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(n9(this.app))return Promise.reject(c9(this));let t=e?nI(e):null;return t&&ht(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ht(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return n9(this.app)?Promise.reject(c9(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return n9(this.app)?Promise.reject(c9(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(hV(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new h5(await h2(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new nm("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await hP(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&hV(e)||this._popupRedirectResolver;ht(t,this,"argument-error"),this.redirectPersistenceManager=await hG.create(this,[hV(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ht(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{let n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ht(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=h0(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(n9(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&function(e,...t){c6.logLevel<=e_.WARN&&c6.warn(`Auth (${rs}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}class h4{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let n=new nE(e,void 0);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return ht(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let h3={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function h8(e){return`__${e}${Math.floor(1e6*Math.random())}`}class h7{constructor(){this.enterprise=new h9}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class h9{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let de="NO_RECAPTCHA";class dt{constructor(e){this.type="recaptcha-enterprise",this.auth=function(e){return nI(e)}(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{hx(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0===r.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new hb(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function r(t,n,r){let i=window.grecaptcha;hv(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(de)})}):r(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new h7().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{n(this.auth).then(n=>{if(!t&&hv(window.grecaptcha))r(n,e,i);else{var s;if("u"<typeof window)return void i(Error("RecaptchaVerifier is only supported in browser"));let t=h3.recaptchaEnterpriseScript;0!==t.length&&(t+=n),(s=t,h3.loadJS(s)).then(()=>{r(n,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function dn(e,t,n,r=!1,i=!1){let s,a=new dt(e);if(i)s=de;else try{s=await a.verify(n)}catch(e){s=await a.verify(n,!0)}let o={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function dr(e,t,n,r,i){if("EMAIL_PASSWORD_PROVIDER"===i)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return r(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await dn(e,t,n,"getOobCode"===n);return r(e,i)}});else{let i=await dn(e,t,n,"getOobCode"===n);return r(e,i)}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let i=await dn(e,t,n);return r(e,i).catch(async i=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);let i=await dn(e,t,n,!1,!0);return r(e,i)}return Promise.reject(i)})}{let i=await dn(e,t,n,!1,!0);return r(e,i)}}async function di(e){let t=nI(e),n=new hb(await hx(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new dt(t).verify()}function ds(e,t,n){let r=nI(e);ht(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");let i=!!n?.disableWarnings,s=da(t),{host:a,port:o}=function(e){let t=da(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let e=i[1];return{host:e,port:dl(r.substr(e.length+1))}}{let[e,t]=r.split(":");return{host:e,port:dl(t)}}}(t),l=null===o?"":`:${o}`,u={url:`${s}//${a}${l}/`},c=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){ht(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ht(ny(u,r.config.emulator)&&ny(c,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=c,r.settings.appVerificationDisabledForTesting=!0,na(a)?(no(`${s}//${a}${l}`),nh("Auth",!0)):i||function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"u">typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"u">typeof window&&"u">typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function da(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function dl(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class du{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return hn("not implemented")}_getIdTokenResponse(e){return hn("not implemented")}_linkToIdToken(e,t){return hn("not implemented")}_getReauthenticationResolver(e){return hn("not implemented")}}async function dc(e,t){return hd(e,"POST","/v1/accounts:signUp",t)}async function dh(e,t){return hf(e,"POST","/v1/accounts:signInWithPassword",hh(e,t))}async function dd(e,t){return hf(e,"POST","/v1/accounts:signInWithEmailLink",hh(e,t))}async function dp(e,t){return hf(e,"POST","/v1/accounts:signInWithEmailLink",hh(e,t))}class df extends du{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new df(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new df(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return dr(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",dh,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return dd(e,{email:this._email,oobCode:this._password});default:c3(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return dr(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",dc,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return dp(e,{idToken:t,email:this._email,oobCode:this._password});default:c3(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function dm(e,t){return hf(e,"POST","/v1/accounts:signInWithIdp",hh(e,t))}class dg extends du{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new dg(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):c3("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:n,...r}="string"==typeof e?JSON.parse(e):e;if(!t||!n)return null;let i=new dg(t,n);return i.idToken=r.idToken||void 0,i.accessToken=r.accessToken||void 0,i.secret=r.secret,i.nonce=r.nonce,i.pendingToken=r.pendingToken||null,i}_getIdTokenResponse(e){return dm(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,dm(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,dm(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=nb(t)}return e}}async function dy(e,t){return hd(e,"POST","/v1/accounts:sendVerificationCode",hh(e,t))}async function dv(e,t){return hf(e,"POST","/v1/accounts:signInWithPhoneNumber",hh(e,t))}async function db(e,t){let n=await hf(e,"POST","/v1/accounts:signInWithPhoneNumber",hh(e,t));if(n.temporaryProof)throw hy(e,"account-exists-with-different-credential",n);return n}let dx={USER_NOT_FOUND:"user-not-found"};async function dw(e,t){return hf(e,"POST","/v1/accounts:signInWithPhoneNumber",hh(e,{...t,operation:"REAUTH"}),dx)}class dE extends du{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new dE({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new dE({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return dv(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return db(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return dw(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new dE({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class d_{constructor(e){const t=nx(nw(e)),n=t.apiKey??null,r=t.oobCode??null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);ht(n&&r&&i,"argument-error"),this.apiKey=n,this.operation=i,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t,n,r,i=(n=(t=nx(nw(e)).link)?nx(nw(t)).deep_link_id:null,((r=nx(nw(e)).deep_link_id)?nx(nw(r)).link:null)||r||n||t||e);try{return new d_(i)}catch{return null}}}class dI{constructor(){this.providerId=dI.PROVIDER_ID}static credential(e,t){return df._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=d_.parseLink(t);return ht(n,"argument-error"),df._fromEmailAndCode(e,n.code,n.tenantId)}}dI.PROVIDER_ID="password",dI.EMAIL_PASSWORD_SIGN_IN_METHOD="password",dI.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class dC{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class dT extends dC{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class dS extends dT{constructor(){super("facebook.com")}static credential(e){return dg._fromParams({providerId:dS.PROVIDER_ID,signInMethod:dS.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return dS.credentialFromTaggedObject(e)}static credentialFromError(e){return dS.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return dS.credential(e.oauthAccessToken)}catch{return null}}}dS.FACEBOOK_SIGN_IN_METHOD="facebook.com",dS.PROVIDER_ID="facebook.com";class dN extends dT{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return dg._fromParams({providerId:dN.PROVIDER_ID,signInMethod:dN.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return dN.credentialFromTaggedObject(e)}static credentialFromError(e){return dN.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return dN.credential(t,n)}catch{return null}}}dN.GOOGLE_SIGN_IN_METHOD="google.com",dN.PROVIDER_ID="google.com";class dA extends dT{constructor(){super("github.com")}static credential(e){return dg._fromParams({providerId:dA.PROVIDER_ID,signInMethod:dA.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return dA.credentialFromTaggedObject(e)}static credentialFromError(e){return dA.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return dA.credential(e.oauthAccessToken)}catch{return null}}}dA.GITHUB_SIGN_IN_METHOD="github.com",dA.PROVIDER_ID="github.com";class dk extends dT{constructor(){super("twitter.com")}static credential(e,t){return dg._fromParams({providerId:dk.PROVIDER_ID,signInMethod:dk.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return dk.credentialFromTaggedObject(e)}static credentialFromError(e){return dk.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return dk.credential(t,n)}catch{return null}}}dk.TWITTER_SIGN_IN_METHOD="twitter.com",dk.PROVIDER_ID="twitter.com";class dO{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){return new dO({user:await hL._fromIdTokenResponse(e,n,r),providerId:dR(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new dO({user:e,providerId:dR(n),_tokenResponse:n,operationType:t})}}function dR(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class dD extends nf{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,dD.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new dD(e,t,n,r)}}function dj(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw dD._fromErrorAndOperation(e,n,t,r);throw n})}async function dP(e,t,n=!1){let r=await hN(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return dO._forOperation(e,"link",r)}async function dM(e,t,n=!1){let{auth:r}=e;if(n9(r.app))return Promise.reject(c9(r));let i="reauthenticate";try{let s=await hN(e,dj(r,i,t,e),n);ht(s.idToken,r,"internal-error");let a=hT(s.idToken);ht(a,r,"internal-error");let{sub:o}=a;return ht(e.uid===o,r,"user-mismatch"),dO._forOperation(e,i,s)}catch(e){throw e?.code==="auth/user-not-found"&&c3(r,"user-mismatch"),e}}async function dU(e,t,n=!1){if(n9(e.app))return Promise.reject(c9(e));let r="signIn",i=await dj(e,r,t),s=await dO._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}class dL{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?dF._fromServerResponse(e,t):"totpInfo"in t?dV._fromServerResponse(e,t):c3(e,"internal-error")}}class dF extends dL{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new dF(t)}}class dV extends dL{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new dV(t)}}function dq(e,t){return hd(e,"POST","/v2/accounts/mfaEnrollment:start",hh(e,t))}new WeakMap;let dB="__sak";class dG{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(dB,"1"),this.storage.removeItem(dB),Promise.resolve(!0)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class dz extends dG{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=hZ(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){let n;if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});let r=e.key;t?this.detachListener():this.stopPolling();let i=()=>{let e=this.storage.getItem(r);(t||this.localCache[r]!==e)&&this.notifyListeners(r,e)},s=this.storage.getItem(r);((n=nd()).indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0)&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}dz.type="LOCAL";class dH extends dG{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}dH.type="SESSION";class d${constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new d$(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:r}=e.data,i=this.handlersMap[n];if(!i?.size)return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(i).map(async t=>t(e.origin,r)),a=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function dK(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}d$.receivers=[];class dW{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let r,i,s="u">typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((a,o)=>{let l=dK("",20);s.port1.start();let u=setTimeout(()=>{o(Error("unsupported_event"))},n);i={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(u),r=setTimeout(()=>{o(Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(e.data.response);break;default:clearTimeout(u),clearTimeout(r),o(Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function dJ(){return window}function dY(){return void 0!==dJ().WorkerGlobalScope&&"function"==typeof dJ().importScripts}async function dX(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}let dQ="firebaseLocalStorageDb",dZ="firebaseLocalStorage",d0="fbase_key";class d1{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function d2(e,t){return e.transaction([dZ],t?"readwrite":"readonly").objectStore(dZ)}function d5(){let e=indexedDB.open(dQ,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(dZ,{keyPath:d0})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(dZ)?t(n):(n.close(),await new d1(indexedDB.deleteDatabase(dQ)).toPromise(),t(await d5()))})})}async function d6(e,t,n){return new d1(d2(e,!0).put({[d0]:t,value:n})).toPromise()}async function d4(e,t){let n=d2(e,!1).get(t),r=await new d1(n).toPromise();return void 0===r?null:r.value}function d3(e,t){return new d1(d2(e,!0).delete(t)).toPromise()}class d8{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await d5()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return dY()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=d$._getInstance(dY()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await dX(),!this.activeServiceWorker)return;this.sender=new dW(this.activeServiceWorker);let e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await d5();return await d6(e,dB,"1"),await d3(e,dB),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>d6(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>d4(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>d3(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new d1(d2(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;if(0!==e.length)for(let{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function d7(e,t){return hd(e,"POST","/v2/accounts/mfaSignIn:start",hh(e,t))}d8.type="LOCAL",h8("rcb"),new hs(3e4,6e4);let d9="recaptcha";async function pe(e,t,n){if(!e._getRecaptchaConfig())try{await di(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let r;if(r="string"==typeof t?{phoneNumber:t}:t,"session"in r){let t=r.session;if("phoneNumber"in r){ht("enroll"===t.type,e,"internal-error");let i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===de){ht(n?.type===d9,e,"argument-error");let r=await pt(e,t,n);return dq(e,r)}return dq(e,t)},a=dr(e,i,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{ht("signin"===t.type,e,"internal-error");let i=r.multiFactorHint?.uid||r.multiFactorUid;ht(i,e,"missing-multi-factor-info");let s={mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===de){ht(n?.type===d9,e,"argument-error");let r=await pt(e,t,n);return d7(e,r)}return d7(e,t)},o=dr(e,s,"mfaSmsSignIn",a,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"},i=async(e,t)=>{if(t.captchaResponse===de){ht(n?.type===d9,e,"argument-error");let r=await pt(e,t,n);return dy(e,r)}return dy(e,t)},s=dr(e,t,"sendVerificationCode",i,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{n?._reset()}}async function pt(e,t,n){ht(n.type===d9,e,"argument-error");let r=await n.verify();ht("string"==typeof r,e,"argument-error");let i={...t};if("phoneEnrollmentInfo"in i){let e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:s}}),i}if(!("phoneSignInInfo"in i))return Object.assign(i,{recaptchaToken:r}),i;{let e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}}class pn{constructor(e){this.providerId=pn.PROVIDER_ID,this.auth=function(e){return nI(e)}(e)}verifyPhoneNumber(e,t){return pe(this.auth,e,nI(t))}static credential(e,t){return dE._fromVerification(e,t)}static credentialFromResult(e){return pn.credentialFromTaggedObject(e)}static credentialFromError(e){return pn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?dE._fromTokenResponse(t,n):null}}function pr(e,t){return t?hV(t):(ht(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}pn.PROVIDER_ID="phone",pn.PHONE_SIGN_IN_METHOD="phone";class pi extends du{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return dm(e,this._buildIdpRequest())}_linkToIdToken(e,t){return dm(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return dm(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ps(e){return dU(e.auth,new pi(e),e.bypassAuthState)}function pa(e){let{auth:t,user:n}=e;return ht(n,t,"internal-error"),dM(n,new pi(e),e.bypassAuthState)}async function po(e){let{auth:t,user:n}=e;return ht(n,t,"internal-error"),dP(n,new pi(e),e.bypassAuthState)}class pl{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:a}=e;if(s)return void this.reject(s);let o={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ps;case"linkViaPopup":case"linkViaRedirect":return po;case"reauthViaPopup":case"reauthViaRedirect":return pa;default:c3(this.auth,"internal-error")}}resolve(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||hn(n),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||hn(n),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let pu=new hs(2e3,1e4);async function pc(e,t,n){if(n9(e.app))return Promise.reject(c8(e,"operation-not-supported-in-this-environment"));let r=nI(e);if(!(t instanceof dC))throw dC.name!==t.constructor.name&&c3(e,"argument-error"),c7(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`);let i=pr(r,n);return new ph(r,"signInViaPopup",t,i).executeNotNull()}class ph extends pl{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,ph.currentPopupAction&&ph.currentPopupAction.cancel(),ph.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return ht(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||hn(t);let n=dK();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(c8(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(c8(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ph.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(c8(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,pu.get())};e()}}ph.currentPopupAction=null;let pd=new Map;class pp extends pl{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=pd.get(this.auth._key());if(!e){try{let t=await pf(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}pd.set(this.auth._key(),e)}return this.bypassAuthState||pd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function pf(e,t){var n;let r=hB("pendingRedirect",(n=t).config.apiKey,n.name),i=hV(e._redirectPersistence);if(!await i._isAvailable())return!1;let s=await i._get(r)==="true";return await i._remove(r),s}function pm(e,t){pd.set(e._key(),t)}async function pg(e,t,n=!1){if(n9(e.app))return Promise.reject(c9(e));let r=nI(e),i=pr(r,t),s=new pp(r,i,n),a=await s.execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}class py{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return pb(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!pb(e)){let n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(c8(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(pv(e))}saveEventToCache(e){this.cachedEventUids.add(pv(e)),this.lastProcessedEventTime=Date.now()}}function pv(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function pb({type:e,error:t}){return"unknown"===e&&t?.code==="auth/no-auth-event"}async function px(e,t={}){return hd(e,"GET","/v1/projects",t)}let pw=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,pE=/^https?/;async function p_(e){if(e.config.emulator)return;let{authorizedDomains:t}=await px(e);for(let e of t)try{if(function(e){let t=hr(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){let i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!pE.test(n))return!1;if(pw.test(e))return r===e;let i=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}(e))return}catch{}c3(e,"unauthorized-domain")}let pI=new hs(3e4,6e4);function pC(){let e=dJ().___jsl;if(e?.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let pT=null,pS=new hs(5e3,15e3),pN={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},pA=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function pk(e){let t,n,r,i,s,a=await (pT=pT||new Promise((t,n)=>{function r(){pC(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{pC(),n(c8(e,"network-request-failed"))},timeout:pI.get()})}if(dJ().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(dJ().gapi?.load)r();else{var i;let t=h8("iframefcb");return dJ()[t]=()=>{gapi.load?r():n(c8(e,"network-request-failed"))},(i=`${h3.gapiScript}?onload=${t}`,h3.loadJS(i)).catch(e=>n(e))}}).catch(e=>{throw pT=null,e})),o=dJ().gapi;return ht(o,e,"internal-error"),a.open({where:document.body,url:(ht((t=e.config).authDomain,e,"auth-domain-config-required"),n=t.emulator?ha(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:rs},(i=pA.get(e.config.apiHost))&&(r.eid=i),(s=e._getFrameworks()).length&&(r.fw=s.join(",")),`${n}?${nb(r).slice(1)}`),messageHandlersFilter:o.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:pN,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});let i=c8(e,"network-request-failed"),s=dJ().setTimeout(()=>{r(i)},pS.get());function a(){dJ().clearTimeout(s),n(t)}t.ping(a).then(a,()=>{r(i)})}))}let pO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class pR{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let pD=encodeURIComponent("fac");async function pj(e,t,n,r,i,s){ht(e.config.authDomain,e,"auth-domain-config-required"),ht(e.config.apiKey,e,"invalid-api-key");let a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:rs,eventId:i};if(t instanceof dC)for(let[n,r]of(t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",!function(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())&&(a.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))a[n]=r;if(t instanceof dT){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}for(let t of(e.tenantId&&(a.tid=e.tenantId),Object.keys(a)))void 0===a[t]&&delete a[t];let o=await e._getAppCheckToken(),l=o?`#${pD}=${encodeURIComponent(o)}`:"";return`${function({config:e}){return e.emulator?ha(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${nb(a).slice(1)}${l}`}let pP="webStorageSupport",pM=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=dH,this._completeRedirectFn=pg,this._overrideRedirectResult=pm}async _openPopup(e,t,n,r){var i,s;i=this.eventManagers[e._key()]?.manager,s="_initialize() not called before _openPopup()",i||hn(s);let a=await pj(e,t,n,hr(),r);return function(e,t,n,r=500,i=600){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString(),o="",l={...pO,width:r.toString(),height:i.toString(),top:s,left:a},u=nd().toLowerCase();n&&(o=hK(u)?"_blank":n),hH(u)&&(t=t||"http://localhost",l.scrollbars="yes");let c=Object.entries(l).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=nd()){return hQ(e)&&!!window.navigator?.standalone}(u)&&"_self"!==o){var h,d;let e,n;return h=t||"",d=o,(e=document.createElement("a")).href=h,e.target=d,(n=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(n),new pR(null)}let p=window.open(t||"",o,c);ht(p,e,"popup-blocked");try{p.focus()}catch(e){}return new pR(p)}(e,a,dK())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=await pj(e,t,n,hr(),r),dJ().location.href=i,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var n;let{manager:e,promise:r}=this.eventManagers[t];return e?Promise.resolve(e):(n="If manager is not set, promise should be",r||hn(n),r)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){let t=await pk(e),n=new py(e);return t.register("authEvent",t=>(ht(t?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(pP,{type:pP},n=>{let r=n?.[0]?.[pP];void 0!==r&&t(!!r),c3(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=p_(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return hZ()||h$()||hQ()}};var pU="@firebase/auth",pL="1.11.1";class pF{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ht(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let pV=ni("authIdTokenMaxAge")||300,pq=null;h3={loadJS:e=>new Promise((t,n)=>{let r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{let t=c8("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},c="Browser",n6(new nC("auth",(e,{options:t})=>{let n,r,i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=i.options;ht(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});let u=new h6(i,s,a,{apiKey:o,authDomain:l,clientPlatform:c,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:h0(c)});return r=(Array.isArray(n=t?.persistence||[])?n:[n]).map(hV),t?.errorMap&&u._updateErrorMap(t.errorMap),u._initializeWithPersistence(r,t?.popupRedirectResolver),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),n6(new nC("auth-internal",e=>new pF(nI(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),rh(pU,pL,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(c)),rh(pU,pL,"esm2020"),e.s([],58556),e.i(58556);let pB=ra({apiKey:t1.default.env.NEXT_PUBLIC_FIREBASE_API_KEY||"demo-api-key",authDomain:t1.default.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"social-stitch.firebaseapp.com",projectId:t1.default.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"social-stitch",storageBucket:t1.default.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"social-stitch.firebasestorage.app",messagingSenderId:t1.default.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"",appId:t1.default.env.NEXT_PUBLIC_FIREBASE_APP_ID||""}),pG=function(e,t){let n=n4("object"==typeof e?e:rl(),"firestore").getImmediate({identifier:"string"==typeof e?e:iq});if(!n._initialized){let e=nn("firestore");e&&ur(n,...e)}return n}(pB),pz=function(e=rl(),t){let n=n4(e=nI(e),cX).getImmediate({identifier:void 0}),r=nn("storage");return r&&c1(n,...r),n}(pB),pH=function(e=rl()){let t=n4(e,"auth");if(t.isInitialized())return t.getImmediate();let n=function(e,t){let n=n4(e,"auth");if(n.isInitialized()){let e=n.getImmediate();if(ny(n.getOptions(),t??{}))return e;c3(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:pM,persistence:[d8,dz,dH]}),r=ni("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(r,location.origin);if(location.origin===e.origin){let t,r=(t=e.toString(),async e=>{let n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>pV)return;let i=n?.token;pq!==i&&(pq=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});nI(n).beforeAuthStateChanged(r,()=>r(n.currentUser)),nI(n).onIdTokenChanged(e=>r(e),void 0,void 0)}}let i=nt("auth");return i&&ds(n,`http://${i}`),n}(pB);if("true"===t1.default.env.NEXT_PUBLIC_USE_EMULATORS)try{ur(pG,"localhost",8080),c1(pz,"localhost",9199),ds(pH,"http://localhost:9099"),console.log("Connected to Firebase emulators")}catch(e){}let p$=t1.default.env.NEXT_PUBLIC_FIREBASE_FUNCTIONS_URL||"http://localhost:5001/social-stitch/us-central1",pK=e=>`${p$}/${e}`,pW="styles";function pJ(){let e=pH.currentUser;if(!e)throw Error("No authenticated user. Please sign in.");return e.uid}async function pY(e,t){var n;let r=pJ(),i=crypto.randomUUID(),s=t||e.name.replace(/\.[^/.]+$/,"")||"Untitled Style",a=c0(pz,`styles/${r}/${i}`);await c$(n=nI(a),e,void 0);let o=await cQ(a),l={userId:r,name:s,imageUrl:o,storagePath:`styles/${r}/${i}`,createdAt:il.now()};return{id:(await u7(uo(pG,pW),l)).id,imageUrl:o,name:s,createdAt:l.createdAt.toDate()}}async function pX(){let e=pJ();try{let t=uz(uo(pG,pW),u$("userId","==",e),uJ("createdAt","desc")),n=await u3(t),r=[];return n.forEach(e=>{let t=e.data();r.push({id:e.id,imageUrl:t.imageUrl,name:t.name,createdAt:t.createdAt.toDate()})}),r}catch(t){if(t?.code==="failed-precondition"){console.log("Index still building, using fallback query...");let t=uz(uo(pG,pW),u$("userId","==",e)),n=await u3(t),r=[];return n.forEach(e=>{let t=e.data();r.push({id:e.id,imageUrl:t.imageUrl,name:t.name,createdAt:t.createdAt?.toDate()||new Date})}),r.sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime()),r}throw t}}async function pQ(e){let t=pJ(),n=ul(pG,pW,e),r=uz(uo(pG,pW),u$("userId","==",t)),i=await u3(r),s=null;if(i.forEach(t=>{t.id===e&&(s=t.data().storagePath)}),s)try{let e=c0(pz,s);await cZ(e)}catch(e){console.warn("Failed to delete image from storage:",e)}await u8(n)}let pZ=({onUpload:e})=>{let[t,n]=(0,tG.useState)(!1),[r,i]=(0,tG.useState)([]),[s,a]=(0,tG.useState)(!0),[o,l]=(0,tG.useState)(!0),[u,c]=(0,tG.useState)(!1),[h,d]=(0,tG.useState)(null);(0,tG.useEffect)(()=>{p()},[]);let p=async()=>{try{let e=await pX();i(e)}catch(e){console.error("Failed to load saved styles:",e)}finally{a(!1)}},f=async t=>{if(!t.type.startsWith("image/"))return void alert("Please upload an image file.");c(!0);let n=new FileReader;n.onload=async n=>{let r=n.target?.result;if(o)try{let e=await pY(t);i(t=>[e,...t])}catch(e){console.error("Failed to save style:",e)}e({id:crypto.randomUUID(),file:t,previewUrl:URL.createObjectURL(t),base64:r.split(",")[1]}),c(!1)},n.readAsDataURL(t)},m=async t=>{try{let n=await fetch(t.imageUrl),r=await n.blob(),i=new File([r],t.name,{type:r.type}),s=new FileReader;s.onload=n=>{let r=n.target?.result;e({id:crypto.randomUUID(),file:i,previewUrl:t.imageUrl,base64:r.split(",")[1]})},s.readAsDataURL(r)}catch(e){console.error("Failed to load saved style:",e),alert("Failed to load this style. Please try again.")}},g=async(e,t)=>{if(e.stopPropagation(),!h){d(t);try{await pQ(t),i(e=>e.filter(e=>e.id!==t))}catch(e){console.error("Failed to delete style:",e),alert("Failed to delete style. Please try again.")}finally{d(null)}}};return(0,tB.jsxs)("div",{className:"max-w-xl mx-auto",children:[(0,tB.jsxs)("div",{className:"relative group",children:[t&&(0,tB.jsx)("div",{className:"absolute -inset-1 rounded-2xl animate-gradient-border opacity-75 blur-sm"}),(0,tB.jsx)("div",{className:`
            relative rounded-2xl p-10 text-center transition-all cursor-pointer overflow-hidden
            ${t?"bg-indigo-50 border-2 border-indigo-400 shadow-lg shadow-indigo-500/10":"bg-white border-2 border-slate-200 hover:border-indigo-300 hover:shadow-md"}
            ${u?"pointer-events-none opacity-70":""}
          `,onDrop:e=>{e.preventDefault(),n(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&f(e.dataTransfer.files[0])},onDragOver:e=>{e.preventDefault(),n(!0)},onDragLeave:e=>{e.preventDefault(),n(!1)},onClick:()=>!u&&document.getElementById("fileInput")?.click(),children:u?(0,tB.jsxs)("div",{className:"py-8",children:[(0,tB.jsx)(tX,{size:48,className:"mx-auto mb-4 text-indigo-500 animate-spin"}),(0,tB.jsx)("p",{className:"text-slate-600 font-medium",children:"Processing your image..."})]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)("div",{className:`
                w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-5 transition-all
                ${t?"bg-indigo-500 text-white scale-110":"bg-gradient-to-br from-indigo-50 to-slate-100 text-indigo-500"}
              `,children:(0,tB.jsx)(tZ,{size:28,strokeWidth:1.5})}),(0,tB.jsx)("h3",{className:"text-xl font-display font-semibold text-slate-800 mb-2",children:"Upload your Apparel Style"}),(0,tB.jsx)("p",{className:"text-slate-500 mb-2",children:"Drag and drop a photo of your t-shirt or garment."}),(0,tB.jsx)("p",{className:"text-xs text-slate-400 mb-6",children:"Flat lay or ghost mannequin photos work best."}),(0,tB.jsx)("input",{id:"fileInput",type:"file",className:"hidden",accept:"image/*",onChange:e=>e.target.files&&f(e.target.files[0])}),(0,tB.jsx)("button",{className:"bg-gradient-to-r from-indigo-600 to-indigo-500 text-white px-6 py-2.5 rounded-xl font-semibold hover:from-indigo-700 hover:to-indigo-600 transition-all shadow-md shadow-indigo-500/20 hover:shadow-lg hover:shadow-indigo-500/25",children:"Select Photo"})]})})]}),(0,tB.jsxs)("div",{className:"mt-4 flex items-center justify-center gap-3",children:[(0,tB.jsx)("button",{onClick:()=>l(!o),className:`
            relative w-11 h-6 rounded-full transition-colors duration-200
            ${o?"bg-indigo-600":"bg-slate-200"}
          `,children:(0,tB.jsx)("span",{className:`
            absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow-sm transition-transform duration-200
            ${o?"translate-x-5":"translate-x-0"}
          `})}),(0,tB.jsx)("span",{className:"text-sm text-slate-600",children:"Save to library for future use"})]}),(0,tB.jsxs)("div",{className:"mt-6 p-4 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl border border-amber-200/50 flex gap-3",children:[(0,tB.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center",children:(0,tB.jsx)(tQ,{size:20,className:"text-amber-600"})}),(0,tB.jsxs)("div",{className:"text-sm",children:[(0,tB.jsx)("p",{className:"font-semibold text-amber-800 mb-0.5",children:"Pro Tip"}),(0,tB.jsxs)("p",{className:"text-amber-700 leading-relaxed",children:["Upload the actual garment photo. We'll use ",(0,tB.jsx)("span",{className:"font-medium",children:"Gemini 3 Pro"})," to faithfully place this exact item on a model in your chosen setting."]})]})]}),(0,tB.jsxs)("div",{className:"mt-10",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,tB.jsx)(tY,{size:16,className:"text-slate-400"}),(0,tB.jsx)("h4",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide",children:"Saved Styles"})]}),s?(0,tB.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,tB.jsx)(tX,{size:24,className:"animate-spin text-indigo-500"})}):0===r.length?(0,tB.jsxs)("div",{className:"text-center py-10 bg-gradient-to-b from-slate-50 to-white rounded-2xl border border-dashed border-slate-200",children:[(0,tB.jsx)("div",{className:"w-14 h-14 bg-slate-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,tB.jsx)(t0,{size:24,className:"text-slate-400"})}),(0,tB.jsx)("p",{className:"text-slate-500 text-sm font-medium mb-1",children:"No saved styles yet"}),(0,tB.jsx)("p",{className:"text-slate-400 text-xs",children:"Upload a style and it'll appear here for quick access"})]}):(0,tB.jsx)("div",{className:"grid grid-cols-3 gap-3 stagger-children",children:r.map(e=>(0,tB.jsxs)("div",{className:"group relative aspect-square rounded-xl overflow-hidden border-2 border-slate-200 hover:border-indigo-400 transition-all cursor-pointer hover-lift",onClick:()=>m(e),children:[(0,tB.jsx)("img",{src:e.imageUrl,alt:e.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"}),(0,tB.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:(0,tB.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-3",children:(0,tB.jsx)("p",{className:"text-white text-xs font-medium truncate",children:e.name})})}),(0,tB.jsx)("button",{onClick:t=>g(t,e.id),disabled:h===e.id,className:"absolute top-2 right-2 w-7 h-7 bg-red-500/90 backdrop-blur-sm text-white rounded-lg flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all hover:bg-red-600 hover:scale-110 disabled:opacity-50",title:"Delete style",children:h===e.id?(0,tB.jsx)(tX,{size:14,className:"animate-spin"}):(0,tB.jsx)(tJ,{size:14})})]},e.id))})]})]})};class p0{}function p1(e,t){return e.replace(/\{([^}]+)\}/g,(e,n)=>{if(Object.prototype.hasOwnProperty.call(t,n)){let e=t[n];return null!=e?String(e):""}throw Error(`Key '${n}' not found in valueMap.`)})}function p2(e,t,n){for(let r=0;r<t.length-1;r++){let i=t[r];if(i.endsWith("[]")){let s=i.slice(0,-2);if(!(s in e))if(Array.isArray(n))e[s]=Array.from({length:n.length},()=>({}));else throw Error(`Value must be a list given an array path ${i}`);if(Array.isArray(e[s])){let i=e[s];if(Array.isArray(n))for(let e=0;e<i.length;e++)p2(i[e],t.slice(r+1),n[e]);else for(let e of i)p2(e,t.slice(r+1),n)}return}if(i.endsWith("[0]")){let s=i.slice(0,-3);s in e||(e[s]=[{}]),p2(e[s][0],t.slice(r+1),n);return}e[i]&&"object"==typeof e[i]||(e[i]={}),e=e[i]}let r=t[t.length-1],i=e[r];if(void 0!==i){if(!n||"object"==typeof n&&0===Object.keys(n).length||n===i)return;if("object"==typeof i&&"object"==typeof n&&null!==i&&null!==n)Object.assign(i,n);else throw Error(`Cannot set value for an existing key. Key: ${r}`)}else"_self"!==r||"object"!=typeof n||null===n||Array.isArray(n)?e[r]=n:Object.assign(e,n)}function p5(e,t,n){try{if(1===t.length&&"_self"===t[0])return e;for(let r=0;r<t.length;r++){if("object"!=typeof e||null===e)return n;let i=t[r];if(i.endsWith("[]")){let s=i.slice(0,-2);if(!(s in e))return n;{let i=e[s];if(!Array.isArray(i))return n;return i.map(e=>p5(e,t.slice(r+1),n))}}e=e[i]}return e}catch(e){if(e instanceof TypeError)return n;throw e}}function p6(e){if("string"!=typeof e)throw Error("fromImageBytes must be a string");return e}function p4(e){var t;let n,r,i,s,a={},o=p5(e,["name"]);null!=o&&p2(a,["name"],o);let l=p5(e,["metadata"]);null!=l&&p2(a,["metadata"],l);let u=p5(e,["done"]);null!=u&&p2(a,["done"],u);let c=p5(e,["error"]);null!=c&&p2(a,["error"],c);let h=p5(e,["response"]);return null!=h&&p2(a,["response"],(n={},null!=(r=p5(t=h,["sdkHttpResponse"]))&&p2(n,["sdkHttpResponse"],r),null!=(i=p5(t,["parent"]))&&p2(n,["parent"],i),null!=(s=p5(t,["documentName"]))&&p2(n,["documentName"],s),n)),a}(h=eV||(eV={})).OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",h.OUTCOME_OK="OUTCOME_OK",h.OUTCOME_FAILED="OUTCOME_FAILED",h.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED",(d=eq||(eq={})).LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",d.PYTHON="PYTHON",(p=eB||(eB={})).SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",p.SILENT="SILENT",p.WHEN_IDLE="WHEN_IDLE",p.INTERRUPT="INTERRUPT",(f=eG||(eG={})).TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",f.STRING="STRING",f.NUMBER="NUMBER",f.INTEGER="INTEGER",f.BOOLEAN="BOOLEAN",f.ARRAY="ARRAY",f.OBJECT="OBJECT",f.NULL="NULL",(m=ez||(ez={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",m.MODE_DYNAMIC="MODE_DYNAMIC",(g=eH||(eH={})).API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",g.SIMPLE_SEARCH="SIMPLE_SEARCH",g.ELASTIC_SEARCH="ELASTIC_SEARCH",(y=e$||(e$={})).AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",y.NO_AUTH="NO_AUTH",y.API_KEY_AUTH="API_KEY_AUTH",y.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",y.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",y.OAUTH="OAUTH",y.OIDC_AUTH="OIDC_AUTH",(v=eK||(eK={})).HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",v.HTTP_IN_QUERY="HTTP_IN_QUERY",v.HTTP_IN_HEADER="HTTP_IN_HEADER",v.HTTP_IN_PATH="HTTP_IN_PATH",v.HTTP_IN_BODY="HTTP_IN_BODY",v.HTTP_IN_COOKIE="HTTP_IN_COOKIE",(b=eW||(eW={})).PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",b.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",b.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",b.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",b.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",b.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",b.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH",(x=eJ||(eJ={})).THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",x.LOW="LOW",x.HIGH="HIGH",(w=eY||(eY={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",w.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",w.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",w.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",w.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",w.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",w.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",w.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",w.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",w.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",w.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK",(E=eX||(eX={})).HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",E.SEVERITY="SEVERITY",E.PROBABILITY="PROBABILITY",(_=eQ||(eQ={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",_.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",_.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",_.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",_.BLOCK_NONE="BLOCK_NONE",_.OFF="OFF",(I=eZ||(eZ={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",I.STOP="STOP",I.MAX_TOKENS="MAX_TOKENS",I.SAFETY="SAFETY",I.RECITATION="RECITATION",I.LANGUAGE="LANGUAGE",I.OTHER="OTHER",I.BLOCKLIST="BLOCKLIST",I.PROHIBITED_CONTENT="PROHIBITED_CONTENT",I.SPII="SPII",I.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",I.IMAGE_SAFETY="IMAGE_SAFETY",I.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",I.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",I.NO_IMAGE="NO_IMAGE",(C=e0||(e0={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",C.NEGLIGIBLE="NEGLIGIBLE",C.LOW="LOW",C.MEDIUM="MEDIUM",C.HIGH="HIGH",(T=e1||(e1={})).HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",T.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",T.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",T.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",T.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH",(S=e2||(e2={})).URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",S.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",S.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",S.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",S.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE",(N=e5||(e5={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",N.SAFETY="SAFETY",N.OTHER="OTHER",N.BLOCKLIST="BLOCKLIST",N.PROHIBITED_CONTENT="PROHIBITED_CONTENT",N.IMAGE_SAFETY="IMAGE_SAFETY",N.MODEL_ARMOR="MODEL_ARMOR",N.JAILBREAK="JAILBREAK",(A=e6||(e6={})).TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",A.ON_DEMAND="ON_DEMAND",A.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT",(k=e4||(e4={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",k.TEXT="TEXT",k.IMAGE="IMAGE",k.AUDIO="AUDIO",(O=e3||(e3={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",O.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",O.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",O.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(R=e8||(e8={})).TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",R.TUNING_MODE_FULL="TUNING_MODE_FULL",R.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER",(D=e7||(e7={})).ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",D.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",D.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",D.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",D.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",D.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",D.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO",(j=e9||(e9={})).JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",j.JOB_STATE_QUEUED="JOB_STATE_QUEUED",j.JOB_STATE_PENDING="JOB_STATE_PENDING",j.JOB_STATE_RUNNING="JOB_STATE_RUNNING",j.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",j.JOB_STATE_FAILED="JOB_STATE_FAILED",j.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",j.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",j.JOB_STATE_PAUSED="JOB_STATE_PAUSED",j.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",j.JOB_STATE_UPDATING="JOB_STATE_UPDATING",j.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",(P=te||(te={})).TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",P.TUNING_TASK_I2V="TUNING_TASK_I2V",P.TUNING_TASK_T2V="TUNING_TASK_T2V",P.TUNING_TASK_R2V="TUNING_TASK_R2V",(M=tt||(tt={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",M.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",M.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",M.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(U=tn||(tn={})).FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",U.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",U.BALANCED="BALANCED",U.PRIORITIZE_COST="PRIORITIZE_COST",(L=tr||(tr={})).UNSPECIFIED="UNSPECIFIED",L.BLOCKING="BLOCKING",L.NON_BLOCKING="NON_BLOCKING",(F=ti||(ti={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",F.MODE_DYNAMIC="MODE_DYNAMIC",(V=ts||(ts={})).ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",V.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER",(q=ta||(ta={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",q.AUTO="AUTO",q.ANY="ANY",q.NONE="NONE",q.VALIDATED="VALIDATED",(B=to||(to={})).BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",B.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",B.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",B.BLOCK_NONE="BLOCK_NONE",(G=tl||(tl={})).DONT_ALLOW="DONT_ALLOW",G.ALLOW_ADULT="ALLOW_ADULT",G.ALLOW_ALL="ALLOW_ALL",(z=tu||(tu={})).auto="auto",z.en="en",z.ja="ja",z.ko="ko",z.hi="hi",z.zh="zh",z.pt="pt",z.es="es",(H=tc||(tc={})).MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",H.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",H.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",H.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",H.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC",($=th||(th={})).CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",$.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",$.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",$.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH",(K=td||(td={})).SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",K.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",K.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",K.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT",(W=tp||(tp={})).EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",W.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",W.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",W.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",W.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",W.EDIT_MODE_STYLE="EDIT_MODE_STYLE",W.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",W.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE",(J=tf||(tf={})).FOREGROUND="FOREGROUND",J.BACKGROUND="BACKGROUND",J.PROMPT="PROMPT",J.SEMANTIC="SEMANTIC",J.INTERACTIVE="INTERACTIVE",(Y=tm||(tm={})).ASSET="ASSET",Y.STYLE="STYLE",(X=tg||(tg={})).INSERT="INSERT",X.REMOVE="REMOVE",X.REMOVE_STATIC="REMOVE_STATIC",X.OUTPAINT="OUTPAINT",(Q=ty||(ty={})).OPTIMIZED="OPTIMIZED",Q.LOSSLESS="LOSSLESS",(Z=tv||(tv={})).SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",Z.PREFERENCE_TUNING="PREFERENCE_TUNING",(ee=tb||(tb={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",ee.STATE_PENDING="STATE_PENDING",ee.STATE_ACTIVE="STATE_ACTIVE",ee.STATE_FAILED="STATE_FAILED",(et=tx||(tx={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",et.PROCESSING="PROCESSING",et.ACTIVE="ACTIVE",et.FAILED="FAILED",(en=tw||(tw={})).SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",en.UPLOADED="UPLOADED",en.GENERATED="GENERATED",(er=tE||(tE={})).TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",er.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",er.RESPONSE_REJECTED="RESPONSE_REJECTED",er.NEED_MORE_INPUT="NEED_MORE_INPUT",(ei=t_||(t_={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",ei.TEXT="TEXT",ei.IMAGE="IMAGE",ei.VIDEO="VIDEO",ei.AUDIO="AUDIO",ei.DOCUMENT="DOCUMENT",(es=tI||(tI={})).START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",es.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",es.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW",(ea=tC||(tC={})).END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",ea.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",ea.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW",(eo=tT||(tT={})).ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",eo.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",eo.NO_INTERRUPTION="NO_INTERRUPTION",(el=tS||(tS={})).TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",el.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",el.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT",(eu=tN||(tN={})).SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",eu.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",eu.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",eu.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",eu.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",eu.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",eu.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",eu.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",eu.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",eu.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",eu.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",eu.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",eu.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR",(ec=tA||(tA={})).MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",ec.QUALITY="QUALITY",ec.DIVERSITY="DIVERSITY",ec.VOCALIZATION="VOCALIZATION",(eh=tk||(tk={})).PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",eh.PLAY="PLAY",eh.PAUSE="PAUSE",eh.STOP="STOP",eh.RESET_CONTEXT="RESET_CONTEXT";class p3{constructor(e){const t={};for(const n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class p8{get text(){var e,t,n,r,i,s,a,o;if((null==(r=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let l="",u=!1,c=[];for(let e of null!=(o=null==(a=null==(s=null==(i=this.candidates)?void 0:i[0])?void 0:s.content)?void 0:a.parts)?o:[]){for(let[t,n]of Object.entries(e))"text"!==t&&"thought"!==t&&"thoughtSignature"!==t&&(null!==n||void 0!==n)&&c.push(t);if("string"==typeof e.text){if("boolean"==typeof e.thought&&e.thought)continue;u=!0,l+=e.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?l:void 0}get data(){var e,t,n,r,i,s,a,o;if((null==(r=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let l="",u=[];for(let e of null!=(o=null==(a=null==(s=null==(i=this.candidates)?void 0:i[0])?void 0:s.content)?void 0:a.parts)?o:[]){for(let[t,n]of Object.entries(e))"inlineData"!==t&&(null!==n||void 0!==n)&&u.push(t);e.inlineData&&"string"==typeof e.inlineData.data&&(l+=atob(e.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),l.length>0?btoa(l):void 0}get functionCalls(){var e,t,n,r,i,s,a,o;if((null==(r=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let l=null==(o=null==(a=null==(s=null==(i=this.candidates)?void 0:i[0])?void 0:s.content)?void 0:a.parts)?void 0:o.filter(e=>e.functionCall).map(e=>e.functionCall).filter(e=>void 0!==e);if((null==l?void 0:l.length)!==0)return l}get executableCode(){var e,t,n,r,i,s,a,o,l;if((null==(r=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let u=null==(o=null==(a=null==(s=null==(i=this.candidates)?void 0:i[0])?void 0:s.content)?void 0:a.parts)?void 0:o.filter(e=>e.executableCode).map(e=>e.executableCode).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null==(l=null==u?void 0:u[0])?void 0:l.code}get codeExecutionResult(){var e,t,n,r,i,s,a,o,l;if((null==(r=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let u=null==(o=null==(a=null==(s=null==(i=this.candidates)?void 0:i[0])?void 0:s.content)?void 0:a.parts)?void 0:o.filter(e=>e.codeExecutionResult).map(e=>e.codeExecutionResult).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null==(l=null==u?void 0:u[0])?void 0:l.output}}class p7{}class p9{}class fe{}class ft{}class fn{}class fr{}class fi{}class fs{}class fa{}class fo{}class fl{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n,r=new fl;if(t){let t,r,i,s,a,o;t={},null!=(r=p5(e,["name"]))&&p2(t,["name"],r),null!=(i=p5(e,["metadata"]))&&p2(t,["metadata"],i),null!=(s=p5(e,["done"]))&&p2(t,["done"],s),null!=(a=p5(e,["error"]))&&p2(t,["error"],a),null!=(o=p5(e,["response"]))&&p2(t,["response"],function(e){let t={},n=p5(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,a,o;return n={},null!=(r=p5(e,["_self"]))&&p2(n,["video"],(i={},null!=(s=p5(t=r,["gcsUri"]))&&p2(i,["uri"],s),null!=(a=p5(t,["bytesBase64Encoded"]))&&p2(i,["videoBytes"],p6(a)),null!=(o=p5(t,["mimeType"]))&&p2(i,["mimeType"],o),i)),n})),p2(t,["generatedVideos"],e)}let r=p5(e,["raiMediaFilteredCount"]);null!=r&&p2(t,["raiMediaFilteredCount"],r);let i=p5(e,["raiMediaFilteredReasons"]);return null!=i&&p2(t,["raiMediaFilteredReasons"],i),t}(o)),n=t}else{let t,r,i,s,a,o;t={},null!=(r=p5(e,["name"]))&&p2(t,["name"],r),null!=(i=p5(e,["metadata"]))&&p2(t,["metadata"],i),null!=(s=p5(e,["done"]))&&p2(t,["done"],s),null!=(a=p5(e,["error"]))&&p2(t,["error"],a),null!=(o=p5(e,["response","generateVideoResponse"]))&&p2(t,["response"],function(e){let t={},n=p5(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,a,o;return n={},null!=(r=p5(e,["video"]))&&p2(n,["video"],(i={},null!=(s=p5(t=r,["uri"]))&&p2(i,["uri"],s),null!=(a=p5(t,["encodedVideo"]))&&p2(i,["videoBytes"],p6(a)),null!=(o=p5(t,["encoding"]))&&p2(i,["mimeType"],o),i)),n})),p2(t,["generatedVideos"],e)}let r=p5(e,["raiMediaFilteredCount"]);null!=r&&p2(t,["raiMediaFilteredCount"],r);let i=p5(e,["raiMediaFilteredReasons"]);return null!=i&&p2(t,["raiMediaFilteredReasons"],i),t}(o)),n=t}return Object.assign(r,n),r}}class fu{}class fc{}class fh{}class fd{}class fp{}class ff{}class fm{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){var n;let r,i,s,a,o,l,u,c,h,d,p=new fm;return Object.assign(p,(o={},null!=(l=p5(e,["name"]))&&p2(o,["name"],l),null!=(u=p5(e,["metadata"]))&&p2(o,["metadata"],u),null!=(c=p5(e,["done"]))&&p2(o,["done"],c),null!=(h=p5(e,["error"]))&&p2(o,["error"],h),null!=(d=p5(e,["response"]))&&p2(o,["response"],(r={},null!=(i=p5(n=d,["sdkHttpResponse"]))&&p2(r,["sdkHttpResponse"],i),null!=(s=p5(n,["parent"]))&&p2(r,["parent"],s),null!=(a=p5(n,["documentName"]))&&p2(r,["documentName"],a),r)),o)),p}}class fg{}class fy{}class fv{}class fb{}class fx{get text(){var e,t,n;let r="",i=!1,s=[];for(let a of null!=(n=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?n:[]){for(let[e,t]of Object.entries(a))"text"!==e&&"thought"!==e&&null!==t&&s.push(e);if("string"==typeof a.text){if("boolean"==typeof a.thought&&a.thought)continue;i=!0,r+=a.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?r:void 0}get data(){var e,t,n;let r="",i=[];for(let s of null!=(n=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?n:[]){for(let[e,t]of Object.entries(s))"inlineData"!==e&&null!==t&&i.push(e);s.inlineData&&"string"==typeof s.inlineData.data&&(r+=atob(s.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),r.length>0?btoa(r):void 0}}class fw{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class fE{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new fE;return Object.assign(n,p4(e)),n}}function f_(e,t){if(!t||"string"!=typeof t)throw Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw Error("invalid model parameter");if(e.isVertexAI())if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;else{if(!(t.indexOf("/")>=0))return`publishers/google/models/${t}`;let e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function fI(e,t){let n=f_(e,t);return n?n.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:n.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${n}`:n:""}function fC(e){return Array.isArray(e)?e.map(e=>fT(e)):[fT(e)]}function fT(e){if("object"==typeof e&&null!==e)return e;throw Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function fS(e){let t=fT(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function fN(e){let t=fT(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function fA(e){if(null==e)throw Error("PartUnion is required");if("object"==typeof e)return e;if("string"==typeof e)return{text:e};throw Error(`Unsupported part type: ${typeof e}`)}function fk(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("PartListUnion is required");return Array.isArray(e)?e.map(e=>fA(e)):[fA(e)]}function fO(e){return null!=e&&"object"==typeof e&&"parts"in e&&Array.isArray(e.parts)}function fR(e){return null!=e&&"object"==typeof e&&"functionCall"in e}function fD(e){return null!=e&&"object"==typeof e&&"functionResponse"in e}function fj(e){if(null==e)throw Error("ContentUnion is required");return fO(e)?e:{role:"user",parts:fk(e)}}function fP(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{let t=fj(e);return t.parts&&t.parts.length>0&&void 0!==t.parts[0].text?[t.parts[0].text]:[]});if(e.isVertexAI()){let e=fj(t);return e.parts&&e.parts.length>0&&void 0!==e.parts[0].text?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>fj(e)):[fj(t)]}function fM(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("contents are required");if(!Array.isArray(e)){if(fR(e)||fD(e))throw Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[fj(e)]}let t=[],n=[],r=fO(e[0]);for(let i of e){let e=fO(i);if(e!=r)throw Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(e)t.push(i);else if(fR(i)||fD(i))throw Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");else n.push(i)}return r||t.push({role:"user",parts:fk(n)}),t}function fU(e){let t={},n=["items"],r=["anyOf"],i=["properties"];if(e.type&&e.anyOf)throw Error("type and anyOf cannot be both populated.");let s=e.anyOf;for(let[a,o]of(null!=s&&2==s.length&&("null"===s[0].type?(t.nullable=!0,e=s[1]):"null"===s[1].type&&(t.nullable=!0,e=s[0])),e.type instanceof Array&&function(e,t){e.includes("null")&&(t.nullable=!0);let n=e.filter(e=>"null"!==e);if(1===n.length)t.type=Object.values(eG).includes(n[0].toUpperCase())?n[0].toUpperCase():eG.TYPE_UNSPECIFIED;else for(let e of(t.anyOf=[],n))t.anyOf.push({type:Object.values(eG).includes(e.toUpperCase())?e.toUpperCase():eG.TYPE_UNSPECIFIED})}(e.type,t),Object.entries(e)))if(null!=o)if("type"==a){if("null"===o)throw Error("type: null can not be the only possible type for the field.");if(o instanceof Array)continue;t.type=Object.values(eG).includes(o.toUpperCase())?o.toUpperCase():eG.TYPE_UNSPECIFIED}else if(n.includes(a))t[a]=fU(o);else if(r.includes(a)){let e=[];for(let n of o){if("null"==n.type){t.nullable=!0;continue}e.push(fU(n))}t[a]=e}else if(i.includes(a)){let e={};for(let[t,n]of Object.entries(o))e[t]=fU(n);t[a]=e}else{if("additionalProperties"===a)continue;t[a]=o}return t}function fL(e){if("object"==typeof e)return e;if("string"==typeof e)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw Error(`Unsupported speechConfig type: ${typeof e}`)}function fF(e){if("multiSpeakerVoiceConfig"in e)throw Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function fV(e){if(e.functionDeclarations)for(let t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=fU(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=fU(t.response));return e}function fq(e){if(null==e)throw Error("tools is required");if(!Array.isArray(e))throw Error("tools is required and must be an array of Tools");let t=[];for(let n of e)t.push(n);return t}function fB(e,t){if("string"!=typeof t)throw Error("name must be a string");return function(e,t,n,r=1){let i=!t.startsWith(`${n}/`)&&t.split("/").length===r;if(e.isVertexAI())if(t.startsWith("projects/"))return t;else if(t.startsWith("locations/"))return`projects/${e.getProject()}/${t}`;else if(t.startsWith(`${n}/`))return`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`;else if(i)return`projects/${e.getProject()}/locations/${e.getLocation()}/${n}/${t}`;else return t;return i?`${n}/${t}`:t}(e,t,"cachedContents")}function fG(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function fz(e){var t;let n;if(null!=e&&"object"==typeof e&&"name"in e&&(n=e.name),null==e||"object"!=typeof e||!("uri"in e)||void 0!==(n=e.uri)){if(null==e||"object"!=typeof e||!("video"in e)||void 0!==(n=null==(t=e.video)?void 0:t.uri)){if("string"==typeof e&&(n=e),void 0===n)throw Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){let e=n.split("files/")[1].match(/[a-z0-9]+/);if(null===e)throw Error(`Could not extract file name from URI ${n}`);n=e[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}}function fH(e,t){return e.isVertexAI()?t?"publishers/google/models":"models":t?"models":"tunedModels"}function f$(e){for(let r of["models","tunedModels","publisherModels"]){var t,n;if(t=e,n=r,null!==t&&"object"==typeof t&&n in t)return e[r]}return[]}function fK(e,t){let n;if("string"==typeof t)if(e.isVertexAI())if(t.startsWith("gs://"))n={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))n={format:"bigquery",bigqueryUri:t};else throw Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))n={fileName:t};else throw Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(e.isVertexAI())throw Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:t}}else n=t;let r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(e.isVertexAI()){if(i>0||1!==r)throw Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||1!==i)throw Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function fW(e){if("object"!=typeof e||null===e)return{};let t=e.inlinedResponses;if("object"!=typeof t||null===t)return e;let n=t.inlinedResponses;if(!Array.isArray(n)||0===n.length)return e;let r=!1;for(let e of n){if("object"!=typeof e||null===e)continue;let t=e.response;if("object"==typeof t&&null!==t&&void 0!==t.embedding){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),e}function fJ(e,t){if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw Error(`Invalid batch job name: ${t}.`)}function fY(e){if("BATCH_STATE_UNSPECIFIED"===e)return"JOB_STATE_UNSPECIFIED";if("BATCH_STATE_PENDING"===e)return"JOB_STATE_PENDING";if("BATCH_STATE_RUNNING"===e)return"JOB_STATE_RUNNING";if("BATCH_STATE_SUCCEEDED"===e)return"JOB_STATE_SUCCEEDED";if("BATCH_STATE_FAILED"===e)return"JOB_STATE_FAILED";else if("BATCH_STATE_CANCELLED"===e)return"JOB_STATE_CANCELLED";else if("BATCH_STATE_EXPIRED"===e)return"JOB_STATE_EXPIRED";else return e}function fX(e){let t={},n=p5(e,["name"]);null!=n&&p2(t,["name"],n);let r=p5(e,["metadata","displayName"]);null!=r&&p2(t,["displayName"],r);let i=p5(e,["metadata","state"]);null!=i&&p2(t,["state"],fY(i));let s=p5(e,["metadata","createTime"]);null!=s&&p2(t,["createTime"],s);let a=p5(e,["metadata","endTime"]);null!=a&&p2(t,["endTime"],a);let o=p5(e,["metadata","updateTime"]);null!=o&&p2(t,["updateTime"],o);let l=p5(e,["metadata","model"]);null!=l&&p2(t,["model"],l);let u=p5(e,["metadata","output"]);return null!=u&&p2(t,["dest"],function(e){let t={},n=p5(e,["responsesFile"]);null!=n&&p2(t,["fileName"],n);let r=p5(e,["inlinedResponses","inlinedResponses"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i;return n={},null!=(r=p5(t=e,["response"]))&&p2(n,["response"],function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["candidates"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=p5(e,["content"]);null!=n&&p2(t,["content"],n);let r=p5(e,["citationMetadata"]);null!=r&&p2(t,["citationMetadata"],function(e){let t={},n=p5(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["citations"],e)}return t}(r));let i=p5(e,["tokenCount"]);null!=i&&p2(t,["tokenCount"],i);let s=p5(e,["finishReason"]);null!=s&&p2(t,["finishReason"],s);let a=p5(e,["avgLogprobs"]);null!=a&&p2(t,["avgLogprobs"],a);let o=p5(e,["groundingMetadata"]);null!=o&&p2(t,["groundingMetadata"],o);let l=p5(e,["index"]);null!=l&&p2(t,["index"],l);let u=p5(e,["logprobsResult"]);null!=u&&p2(t,["logprobsResult"],u);let c=p5(e,["safetyRatings"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["safetyRatings"],e)}let h=p5(e,["urlContextMetadata"]);return null!=h&&p2(t,["urlContextMetadata"],h),t})(e))),p2(t,["candidates"],e)}let i=p5(e,["modelVersion"]);null!=i&&p2(t,["modelVersion"],i);let s=p5(e,["promptFeedback"]);null!=s&&p2(t,["promptFeedback"],s);let a=p5(e,["responseId"]);null!=a&&p2(t,["responseId"],a);let o=p5(e,["usageMetadata"]);return null!=o&&p2(t,["usageMetadata"],o),t}(r)),null!=(i=p5(t,["error"]))&&p2(n,["error"],i),n})),p2(t,["inlinedResponses"],e)}let i=p5(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["inlinedEmbedContentResponses"],e)}return t}(fW(u))),t}function fQ(e){var t,n;let r,i,s,a,o,l,u,c,h={},d=p5(e,["name"]);null!=d&&p2(h,["name"],d);let p=p5(e,["displayName"]);null!=p&&p2(h,["displayName"],p);let f=p5(e,["state"]);null!=f&&p2(h,["state"],fY(f));let m=p5(e,["error"]);null!=m&&p2(h,["error"],m);let g=p5(e,["createTime"]);null!=g&&p2(h,["createTime"],g);let y=p5(e,["startTime"]);null!=y&&p2(h,["startTime"],y);let v=p5(e,["endTime"]);null!=v&&p2(h,["endTime"],v);let b=p5(e,["updateTime"]);null!=b&&p2(h,["updateTime"],b);let x=p5(e,["model"]);null!=x&&p2(h,["model"],x);let w=p5(e,["inputConfig"]);null!=w&&p2(h,["src"],(r={},null!=(i=p5(n=w,["instancesFormat"]))&&p2(r,["format"],i),null!=(s=p5(n,["gcsSource","uris"]))&&p2(r,["gcsUri"],s),null!=(a=p5(n,["bigquerySource","inputUri"]))&&p2(r,["bigqueryUri"],a),r));let E=p5(e,["outputConfig"]);null!=E&&p2(h,["dest"],(t=fW(E),o={},null!=(l=p5(t,["predictionsFormat"]))&&p2(o,["format"],l),null!=(u=p5(t,["gcsDestination","outputUriPrefix"]))&&p2(o,["gcsUri"],u),null!=(c=p5(t,["bigqueryDestination","outputUri"]))&&p2(o,["bigqueryUri"],c),o));let _=p5(e,["completionStats"]);return null!=_&&p2(h,["completionStats"],_),h}function fZ(e){let t={},n=p5(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,a,o,l,u,c,h,d,p;return n={},null!=(r=p5(t=e,["mediaResolution"]))&&p2(n,["mediaResolution"],r),null!=(i=p5(t,["codeExecutionResult"]))&&p2(n,["codeExecutionResult"],i),null!=(s=p5(t,["executableCode"]))&&p2(n,["executableCode"],s),null!=(a=p5(t,["fileData"]))&&p2(n,["fileData"],function(e){let t={};if(void 0!==p5(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=p5(e,["fileUri"]);null!=n&&p2(t,["fileUri"],n);let r=p5(e,["mimeType"]);return null!=r&&p2(t,["mimeType"],r),t}(a)),null!=(o=p5(t,["functionCall"]))&&p2(n,["functionCall"],function(e){let t={},n=p5(e,["id"]);null!=n&&p2(t,["id"],n);let r=p5(e,["args"]);null!=r&&p2(t,["args"],r);let i=p5(e,["name"]);if(null!=i&&p2(t,["name"],i),void 0!==p5(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==p5(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(o)),null!=(l=p5(t,["functionResponse"]))&&p2(n,["functionResponse"],l),null!=(u=p5(t,["inlineData"]))&&p2(n,["inlineData"],function(e){let t={},n=p5(e,["data"]);if(null!=n&&p2(t,["data"],n),void 0!==p5(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=p5(e,["mimeType"]);return null!=r&&p2(t,["mimeType"],r),t}(u)),null!=(c=p5(t,["text"]))&&p2(n,["text"],c),null!=(h=p5(t,["thought"]))&&p2(n,["thought"],h),null!=(d=p5(t,["thoughtSignature"]))&&p2(n,["thoughtSignature"],d),null!=(p=p5(t,["videoMetadata"]))&&p2(n,["videoMetadata"],p),n})),p2(t,["parts"],e)}let r=p5(e,["role"]);return null!=r&&p2(t,["role"],r),t}function f0(e,t){let n={},r=p5(t,["model"]);null!=r&&p2(n,["_url","model"],f_(e,r));let i=p5(t,["src"]);null!=i&&p2(n,["batch","inputConfig"],function(e,t){let n={};if(void 0!==p5(t,["format"]))throw Error("format parameter is not supported in Gemini API.");if(void 0!==p5(t,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==p5(t,["bigqueryUri"]))throw Error("bigqueryUri parameter is not supported in Gemini API.");let r=p5(t,["fileName"]);null!=r&&p2(n,["fileName"],r);let i=p5(t,["inlinedRequests"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=p5(t,["model"]);null!=r&&p2(n,["request","model"],f_(e,r));let i=p5(t,["contents"]);if(null!=i){let e=fM(i);Array.isArray(e)&&(e=e.map(e=>fZ(e))),p2(n,["request","contents"],e)}let s=p5(t,["metadata"]);null!=s&&p2(n,["metadata"],s);let a=p5(t,["config"]);return null!=a&&p2(n,["request","generationConfig"],function(e,t,n){var r;let i,s,a,o={},l=p5(t,["systemInstruction"]);void 0!==n&&null!=l&&p2(n,["systemInstruction"],fZ(fj(l)));let u=p5(t,["temperature"]);null!=u&&p2(o,["temperature"],u);let c=p5(t,["topP"]);null!=c&&p2(o,["topP"],c);let h=p5(t,["topK"]);null!=h&&p2(o,["topK"],h);let d=p5(t,["candidateCount"]);null!=d&&p2(o,["candidateCount"],d);let p=p5(t,["maxOutputTokens"]);null!=p&&p2(o,["maxOutputTokens"],p);let f=p5(t,["stopSequences"]);null!=f&&p2(o,["stopSequences"],f);let m=p5(t,["responseLogprobs"]);null!=m&&p2(o,["responseLogprobs"],m);let g=p5(t,["logprobs"]);null!=g&&p2(o,["logprobs"],g);let y=p5(t,["presencePenalty"]);null!=y&&p2(o,["presencePenalty"],y);let v=p5(t,["frequencyPenalty"]);null!=v&&p2(o,["frequencyPenalty"],v);let b=p5(t,["seed"]);null!=b&&p2(o,["seed"],b);let x=p5(t,["responseMimeType"]);null!=x&&p2(o,["responseMimeType"],x);let w=p5(t,["responseSchema"]);null!=w&&p2(o,["responseSchema"],fU(w));let E=p5(t,["responseJsonSchema"]);if(null!=E&&p2(o,["responseJsonSchema"],E),void 0!==p5(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==p5(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let _=p5(t,["safetySettings"]);if(void 0!==n&&null!=_){let e=_;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=p5(e,["category"]);if(null!=n&&p2(t,["category"],n),void 0!==p5(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let r=p5(e,["threshold"]);return null!=r&&p2(t,["threshold"],r),t})(e))),p2(n,["safetySettings"],e)}let I=p5(t,["tools"]);if(void 0!==n&&null!=I){let e=fq(I);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=p5(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["functionDeclarations"],e)}if(void 0!==p5(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=p5(e,["googleSearchRetrieval"]);null!=r&&p2(t,["googleSearchRetrieval"],r);let i=p5(e,["computerUse"]);null!=i&&p2(t,["computerUse"],i);let s=p5(e,["fileSearch"]);null!=s&&p2(t,["fileSearch"],s);let a=p5(e,["codeExecution"]);if(null!=a&&p2(t,["codeExecution"],a),void 0!==p5(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=p5(e,["googleMaps"]);null!=o&&p2(t,["googleMaps"],function(e){let t={};if(void 0!==p5(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=p5(e,["enableWidget"]);return null!=n&&p2(t,["enableWidget"],n),t}(o));let l=p5(e,["googleSearch"]);null!=l&&p2(t,["googleSearch"],function(e){let t={};if(void 0!==p5(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==p5(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=p5(e,["timeRangeFilter"]);return null!=n&&p2(t,["timeRangeFilter"],n),t}(l));let u=p5(e,["urlContext"]);return null!=u&&p2(t,["urlContext"],u),t})(fV(e)))),p2(n,["tools"],e)}let C=p5(t,["toolConfig"]);if(void 0!==n&&null!=C&&p2(n,["toolConfig"],(i={},null!=(s=p5(r=C,["functionCallingConfig"]))&&p2(i,["functionCallingConfig"],function(e){let t={},n=p5(e,["mode"]);null!=n&&p2(t,["mode"],n);let r=p5(e,["allowedFunctionNames"]);if(null!=r&&p2(t,["allowedFunctionNames"],r),void 0!==p5(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(s)),null!=(a=p5(r,["retrievalConfig"]))&&p2(i,["retrievalConfig"],a),i)),void 0!==p5(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let T=p5(t,["cachedContent"]);void 0!==n&&null!=T&&p2(n,["cachedContent"],fB(e,T));let S=p5(t,["responseModalities"]);null!=S&&p2(o,["responseModalities"],S);let N=p5(t,["mediaResolution"]);null!=N&&p2(o,["mediaResolution"],N);let A=p5(t,["speechConfig"]);if(null!=A&&p2(o,["speechConfig"],fL(A)),void 0!==p5(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let k=p5(t,["thinkingConfig"]);null!=k&&p2(o,["thinkingConfig"],k);let O=p5(t,["imageConfig"]);return null!=O&&p2(o,["imageConfig"],function(e){let t={},n=p5(e,["aspectRatio"]);null!=n&&p2(t,["aspectRatio"],n);let r=p5(e,["imageSize"]);if(null!=r&&p2(t,["imageSize"],r),void 0!==p5(e,["outputMimeType"]))throw Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==p5(e,["outputCompressionQuality"]))throw Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}(O)),o}(e,a,p5(n,["request"],{}))),n})(e,t))),p2(n,["requests","requests"],t)}return n}(e,fK(e,i)));let s=p5(t,["config"]);return null!=s&&function(e,t){let n=p5(e,["displayName"]);if(void 0!==t&&null!=n&&p2(t,["batch","displayName"],n),void 0!==p5(e,["dest"]))throw Error("dest parameter is not supported in Gemini API.")}(s,n),n}(ed=tO||(tO={})).PAGED_ITEM_BATCH_JOBS="batchJobs",ed.PAGED_ITEM_MODELS="models",ed.PAGED_ITEM_TUNING_JOBS="tuningJobs",ed.PAGED_ITEM_FILES="files",ed.PAGED_ITEM_CACHED_CONTENTS="cachedContents",ed.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",ed.PAGED_ITEM_DOCUMENTS="documents";class f1{constructor(e,t,n,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,r)}init(e,t,n){var r,i;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=null==t?void 0:t.sdkHttpResponse,this.idxInternal=0;let s={config:{}};(s=n&&0!==Object.keys(n).length?"object"==typeof n?Object.assign({},n):n:{config:{}}).config&&(s.config.pageToken=t.nextPageToken),this.paramsInternal=s,this.pageInternalSize=null!=(i=null==(r=s.config)?void 0:r.pageSize)?i:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(!this.hasNextPage())return{value:void 0,done:!0};else await this.nextPage();let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return(null==(e=this.params.config)?void 0:e.pageToken)!==void 0}}class f2 extends p0{constructor(e){super(),this.apiClient=e,this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)},this.list=async(e={})=>new f1(tO.PAGED_ITEM_BATCH_JOBS,e=>this.listInternal(e),await this.listInternal(e),e)}createInlinedGenerateContentRequest(e){let t=f0(this.apiClient,e),n=p1("{model}:batchGenerateContent",t._url),r=t.batch.inputConfig.requests,i=r.requests,s=[];for(let e of i){let t=Object.assign({},e);if(t.systemInstruction){let e=t.systemInstruction;delete t.systemInstruction;let n=t.request;n.systemInstruction=e,t.request=n}s.push(t)}return r.requests=s,delete t.config,delete t._url,delete t._query,{path:n,body:t}}getGcsUri(e){return"string"==typeof e?e.startsWith("gs://")?e:void 0:!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0?e.gcsUri[0]:void 0}getBigqueryUri(e){return"string"==typeof e?e.startsWith("bq://")?e:void 0:Array.isArray(e)?void 0:e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},r=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${r}`),void 0===n.dest){let t=this.getGcsUri(e),i=this.getBigqueryUri(e);if(t)t.endsWith(".jsonl")?n.dest=`${t.slice(0,-6)}/dest`:n.dest=`${t}_dest_${r}`;else if(i)n.dest=`${i}_dest_${r}`;else throw Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,r,i,s;let a="",o={};if(this.apiClient.isVertexAI()){let r,i,l,u,c,h,d=(s=this.apiClient,r={},null!=(i=p5(e,["model"]))&&p2(r,["model"],f_(s,i)),null!=(l=p5(e,["src"]))&&p2(r,["inputConfig"],function(e){let t={},n=p5(e,["format"]);null!=n&&p2(t,["instancesFormat"],n);let r=p5(e,["gcsUri"]);null!=r&&p2(t,["gcsSource","uris"],r);let i=p5(e,["bigqueryUri"]);if(null!=i&&p2(t,["bigquerySource","inputUri"],i),void 0!==p5(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==p5(e,["inlinedRequests"]))throw Error("inlinedRequests parameter is not supported in Vertex AI.");return t}(fK(s,l))),null!=(u=p5(e,["config"]))&&(c=p5(u,["displayName"]),void 0!==r&&null!=c&&p2(r,["displayName"],c),h=p5(u,["dest"]),void 0!==r&&null!=h&&p2(r,["outputConfig"],function(e){let t={},n=p5(e,["format"]);null!=n&&p2(t,["predictionsFormat"],n);let r=p5(e,["gcsUri"]);null!=r&&p2(t,["gcsDestination","outputUriPrefix"],r);let i=p5(e,["bigqueryUri"]);if(null!=i&&p2(t,["bigqueryDestination","outputUri"],i),void 0!==p5(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==p5(e,["inlinedResponses"]))throw Error("inlinedResponses parameter is not supported in Vertex AI.");if(void 0!==p5(e,["inlinedEmbedContentResponses"]))throw Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}(function(e){if("string"!=typeof e)return e;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw Error(`Unsupported destination: ${e}`)}(h)))),r);return a=p1("batchPredictionJobs",d._url),o=d._query,delete d._url,delete d._query,this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(d),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>fQ(e))}{let t=f0(this.apiClient,e);return a=p1("{model}:batchGenerateContent",t._url),o=t._query,delete t._url,delete t._query,this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>fX(e))}}async createEmbeddingsInternal(e){var t,n,r,i,s;let a="",o={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let l,u,c,h,d,p,f,m,g=(r=this.apiClient,h={},null!=(d=p5(e,["model"]))&&p2(h,["_url","model"],f_(r,d)),null!=(p=p5(e,["src"]))&&p2(h,["batch","inputConfig"],(i=r,l={},null!=(u=p5(s=p,["fileName"]))&&p2(l,["file_name"],u),null!=(c=p5(s,["inlinedRequests"]))&&p2(l,["requests"],function(e,t){let n={},r=p5(t,["contents"]);if(null!=r){let t=fP(e,r);Array.isArray(t)&&(t=t.map(e=>e)),p2(n,["requests[]","request","content"],t)}let i=p5(t,["config"]);return null!=i&&(p2(n,["_self"],function(e,t){let n=p5(e,["taskType"]);void 0!==t&&null!=n&&p2(t,["requests[]","taskType"],n);let r=p5(e,["title"]);void 0!==t&&null!=r&&p2(t,["requests[]","title"],r);let i=p5(e,["outputDimensionality"]);if(void 0!==t&&null!=i&&p2(t,["requests[]","outputDimensionality"],i),void 0!==p5(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==p5(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.");return{}}(i,n)),!function(e,t){for(let[n,r]of Object.entries(t)){let t=n.split("."),i=r.split("."),s=new Set,a=-1;for(let e=0;e<t.length;e++)if("*"===t[e]){a=e;break}if(-1!==a&&i.length>a)for(let e=a;e<i.length;e++){let t=i[e];"*"===t||t.endsWith("[]")||t.endsWith("[0]")||s.add(t)}!function e(t,n,r,i,s){if(i>=n.length||"object"!=typeof t||null===t)return;let a=n[i];if(a.endsWith("[]")){let o=a.slice(0,-2);if(o in t&&Array.isArray(t[o]))for(let a of t[o])e(a,n,r,i+1,s)}else if("*"===a){if("object"==typeof t&&null!==t&&!Array.isArray(t)){let e=Object.keys(t).filter(e=>!e.startsWith("_")&&!s.has(e)),n={};for(let r of e)n[r]=t[r];for(let[e,s]of Object.entries(n)){let n=[];for(let t of r.slice(i))"*"===t?n.push(e):n.push(t);p2(t,n,s)}for(let n of e)delete t[n]}}else a in t&&e(t[a],n,r,i+1,s)}(e,t,i,0,s)}}(n,{"requests[].*":"requests[].request.*"})),n}(i,c)),l)),null!=(f=p5(e,["config"]))&&(m=p5(f,["displayName"]),void 0!==h&&null!=m&&p2(h,["batch","displayName"],m)),h);return a=p1("{model}:asyncBatchEmbedContent",g._url),o=g._query,delete g._url,delete g._query,this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(g),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>fX(e))}}async get(e){var t,n,r,i,s,a;let o="",l={};if(this.apiClient.isVertexAI()){let r,i,a=(s=this.apiClient,r={},null!=(i=p5(e,["name"]))&&p2(r,["_url","name"],fJ(s,i)),r);return o=p1("batchPredictionJobs/{name}",a._url),l=a._query,delete a._url,delete a._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>fQ(e))}{let t,n,s=(a=this.apiClient,t={},null!=(n=p5(e,["name"]))&&p2(t,["_url","name"],fJ(a,n)),t);return o=p1("batches/{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>fX(e))}}async cancel(e){var t,n,r,i,s,a;let o="",l={};if(this.apiClient.isVertexAI()){let r,i,a=(s=this.apiClient,r={},null!=(i=p5(e,["name"]))&&p2(r,["_url","name"],fJ(s,i)),r);o=p1("batchPredictionJobs/{name}:cancel",a._url),l=a._query,delete a._url,delete a._query,await this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}else{let t,n,s=(a=this.apiClient,t={},null!=(n=p5(e,["name"]))&&p2(t,["_url","name"],fJ(a,n)),t);o=p1("batches/{name}:cancel",s._url),l=s._query,delete s._url,delete s._query,await this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal})}}async listInternal(e){var t,n,r,i;let s="",a={};if(this.apiClient.isVertexAI()){let r,i,o,l,u,c=(r={},null!=(i=p5(e,["config"]))&&(o=p5(i,["pageSize"]),void 0!==r&&null!=o&&p2(r,["_query","pageSize"],o),l=p5(i,["pageToken"]),void 0!==r&&null!=l&&p2(r,["_query","pageToken"],l),u=p5(i,["filter"]),void 0!==r&&null!=u&&p2(r,["_query","filter"],u)),r);return s=p1("batchPredictionJobs",c._url),a=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["nextPageToken"]);null!=r&&p2(t,["nextPageToken"],r);let i=p5(e,["batchPredictionJobs"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>fQ(e))),p2(t,["batchJobs"],e)}return t}(e),n=new fb;return Object.assign(n,t),n})}{let t,n,o=(t={},null!=(n=p5(e,["config"]))&&function(e,t){let n=p5(e,["pageSize"]);void 0!==t&&null!=n&&p2(t,["_query","pageSize"],n);let r=p5(e,["pageToken"]);if(void 0!==t&&null!=r&&p2(t,["_query","pageToken"],r),void 0!==p5(e,["filter"]))throw Error("filter parameter is not supported in Gemini API.")}(n,t),t);return s=p1("batches",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["nextPageToken"]);null!=r&&p2(t,["nextPageToken"],r);let i=p5(e,["operations"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>fX(e))),p2(t,["batchJobs"],e)}return t}(e),n=new fb;return Object.assign(n,t),n})}}async delete(e){var t,n,r,i,s,a;let o="",l={};if(this.apiClient.isVertexAI()){let r,i,a=(s=this.apiClient,r={},null!=(i=p5(e,["name"]))&&p2(r,["_url","name"],fJ(s,i)),r);return o=p1("batchPredictionJobs/{name}",a._url),l=a._query,delete a._url,delete a._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r,i,s;return t={},null!=(n=p5(e,["sdkHttpResponse"]))&&p2(t,["sdkHttpResponse"],n),null!=(r=p5(e,["name"]))&&p2(t,["name"],r),null!=(i=p5(e,["done"]))&&p2(t,["done"],i),null!=(s=p5(e,["error"]))&&p2(t,["error"],s),t})}{let t,n,s=(a=this.apiClient,t={},null!=(n=p5(e,["name"]))&&p2(t,["_url","name"],fJ(a,n)),t);return o=p1("batches/{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r,i,s;return t={},null!=(n=p5(e,["sdkHttpResponse"]))&&p2(t,["sdkHttpResponse"],n),null!=(r=p5(e,["name"]))&&p2(t,["name"],r),null!=(i=p5(e,["done"]))&&p2(t,["done"],i),null!=(s=p5(e,["error"]))&&p2(t,["error"],s),t})}}}function f5(e){let t={},n=p5(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,a,o,l,u,c,h,d,p;return n={},null!=(r=p5(t=e,["mediaResolution"]))&&p2(n,["mediaResolution"],r),null!=(i=p5(t,["codeExecutionResult"]))&&p2(n,["codeExecutionResult"],i),null!=(s=p5(t,["executableCode"]))&&p2(n,["executableCode"],s),null!=(a=p5(t,["fileData"]))&&p2(n,["fileData"],function(e){let t={};if(void 0!==p5(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=p5(e,["fileUri"]);null!=n&&p2(t,["fileUri"],n);let r=p5(e,["mimeType"]);return null!=r&&p2(t,["mimeType"],r),t}(a)),null!=(o=p5(t,["functionCall"]))&&p2(n,["functionCall"],function(e){let t={},n=p5(e,["id"]);null!=n&&p2(t,["id"],n);let r=p5(e,["args"]);null!=r&&p2(t,["args"],r);let i=p5(e,["name"]);if(null!=i&&p2(t,["name"],i),void 0!==p5(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==p5(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(o)),null!=(l=p5(t,["functionResponse"]))&&p2(n,["functionResponse"],l),null!=(u=p5(t,["inlineData"]))&&p2(n,["inlineData"],function(e){let t={},n=p5(e,["data"]);if(null!=n&&p2(t,["data"],n),void 0!==p5(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=p5(e,["mimeType"]);return null!=r&&p2(t,["mimeType"],r),t}(u)),null!=(c=p5(t,["text"]))&&p2(n,["text"],c),null!=(h=p5(t,["thought"]))&&p2(n,["thought"],h),null!=(d=p5(t,["thoughtSignature"]))&&p2(n,["thoughtSignature"],d),null!=(p=p5(t,["videoMetadata"]))&&p2(n,["videoMetadata"],p),n})),p2(t,["parts"],e)}let r=p5(e,["role"]);return null!=r&&p2(t,["role"],r),t}class f6 extends p0{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new f1(tO.PAGED_ITEM_CACHED_CONTENTS,e=>this.listInternal(e),await this.listInternal(e),e)}async create(e){var t,n,r,i,s,a;let o="",l={};if(this.apiClient.isVertexAI()){let r,i,a,u=(s=this.apiClient,r={},null!=(i=p5(e,["model"]))&&p2(r,["model"],fI(s,i)),null!=(a=p5(e,["config"]))&&function(e,t){let n=p5(e,["ttl"]);void 0!==t&&null!=n&&p2(t,["ttl"],n);let r=p5(e,["expireTime"]);void 0!==t&&null!=r&&p2(t,["expireTime"],r);let i=p5(e,["displayName"]);void 0!==t&&null!=i&&p2(t,["displayName"],i);let s=p5(e,["contents"]);if(void 0!==t&&null!=s){let e=fM(s);Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["contents"],e)}let a=p5(e,["systemInstruction"]);void 0!==t&&null!=a&&p2(t,["systemInstruction"],fj(a));let o=p5(e,["tools"]);if(void 0!==t&&null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=p5(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==p5(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=p5(e,["description"]);null!=n&&p2(t,["description"],n);let r=p5(e,["name"]);null!=r&&p2(t,["name"],r);let i=p5(e,["parameters"]);null!=i&&p2(t,["parameters"],i);let s=p5(e,["parametersJsonSchema"]);null!=s&&p2(t,["parametersJsonSchema"],s);let a=p5(e,["response"]);null!=a&&p2(t,["response"],a);let o=p5(e,["responseJsonSchema"]);return null!=o&&p2(t,["responseJsonSchema"],o),t})(e))),p2(t,["functionDeclarations"],e)}let r=p5(e,["retrieval"]);null!=r&&p2(t,["retrieval"],r);let i=p5(e,["googleSearchRetrieval"]);null!=i&&p2(t,["googleSearchRetrieval"],i);let s=p5(e,["computerUse"]);if(null!=s&&p2(t,["computerUse"],s),void 0!==p5(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let a=p5(e,["codeExecution"]);null!=a&&p2(t,["codeExecution"],a);let o=p5(e,["enterpriseWebSearch"]);null!=o&&p2(t,["enterpriseWebSearch"],o);let l=p5(e,["googleMaps"]);null!=l&&p2(t,["googleMaps"],l);let u=p5(e,["googleSearch"]);null!=u&&p2(t,["googleSearch"],u);let c=p5(e,["urlContext"]);return null!=c&&p2(t,["urlContext"],c),t})(e))),p2(t,["tools"],e)}let l=p5(e,["toolConfig"]);void 0!==t&&null!=l&&p2(t,["toolConfig"],l);let u=p5(e,["kmsKeyName"]);void 0!==t&&null!=u&&p2(t,["encryption_spec","kmsKeyName"],u)}(a,r),r);return o=p1("cachedContents",u._url),l=u._query,delete u._url,delete u._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,s,u=(a=this.apiClient,t={},null!=(n=p5(e,["model"]))&&p2(t,["model"],fI(a,n)),null!=(s=p5(e,["config"]))&&function(e,t){var n;let r,i,s,a=p5(e,["ttl"]);void 0!==t&&null!=a&&p2(t,["ttl"],a);let o=p5(e,["expireTime"]);void 0!==t&&null!=o&&p2(t,["expireTime"],o);let l=p5(e,["displayName"]);void 0!==t&&null!=l&&p2(t,["displayName"],l);let u=p5(e,["contents"]);if(void 0!==t&&null!=u){let e=fM(u);Array.isArray(e)&&(e=e.map(e=>f5(e))),p2(t,["contents"],e)}let c=p5(e,["systemInstruction"]);void 0!==t&&null!=c&&p2(t,["systemInstruction"],f5(fj(c)));let h=p5(e,["tools"]);if(void 0!==t&&null!=h){let e=h;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=p5(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["functionDeclarations"],e)}if(void 0!==p5(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=p5(e,["googleSearchRetrieval"]);null!=r&&p2(t,["googleSearchRetrieval"],r);let i=p5(e,["computerUse"]);null!=i&&p2(t,["computerUse"],i);let s=p5(e,["fileSearch"]);null!=s&&p2(t,["fileSearch"],s);let a=p5(e,["codeExecution"]);if(null!=a&&p2(t,["codeExecution"],a),void 0!==p5(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=p5(e,["googleMaps"]);null!=o&&p2(t,["googleMaps"],function(e){let t={};if(void 0!==p5(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=p5(e,["enableWidget"]);return null!=n&&p2(t,["enableWidget"],n),t}(o));let l=p5(e,["googleSearch"]);null!=l&&p2(t,["googleSearch"],function(e){let t={};if(void 0!==p5(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==p5(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=p5(e,["timeRangeFilter"]);return null!=n&&p2(t,["timeRangeFilter"],n),t}(l));let u=p5(e,["urlContext"]);return null!=u&&p2(t,["urlContext"],u),t})(e))),p2(t,["tools"],e)}let d=p5(e,["toolConfig"]);if(void 0!==t&&null!=d&&p2(t,["toolConfig"],(r={},null!=(i=p5(n=d,["functionCallingConfig"]))&&p2(r,["functionCallingConfig"],function(e){let t={},n=p5(e,["mode"]);null!=n&&p2(t,["mode"],n);let r=p5(e,["allowedFunctionNames"]);if(null!=r&&p2(t,["allowedFunctionNames"],r),void 0!==p5(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(i)),null!=(s=p5(n,["retrievalConfig"]))&&p2(r,["retrievalConfig"],s),r)),void 0!==p5(e,["kmsKeyName"]))throw Error("kmsKeyName parameter is not supported in Gemini API.")}(s,t),t);return o=p1("cachedContents",u._url),l=u._query,delete u._url,delete u._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,n,r,i,s,a;let o="",l={};if(this.apiClient.isVertexAI()){let r,i,a=(s=this.apiClient,r={},null!=(i=p5(e,["name"]))&&p2(r,["_url","name"],fB(s,i)),r);return o=p1("{name}",a._url),l=a._query,delete a._url,delete a._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,s=(a=this.apiClient,t={},null!=(n=p5(e,["name"]))&&p2(t,["_url","name"],fB(a,n)),t);return o=p1("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n,r,i,s,a;let o="",l={};if(this.apiClient.isVertexAI()){let r,i,a=(s=this.apiClient,r={},null!=(i=p5(e,["name"]))&&p2(r,["_url","name"],fB(s,i)),r);return o=p1("{name}",a._url),l=a._query,delete a._url,delete a._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r=(t={},null!=(n=p5(e,["sdkHttpResponse"]))&&p2(t,["sdkHttpResponse"],n),t),i=new fc;return Object.assign(i,r),i})}{let t,n,s=(a=this.apiClient,t={},null!=(n=p5(e,["name"]))&&p2(t,["_url","name"],fB(a,n)),t);return o=p1("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r=(t={},null!=(n=p5(e,["sdkHttpResponse"]))&&p2(t,["sdkHttpResponse"],n),t),i=new fc;return Object.assign(i,r),i})}}async update(e){var t,n,r,i,s,a;let o="",l={};if(this.apiClient.isVertexAI()){let r,i,a,u,c,h=(s=this.apiClient,r={},null!=(i=p5(e,["name"]))&&p2(r,["_url","name"],fB(s,i)),null!=(a=p5(e,["config"]))&&(u=p5(a,["ttl"]),void 0!==r&&null!=u&&p2(r,["ttl"],u),c=p5(a,["expireTime"]),void 0!==r&&null!=c&&p2(r,["expireTime"],c)),r);return o=p1("{name}",h._url),l=h._query,delete h._url,delete h._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,s,u,c,h=(a=this.apiClient,t={},null!=(n=p5(e,["name"]))&&p2(t,["_url","name"],fB(a,n)),null!=(s=p5(e,["config"]))&&(u=p5(s,["ttl"]),void 0!==t&&null!=u&&p2(t,["ttl"],u),c=p5(s,["expireTime"]),void 0!==t&&null!=c&&p2(t,["expireTime"],c)),t);return o=p1("{name}",h._url),l=h._query,delete h._url,delete h._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async listInternal(e){var t,n,r,i;let s="",a={};if(this.apiClient.isVertexAI()){let r,i,o,l,u=(r={},null!=(i=p5(e,["config"]))&&(o=p5(i,["pageSize"]),void 0!==r&&null!=o&&p2(r,["_query","pageSize"],o),l=p5(i,["pageToken"]),void 0!==r&&null!=l&&p2(r,["_query","pageToken"],l)),r);return s=p1("cachedContents",u._url),a=u._query,delete u._url,delete u._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["nextPageToken"]);null!=r&&p2(t,["nextPageToken"],r);let i=p5(e,["cachedContents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["cachedContents"],e)}return t}(e),n=new fh;return Object.assign(n,t),n})}{let t,n,o,l,u=(t={},null!=(n=p5(e,["config"]))&&(o=p5(n,["pageSize"]),void 0!==t&&null!=o&&p2(t,["_query","pageSize"],o),l=p5(n,["pageToken"]),void 0!==t&&null!=l&&p2(t,["_query","pageToken"],l)),t);return s=p1("cachedContents",u._url),a=u._query,delete u._url,delete u._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["nextPageToken"]);null!=r&&p2(t,["nextPageToken"],r);let i=p5(e,["cachedContents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["cachedContents"],e)}return t}(e),n=new fh;return Object.assign(n,t),n})}}}function f4(e){return this instanceof f4?(this.v=e,this):new f4(e)}function f3(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),r[Symbol.asyncIterator]=function(){return this},r;function a(e,t){i[e]&&(r[e]=function(t){return new Promise(function(n,r){s.push([e,t,n,r])>1||o(e,t)})},t&&(r[e]=t(r[e])))}function o(e,t){try{var n;(n=i[e](t)).value instanceof f4?Promise.resolve(n.value.v).then(l,u):c(s[0][2],n)}catch(e){c(s[0][3],e)}}function l(e){o("next",e)}function u(e){o("throw",e)}function c(e,t){e(t),s.shift(),s.length&&o(s[0][0],s[0][1])}}function f8(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){var s,a,o;s=r,a=i,o=(t=e[n](t)).done,Promise.resolve(t.value).then(function(e){s({value:e,done:o})},a)})}}}function f7(e){if(void 0===e.parts||0===e.parts.length)return!1;for(let t of e.parts)if(void 0===t||0===Object.keys(t).length)return!1;return!0}function f9(e){if(void 0===e||0===e.length)return[];let t=[],n=e.length,r=0;for(;r<n;)if("user"===e[r].role)t.push(e[r]),r++;else{let i=[],s=!0;for(;r<n&&"model"===e[r].role;)i.push(e[r]),s&&!f7(e[r])&&(s=!1),r++;s?t.push(...i):t.pop()}return t}"function"==typeof SuppressedError&&SuppressedError;class me{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new mt(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class mt{constructor(e,t,n,r={},i=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=r,this.history=i,this.sendPromise=Promise.resolve(),function(e){if(0!==e.length){for(let t of e)if("user"!==t.role&&"model"!==t.role)throw Error(`Role must be user or model, but got ${t.role}.`)}}(i)}async sendMessage(e){var t;await this.sendPromise;let n=fj(e.message),r=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:null!=(t=e.config)?t:this.config});return this.sendPromise=(async()=>{var e,t,i;let s=await r,a=null==(t=null==(e=s.candidates)?void 0:e[0])?void 0:t.content,o=s.automaticFunctionCallingHistory,l=this.getHistory(!0).length,u=[];null!=o&&(u=null!=(i=o.slice(l))?i:[]),this.recordHistory(n,a?[a]:[],u)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),r}async sendMessageStream(e){var t;await this.sendPromise;let n=fj(e.message),r=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:null!=(t=e.config)?t:this.config});this.sendPromise=r.then(()=>void 0).catch(()=>void 0);let i=await r;return this.processStreamResponse(i,n)}getHistory(e=!1){return structuredClone(e?f9(this.history):this.history)}processStreamResponse(e,t){var n,r;return f3(this,arguments,function*(){var i,s,a,o;let l=[];try{for(var u,c=!0,h=f8(e);!(i=(u=yield f4(h.next())).done);c=!0){if(o=u.value,c=!1,function(e){var t;if(void 0==e.candidates||0===e.candidates.length)return!1;let n=null==(t=e.candidates[0])?void 0:t.content;return void 0!==n&&f7(n)}(o)){let e=null==(r=null==(n=o.candidates)?void 0:n[0])?void 0:r.content;void 0!==e&&l.push(e)}yield yield f4(o)}}catch(e){s={error:e}}finally{try{!c&&!i&&(a=h.return)&&(yield f4(a.call(h)))}finally{if(s)throw s.error}}this.recordHistory(t,l)})}recordHistory(e,t,n){let r=[];t.length>0&&t.every(e=>void 0!==e.role)?r=t:r.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...f9(n)):this.history.push(e),this.history.push(...r)}}class mn extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,mn.prototype)}}class mr extends p0{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new f1(tO.PAGED_ITEM_FILES,e=>this.listInternal(e),await this.listInternal(e),e)}async upload(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(e=>e)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,a,o,l,u=(s={},null!=(a=p5(e,["config"]))&&(o=p5(a,["pageSize"]),void 0!==s&&null!=o&&p2(s,["_query","pageSize"],o),l=p5(a,["pageToken"]),void 0!==s&&null!=l&&p2(s,["_query","pageToken"],l)),s);return r=p1("files",u._url),i=u._query,delete u._url,delete u._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["nextPageToken"]);null!=r&&p2(t,["nextPageToken"],r);let i=p5(e,["files"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["files"],e)}return t}(e),n=new fg;return Object.assign(n,t),n})}}async createInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,a,o=(s={},null!=(a=p5(e,["file"]))&&p2(s,["file"],a),s);return r=p1("upload/v1beta/files",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t,n,r=(t={},null!=(n=p5(e,["sdkHttpResponse"]))&&p2(t,["sdkHttpResponse"],n),t),i=new fy;return Object.assign(i,r),i})}}async get(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,a,o=(s={},null!=(a=p5(e,["name"]))&&p2(s,["_url","file"],fz(a)),s);return r=p1("files/{file}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,a,o=(s={},null!=(a=p5(e,["name"]))&&p2(s,["_url","file"],fz(a)),s);return r=p1("files/{file}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r=(t={},null!=(n=p5(e,["sdkHttpResponse"]))&&p2(t,["sdkHttpResponse"],n),t),i=new fv;return Object.assign(i,r),i})}}}function mi(e){let t={},n=p5(e,["data"]);if(null!=n&&p2(t,["data"],n),void 0!==p5(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=p5(e,["mimeType"]);return null!=r&&p2(t,["mimeType"],r),t}function ms(e){let t={},n=p5(e,["languageCode"]);null!=n&&p2(t,["languageCode"],n);let r=p5(e,["voiceConfig"]);if(null!=r&&p2(t,["voiceConfig"],r),void 0!==p5(e,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return t}function ma(e){let t={},n=p5(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,a,o,l,u,c,h,d,p;return n={},null!=(r=p5(t=e,["mediaResolution"]))&&p2(n,["mediaResolution"],r),null!=(i=p5(t,["codeExecutionResult"]))&&p2(n,["codeExecutionResult"],i),null!=(s=p5(t,["executableCode"]))&&p2(n,["executableCode"],s),null!=(a=p5(t,["fileData"]))&&p2(n,["fileData"],function(e){let t={};if(void 0!==p5(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=p5(e,["fileUri"]);null!=n&&p2(t,["fileUri"],n);let r=p5(e,["mimeType"]);return null!=r&&p2(t,["mimeType"],r),t}(a)),null!=(o=p5(t,["functionCall"]))&&p2(n,["functionCall"],function(e){let t={},n=p5(e,["id"]);null!=n&&p2(t,["id"],n);let r=p5(e,["args"]);null!=r&&p2(t,["args"],r);let i=p5(e,["name"]);if(null!=i&&p2(t,["name"],i),void 0!==p5(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==p5(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(o)),null!=(l=p5(t,["functionResponse"]))&&p2(n,["functionResponse"],l),null!=(u=p5(t,["inlineData"]))&&p2(n,["inlineData"],function(e){let t={},n=p5(e,["data"]);if(null!=n&&p2(t,["data"],n),void 0!==p5(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=p5(e,["mimeType"]);return null!=r&&p2(t,["mimeType"],r),t}(u)),null!=(c=p5(t,["text"]))&&p2(n,["text"],c),null!=(h=p5(t,["thought"]))&&p2(n,["thought"],h),null!=(d=p5(t,["thoughtSignature"]))&&p2(n,["thoughtSignature"],d),null!=(p=p5(t,["videoMetadata"]))&&p2(n,["videoMetadata"],p),n})),p2(t,["parts"],e)}let r=p5(e,["role"]);return null!=r&&p2(t,["role"],r),t}function mo(e,t){let n={},r=p5(t,["model"]);null!=r&&p2(n,["_url","model"],f_(e,r));let i=p5(t,["contents"]);if(null!=i){let e=fM(i);Array.isArray(e)&&(e=e.map(e=>ma(e))),p2(n,["contents"],e)}let s=p5(t,["config"]);return null!=s&&p2(n,["generationConfig"],function(e,t,n){var r;let i,s,a,o={},l=p5(t,["systemInstruction"]);void 0!==n&&null!=l&&p2(n,["systemInstruction"],ma(fj(l)));let u=p5(t,["temperature"]);null!=u&&p2(o,["temperature"],u);let c=p5(t,["topP"]);null!=c&&p2(o,["topP"],c);let h=p5(t,["topK"]);null!=h&&p2(o,["topK"],h);let d=p5(t,["candidateCount"]);null!=d&&p2(o,["candidateCount"],d);let p=p5(t,["maxOutputTokens"]);null!=p&&p2(o,["maxOutputTokens"],p);let f=p5(t,["stopSequences"]);null!=f&&p2(o,["stopSequences"],f);let m=p5(t,["responseLogprobs"]);null!=m&&p2(o,["responseLogprobs"],m);let g=p5(t,["logprobs"]);null!=g&&p2(o,["logprobs"],g);let y=p5(t,["presencePenalty"]);null!=y&&p2(o,["presencePenalty"],y);let v=p5(t,["frequencyPenalty"]);null!=v&&p2(o,["frequencyPenalty"],v);let b=p5(t,["seed"]);null!=b&&p2(o,["seed"],b);let x=p5(t,["responseMimeType"]);null!=x&&p2(o,["responseMimeType"],x);let w=p5(t,["responseSchema"]);null!=w&&p2(o,["responseSchema"],fU(w));let E=p5(t,["responseJsonSchema"]);if(null!=E&&p2(o,["responseJsonSchema"],E),void 0!==p5(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==p5(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let _=p5(t,["safetySettings"]);if(void 0!==n&&null!=_){let e=_;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=p5(e,["category"]);if(null!=n&&p2(t,["category"],n),void 0!==p5(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let r=p5(e,["threshold"]);return null!=r&&p2(t,["threshold"],r),t})(e))),p2(n,["safetySettings"],e)}let I=p5(t,["tools"]);if(void 0!==n&&null!=I){let e=fq(I);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=p5(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["functionDeclarations"],e)}if(void 0!==p5(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=p5(e,["googleSearchRetrieval"]);null!=r&&p2(t,["googleSearchRetrieval"],r);let i=p5(e,["computerUse"]);null!=i&&p2(t,["computerUse"],i);let s=p5(e,["fileSearch"]);null!=s&&p2(t,["fileSearch"],s);let a=p5(e,["codeExecution"]);if(null!=a&&p2(t,["codeExecution"],a),void 0!==p5(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=p5(e,["googleMaps"]);null!=o&&p2(t,["googleMaps"],function(e){let t={};if(void 0!==p5(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=p5(e,["enableWidget"]);return null!=n&&p2(t,["enableWidget"],n),t}(o));let l=p5(e,["googleSearch"]);null!=l&&p2(t,["googleSearch"],function(e){let t={};if(void 0!==p5(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==p5(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=p5(e,["timeRangeFilter"]);return null!=n&&p2(t,["timeRangeFilter"],n),t}(l));let u=p5(e,["urlContext"]);return null!=u&&p2(t,["urlContext"],u),t})(fV(e)))),p2(n,["tools"],e)}let C=p5(t,["toolConfig"]);if(void 0!==n&&null!=C&&p2(n,["toolConfig"],(i={},null!=(s=p5(r=C,["functionCallingConfig"]))&&p2(i,["functionCallingConfig"],function(e){let t={},n=p5(e,["mode"]);null!=n&&p2(t,["mode"],n);let r=p5(e,["allowedFunctionNames"]);if(null!=r&&p2(t,["allowedFunctionNames"],r),void 0!==p5(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(s)),null!=(a=p5(r,["retrievalConfig"]))&&p2(i,["retrievalConfig"],a),i)),void 0!==p5(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let T=p5(t,["cachedContent"]);void 0!==n&&null!=T&&p2(n,["cachedContent"],fB(e,T));let S=p5(t,["responseModalities"]);null!=S&&p2(o,["responseModalities"],S);let N=p5(t,["mediaResolution"]);null!=N&&p2(o,["mediaResolution"],N);let A=p5(t,["speechConfig"]);if(null!=A&&p2(o,["speechConfig"],fL(A)),void 0!==p5(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let k=p5(t,["thinkingConfig"]);null!=k&&p2(o,["thinkingConfig"],k);let O=p5(t,["imageConfig"]);return null!=O&&p2(o,["imageConfig"],function(e){let t={},n=p5(e,["aspectRatio"]);null!=n&&p2(t,["aspectRatio"],n);let r=p5(e,["imageSize"]);if(null!=r&&p2(t,["imageSize"],r),void 0!==p5(e,["outputMimeType"]))throw Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==p5(e,["outputCompressionQuality"]))throw Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}(O)),o}(e,s,n)),n}function ml(e,t){let n={},r=p5(t,["model"]);null!=r&&p2(n,["_url","model"],f_(e,r));let i=p5(t,["contents"]);if(null!=i){let e=fM(i);Array.isArray(e)&&(e=e.map(e=>e)),p2(n,["contents"],e)}let s=p5(t,["config"]);return null!=s&&p2(n,["generationConfig"],function(e,t,n){var r;let i,s,a,o,l,u={},c=p5(t,["systemInstruction"]);void 0!==n&&null!=c&&p2(n,["systemInstruction"],fj(c));let h=p5(t,["temperature"]);null!=h&&p2(u,["temperature"],h);let d=p5(t,["topP"]);null!=d&&p2(u,["topP"],d);let p=p5(t,["topK"]);null!=p&&p2(u,["topK"],p);let f=p5(t,["candidateCount"]);null!=f&&p2(u,["candidateCount"],f);let m=p5(t,["maxOutputTokens"]);null!=m&&p2(u,["maxOutputTokens"],m);let g=p5(t,["stopSequences"]);null!=g&&p2(u,["stopSequences"],g);let y=p5(t,["responseLogprobs"]);null!=y&&p2(u,["responseLogprobs"],y);let v=p5(t,["logprobs"]);null!=v&&p2(u,["logprobs"],v);let b=p5(t,["presencePenalty"]);null!=b&&p2(u,["presencePenalty"],b);let x=p5(t,["frequencyPenalty"]);null!=x&&p2(u,["frequencyPenalty"],x);let w=p5(t,["seed"]);null!=w&&p2(u,["seed"],w);let E=p5(t,["responseMimeType"]);null!=E&&p2(u,["responseMimeType"],E);let _=p5(t,["responseSchema"]);null!=_&&p2(u,["responseSchema"],fU(_));let I=p5(t,["responseJsonSchema"]);null!=I&&p2(u,["responseJsonSchema"],I);let C=p5(t,["routingConfig"]);null!=C&&p2(u,["routingConfig"],C);let T=p5(t,["modelSelectionConfig"]);null!=T&&p2(u,["modelConfig"],T);let S=p5(t,["safetySettings"]);if(void 0!==n&&null!=S){let e=S;Array.isArray(e)&&(e=e.map(e=>e)),p2(n,["safetySettings"],e)}let N=p5(t,["tools"]);if(void 0!==n&&null!=N){let e=fq(N);Array.isArray(e)&&(e=e.map(e=>mx(fV(e)))),p2(n,["tools"],e)}let A=p5(t,["toolConfig"]);void 0!==n&&null!=A&&p2(n,["toolConfig"],A);let k=p5(t,["labels"]);void 0!==n&&null!=k&&p2(n,["labels"],k);let O=p5(t,["cachedContent"]);void 0!==n&&null!=O&&p2(n,["cachedContent"],fB(e,O));let R=p5(t,["responseModalities"]);null!=R&&p2(u,["responseModalities"],R);let D=p5(t,["mediaResolution"]);null!=D&&p2(u,["mediaResolution"],D);let j=p5(t,["speechConfig"]);null!=j&&p2(u,["speechConfig"],mb(fL(j)));let P=p5(t,["audioTimestamp"]);null!=P&&p2(u,["audioTimestamp"],P);let M=p5(t,["thinkingConfig"]);null!=M&&p2(u,["thinkingConfig"],M);let U=p5(t,["imageConfig"]);return null!=U&&p2(u,["imageConfig"],(i={},null!=(s=p5(r=U,["aspectRatio"]))&&p2(i,["aspectRatio"],s),null!=(a=p5(r,["imageSize"]))&&p2(i,["imageSize"],a),null!=(o=p5(r,["outputMimeType"]))&&p2(i,["imageOutputOptions","mimeType"],o),null!=(l=p5(r,["outputCompressionQuality"]))&&p2(i,["imageOutputOptions","compressionQuality"],l),i)),u}(e,s,n)),n}function mu(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["candidates"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=p5(e,["content"]);null!=n&&p2(t,["content"],n);let r=p5(e,["citationMetadata"]);null!=r&&p2(t,["citationMetadata"],function(e){let t={},n=p5(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["citations"],e)}return t}(r));let i=p5(e,["tokenCount"]);null!=i&&p2(t,["tokenCount"],i);let s=p5(e,["finishReason"]);null!=s&&p2(t,["finishReason"],s);let a=p5(e,["avgLogprobs"]);null!=a&&p2(t,["avgLogprobs"],a);let o=p5(e,["groundingMetadata"]);null!=o&&p2(t,["groundingMetadata"],o);let l=p5(e,["index"]);null!=l&&p2(t,["index"],l);let u=p5(e,["logprobsResult"]);null!=u&&p2(t,["logprobsResult"],u);let c=p5(e,["safetyRatings"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["safetyRatings"],e)}let h=p5(e,["urlContextMetadata"]);return null!=h&&p2(t,["urlContextMetadata"],h),t})(e))),p2(t,["candidates"],e)}let i=p5(e,["modelVersion"]);null!=i&&p2(t,["modelVersion"],i);let s=p5(e,["promptFeedback"]);null!=s&&p2(t,["promptFeedback"],s);let a=p5(e,["responseId"]);null!=a&&p2(t,["responseId"],a);let o=p5(e,["usageMetadata"]);return null!=o&&p2(t,["usageMetadata"],o),t}function mc(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["candidates"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["candidates"],e)}let i=p5(e,["createTime"]);null!=i&&p2(t,["createTime"],i);let s=p5(e,["modelVersion"]);null!=s&&p2(t,["modelVersion"],s);let a=p5(e,["promptFeedback"]);null!=a&&p2(t,["promptFeedback"],a);let o=p5(e,["responseId"]);null!=o&&p2(t,["responseId"],o);let l=p5(e,["usageMetadata"]);return null!=l&&p2(t,["usageMetadata"],l),t}function mh(e){let t={},n=p5(e,["_self"]);null!=n&&p2(t,["image"],md(n));let r=p5(e,["raiFilteredReason"]);null!=r&&p2(t,["raiFilteredReason"],r);let i=p5(e,["_self"]);null!=i&&p2(t,["safetyAttributes"],mv(i));let s=p5(e,["prompt"]);return null!=s&&p2(t,["enhancedPrompt"],s),t}function md(e){let t={},n=p5(e,["gcsUri"]);null!=n&&p2(t,["gcsUri"],n);let r=p5(e,["bytesBase64Encoded"]);null!=r&&p2(t,["imageBytes"],p6(r));let i=p5(e,["mimeType"]);return null!=i&&p2(t,["mimeType"],i),t}function mp(e){let t={};if(void 0!==p5(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");let n=p5(e,["imageBytes"]);null!=n&&p2(t,["bytesBase64Encoded"],p6(n));let r=p5(e,["mimeType"]);return null!=r&&p2(t,["mimeType"],r),t}function mf(e){let t={},n=p5(e,["gcsUri"]);null!=n&&p2(t,["gcsUri"],n);let r=p5(e,["imageBytes"]);null!=r&&p2(t,["bytesBase64Encoded"],p6(r));let i=p5(e,["mimeType"]);return null!=i&&p2(t,["mimeType"],i),t}function mm(e){var t;let n,r,i,s,a={},o=p5(e,["name"]);null!=o&&p2(a,["name"],o);let l=p5(e,["displayName"]);null!=l&&p2(a,["displayName"],l);let u=p5(e,["description"]);null!=u&&p2(a,["description"],u);let c=p5(e,["version"]);null!=c&&p2(a,["version"],c);let h=p5(e,["_self"]);null!=h&&p2(a,["tunedModelInfo"],(n={},null!=(r=p5(t=h,["baseModel"]))&&p2(n,["baseModel"],r),null!=(i=p5(t,["createTime"]))&&p2(n,["createTime"],i),null!=(s=p5(t,["updateTime"]))&&p2(n,["updateTime"],s),n));let d=p5(e,["inputTokenLimit"]);null!=d&&p2(a,["inputTokenLimit"],d);let p=p5(e,["outputTokenLimit"]);null!=p&&p2(a,["outputTokenLimit"],p);let f=p5(e,["supportedGenerationMethods"]);null!=f&&p2(a,["supportedActions"],f);let m=p5(e,["temperature"]);null!=m&&p2(a,["temperature"],m);let g=p5(e,["maxTemperature"]);null!=g&&p2(a,["maxTemperature"],g);let y=p5(e,["topP"]);null!=y&&p2(a,["topP"],y);let v=p5(e,["topK"]);null!=v&&p2(a,["topK"],v);let b=p5(e,["thinking"]);return null!=b&&p2(a,["thinking"],b),a}function mg(e){var t;let n,r,i,s,a={},o=p5(e,["name"]);null!=o&&p2(a,["name"],o);let l=p5(e,["displayName"]);null!=l&&p2(a,["displayName"],l);let u=p5(e,["description"]);null!=u&&p2(a,["description"],u);let c=p5(e,["versionId"]);null!=c&&p2(a,["version"],c);let h=p5(e,["deployedModels"]);if(null!=h){let e=h;Array.isArray(e)&&(e=e.map(e=>{let t,n,r;return t={},null!=(n=p5(e,["endpoint"]))&&p2(t,["name"],n),null!=(r=p5(e,["deployedModelId"]))&&p2(t,["deployedModelId"],r),t})),p2(a,["endpoints"],e)}let d=p5(e,["labels"]);null!=d&&p2(a,["labels"],d);let p=p5(e,["_self"]);null!=p&&p2(a,["tunedModelInfo"],(n={},null!=(r=p5(t=p,["labels","google-vertex-llm-tuning-base-model-id"]))&&p2(n,["baseModel"],r),null!=(i=p5(t,["createTime"]))&&p2(n,["createTime"],i),null!=(s=p5(t,["updateTime"]))&&p2(n,["updateTime"],s),n));let f=p5(e,["defaultCheckpointId"]);null!=f&&p2(a,["defaultCheckpointId"],f);let m=p5(e,["checkpoints"]);if(null!=m){let e=m;Array.isArray(e)&&(e=e.map(e=>e)),p2(a,["checkpoints"],e)}return a}function my(e){let t={},n=p5(e,["safetyAttributes","categories"]);null!=n&&p2(t,["categories"],n);let r=p5(e,["safetyAttributes","scores"]);null!=r&&p2(t,["scores"],r);let i=p5(e,["contentType"]);return null!=i&&p2(t,["contentType"],i),t}function mv(e){let t={},n=p5(e,["safetyAttributes","categories"]);null!=n&&p2(t,["categories"],n);let r=p5(e,["safetyAttributes","scores"]);null!=r&&p2(t,["scores"],r);let i=p5(e,["contentType"]);return null!=i&&p2(t,["contentType"],i),t}function mb(e){let t={},n=p5(e,["languageCode"]);null!=n&&p2(t,["languageCode"],n);let r=p5(e,["voiceConfig"]);if(null!=r&&p2(t,["voiceConfig"],r),void 0!==p5(e,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return t}function mx(e){let t={},n=p5(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==p5(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=p5(e,["description"]);null!=n&&p2(t,["description"],n);let r=p5(e,["name"]);null!=r&&p2(t,["name"],r);let i=p5(e,["parameters"]);null!=i&&p2(t,["parameters"],i);let s=p5(e,["parametersJsonSchema"]);null!=s&&p2(t,["parametersJsonSchema"],s);let a=p5(e,["response"]);null!=a&&p2(t,["response"],a);let o=p5(e,["responseJsonSchema"]);return null!=o&&p2(t,["responseJsonSchema"],o),t})(e))),p2(t,["functionDeclarations"],e)}let r=p5(e,["retrieval"]);null!=r&&p2(t,["retrieval"],r);let i=p5(e,["googleSearchRetrieval"]);null!=i&&p2(t,["googleSearchRetrieval"],i);let s=p5(e,["computerUse"]);if(null!=s&&p2(t,["computerUse"],s),void 0!==p5(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let a=p5(e,["codeExecution"]);null!=a&&p2(t,["codeExecution"],a);let o=p5(e,["enterpriseWebSearch"]);null!=o&&p2(t,["enterpriseWebSearch"],o);let l=p5(e,["googleMaps"]);null!=l&&p2(t,["googleMaps"],l);let u=p5(e,["googleSearch"]);null!=u&&p2(t,["googleSearch"],u);let c=p5(e,["urlContext"]);return null!=c&&p2(t,["urlContext"],c),t}function mw(e){let t={},n=p5(e,["uri"]);null!=n&&p2(t,["uri"],n);let r=p5(e,["videoBytes"]);null!=r&&p2(t,["encodedVideo"],p6(r));let i=p5(e,["mimeType"]);return null!=i&&p2(t,["encoding"],i),t}function mE(e){let t={},n=p5(e,["uri"]);null!=n&&p2(t,["gcsUri"],n);let r=p5(e,["videoBytes"]);null!=r&&p2(t,["bytesBase64Encoded"],p6(r));let i=p5(e,["mimeType"]);return null!=i&&p2(t,["mimeType"],i),t}let m_="x-goog-api-client",mI=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class mC{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const r={};this.clientOptions.vertexai?(r.apiVersion=null!=(t=this.clientOptions.apiVersion)?t:"v1beta1",r.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(r.apiVersion=null!=(n=this.clientOptions.apiVersion)?n:"v1beta",r.baseUrl="https://generativelanguage.googleapis.com/"),r.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=r,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(r,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&"global"!==this.clientOptions.location?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return null!=(e=this.clientOptions.vertexai)&&e}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||void 0===e.baseUrl||void 0===e.apiVersion)throw Error("HTTP options are not correctly set.");let t=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&""!==e.apiVersion&&t.push(e.apiVersion),t.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=new URL(this.getBaseUrl());return e.protocol="http:"==e.protocol?"ws":"wss",e.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let r=[this.getRequestUrlInternal(t)];return n&&r.push(this.getBaseResourcePath()),""!==e&&r.push(e),new URL(`${r.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||"GET"===e.httpMethod&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[t,n]of Object.entries(e.queryParams))r.searchParams.append(t,String(n));let i={};if("GET"===e.httpMethod){if(e.body&&"{}"!==e.body)throw Error("Request body should be empty for GET request, but got non empty request body")}else i.body=e.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,t,r.toString(),e.abortSignal),this.unaryApiCall(r,i,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[e,r]of Object.entries(t))"object"==typeof r?n[e]=Object.assign(Object.assign({},n[e]),r):void 0!==r&&(n[e]=r);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,n);r.searchParams.has("alt")&&"sse"===r.searchParams.get("alt")||r.searchParams.set("alt","sse");let i={};return i.body=e.body,i=await this.includeExtraHttpOptionsToRequestInit(i,t,r.toString(),e.abortSignal),this.streamApiCall(r,i,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,r){if(t&&t.timeout||r){let n=new AbortController,i=n.signal;if(t.timeout&&(null==t?void 0:t.timeout)>0){let e=setTimeout(()=>n.abort(),t.timeout);e&&"function"==typeof e.unref&&e.unref()}r&&r.addEventListener("abort",()=>{n.abort()}),e.signal=i}return t&&null!==t.extraBody&&function(e,t){if(!t||0===Object.keys(t).length)return;if(e.body instanceof Blob)return console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");let n={};if("string"==typeof e.body&&e.body.length>0)try{let t=JSON.parse(e.body);if("object"!=typeof t||null===t||Array.isArray(t))return void console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");n=t}catch(e){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}e.body=JSON.stringify(function e(t,n){let r=Object.assign({},t);for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let i=n[t],s=r[t];i&&"object"==typeof i&&!Array.isArray(i)&&s&&"object"==typeof s&&!Array.isArray(s)?r[t]=e(s,i):(s&&i&&typeof s!=typeof i&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${t}". Original type: ${typeof s}, New type: ${typeof i}. Overwriting.`),r[t]=i)}return r}(n,t))}(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await mT(e),new p3(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await mT(e),this.processStreamResponse(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}processStreamResponse(e){var t;return f3(this,arguments,function*(){let n=null==(t=null==e?void 0:e.body)?void 0:t.getReader(),r=new TextDecoder("utf-8");if(!n)throw Error("Response body is empty");try{let t="";for(;;){let{done:i,value:s}=yield f4(n.read());if(i){if(t.trim().length>0)throw Error("Incomplete JSON segment at the end");break}let a=r.decode(s,{stream:!0});try{let e=JSON.parse(a);if("error"in e){let t=JSON.parse(JSON.stringify(e.error)),n=t.status,r=t.code,i=`got status: ${n}. ${JSON.stringify(e)}`;if(r>=400&&r<600)throw new mn({message:i,status:r})}}catch(e){if("ApiError"===e.name)throw e}let o=(t+=a).match(mI);for(;o;){let n=o[1];try{let r=new Response(n,{headers:null==e?void 0:e.headers,status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText});yield yield f4(new p3(r)),o=(t=t.slice(o[0].length)).match(mI)}catch(e){throw Error(`exception parsing stream chunk ${n}. ${e}`)}}}}finally{n.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(e=>{throw Error(`exception ${e} sending request`)})}getDefaultHeaders(){let e={},t="google-genai-sdk/1.30.0 "+this.clientOptions.userAgentExtra;return e["User-Agent"]=t,e[m_]=t,e["Content-Type"]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[t,r]of Object.entries(e.headers))n.append(t,r);e.timeout&&e.timeout>0&&n.append("X-Server-Timeout",String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return"string"==typeof e&&(n=null!=(t=(n=e.replace(/[/\\]+$/,"")).split(/[/\\]/).pop())?t:""),n}async uploadFile(e,t){var n;let r={};null!=t&&(r.mimeType=t.mimeType,r.name=t.name,r.displayName=t.displayName),r.name&&!r.name.startsWith("files/")&&(r.name=`files/${r.name}`);let i=this.clientOptions.uploader,s=await i.stat(e);r.sizeBytes=String(s.size);let a=null!=(n=null==t?void 0:t.mimeType)?n:s.type;if(void 0===a||""===a)throw Error("Can not determine mimeType. Please provide mimeType in the config.");r.mimeType=a;let o={file:r},l=this.getFileName(e),u=p1("upload/v1beta/files",o._url),c=await this.fetchUploadUrl(u,r.sizeBytes,r.mimeType,l,o,null==t?void 0:t.httpOptions);return i.upload(e,c,this)}async uploadFileToFileSearchStore(e,t,n){var r;let i=this.clientOptions.uploader,s=await i.stat(t),a=String(s.size),o=null!=(r=null==n?void 0:n.mimeType)?r:s.type;if(void 0===o||""===o)throw Error("Can not determine mimeType. Please provide mimeType in the config.");let l=`upload/v1beta/${e}:uploadToFileSearchStore`,u=this.getFileName(t),c={};(null==n?void 0:n.customMetadata)&&(c.customMetadata=n.customMetadata),(null==n?void 0:n.chunkingConfig)&&(c.chunkingConfig=n.chunkingConfig);let h=await this.fetchUploadUrl(l,a,o,u,c,null==n?void 0:n.httpOptions);return i.uploadToFileSearchStore(t,h,this)}async downloadFile(e){let t=this.clientOptions.downloader;await t.download(e,this)}async fetchUploadUrl(e,t,n,r,i,s){var a;let o={};o=s||{apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},r?{"X-Goog-Upload-File-Name":r}:{})};let l=await this.request({path:e,body:JSON.stringify(i),httpMethod:"POST",httpOptions:o});if(!l||!(null==l?void 0:l.headers))throw Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let u=null==(a=null==l?void 0:l.headers)?void 0:a["x-goog-upload-url"];if(void 0===u)throw Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function mT(e){var t;if(void 0===e)throw Error("response is undefined");if(!e.ok){let n=e.status,r=JSON.stringify((null==(t=e.headers.get("content-type"))?void 0:t.includes("application/json"))?await e.json():{error:{message:await e.text(),code:e.status,status:e.statusText}});if(n>=400&&n<600)throw new mn({message:r,status:n});throw Error(r)}}function mS(e){for(let n of e){var t;if(null!==(t=n)&&"object"==typeof t&&t instanceof mA||"object"==typeof n&&"inputSchema"in n)return!0}return!1}function mN(e){var t;let n=null!=(t=e[m_])?t:"";e[m_]=(n+" mcp_used/unknown").trimStart()}class mA{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new mA(e,t)}async initialize(){var e,t,n,r;if(this.mcpTools.length>0)return;let i={},s=[];for(let u of this.mcpClients)try{for(var a,o=!0,l=(t=void 0,f8(function(e,t=100){return f3(this,arguments,function*(){let n,r=0;for(;r<t;){let t=yield f4(e.listTools({cursor:n}));for(let e of t.tools)yield yield f4(e),r++;if(!t.nextCursor)break;n=t.nextCursor}})}(u)));!(e=(a=await l.next()).done);o=!0){r=a.value,o=!1,s.push(r);let e=r.name;if(i[e])throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);i[e]=u}}catch(e){t={error:e}}finally{try{!o&&!e&&(n=l.return)&&await n.call(l)}finally{if(t)throw t.error}}this.mcpTools=s,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),function(e,t={}){let n=[],r=new Set;for(let i of e){let e=i.name;if(r.has(e))throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);r.add(e);let s=function(e,t={}){let n={name:e.name,description:e.description,parametersJsonSchema:e.inputSchema};return e.outputSchema&&(n.responseJsonSchema=e.outputSchema),t.behavior&&(n.behavior=t.behavior),{functionDeclarations:[n]}}(i,t);s.functionDeclarations&&n.push(...s.functionDeclarations)}return{functionDeclarations:n}}(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let e,r=this.functionNameToMcpClient[n.name];this.config.timeout&&(e={timeout:this.config.timeout});let i=await r.callTool({name:n.name,arguments:n.args},void 0,e);t.push({functionResponse:{name:n.name,response:i.isError?{error:i}:i}})}return t}}async function mk(e,t,n){let r=new fw;Object.assign(r,n.data instanceof Blob?JSON.parse(await n.data.text()):JSON.parse(n.data)),t(r)}class mO{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;let r;if(this.apiClient.isVertexAI())throw Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let i=this.apiClient.getWebsocketBaseUrl(),s=this.apiClient.getApiVersion(),a=function(e){let t=new Headers;for(let[n,r]of Object.entries(e))t.append(n,r);return t}(this.apiClient.getDefaultHeaders()),o=this.apiClient.getApiKey(),l=`${i}/ws/google.ai.generativelanguage.${s}.GenerativeService.BidiGenerateMusic?key=${o}`,u=()=>{},c=new Promise(e=>{u=e}),h=e.callbacks,d=this.apiClient,p={onopen:function(){u({})},onmessage:e=>{mk(d,h.onmessage,e)},onerror:null!=(t=null==h?void 0:h.onerror)?t:function(e){},onclose:null!=(n=null==h?void 0:h.onclose)?n:function(e){}},f=this.webSocketFactory.create(l,(r={},a.forEach((e,t)=>{r[t]=e}),r),p);f.connect(),await c;let m=f_(this.apiClient,e.model);return f.send(JSON.stringify({setup:{model:m}})),new mR(f,this.apiClient)}}class mR{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||0===Object.keys(e.weightedPrompts).length)throw Error("Weighted prompts must be set and contain at least one entry.");let t=function(e){let t={},n=p5(e,["weightedPrompts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["weightedPrompts"],e)}return t}(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){let t,n;e.musicGenerationConfig||(e.musicGenerationConfig={});let r=(t={},null!=(n=p5(e,["musicGenerationConfig"]))&&p2(t,["musicGenerationConfig"],n),t);this.conn.send(JSON.stringify(r))}sendPlaybackControl(e){this.conn.send(JSON.stringify({playbackControl:e}))}play(){this.sendPlaybackControl(tk.PLAY)}pause(){this.sendPlaybackControl(tk.PAUSE)}stop(){this.sendPlaybackControl(tk.STOP)}resetContext(){this.sendPlaybackControl(tk.RESET_CONTEXT)}close(){this.conn.close()}}async function mD(e,t,n){let r=new fx,i=JSON.parse(n.data instanceof Blob?await n.data.text():n.data instanceof ArrayBuffer?new TextDecoder().decode(n.data):n.data);if(e.isVertexAI()){let e,t,n,s,a,o,l,u;Object.assign(r,(e={},null!=(t=p5(i,["setupComplete"]))&&p2(e,["setupComplete"],t),null!=(n=p5(i,["serverContent"]))&&p2(e,["serverContent"],n),null!=(s=p5(i,["toolCall"]))&&p2(e,["toolCall"],s),null!=(a=p5(i,["toolCallCancellation"]))&&p2(e,["toolCallCancellation"],a),null!=(o=p5(i,["usageMetadata"]))&&p2(e,["usageMetadata"],function(e){let t={},n=p5(e,["promptTokenCount"]);null!=n&&p2(t,["promptTokenCount"],n);let r=p5(e,["cachedContentTokenCount"]);null!=r&&p2(t,["cachedContentTokenCount"],r);let i=p5(e,["candidatesTokenCount"]);null!=i&&p2(t,["responseTokenCount"],i);let s=p5(e,["toolUsePromptTokenCount"]);null!=s&&p2(t,["toolUsePromptTokenCount"],s);let a=p5(e,["thoughtsTokenCount"]);null!=a&&p2(t,["thoughtsTokenCount"],a);let o=p5(e,["totalTokenCount"]);null!=o&&p2(t,["totalTokenCount"],o);let l=p5(e,["promptTokensDetails"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["promptTokensDetails"],e)}let u=p5(e,["cacheTokensDetails"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["cacheTokensDetails"],e)}let c=p5(e,["candidatesTokensDetails"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["responseTokensDetails"],e)}let h=p5(e,["toolUsePromptTokensDetails"]);if(null!=h){let e=h;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["toolUsePromptTokensDetails"],e)}let d=p5(e,["trafficType"]);return null!=d&&p2(t,["trafficType"],d),t}(o)),null!=(l=p5(i,["goAway"]))&&p2(e,["goAway"],l),null!=(u=p5(i,["sessionResumptionUpdate"]))&&p2(e,["sessionResumptionUpdate"],u),e))}else Object.assign(r,i);t(r)}class mj{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new mO(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,r,i,s,a,o,l;let u,c;if(e.config&&e.config.httpOptions)throw Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let h=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion(),p=this.apiClient.getHeaders();e.config&&e.config.tools&&mS(e.config.tools)&&mN(p);let f=function(e){let t=new Headers;for(let[n,r]of Object.entries(e))t.append(n,r);return t}(p);if(this.apiClient.isVertexAI())u=`${h}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(f,u);else{let e=this.apiClient.getApiKey(),t="BidiGenerateContent",n="key";(null==e?void 0:e.startsWith("auth_tokens/"))&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),"v1alpha"!==d&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),t="BidiGenerateContentConstrained",n="access_token"),u=`${h}/ws/google.ai.generativelanguage.${d}.GenerativeService.${t}?${n}=${e}`}let m=()=>{},g=new Promise(e=>{m=e}),y=e.callbacks,v=this.apiClient,b={onopen:function(){var e;null==(e=null==y?void 0:y.onopen)||e.call(y),m({})},onmessage:e=>{mD(v,y.onmessage,e)},onerror:null!=(t=null==y?void 0:y.onerror)?t:function(e){},onclose:null!=(n=null==y?void 0:y.onclose)?n:function(e){}},x=this.webSocketFactory.create(u,(c={},f.forEach((e,t)=>{c[t]=e}),c),b);x.connect(),await g;let w=f_(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&w.startsWith("publishers/")){let e=this.apiClient.getProject(),t=this.apiClient.getLocation();w=`projects/${e}/locations/${t}/`+w}let E={};this.apiClient.isVertexAI()&&(null==(r=e.config)?void 0:r.responseModalities)===void 0&&(void 0===e.config?e.config={responseModalities:[e4.AUDIO]}:e.config.responseModalities=[e4.AUDIO]),(null==(i=e.config)?void 0:i.generationConfig)&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let _=null!=(a=null==(s=e.config)?void 0:s.tools)?a:[],I=[];for(let e of _)this.isCallableTool(e)?I.push(await e.tool()):I.push(e);I.length>0&&(e.config.tools=I);let C={model:w,config:e.config,callbacks:e.callbacks};if(this.apiClient.isVertexAI()){let e,t,n;o=this.apiClient,e={},null!=(t=p5(C,["model"]))&&p2(e,["setup","model"],f_(o,t)),null!=(n=p5(C,["config"]))&&p2(e,["config"],function(e,t){let n=p5(e,["generationConfig"]);void 0!==t&&null!=n&&p2(t,["setup","generationConfig"],function(e){let t={},n=p5(e,["modelSelectionConfig"]);null!=n&&p2(t,["modelConfig"],n);let r=p5(e,["responseJsonSchema"]);null!=r&&p2(t,["responseJsonSchema"],r);let i=p5(e,["audioTimestamp"]);null!=i&&p2(t,["audioTimestamp"],i);let s=p5(e,["candidateCount"]);null!=s&&p2(t,["candidateCount"],s);let a=p5(e,["enableAffectiveDialog"]);null!=a&&p2(t,["enableAffectiveDialog"],a);let o=p5(e,["frequencyPenalty"]);null!=o&&p2(t,["frequencyPenalty"],o);let l=p5(e,["logprobs"]);null!=l&&p2(t,["logprobs"],l);let u=p5(e,["maxOutputTokens"]);null!=u&&p2(t,["maxOutputTokens"],u);let c=p5(e,["mediaResolution"]);null!=c&&p2(t,["mediaResolution"],c);let h=p5(e,["presencePenalty"]);null!=h&&p2(t,["presencePenalty"],h);let d=p5(e,["responseLogprobs"]);null!=d&&p2(t,["responseLogprobs"],d);let p=p5(e,["responseMimeType"]);null!=p&&p2(t,["responseMimeType"],p);let f=p5(e,["responseModalities"]);null!=f&&p2(t,["responseModalities"],f);let m=p5(e,["responseSchema"]);null!=m&&p2(t,["responseSchema"],m);let g=p5(e,["routingConfig"]);null!=g&&p2(t,["routingConfig"],g);let y=p5(e,["seed"]);null!=y&&p2(t,["seed"],y);let v=p5(e,["speechConfig"]);null!=v&&p2(t,["speechConfig"],ms(v));let b=p5(e,["stopSequences"]);null!=b&&p2(t,["stopSequences"],b);let x=p5(e,["temperature"]);null!=x&&p2(t,["temperature"],x);let w=p5(e,["thinkingConfig"]);null!=w&&p2(t,["thinkingConfig"],w);let E=p5(e,["topK"]);null!=E&&p2(t,["topK"],E);let _=p5(e,["topP"]);if(null!=_&&p2(t,["topP"],_),void 0!==p5(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(n));let r=p5(e,["responseModalities"]);void 0!==t&&null!=r&&p2(t,["setup","generationConfig","responseModalities"],r);let i=p5(e,["temperature"]);void 0!==t&&null!=i&&p2(t,["setup","generationConfig","temperature"],i);let s=p5(e,["topP"]);void 0!==t&&null!=s&&p2(t,["setup","generationConfig","topP"],s);let a=p5(e,["topK"]);void 0!==t&&null!=a&&p2(t,["setup","generationConfig","topK"],a);let o=p5(e,["maxOutputTokens"]);void 0!==t&&null!=o&&p2(t,["setup","generationConfig","maxOutputTokens"],o);let l=p5(e,["mediaResolution"]);void 0!==t&&null!=l&&p2(t,["setup","generationConfig","mediaResolution"],l);let u=p5(e,["seed"]);void 0!==t&&null!=u&&p2(t,["setup","generationConfig","seed"],u);let c=p5(e,["speechConfig"]);void 0!==t&&null!=c&&p2(t,["setup","generationConfig","speechConfig"],ms(fF(c)));let h=p5(e,["thinkingConfig"]);void 0!==t&&null!=h&&p2(t,["setup","generationConfig","thinkingConfig"],h);let d=p5(e,["enableAffectiveDialog"]);void 0!==t&&null!=d&&p2(t,["setup","generationConfig","enableAffectiveDialog"],d);let p=p5(e,["systemInstruction"]);void 0!==t&&null!=p&&p2(t,["setup","systemInstruction"],fj(p));let f=p5(e,["tools"]);if(void 0!==t&&null!=f){let e=fq(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=p5(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==p5(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=p5(e,["description"]);null!=n&&p2(t,["description"],n);let r=p5(e,["name"]);null!=r&&p2(t,["name"],r);let i=p5(e,["parameters"]);null!=i&&p2(t,["parameters"],i);let s=p5(e,["parametersJsonSchema"]);null!=s&&p2(t,["parametersJsonSchema"],s);let a=p5(e,["response"]);null!=a&&p2(t,["response"],a);let o=p5(e,["responseJsonSchema"]);return null!=o&&p2(t,["responseJsonSchema"],o),t})(e))),p2(t,["functionDeclarations"],e)}let r=p5(e,["retrieval"]);null!=r&&p2(t,["retrieval"],r);let i=p5(e,["googleSearchRetrieval"]);null!=i&&p2(t,["googleSearchRetrieval"],i);let s=p5(e,["computerUse"]);if(null!=s&&p2(t,["computerUse"],s),void 0!==p5(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let a=p5(e,["codeExecution"]);null!=a&&p2(t,["codeExecution"],a);let o=p5(e,["enterpriseWebSearch"]);null!=o&&p2(t,["enterpriseWebSearch"],o);let l=p5(e,["googleMaps"]);null!=l&&p2(t,["googleMaps"],l);let u=p5(e,["googleSearch"]);null!=u&&p2(t,["googleSearch"],u);let c=p5(e,["urlContext"]);return null!=c&&p2(t,["urlContext"],c),t})(fV(e)))),p2(t,["setup","tools"],e)}let m=p5(e,["sessionResumption"]);void 0!==t&&null!=m&&p2(t,["setup","sessionResumption"],m);let g=p5(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&p2(t,["setup","inputAudioTranscription"],g);let y=p5(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&p2(t,["setup","outputAudioTranscription"],y);let v=p5(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&p2(t,["setup","realtimeInputConfig"],v);let b=p5(e,["contextWindowCompression"]);void 0!==t&&null!=b&&p2(t,["setup","contextWindowCompression"],b);let x=p5(e,["proactivity"]);return void 0!==t&&null!=x&&p2(t,["setup","proactivity"],x),{}}(n,e)),E=e}else{let e,t,n;l=this.apiClient,e={},null!=(t=p5(C,["model"]))&&p2(e,["setup","model"],f_(l,t)),null!=(n=p5(C,["config"]))&&p2(e,["config"],function(e,t){let n=p5(e,["generationConfig"]);void 0!==t&&null!=n&&p2(t,["setup","generationConfig"],n);let r=p5(e,["responseModalities"]);void 0!==t&&null!=r&&p2(t,["setup","generationConfig","responseModalities"],r);let i=p5(e,["temperature"]);void 0!==t&&null!=i&&p2(t,["setup","generationConfig","temperature"],i);let s=p5(e,["topP"]);void 0!==t&&null!=s&&p2(t,["setup","generationConfig","topP"],s);let a=p5(e,["topK"]);void 0!==t&&null!=a&&p2(t,["setup","generationConfig","topK"],a);let o=p5(e,["maxOutputTokens"]);void 0!==t&&null!=o&&p2(t,["setup","generationConfig","maxOutputTokens"],o);let l=p5(e,["mediaResolution"]);void 0!==t&&null!=l&&p2(t,["setup","generationConfig","mediaResolution"],l);let u=p5(e,["seed"]);void 0!==t&&null!=u&&p2(t,["setup","generationConfig","seed"],u);let c=p5(e,["speechConfig"]);void 0!==t&&null!=c&&p2(t,["setup","generationConfig","speechConfig"],fF(c));let h=p5(e,["thinkingConfig"]);void 0!==t&&null!=h&&p2(t,["setup","generationConfig","thinkingConfig"],h);let d=p5(e,["enableAffectiveDialog"]);void 0!==t&&null!=d&&p2(t,["setup","generationConfig","enableAffectiveDialog"],d);let p=p5(e,["systemInstruction"]);void 0!==t&&null!=p&&p2(t,["setup","systemInstruction"],function(e){let t={},n=p5(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,a,o,l,u,c,h,d,p;return n={},null!=(r=p5(t=e,["mediaResolution"]))&&p2(n,["mediaResolution"],r),null!=(i=p5(t,["codeExecutionResult"]))&&p2(n,["codeExecutionResult"],i),null!=(s=p5(t,["executableCode"]))&&p2(n,["executableCode"],s),null!=(a=p5(t,["fileData"]))&&p2(n,["fileData"],function(e){let t={};if(void 0!==p5(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=p5(e,["fileUri"]);null!=n&&p2(t,["fileUri"],n);let r=p5(e,["mimeType"]);return null!=r&&p2(t,["mimeType"],r),t}(a)),null!=(o=p5(t,["functionCall"]))&&p2(n,["functionCall"],function(e){let t={},n=p5(e,["id"]);null!=n&&p2(t,["id"],n);let r=p5(e,["args"]);null!=r&&p2(t,["args"],r);let i=p5(e,["name"]);if(null!=i&&p2(t,["name"],i),void 0!==p5(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==p5(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(o)),null!=(l=p5(t,["functionResponse"]))&&p2(n,["functionResponse"],l),null!=(u=p5(t,["inlineData"]))&&p2(n,["inlineData"],mi(u)),null!=(c=p5(t,["text"]))&&p2(n,["text"],c),null!=(h=p5(t,["thought"]))&&p2(n,["thought"],h),null!=(d=p5(t,["thoughtSignature"]))&&p2(n,["thoughtSignature"],d),null!=(p=p5(t,["videoMetadata"]))&&p2(n,["videoMetadata"],p),n})),p2(t,["parts"],e)}let r=p5(e,["role"]);return null!=r&&p2(t,["role"],r),t}(fj(p)));let f=p5(e,["tools"]);if(void 0!==t&&null!=f){let e=fq(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=p5(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["functionDeclarations"],e)}if(void 0!==p5(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=p5(e,["googleSearchRetrieval"]);null!=r&&p2(t,["googleSearchRetrieval"],r);let i=p5(e,["computerUse"]);null!=i&&p2(t,["computerUse"],i);let s=p5(e,["fileSearch"]);null!=s&&p2(t,["fileSearch"],s);let a=p5(e,["codeExecution"]);if(null!=a&&p2(t,["codeExecution"],a),void 0!==p5(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=p5(e,["googleMaps"]);null!=o&&p2(t,["googleMaps"],function(e){let t={};if(void 0!==p5(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=p5(e,["enableWidget"]);return null!=n&&p2(t,["enableWidget"],n),t}(o));let l=p5(e,["googleSearch"]);null!=l&&p2(t,["googleSearch"],function(e){let t={};if(void 0!==p5(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==p5(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=p5(e,["timeRangeFilter"]);return null!=n&&p2(t,["timeRangeFilter"],n),t}(l));let u=p5(e,["urlContext"]);return null!=u&&p2(t,["urlContext"],u),t})(fV(e)))),p2(t,["setup","tools"],e)}let m=p5(e,["sessionResumption"]);void 0!==t&&null!=m&&p2(t,["setup","sessionResumption"],function(e){let t={},n=p5(e,["handle"]);if(null!=n&&p2(t,["handle"],n),void 0!==p5(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(m));let g=p5(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&p2(t,["setup","inputAudioTranscription"],g);let y=p5(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&p2(t,["setup","outputAudioTranscription"],y);let v=p5(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&p2(t,["setup","realtimeInputConfig"],v);let b=p5(e,["contextWindowCompression"]);void 0!==t&&null!=b&&p2(t,["setup","contextWindowCompression"],b);let x=p5(e,["proactivity"]);return void 0!==t&&null!=x&&p2(t,["setup","proactivity"],x),{}}(n,e)),E=e}return delete E.config,x.send(JSON.stringify(E)),new mM(x,this.apiClient)}isCallableTool(e){return"callTool"in e&&"function"==typeof e.callTool}}let mP={turnComplete:!0};class mM{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(null!==t.turns&&void 0!==t.turns){let n=[];try{n=fM(t.turns),e.isVertexAI()||(n=n.map(e=>ma(e)))}catch(e){throw Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(null==t.functionResponses||0===(n=Array.isArray(t.functionResponses)?t.functionResponses:[t.functionResponses]).length)throw Error("functionResponses is required.");for(let t of n){if("object"!=typeof t||null===t||!("name"in t)||!("response"in t))throw Error(`Could not parse function response, type '${typeof t}'.`);if(!e.isVertexAI()&&!("id"in t))throw Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},mP),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};t=this.apiClient.isVertexAI()?{realtimeInput:function(e){let t={},n=p5(e,["media"]);if(null!=n){let e=fC(n);Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["mediaChunks"],e)}let r=p5(e,["audio"]);null!=r&&p2(t,["audio"],fN(r));let i=p5(e,["audioStreamEnd"]);null!=i&&p2(t,["audioStreamEnd"],i);let s=p5(e,["video"]);null!=s&&p2(t,["video"],fS(s));let a=p5(e,["text"]);null!=a&&p2(t,["text"],a);let o=p5(e,["activityStart"]);null!=o&&p2(t,["activityStart"],o);let l=p5(e,["activityEnd"]);return null!=l&&p2(t,["activityEnd"],l),t}(e)}:{realtimeInput:function(e){let t={},n=p5(e,["media"]);if(null!=n){let e=fC(n);Array.isArray(e)&&(e=e.map(e=>mi(e))),p2(t,["mediaChunks"],e)}let r=p5(e,["audio"]);null!=r&&p2(t,["audio"],mi(fN(r)));let i=p5(e,["audioStreamEnd"]);null!=i&&p2(t,["audioStreamEnd"],i);let s=p5(e,["video"]);null!=s&&p2(t,["video"],mi(fS(s)));let a=p5(e,["text"]);null!=a&&p2(t,["text"],a);let o=p5(e,["activityStart"]);null!=o&&p2(t,["activityStart"],o);let l=p5(e,["activityEnd"]);return null!=l&&p2(t,["activityEnd"],l),t}(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(null==e.functionResponses)throw Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function mU(e){var t,n,r;if(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.disable)return!0;let i=!1;for(let t of null!=(n=null==e?void 0:e.tools)?n:[])if(mL(t)){i=!0;break}if(!i)return!0;let s=null==(r=null==e?void 0:e.automaticFunctionCalling)?void 0:r.maximumRemoteCalls;return(!(!s||!(s<0)&&Number.isInteger(s))||0==s)&&(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",s),!0)}function mL(e){return"callTool"in e&&"function"==typeof e.callTool}function mF(e){var t;let n=[];return(null==(t=null==e?void 0:e.config)?void 0:t.tools)&&e.config.tools.forEach((e,t)=>{mL(e)||e.functionDeclarations&&e.functionDeclarations.length>0&&n.push(t)}),n}function mV(e){var t;return!(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.ignoreCallHistory)}class mq extends p0{constructor(e){super(),this.apiClient=e,this.generateContent=async e=>{var t,n,r,i,s,a,o,l;let u,c,h=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!(null!=(l=null==(o=null==(a=e.config)?void 0:a.tools)?void 0:o.some(e=>mL(e)))&&l)||mU(e.config))return await this.generateContentInternal(h);let d=mF(e);if(d.length>0){let e=d.map(e=>`tools[${e}]`).join(", ");throw Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${e}.`)}let p=fM(h.contents),f=null!=(r=null==(n=null==(t=h.config)?void 0:t.automaticFunctionCalling)?void 0:n.maximumRemoteCalls)?r:10,m=0;for(;m<f&&(u=await this.generateContentInternal(h)).functionCalls&&0!==u.functionCalls.length;){let t=u.candidates[0].content,n=[];for(let t of null!=(s=null==(i=e.config)?void 0:i.tools)?s:[])if(mL(t)){let e=await t.callTool(u.functionCalls);n.push(...e)}m++,c={role:"user",parts:n},h.contents=fM(h.contents),h.contents.push(t),h.contents.push(c),mV(h.config)&&(p.push(t),p.push(c))}return mV(h.config)&&(u.automaticFunctionCallingHistory=p),u},this.generateContentStream=async e=>{var t,n,r,i,s;if(this.maybeMoveToResponseJsonSchem(e),mU(e.config)){let t=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(t)}let a=mF(e);if(a.length>0){let e=a.map(e=>`tools[${e}]`).join(", ");throw Error(`Incompatible tools found at ${e}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let o=null==(r=null==(n=null==(t=null==e?void 0:e.config)?void 0:t.toolConfig)?void 0:n.functionCallingConfig)?void 0:r.streamFunctionCallArguments,l=null==(s=null==(i=null==e?void 0:e.config)?void 0:i.automaticFunctionCalling)?void 0:s.disable;if(o&&!l)throw Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(e)},this.generateImages=async e=>await this.generateImagesInternal(e).then(e=>{var t;let n,r=[];if(null==e?void 0:e.generatedImages)for(let i of e.generatedImages)i&&(null==i?void 0:i.safetyAttributes)&&(null==(t=null==i?void 0:i.safetyAttributes)?void 0:t.contentType)==="Positive Prompt"?n=null==i?void 0:i.safetyAttributes:r.push(i);return n?{generatedImages:r,positivePromptSafetyAttributes:n,sdkHttpResponse:e.sdkHttpResponse}:{generatedImages:r,sdkHttpResponse:e.sdkHttpResponse}}),this.list=async e=>{var t;let n={config:Object.assign(Object.assign({},{queryBase:!0}),null==e?void 0:e.config)};if(this.apiClient.isVertexAI()&&!n.config.queryBase)if(null==(t=n.config)?void 0:t.filter)throw Error("Filtering tuned models list for Vertex AI is not currently supported");else n.config.filter="labels.tune-type:*";return new f1(tO.PAGED_ITEM_MODELS,e=>this.listInternal(e),await this.listInternal(n),n)},this.editImage=async e=>{let t={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(t.referenceImages=e.referenceImages.map(e=>e.toReferenceImageAPI())),await this.editImageInternal(t)},this.upscaleImage=async e=>{let t={numberOfImages:1,mode:"upscale"};e.config&&(t=Object.assign(Object.assign({},t),e.config));let n={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:t};return await this.upscaleImageInternal(n)},this.generateVideos=async e=>{var t,n,r,i,s,a;if((e.prompt||e.image||e.video)&&e.source)throw Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return!this.apiClient.isVertexAI()&&((null==(t=e.video)?void 0:t.uri)&&(null==(n=e.video)?void 0:n.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:(null==(i=null==(r=e.source)?void 0:r.video)?void 0:i.uri)&&(null==(a=null==(s=e.source)?void 0:s.video)?void 0:a.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&!e.config.responseJsonSchema&&Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema)}async processParamsMaybeAddMcpUsage(e){var t,n,r;let i=null==(t=e.config)?void 0:t.tools;if(!i)return e;let s=await Promise.all(i.map(async e=>mL(e)?await e.tool():e)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:s})};if(a.config.tools=s,e.config&&e.config.tools&&mS(e.config.tools)){let t=Object.assign({},null!=(r=null==(n=e.config.httpOptions)?void 0:n.headers)?r:{});0===Object.keys(t).length&&(t=this.apiClient.getDefaultHeaders()),mN(t),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:t})}return a}async initAfcToolsMap(e){var t,n,r;let i=new Map;for(let s of null!=(n=null==(t=e.config)?void 0:t.tools)?n:[])if(mL(s))for(let e of null!=(r=(await s.tool()).functionDeclarations)?r:[]){if(!e.name)throw Error("Function declaration name is required.");if(i.has(e.name))throw Error(`Duplicate tool declaration name: ${e.name}`);i.set(e.name,s)}return i}async processAfcStream(e){var t,n,r;let i=null!=(r=null==(n=null==(t=e.config)?void 0:t.automaticFunctionCalling)?void 0:n.maximumRemoteCalls)?r:10,s=!1,a=0;return function(e,t,n){var r,o;return f3(this,arguments,function*(){for(var l,u,c,h;a<i;){s&&(a++,s=!1);let m=yield f4(e.processParamsMaybeAddMcpUsage(n)),g=yield f4(e.generateContentStreamInternal(m)),y=[],v=[];try{for(var d,p=!0,f=(u=void 0,f8(g));!(l=(d=yield f4(f.next())).done);p=!0)if(h=d.value,p=!1,yield yield f4(h),h.candidates&&(null==(r=h.candidates[0])?void 0:r.content)){for(let e of(v.push(h.candidates[0].content),null!=(o=h.candidates[0].content.parts)?o:[]))if(a<i&&e.functionCall){if(!e.functionCall.name)throw Error("Function call name was not returned by the model.");if(t.has(e.functionCall.name)){let n=yield f4(t.get(e.functionCall.name).callTool([e.functionCall]));y.push(...n)}else throw Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${t.keys()}, mising tool: ${e.functionCall.name}`)}}}catch(e){u={error:e}}finally{try{!p&&!l&&(c=f.return)&&(yield f4(c.call(f)))}finally{if(u)throw u.error}}if(y.length>0){s=!0;let e=new p8;e.candidates=[{content:{role:"user",parts:y}}],yield yield f4(e);let t=[];t.push(...v),t.push({role:"user",parts:y});let r=fM(n.contents).concat(t);n.contents=r}else break}})}(this,await this.initAfcToolsMap(e),e)}async generateContentInternal(e){var t,n,r,i;let s="",a={};if(this.apiClient.isVertexAI()){let r=ml(this.apiClient,e);return s=p1("{model}:generateContent",r._url),a=r._query,delete r._url,delete r._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=mc(e),n=new p8;return Object.assign(n,t),n})}{let t=mo(this.apiClient,e);return s=p1("{model}:generateContent",t._url),a=t._query,delete t._url,delete t._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=mu(e),n=new p8;return Object.assign(n,t),n})}}async generateContentStreamInternal(e){var t,n,r,i;let s="",a={};if(this.apiClient.isVertexAI()){let r=ml(this.apiClient,e);return s=p1("{model}:streamGenerateContent?alt=sse",r._url),a=r._query,delete r._url,delete r._query,this.apiClient.requestStream({path:s,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(function(e){return f3(this,arguments,function*(){var t,n,r,i;try{for(var s,a=!0,o=f8(e);!(t=(s=yield f4(o.next())).done);a=!0){i=s.value,a=!1;let e=mc((yield f4(i.json())));e.sdkHttpResponse={headers:i.headers};let t=new p8;Object.assign(t,e),yield yield f4(t)}}catch(e){n={error:e}}finally{try{!a&&!t&&(r=o.return)&&(yield f4(r.call(o)))}finally{if(n)throw n.error}}})})}{let t=mo(this.apiClient,e);return s=p1("{model}:streamGenerateContent?alt=sse",t._url),a=t._query,delete t._url,delete t._query,this.apiClient.requestStream({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(function(e){return f3(this,arguments,function*(){var t,n,r,i;try{for(var s,a=!0,o=f8(e);!(t=(s=yield f4(o.next())).done);a=!0){i=s.value,a=!1;let e=mu((yield f4(i.json())));e.sdkHttpResponse={headers:i.headers};let t=new p8;Object.assign(t,e),yield yield f4(t)}}catch(e){n={error:e}}finally{try{!a&&!t&&(r=o.return)&&(yield f4(r.call(o)))}finally{if(n)throw n.error}}})})}}async embedContent(e){var t,n,r,i;let s="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n,r,i,s,a,o={},l=p5(t,["model"]);null!=l&&p2(o,["_url","model"],f_(e,l));let u=p5(t,["contents"]);if(null!=u){let t=fP(e,u);Array.isArray(t)&&(t=t.map(e=>e)),p2(o,["instances[]","content"],t)}let c=p5(t,["config"]);return null!=c&&(n=p5(c,["taskType"]),void 0!==o&&null!=n&&p2(o,["instances[]","task_type"],n),r=p5(c,["title"]),void 0!==o&&null!=r&&p2(o,["instances[]","title"],r),i=p5(c,["outputDimensionality"]),void 0!==o&&null!=i&&p2(o,["parameters","outputDimensionality"],i),s=p5(c,["mimeType"]),void 0!==o&&null!=s&&p2(o,["instances[]","mimeType"],s),a=p5(c,["autoTruncate"]),void 0!==o&&null!=a&&p2(o,["parameters","autoTruncate"],a)),o}(this.apiClient,e);return s=p1("{model}:predict",r._url),a=r._query,delete r._url,delete r._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["predictions[]","embeddings"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,a,o;return n={},null!=(r=p5(e,["values"]))&&p2(n,["values"],r),null!=(i=p5(e,["statistics"]))&&p2(n,["statistics"],(s={},null!=(a=p5(t=i,["truncated"]))&&p2(s,["truncated"],a),null!=(o=p5(t,["token_count"]))&&p2(s,["tokenCount"],o),s)),n})),p2(t,["embeddings"],e)}let i=p5(e,["metadata"]);return null!=i&&p2(t,["metadata"],i),t}(e),n=new p7;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=p5(t,["model"]);null!=r&&p2(n,["_url","model"],f_(e,r));let i=p5(t,["contents"]);if(null!=i){let t=fP(e,i);Array.isArray(t)&&(t=t.map(e=>e)),p2(n,["requests[]","content"],t)}let s=p5(t,["config"]);null!=s&&function(e,t){let n=p5(e,["taskType"]);void 0!==t&&null!=n&&p2(t,["requests[]","taskType"],n);let r=p5(e,["title"]);void 0!==t&&null!=r&&p2(t,["requests[]","title"],r);let i=p5(e,["outputDimensionality"]);if(void 0!==t&&null!=i&&p2(t,["requests[]","outputDimensionality"],i),void 0!==p5(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==p5(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.")}(s,n);let a=p5(t,["model"]);return void 0!==a&&p2(n,["requests[]","model"],f_(e,a)),n}(this.apiClient,e);return s=p1("{model}:batchEmbedContents",t._url),a=t._query,delete t._url,delete t._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["embeddings"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["embeddings"],e)}let i=p5(e,["metadata"]);return null!=i&&p2(t,["metadata"],i),t}(e),n=new p7;return Object.assign(n,t),n})}}async generateImagesInternal(e){var t,n,r,i,s,a;let o="",l={};if(this.apiClient.isVertexAI()){let r,i,a,u,c,h,d,p,f,m,g,y,v,b,x,w,E,_,I,C,T,S=(s=this.apiClient,r={},null!=(i=p5(e,["model"]))&&p2(r,["_url","model"],f_(s,i)),null!=(a=p5(e,["prompt"]))&&p2(r,["instances[0]","prompt"],a),null!=(u=p5(e,["config"]))&&(c=p5(u,["outputGcsUri"]),void 0!==r&&null!=c&&p2(r,["parameters","storageUri"],c),h=p5(u,["negativePrompt"]),void 0!==r&&null!=h&&p2(r,["parameters","negativePrompt"],h),d=p5(u,["numberOfImages"]),void 0!==r&&null!=d&&p2(r,["parameters","sampleCount"],d),p=p5(u,["aspectRatio"]),void 0!==r&&null!=p&&p2(r,["parameters","aspectRatio"],p),f=p5(u,["guidanceScale"]),void 0!==r&&null!=f&&p2(r,["parameters","guidanceScale"],f),m=p5(u,["seed"]),void 0!==r&&null!=m&&p2(r,["parameters","seed"],m),g=p5(u,["safetyFilterLevel"]),void 0!==r&&null!=g&&p2(r,["parameters","safetySetting"],g),y=p5(u,["personGeneration"]),void 0!==r&&null!=y&&p2(r,["parameters","personGeneration"],y),v=p5(u,["includeSafetyAttributes"]),void 0!==r&&null!=v&&p2(r,["parameters","includeSafetyAttributes"],v),b=p5(u,["includeRaiReason"]),void 0!==r&&null!=b&&p2(r,["parameters","includeRaiReason"],b),x=p5(u,["language"]),void 0!==r&&null!=x&&p2(r,["parameters","language"],x),w=p5(u,["outputMimeType"]),void 0!==r&&null!=w&&p2(r,["parameters","outputOptions","mimeType"],w),E=p5(u,["outputCompressionQuality"]),void 0!==r&&null!=E&&p2(r,["parameters","outputOptions","compressionQuality"],E),_=p5(u,["addWatermark"]),void 0!==r&&null!=_&&p2(r,["parameters","addWatermark"],_),I=p5(u,["labels"]),void 0!==r&&null!=I&&p2(r,["labels"],I),C=p5(u,["imageSize"]),void 0!==r&&null!=C&&p2(r,["parameters","sampleImageSize"],C),T=p5(u,["enhancePrompt"]),void 0!==r&&null!=T&&p2(r,["parameters","enhancePrompt"],T)),r);return o=p1("{model}:predict",S._url),l=S._query,delete S._url,delete S._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(S),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>mh(e))),p2(t,["generatedImages"],e)}let i=p5(e,["positivePromptSafetyAttributes"]);return null!=i&&p2(t,["positivePromptSafetyAttributes"],mv(i)),t}(e),n=new p9;return Object.assign(n,t),n})}{let t,n,s,u,c=(a=this.apiClient,t={},null!=(n=p5(e,["model"]))&&p2(t,["_url","model"],f_(a,n)),null!=(s=p5(e,["prompt"]))&&p2(t,["instances[0]","prompt"],s),null!=(u=p5(e,["config"]))&&function(e,t){if(void 0!==p5(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==p5(e,["negativePrompt"]))throw Error("negativePrompt parameter is not supported in Gemini API.");let n=p5(e,["numberOfImages"]);void 0!==t&&null!=n&&p2(t,["parameters","sampleCount"],n);let r=p5(e,["aspectRatio"]);void 0!==t&&null!=r&&p2(t,["parameters","aspectRatio"],r);let i=p5(e,["guidanceScale"]);if(void 0!==t&&null!=i&&p2(t,["parameters","guidanceScale"],i),void 0!==p5(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let s=p5(e,["safetyFilterLevel"]);void 0!==t&&null!=s&&p2(t,["parameters","safetySetting"],s);let a=p5(e,["personGeneration"]);void 0!==t&&null!=a&&p2(t,["parameters","personGeneration"],a);let o=p5(e,["includeSafetyAttributes"]);void 0!==t&&null!=o&&p2(t,["parameters","includeSafetyAttributes"],o);let l=p5(e,["includeRaiReason"]);void 0!==t&&null!=l&&p2(t,["parameters","includeRaiReason"],l);let u=p5(e,["language"]);void 0!==t&&null!=u&&p2(t,["parameters","language"],u);let c=p5(e,["outputMimeType"]);void 0!==t&&null!=c&&p2(t,["parameters","outputOptions","mimeType"],c);let h=p5(e,["outputCompressionQuality"]);if(void 0!==t&&null!=h&&p2(t,["parameters","outputOptions","compressionQuality"],h),void 0!==p5(e,["addWatermark"]))throw Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==p5(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let d=p5(e,["imageSize"]);if(void 0!==t&&null!=d&&p2(t,["parameters","sampleImageSize"],d),void 0!==p5(e,["enhancePrompt"]))throw Error("enhancePrompt parameter is not supported in Gemini API.")}(u,t),t);return o=p1("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{var t,n;let r,i,s,a,o,l,u;return r={},null!=(i=p5(t=e,["_self"]))&&p2(r,["image"],(s={},null!=(a=p5(n=i,["bytesBase64Encoded"]))&&p2(s,["imageBytes"],p6(a)),null!=(o=p5(n,["mimeType"]))&&p2(s,["mimeType"],o),s)),null!=(l=p5(t,["raiFilteredReason"]))&&p2(r,["raiFilteredReason"],l),null!=(u=p5(t,["_self"]))&&p2(r,["safetyAttributes"],my(u)),r})),p2(t,["generatedImages"],e)}let i=p5(e,["positivePromptSafetyAttributes"]);return null!=i&&p2(t,["positivePromptSafetyAttributes"],my(i)),t}(e),n=new p9;return Object.assign(n,t),n})}}async editImageInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let s=function(e,t){let n,r,i,s,a,o,l,u,c,h,d,p,f,m,g,y,v,b={},x=p5(t,["model"]);null!=x&&p2(b,["_url","model"],f_(e,x));let w=p5(t,["prompt"]);null!=w&&p2(b,["instances[0]","prompt"],w);let E=p5(t,["referenceImages"]);if(null!=E){let e=E;Array.isArray(e)&&(e=e.map(e=>(function(e){let t,n,r,i,s,a,o,l={},u=p5(e,["referenceImage"]);null!=u&&p2(l,["referenceImage"],mf(u));let c=p5(e,["referenceId"]);null!=c&&p2(l,["referenceId"],c);let h=p5(e,["referenceType"]);null!=h&&p2(l,["referenceType"],h);let d=p5(e,["maskImageConfig"]);null!=d&&p2(l,["maskImageConfig"],(t={},null!=(n=p5(d,["maskMode"]))&&p2(t,["maskMode"],n),null!=(r=p5(d,["segmentationClasses"]))&&p2(t,["maskClasses"],r),null!=(i=p5(d,["maskDilation"]))&&p2(t,["dilation"],i),t));let p=p5(e,["controlImageConfig"]);null!=p&&p2(l,["controlImageConfig"],(s={},null!=(a=p5(p,["controlType"]))&&p2(s,["controlType"],a),null!=(o=p5(p,["enableControlImageComputation"]))&&p2(s,["computeControl"],o),s));let f=p5(e,["styleImageConfig"]);null!=f&&p2(l,["styleImageConfig"],f);let m=p5(e,["subjectImageConfig"]);return null!=m&&p2(l,["subjectImageConfig"],m),l})(e))),p2(b,["instances[0]","referenceImages"],e)}let _=p5(t,["config"]);return null!=_&&(n=p5(_,["outputGcsUri"]),void 0!==b&&null!=n&&p2(b,["parameters","storageUri"],n),r=p5(_,["negativePrompt"]),void 0!==b&&null!=r&&p2(b,["parameters","negativePrompt"],r),i=p5(_,["numberOfImages"]),void 0!==b&&null!=i&&p2(b,["parameters","sampleCount"],i),s=p5(_,["aspectRatio"]),void 0!==b&&null!=s&&p2(b,["parameters","aspectRatio"],s),a=p5(_,["guidanceScale"]),void 0!==b&&null!=a&&p2(b,["parameters","guidanceScale"],a),o=p5(_,["seed"]),void 0!==b&&null!=o&&p2(b,["parameters","seed"],o),l=p5(_,["safetyFilterLevel"]),void 0!==b&&null!=l&&p2(b,["parameters","safetySetting"],l),u=p5(_,["personGeneration"]),void 0!==b&&null!=u&&p2(b,["parameters","personGeneration"],u),c=p5(_,["includeSafetyAttributes"]),void 0!==b&&null!=c&&p2(b,["parameters","includeSafetyAttributes"],c),h=p5(_,["includeRaiReason"]),void 0!==b&&null!=h&&p2(b,["parameters","includeRaiReason"],h),d=p5(_,["language"]),void 0!==b&&null!=d&&p2(b,["parameters","language"],d),p=p5(_,["outputMimeType"]),void 0!==b&&null!=p&&p2(b,["parameters","outputOptions","mimeType"],p),f=p5(_,["outputCompressionQuality"]),void 0!==b&&null!=f&&p2(b,["parameters","outputOptions","compressionQuality"],f),m=p5(_,["addWatermark"]),void 0!==b&&null!=m&&p2(b,["parameters","addWatermark"],m),g=p5(_,["labels"]),void 0!==b&&null!=g&&p2(b,["labels"],g),y=p5(_,["editMode"]),void 0!==b&&null!=y&&p2(b,["parameters","editMode"],y),v=p5(_,["baseSteps"]),void 0!==b&&null!=v&&p2(b,["parameters","editConfig","baseSteps"],v)),b}(this.apiClient,e);return r=p1("{model}:predict",s._url),i=s._query,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>mh(e))),p2(t,["generatedImages"],e)}return t}(e),n=new fe;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n,r;let i="",s={};if(this.apiClient.isVertexAI()){let a,o,l,u,c,h,d,p,f,m,g,y,v,b,x,w,E=(r=this.apiClient,a={},null!=(o=p5(e,["model"]))&&p2(a,["_url","model"],f_(r,o)),null!=(l=p5(e,["image"]))&&p2(a,["instances[0]","image"],mf(l)),null!=(u=p5(e,["upscaleFactor"]))&&p2(a,["parameters","upscaleConfig","upscaleFactor"],u),null!=(c=p5(e,["config"]))&&(h=p5(c,["outputGcsUri"]),void 0!==a&&null!=h&&p2(a,["parameters","storageUri"],h),d=p5(c,["safetyFilterLevel"]),void 0!==a&&null!=d&&p2(a,["parameters","safetySetting"],d),p=p5(c,["personGeneration"]),void 0!==a&&null!=p&&p2(a,["parameters","personGeneration"],p),f=p5(c,["includeRaiReason"]),void 0!==a&&null!=f&&p2(a,["parameters","includeRaiReason"],f),m=p5(c,["outputMimeType"]),void 0!==a&&null!=m&&p2(a,["parameters","outputOptions","mimeType"],m),g=p5(c,["outputCompressionQuality"]),void 0!==a&&null!=g&&p2(a,["parameters","outputOptions","compressionQuality"],g),y=p5(c,["enhanceInputImage"]),void 0!==a&&null!=y&&p2(a,["parameters","upscaleConfig","enhanceInputImage"],y),v=p5(c,["imagePreservationFactor"]),void 0!==a&&null!=v&&p2(a,["parameters","upscaleConfig","imagePreservationFactor"],v),b=p5(c,["labels"]),void 0!==a&&null!=b&&p2(a,["labels"],b),x=p5(c,["numberOfImages"]),void 0!==a&&null!=x&&p2(a,["parameters","sampleCount"],x),w=p5(c,["mode"]),void 0!==a&&null!=w&&p2(a,["parameters","mode"],w)),a);return i=p1("{model}:predict",E._url),s=E._query,delete E._url,delete E._query,this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(E),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>mh(e))),p2(t,["generatedImages"],e)}return t}(e),n=new ft;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n,r;let i="",s={};if(this.apiClient.isVertexAI()){let a,o,l,u,c,h,d,p,f,m,g,y,v,b,x,w=(r=this.apiClient,a={},null!=(o=p5(e,["model"]))&&p2(a,["_url","model"],f_(r,o)),null!=(l=p5(e,["source"]))&&function(e,t){let n=p5(e,["prompt"]);void 0!==t&&null!=n&&p2(t,["instances[0]","prompt"],n);let r=p5(e,["personImage"]);void 0!==t&&null!=r&&p2(t,["instances[0]","personImage","image"],mf(r));let i=p5(e,["productImages"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>{let t,n;return t={},null!=(n=p5(e,["productImage"]))&&p2(t,["image"],mf(n)),t})),p2(t,["instances[0]","productImages"],e)}}(l,a),null!=(u=p5(e,["config"]))&&(c=p5(u,["numberOfImages"]),void 0!==a&&null!=c&&p2(a,["parameters","sampleCount"],c),h=p5(u,["baseSteps"]),void 0!==a&&null!=h&&p2(a,["parameters","baseSteps"],h),d=p5(u,["outputGcsUri"]),void 0!==a&&null!=d&&p2(a,["parameters","storageUri"],d),p=p5(u,["seed"]),void 0!==a&&null!=p&&p2(a,["parameters","seed"],p),f=p5(u,["safetyFilterLevel"]),void 0!==a&&null!=f&&p2(a,["parameters","safetySetting"],f),m=p5(u,["personGeneration"]),void 0!==a&&null!=m&&p2(a,["parameters","personGeneration"],m),g=p5(u,["addWatermark"]),void 0!==a&&null!=g&&p2(a,["parameters","addWatermark"],g),y=p5(u,["outputMimeType"]),void 0!==a&&null!=y&&p2(a,["parameters","outputOptions","mimeType"],y),v=p5(u,["outputCompressionQuality"]),void 0!==a&&null!=v&&p2(a,["parameters","outputOptions","compressionQuality"],v),b=p5(u,["enhancePrompt"]),void 0!==a&&null!=b&&p2(a,["parameters","enhancePrompt"],b),x=p5(u,["labels"]),void 0!==a&&null!=x&&p2(a,["labels"],x)),a);return i=p1("{model}:predict",w._url),s=w._query,delete w._url,delete w._query,this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(w),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=p5(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>mh(e))),p2(t,["generatedImages"],e)}return t}(e),n=new fn;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n,r,i,s;let a="",o={};if(this.apiClient.isVertexAI()){let l,u,c,h,d,p,f,m,g,y,v,b,x,w,E,_=(r=this.apiClient,p={},null!=(f=p5(e,["model"]))&&p2(p,["_url","model"],f_(r,f)),null!=(m=p5(e,["source"]))&&(i=m,s=p,c=p5(i,["prompt"]),void 0!==s&&null!=c&&p2(s,["instances[0]","prompt"],c),h=p5(i,["image"]),void 0!==s&&null!=h&&p2(s,["instances[0]","image"],mf(h)),d=p5(i,["scribbleImage"]),void 0!==s&&null!=d&&p2(s,["instances[0]","scribble"],(l={},null!=(u=p5(d,["image"]))&&p2(l,["image"],mf(u)),l))),null!=(g=p5(e,["config"]))&&(y=p5(g,["mode"]),void 0!==p&&null!=y&&p2(p,["parameters","mode"],y),v=p5(g,["maxPredictions"]),void 0!==p&&null!=v&&p2(p,["parameters","maxPredictions"],v),b=p5(g,["confidenceThreshold"]),void 0!==p&&null!=b&&p2(p,["parameters","confidenceThreshold"],b),x=p5(g,["maskDilation"]),void 0!==p&&null!=x&&p2(p,["parameters","maskDilation"],x),w=p5(g,["binaryColorThreshold"]),void 0!==p&&null!=w&&p2(p,["parameters","binaryColorThreshold"],w),E=p5(g,["labels"]),void 0!==p&&null!=E&&p2(p,["labels"],E)),p);return a=p1("{model}:predict",_._url),o=_._query,delete _._url,delete _._query,this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(_),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=p5(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=p5(e,["_self"]);null!=n&&p2(t,["mask"],md(n));let r=p5(e,["labels"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["labels"],e)}return t})(e))),p2(t,["generatedMasks"],e)}return t}(e),n=new fr;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,r,i,s,a;let o="",l={};if(this.apiClient.isVertexAI()){let r,i,a=(s=this.apiClient,r={},null!=(i=p5(e,["model"]))&&p2(r,["_url","name"],f_(s,i)),r);return o=p1("{name}",a._url),l=a._query,delete a._url,delete a._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>mg(e))}{let t,n,s=(a=this.apiClient,t={},null!=(n=p5(e,["model"]))&&p2(t,["_url","name"],f_(a,n)),t);return o=p1("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>mm(e))}}async listInternal(e){var t,n,r,i,s,a;let o="",l={};if(this.apiClient.isVertexAI()){let r,i,a,u,c,h,d=(s=this.apiClient,r={},null!=(i=p5(e,["config"]))&&(a=p5(i,["pageSize"]),void 0!==r&&null!=a&&p2(r,["_query","pageSize"],a),u=p5(i,["pageToken"]),void 0!==r&&null!=u&&p2(r,["_query","pageToken"],u),c=p5(i,["filter"]),void 0!==r&&null!=c&&p2(r,["_query","filter"],c),h=p5(i,["queryBase"]),void 0!==r&&null!=h&&p2(r,["_url","models_url"],fH(s,h))),r);return o=p1("{models_url}",d._url),l=d._query,delete d._url,delete d._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["nextPageToken"]);null!=r&&p2(t,["nextPageToken"],r);let i=p5(e,["_self"]);if(null!=i){let e=f$(i);Array.isArray(e)&&(e=e.map(e=>mg(e))),p2(t,["models"],e)}return t}(e),n=new fi;return Object.assign(n,t),n})}{let t,n,s,u,c,h,d=(a=this.apiClient,t={},null!=(n=p5(e,["config"]))&&(s=p5(n,["pageSize"]),void 0!==t&&null!=s&&p2(t,["_query","pageSize"],s),u=p5(n,["pageToken"]),void 0!==t&&null!=u&&p2(t,["_query","pageToken"],u),c=p5(n,["filter"]),void 0!==t&&null!=c&&p2(t,["_query","filter"],c),h=p5(n,["queryBase"]),void 0!==t&&null!=h&&p2(t,["_url","models_url"],fH(a,h))),t);return o=p1("{models_url}",d._url),l=d._query,delete d._url,delete d._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["nextPageToken"]);null!=r&&p2(t,["nextPageToken"],r);let i=p5(e,["_self"]);if(null!=i){let e=f$(i);Array.isArray(e)&&(e=e.map(e=>mm(e))),p2(t,["models"],e)}return t}(e),n=new fi;return Object.assign(n,t),n})}}async update(e){var t,n,r,i,s,a;let o="",l={};if(this.apiClient.isVertexAI()){let r,i,a,u,c,h,d=(s=this.apiClient,r={},null!=(i=p5(e,["model"]))&&p2(r,["_url","model"],f_(s,i)),null!=(a=p5(e,["config"]))&&(u=p5(a,["displayName"]),void 0!==r&&null!=u&&p2(r,["displayName"],u),c=p5(a,["description"]),void 0!==r&&null!=c&&p2(r,["description"],c),h=p5(a,["defaultCheckpointId"]),void 0!==r&&null!=h&&p2(r,["defaultCheckpointId"],h)),r);return o=p1("{model}",d._url),l=d._query,delete d._url,delete d._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>mg(e))}{let t,n,s,u,c,h,d=(a=this.apiClient,t={},null!=(n=p5(e,["model"]))&&p2(t,["_url","name"],f_(a,n)),null!=(s=p5(e,["config"]))&&(u=p5(s,["displayName"]),void 0!==t&&null!=u&&p2(t,["displayName"],u),c=p5(s,["description"]),void 0!==t&&null!=c&&p2(t,["description"],c),h=p5(s,["defaultCheckpointId"]),void 0!==t&&null!=h&&p2(t,["defaultCheckpointId"],h)),t);return o=p1("{name}",d._url),l=d._query,delete d._url,delete d._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>mm(e))}}async delete(e){var t,n,r,i,s,a;let o="",l={};if(this.apiClient.isVertexAI()){let r,i,a=(s=this.apiClient,r={},null!=(i=p5(e,["model"]))&&p2(r,["_url","name"],f_(s,i)),r);return o=p1("{name}",a._url),l=a._query,delete a._url,delete a._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r=(t={},null!=(n=p5(e,["sdkHttpResponse"]))&&p2(t,["sdkHttpResponse"],n),t),i=new fs;return Object.assign(i,r),i})}{let t,n,s=(a=this.apiClient,t={},null!=(n=p5(e,["model"]))&&p2(t,["_url","name"],f_(a,n)),t);return o=p1("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r=(t={},null!=(n=p5(e,["sdkHttpResponse"]))&&p2(t,["sdkHttpResponse"],n),t),i=new fs;return Object.assign(i,r),i})}}async countTokens(e){var t,n,r,i;let s="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=p5(t,["model"]);null!=r&&p2(n,["_url","model"],f_(e,r));let i=p5(t,["contents"]);if(null!=i){let e=fM(i);Array.isArray(e)&&(e=e.map(e=>e)),p2(n,["contents"],e)}let s=p5(t,["config"]);return null!=s&&function(e,t){let n=p5(e,["systemInstruction"]);void 0!==t&&null!=n&&p2(t,["systemInstruction"],fj(n));let r=p5(e,["tools"]);if(void 0!==t&&null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>mx(e))),p2(t,["tools"],e)}let i=p5(e,["generationConfig"]);void 0!==t&&null!=i&&p2(t,["generationConfig"],function(e){let t={},n=p5(e,["modelSelectionConfig"]);null!=n&&p2(t,["modelConfig"],n);let r=p5(e,["responseJsonSchema"]);null!=r&&p2(t,["responseJsonSchema"],r);let i=p5(e,["audioTimestamp"]);null!=i&&p2(t,["audioTimestamp"],i);let s=p5(e,["candidateCount"]);null!=s&&p2(t,["candidateCount"],s);let a=p5(e,["enableAffectiveDialog"]);null!=a&&p2(t,["enableAffectiveDialog"],a);let o=p5(e,["frequencyPenalty"]);null!=o&&p2(t,["frequencyPenalty"],o);let l=p5(e,["logprobs"]);null!=l&&p2(t,["logprobs"],l);let u=p5(e,["maxOutputTokens"]);null!=u&&p2(t,["maxOutputTokens"],u);let c=p5(e,["mediaResolution"]);null!=c&&p2(t,["mediaResolution"],c);let h=p5(e,["presencePenalty"]);null!=h&&p2(t,["presencePenalty"],h);let d=p5(e,["responseLogprobs"]);null!=d&&p2(t,["responseLogprobs"],d);let p=p5(e,["responseMimeType"]);null!=p&&p2(t,["responseMimeType"],p);let f=p5(e,["responseModalities"]);null!=f&&p2(t,["responseModalities"],f);let m=p5(e,["responseSchema"]);null!=m&&p2(t,["responseSchema"],m);let g=p5(e,["routingConfig"]);null!=g&&p2(t,["routingConfig"],g);let y=p5(e,["seed"]);null!=y&&p2(t,["seed"],y);let v=p5(e,["speechConfig"]);null!=v&&p2(t,["speechConfig"],mb(v));let b=p5(e,["stopSequences"]);null!=b&&p2(t,["stopSequences"],b);let x=p5(e,["temperature"]);null!=x&&p2(t,["temperature"],x);let w=p5(e,["thinkingConfig"]);null!=w&&p2(t,["thinkingConfig"],w);let E=p5(e,["topK"]);null!=E&&p2(t,["topK"],E);let _=p5(e,["topP"]);if(null!=_&&p2(t,["topP"],_),void 0!==p5(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(i))}(s,n),n}(this.apiClient,e);return s=p1("{model}:countTokens",r._url),a=r._query,delete r._url,delete r._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r,i=(t={},null!=(n=p5(e,["sdkHttpResponse"]))&&p2(t,["sdkHttpResponse"],n),null!=(r=p5(e,["totalTokens"]))&&p2(t,["totalTokens"],r),t),s=new fa;return Object.assign(s,i),s})}{let t=function(e,t){let n={},r=p5(t,["model"]);null!=r&&p2(n,["_url","model"],f_(e,r));let i=p5(t,["contents"]);if(null!=i){let e=fM(i);Array.isArray(e)&&(e=e.map(e=>ma(e))),p2(n,["contents"],e)}let s=p5(t,["config"]);return null!=s&&function(e){if(void 0!==p5(e,["systemInstruction"]))throw Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==p5(e,["tools"]))throw Error("tools parameter is not supported in Gemini API.");if(void 0!==p5(e,["generationConfig"]))throw Error("generationConfig parameter is not supported in Gemini API.")}(s),n}(this.apiClient,e);return s=p1("{model}:countTokens",t._url),a=t._query,delete t._url,delete t._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r,i,s=(t={},null!=(n=p5(e,["sdkHttpResponse"]))&&p2(t,["sdkHttpResponse"],n),null!=(r=p5(e,["totalTokens"]))&&p2(t,["totalTokens"],r),null!=(i=p5(e,["cachedContentTokenCount"]))&&p2(t,["cachedContentTokenCount"],i),t),a=new fa;return Object.assign(a,s),a})}}async computeTokens(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let s=function(e,t){let n={},r=p5(t,["model"]);null!=r&&p2(n,["_url","model"],f_(e,r));let i=p5(t,["contents"]);if(null!=i){let e=fM(i);Array.isArray(e)&&(e=e.map(e=>e)),p2(n,["contents"],e)}return n}(this.apiClient,e);return r=p1("{model}:computeTokens",s._url),i=s._query,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["tokensInfo"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["tokensInfo"],e)}return t}(e),n=new fo;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,r,i,s,a,o,l,u,c;let h="",d={};if(this.apiClient.isVertexAI()){let r,i,a,u,c,p,f,m,g,y,v=(s=this.apiClient,u={},null!=(c=p5(e,["model"]))&&p2(u,["_url","model"],f_(s,c)),null!=(p=p5(e,["prompt"]))&&p2(u,["instances[0]","prompt"],p),null!=(f=p5(e,["image"]))&&p2(u,["instances[0]","image"],mf(f)),null!=(m=p5(e,["video"]))&&p2(u,["instances[0]","video"],mE(m)),null!=(g=p5(e,["source"]))&&(o=g,l=u,r=p5(o,["prompt"]),void 0!==l&&null!=r&&p2(l,["instances[0]","prompt"],r),i=p5(o,["image"]),void 0!==l&&null!=i&&p2(l,["instances[0]","image"],mf(i)),a=p5(o,["video"]),void 0!==l&&null!=a&&p2(l,["instances[0]","video"],mE(a))),null!=(y=p5(e,["config"]))&&function(e,t){var n;let r,i,s,a=p5(e,["numberOfVideos"]);void 0!==t&&null!=a&&p2(t,["parameters","sampleCount"],a);let o=p5(e,["outputGcsUri"]);void 0!==t&&null!=o&&p2(t,["parameters","storageUri"],o);let l=p5(e,["fps"]);void 0!==t&&null!=l&&p2(t,["parameters","fps"],l);let u=p5(e,["durationSeconds"]);void 0!==t&&null!=u&&p2(t,["parameters","durationSeconds"],u);let c=p5(e,["seed"]);void 0!==t&&null!=c&&p2(t,["parameters","seed"],c);let h=p5(e,["aspectRatio"]);void 0!==t&&null!=h&&p2(t,["parameters","aspectRatio"],h);let d=p5(e,["resolution"]);void 0!==t&&null!=d&&p2(t,["parameters","resolution"],d);let p=p5(e,["personGeneration"]);void 0!==t&&null!=p&&p2(t,["parameters","personGeneration"],p);let f=p5(e,["pubsubTopic"]);void 0!==t&&null!=f&&p2(t,["parameters","pubsubTopic"],f);let m=p5(e,["negativePrompt"]);void 0!==t&&null!=m&&p2(t,["parameters","negativePrompt"],m);let g=p5(e,["enhancePrompt"]);void 0!==t&&null!=g&&p2(t,["parameters","enhancePrompt"],g);let y=p5(e,["generateAudio"]);void 0!==t&&null!=y&&p2(t,["parameters","generateAudio"],y);let v=p5(e,["lastFrame"]);void 0!==t&&null!=v&&p2(t,["instances[0]","lastFrame"],mf(v));let b=p5(e,["referenceImages"]);if(void 0!==t&&null!=b){let e=b;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i;return n={},null!=(r=p5(t=e,["image"]))&&p2(n,["image"],mf(r)),null!=(i=p5(t,["referenceType"]))&&p2(n,["referenceType"],i),n})),p2(t,["instances[0]","referenceImages"],e)}let x=p5(e,["mask"]);void 0!==t&&null!=x&&p2(t,["instances[0]","mask"],(r={},null!=(i=p5(n=x,["image"]))&&p2(r,["_self"],mf(i)),null!=(s=p5(n,["maskMode"]))&&p2(r,["maskMode"],s),r));let w=p5(e,["compressionQuality"]);void 0!==t&&null!=w&&p2(t,["parameters","compressionQuality"],w)}(y,u),u);return h=p1("{model}:predictLongRunning",v._url),d=v._query,delete v._url,delete v._query,this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(v),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t,n,r,i,s,a,o=(t={},null!=(n=p5(e,["name"]))&&p2(t,["name"],n),null!=(r=p5(e,["metadata"]))&&p2(t,["metadata"],r),null!=(i=p5(e,["done"]))&&p2(t,["done"],i),null!=(s=p5(e,["error"]))&&p2(t,["error"],s),null!=(a=p5(e,["response"]))&&p2(t,["response"],function(e){let t={},n=p5(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,a,o;return n={},null!=(r=p5(e,["_self"]))&&p2(n,["video"],(i={},null!=(s=p5(t=r,["gcsUri"]))&&p2(i,["uri"],s),null!=(a=p5(t,["bytesBase64Encoded"]))&&p2(i,["videoBytes"],p6(a)),null!=(o=p5(t,["mimeType"]))&&p2(i,["mimeType"],o),i)),n})),p2(t,["generatedVideos"],e)}let r=p5(e,["raiMediaFilteredCount"]);null!=r&&p2(t,["raiMediaFilteredCount"],r);let i=p5(e,["raiMediaFilteredReasons"]);return null!=i&&p2(t,["raiMediaFilteredReasons"],i),t}(a)),t),l=new fl;return Object.assign(l,o),l})}{let t,n,s,o,l,p,f,m,g,y,v=(a=this.apiClient,o={},null!=(l=p5(e,["model"]))&&p2(o,["_url","model"],f_(a,l)),null!=(p=p5(e,["prompt"]))&&p2(o,["instances[0]","prompt"],p),null!=(f=p5(e,["image"]))&&p2(o,["instances[0]","image"],mp(f)),null!=(m=p5(e,["video"]))&&p2(o,["instances[0]","video"],mw(m)),null!=(g=p5(e,["source"]))&&(u=g,c=o,t=p5(u,["prompt"]),void 0!==c&&null!=t&&p2(c,["instances[0]","prompt"],t),n=p5(u,["image"]),void 0!==c&&null!=n&&p2(c,["instances[0]","image"],mp(n)),s=p5(u,["video"]),void 0!==c&&null!=s&&p2(c,["instances[0]","video"],mw(s))),null!=(y=p5(e,["config"]))&&function(e,t){let n=p5(e,["numberOfVideos"]);if(void 0!==t&&null!=n&&p2(t,["parameters","sampleCount"],n),void 0!==p5(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==p5(e,["fps"]))throw Error("fps parameter is not supported in Gemini API.");let r=p5(e,["durationSeconds"]);if(void 0!==t&&null!=r&&p2(t,["parameters","durationSeconds"],r),void 0!==p5(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let i=p5(e,["aspectRatio"]);void 0!==t&&null!=i&&p2(t,["parameters","aspectRatio"],i);let s=p5(e,["resolution"]);void 0!==t&&null!=s&&p2(t,["parameters","resolution"],s);let a=p5(e,["personGeneration"]);if(void 0!==t&&null!=a&&p2(t,["parameters","personGeneration"],a),void 0!==p5(e,["pubsubTopic"]))throw Error("pubsubTopic parameter is not supported in Gemini API.");let o=p5(e,["negativePrompt"]);void 0!==t&&null!=o&&p2(t,["parameters","negativePrompt"],o);let l=p5(e,["enhancePrompt"]);if(void 0!==t&&null!=l&&p2(t,["parameters","enhancePrompt"],l),void 0!==p5(e,["generateAudio"]))throw Error("generateAudio parameter is not supported in Gemini API.");let u=p5(e,["lastFrame"]);void 0!==t&&null!=u&&p2(t,["instances[0]","lastFrame"],mp(u));let c=p5(e,["referenceImages"]);if(void 0!==t&&null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i;return n={},null!=(r=p5(t=e,["image"]))&&p2(n,["image"],mp(r)),null!=(i=p5(t,["referenceType"]))&&p2(n,["referenceType"],i),n})),p2(t,["instances[0]","referenceImages"],e)}if(void 0!==p5(e,["mask"]))throw Error("mask parameter is not supported in Gemini API.");if(void 0!==p5(e,["compressionQuality"]))throw Error("compressionQuality parameter is not supported in Gemini API.")}(y,o),o);return h=p1("{model}:predictLongRunning",v._url),d=v._query,delete v._url,delete v._query,this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(v),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>{let t,n,r,i,s,a,o=(t={},null!=(n=p5(e,["name"]))&&p2(t,["name"],n),null!=(r=p5(e,["metadata"]))&&p2(t,["metadata"],r),null!=(i=p5(e,["done"]))&&p2(t,["done"],i),null!=(s=p5(e,["error"]))&&p2(t,["error"],s),null!=(a=p5(e,["response","generateVideoResponse"]))&&p2(t,["response"],function(e){let t={},n=p5(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,a,o;return n={},null!=(r=p5(e,["video"]))&&p2(n,["video"],(i={},null!=(s=p5(t=r,["uri"]))&&p2(i,["uri"],s),null!=(a=p5(t,["encodedVideo"]))&&p2(i,["videoBytes"],p6(a)),null!=(o=p5(t,["encoding"]))&&p2(i,["mimeType"],o),i)),n})),p2(t,["generatedVideos"],e)}let r=p5(e,["raiMediaFilteredCount"]);null!=r&&p2(t,["raiMediaFilteredCount"],r);let i=p5(e,["raiMediaFilteredReasons"]);return null!=i&&p2(t,["raiMediaFilteredReasons"],i),t}(a)),t),l=new fl;return Object.assign(l,o),l})}}}class mB extends p0{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e,r=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e,r=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,r,i;let s="",a={};if(this.apiClient.isVertexAI()){let r,i,o=(r={},null!=(i=p5(e,["operationName"]))&&p2(r,["_url","operationName"],i),r);return s=p1("{operationName}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json())}{let t,n,o=(t={},null!=(n=p5(e,["operationName"]))&&p2(t,["_url","operationName"],n),t);return s=p1("{operationName}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json())}}async fetchPredictVideosOperationInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let s,a,o,l=(s={},null!=(a=p5(e,["operationName"]))&&p2(s,["operationName"],a),null!=(o=p5(e,["resourceName"]))&&p2(s,["_url","resourceName"],o),s);return r=p1("{resourceName}:fetchPredictOperation",l._url),i=l._query,delete l._url,delete l._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(l),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json())}throw Error("This method is only supported by the Vertex AI.")}}class mG extends p0{constructor(e){super(),this.apiClient=e}async create(e){var t,n,r,i,s;let a="",o={};if(this.apiClient.isVertexAI())throw Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let l,u,c,h,d,p,f,m,g,y,v=(r=this.apiClient,h={},null!=(d=p5(e,["config"]))&&p2(h,["config"],(p=p5(d,["expireTime"]),void 0!==h&&null!=p&&p2(h,["expireTime"],p),f=p5(d,["newSessionExpireTime"]),void 0!==h&&null!=f&&p2(h,["newSessionExpireTime"],f),m=p5(d,["uses"]),void 0!==h&&null!=m&&p2(h,["uses"],m),g=p5(d,["liveConnectConstraints"]),void 0!==h&&null!=g&&p2(h,["bidiGenerateContentSetup"],(i=r,l={},null!=(u=p5(s=g,["model"]))&&p2(l,["setup","model"],f_(i,u)),null!=(c=p5(s,["config"]))&&p2(l,["config"],function(e,t){let n=p5(e,["generationConfig"]);void 0!==t&&null!=n&&p2(t,["setup","generationConfig"],n);let r=p5(e,["responseModalities"]);void 0!==t&&null!=r&&p2(t,["setup","generationConfig","responseModalities"],r);let i=p5(e,["temperature"]);void 0!==t&&null!=i&&p2(t,["setup","generationConfig","temperature"],i);let s=p5(e,["topP"]);void 0!==t&&null!=s&&p2(t,["setup","generationConfig","topP"],s);let a=p5(e,["topK"]);void 0!==t&&null!=a&&p2(t,["setup","generationConfig","topK"],a);let o=p5(e,["maxOutputTokens"]);void 0!==t&&null!=o&&p2(t,["setup","generationConfig","maxOutputTokens"],o);let l=p5(e,["mediaResolution"]);void 0!==t&&null!=l&&p2(t,["setup","generationConfig","mediaResolution"],l);let u=p5(e,["seed"]);void 0!==t&&null!=u&&p2(t,["setup","generationConfig","seed"],u);let c=p5(e,["speechConfig"]);void 0!==t&&null!=c&&p2(t,["setup","generationConfig","speechConfig"],fF(c));let h=p5(e,["thinkingConfig"]);void 0!==t&&null!=h&&p2(t,["setup","generationConfig","thinkingConfig"],h);let d=p5(e,["enableAffectiveDialog"]);void 0!==t&&null!=d&&p2(t,["setup","generationConfig","enableAffectiveDialog"],d);let p=p5(e,["systemInstruction"]);void 0!==t&&null!=p&&p2(t,["setup","systemInstruction"],function(e){let t={},n=p5(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,r,i,s,a,o,l,u,c,h,d,p;return n={},null!=(r=p5(t=e,["mediaResolution"]))&&p2(n,["mediaResolution"],r),null!=(i=p5(t,["codeExecutionResult"]))&&p2(n,["codeExecutionResult"],i),null!=(s=p5(t,["executableCode"]))&&p2(n,["executableCode"],s),null!=(a=p5(t,["fileData"]))&&p2(n,["fileData"],function(e){let t={};if(void 0!==p5(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=p5(e,["fileUri"]);null!=n&&p2(t,["fileUri"],n);let r=p5(e,["mimeType"]);return null!=r&&p2(t,["mimeType"],r),t}(a)),null!=(o=p5(t,["functionCall"]))&&p2(n,["functionCall"],function(e){let t={},n=p5(e,["id"]);null!=n&&p2(t,["id"],n);let r=p5(e,["args"]);null!=r&&p2(t,["args"],r);let i=p5(e,["name"]);if(null!=i&&p2(t,["name"],i),void 0!==p5(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==p5(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(o)),null!=(l=p5(t,["functionResponse"]))&&p2(n,["functionResponse"],l),null!=(u=p5(t,["inlineData"]))&&p2(n,["inlineData"],function(e){let t={},n=p5(e,["data"]);if(null!=n&&p2(t,["data"],n),void 0!==p5(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=p5(e,["mimeType"]);return null!=r&&p2(t,["mimeType"],r),t}(u)),null!=(c=p5(t,["text"]))&&p2(n,["text"],c),null!=(h=p5(t,["thought"]))&&p2(n,["thought"],h),null!=(d=p5(t,["thoughtSignature"]))&&p2(n,["thoughtSignature"],d),null!=(p=p5(t,["videoMetadata"]))&&p2(n,["videoMetadata"],p),n})),p2(t,["parts"],e)}let r=p5(e,["role"]);return null!=r&&p2(t,["role"],r),t}(fj(p)));let f=p5(e,["tools"]);if(void 0!==t&&null!=f){let e=fq(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=p5(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["functionDeclarations"],e)}if(void 0!==p5(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=p5(e,["googleSearchRetrieval"]);null!=r&&p2(t,["googleSearchRetrieval"],r);let i=p5(e,["computerUse"]);null!=i&&p2(t,["computerUse"],i);let s=p5(e,["fileSearch"]);null!=s&&p2(t,["fileSearch"],s);let a=p5(e,["codeExecution"]);if(null!=a&&p2(t,["codeExecution"],a),void 0!==p5(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=p5(e,["googleMaps"]);null!=o&&p2(t,["googleMaps"],function(e){let t={};if(void 0!==p5(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=p5(e,["enableWidget"]);return null!=n&&p2(t,["enableWidget"],n),t}(o));let l=p5(e,["googleSearch"]);null!=l&&p2(t,["googleSearch"],function(e){let t={};if(void 0!==p5(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==p5(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=p5(e,["timeRangeFilter"]);return null!=n&&p2(t,["timeRangeFilter"],n),t}(l));let u=p5(e,["urlContext"]);return null!=u&&p2(t,["urlContext"],u),t})(fV(e)))),p2(t,["setup","tools"],e)}let m=p5(e,["sessionResumption"]);void 0!==t&&null!=m&&p2(t,["setup","sessionResumption"],function(e){let t={},n=p5(e,["handle"]);if(null!=n&&p2(t,["handle"],n),void 0!==p5(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(m));let g=p5(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&p2(t,["setup","inputAudioTranscription"],g);let y=p5(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&p2(t,["setup","outputAudioTranscription"],y);let v=p5(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&p2(t,["setup","realtimeInputConfig"],v);let b=p5(e,["contextWindowCompression"]);void 0!==t&&null!=b&&p2(t,["setup","contextWindowCompression"],b);let x=p5(e,["proactivity"]);return void 0!==t&&null!=x&&p2(t,["setup","proactivity"],x),{}}(c,l)),l)),y=p5(d,["lockAdditionalFields"]),void 0!==h&&null!=y&&p2(h,["fieldMask"],y),{})),h);a=p1("auth_tokens",v._url),o=v._query,delete v.config,delete v._url,delete v._query;let b=function(e,t){let n=null,r=e.bidiGenerateContentSetup;if("object"==typeof r&&null!==r&&"setup"in r){let t=r.setup;"object"==typeof t&&null!==t?(e.bidiGenerateContentSetup=t,n=t):delete e.bidiGenerateContentSetup}else void 0!==r&&delete e.bidiGenerateContentSetup;let i=e.fieldMask;if(n){let r=function(e){let t=[];for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let r=e[n];if("object"==typeof r&&null!=r&&Object.keys(r).length>0){let e=Object.keys(r).map(e=>`${n}.${e}`);t.push(...e)}else t.push(n)}return t.join(",")}(n);if(Array.isArray(null==t?void 0:t.lockAdditionalFields)&&(null==t?void 0:t.lockAdditionalFields.length)===0)r?e.fieldMask=r:delete e.fieldMask;else if((null==t?void 0:t.lockAdditionalFields)&&t.lockAdditionalFields.length>0&&null!==i&&Array.isArray(i)&&i.length>0){let t=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],n=[];i.length>0&&(n=i.map(e=>t.includes(e)?`generationConfig.${e}`:e));let s=[];r&&s.push(r),n.length>0&&s.push(...n),s.length>0?e.fieldMask=s.join(","):delete e.fieldMask}else delete e.fieldMask}else null!==i&&Array.isArray(i)&&i.length>0?e.fieldMask=i.join(","):delete e.fieldMask;return e}(v,e.config);return this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(b),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}}class mz extends p0{constructor(e){super(),this.apiClient=e,this.list=async e=>new f1(tO.PAGED_ITEM_DOCUMENTS,t=>this.listInternal({parent:e.parent,config:t.config}),await this.listInternal(e),e)}async get(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,a,o=(s={},null!=(a=p5(e,["name"]))&&p2(s,["_url","name"],a),s);return r=p1("{name}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,a,o,l,u=(s={},null!=(a=p5(e,["name"]))&&p2(s,["_url","name"],a),null!=(o=p5(e,["config"]))&&(l=p5(o,["force"]),void 0!==s&&null!=l&&p2(s,["_query","force"],l)),s);r=p1("{name}",u._url),i=u._query,delete u._url,delete u._query,await this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}}async listInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,a,o,l,u,c=(s={},null!=(a=p5(e,["parent"]))&&p2(s,["_url","parent"],a),null!=(o=p5(e,["config"]))&&(l=p5(o,["pageSize"]),void 0!==s&&null!=l&&p2(s,["_query","pageSize"],l),u=p5(o,["pageToken"]),void 0!==s&&null!=u&&p2(s,["_query","pageToken"],u)),s);return r=p1("{parent}/documents",c._url),i=c._query,delete c._url,delete c._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["nextPageToken"]);null!=r&&p2(t,["nextPageToken"],r);let i=p5(e,["documents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["documents"],e)}return t}(e),n=new fd;return Object.assign(n,t),n})}}}class mH extends p0{constructor(e,t=new mz(e)){super(),this.apiClient=e,this.documents=t,this.list=async(e={})=>new f1(tO.PAGED_ITEM_FILE_SEARCH_STORES,e=>this.listInternal(e),await this.listInternal(e),e)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,a,o,l=(s={},null!=(a=p5(e,["config"]))&&(o=p5(a,["displayName"]),void 0!==s&&null!=o&&p2(s,["displayName"],o)),s);return r=p1("fileSearchStores",l._url),i=l._query,delete l._url,delete l._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(l),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,a,o=(s={},null!=(a=p5(e,["name"]))&&p2(s,["_url","name"],a),s);return r=p1("{name}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,a,o,l,u=(s={},null!=(a=p5(e,["name"]))&&p2(s,["_url","name"],a),null!=(o=p5(e,["config"]))&&(l=p5(o,["force"]),void 0!==s&&null!=l&&p2(s,["_query","force"],l)),s);r=p1("{name}",u._url),i=u._query,delete u._url,delete u._query,await this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}}async listInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,a,o,l,u=(s={},null!=(a=p5(e,["config"]))&&(o=p5(a,["pageSize"]),void 0!==s&&null!=o&&p2(s,["_query","pageSize"],o),l=p5(a,["pageToken"]),void 0!==s&&null!=l&&p2(s,["_query","pageToken"],l)),s);return r=p1("fileSearchStores",u._url),i=u._query,delete u._url,delete u._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=p5(e,["sdkHttpResponse"]);null!=n&&p2(t,["sdkHttpResponse"],n);let r=p5(e,["nextPageToken"]);null!=r&&p2(t,["nextPageToken"],r);let i=p5(e,["fileSearchStores"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["fileSearchStores"],e)}return t}(e),n=new fp;return Object.assign(n,t),n})}}async uploadToFileSearchStoreInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,a,o,l=(s={},null!=(a=p5(e,["fileSearchStoreName"]))&&p2(s,["_url","file_search_store_name"],a),null!=(o=p5(e,["config"]))&&function(e,t){let n=p5(e,["mimeType"]);void 0!==t&&null!=n&&p2(t,["mimeType"],n);let r=p5(e,["displayName"]);void 0!==t&&null!=r&&p2(t,["displayName"],r);let i=p5(e,["customMetadata"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["customMetadata"],e)}let s=p5(e,["chunkingConfig"]);void 0!==t&&null!=s&&p2(t,["chunkingConfig"],s)}(o,s),s);return r=p1("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",l._url),i=l._query,delete l._url,delete l._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(l),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t,n,r=(t={},null!=(n=p5(e,["sdkHttpResponse"]))&&p2(t,["sdkHttpResponse"],n),t),i=new ff;return Object.assign(i,r),i})}}async importFile(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,a,o,l,u=(s={},null!=(a=p5(e,["fileSearchStoreName"]))&&p2(s,["_url","file_search_store_name"],a),null!=(o=p5(e,["fileName"]))&&p2(s,["fileName"],o),null!=(l=p5(e,["config"]))&&function(e,t){let n=p5(e,["customMetadata"]);if(void 0!==t&&null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),p2(t,["customMetadata"],e)}let r=p5(e,["chunkingConfig"]);void 0!==t&&null!=r&&p2(t,["chunkingConfig"],r)}(l,s),s);return r=p1("{file_search_store_name}:importFile",u._url),i=u._query,delete u._url,delete u._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(u),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{var t;let n,r,i,s,a,o,l,u,c,h,d=(a={},null!=(o=p5(e,["name"]))&&p2(a,["name"],o),null!=(l=p5(e,["metadata"]))&&p2(a,["metadata"],l),null!=(u=p5(e,["done"]))&&p2(a,["done"],u),null!=(c=p5(e,["error"]))&&p2(a,["error"],c),null!=(h=p5(e,["response"]))&&p2(a,["response"],(n={},null!=(r=p5(t=h,["sdkHttpResponse"]))&&p2(n,["sdkHttpResponse"],r),null!=(i=p5(t,["parent"]))&&p2(n,["parent"],i),null!=(s=p5(t,["documentName"]))&&p2(n,["documentName"],s),n)),a),p=new fm;return Object.assign(p,d),p})}}}function m$(e,t){let n,r,i,s={},a=p5(e,["sdkHttpResponse"]);null!=a&&p2(s,["sdkHttpResponse"],a);let o=p5(e,["name"]);null!=o&&p2(s,["name"],o);let l=p5(e,["state"]);null!=l&&p2(s,["state"],fG(l));let u=p5(e,["createTime"]);null!=u&&p2(s,["createTime"],u);let c=p5(e,["tuningTask","startTime"]);null!=c&&p2(s,["startTime"],c);let h=p5(e,["tuningTask","completeTime"]);null!=h&&p2(s,["endTime"],h);let d=p5(e,["updateTime"]);null!=d&&p2(s,["updateTime"],d);let p=p5(e,["description"]);null!=p&&p2(s,["description"],p);let f=p5(e,["baseModel"]);null!=f&&p2(s,["baseModel"],f);let m=p5(e,["_self"]);return null!=m&&p2(s,["tunedModel"],(n={},null!=(r=p5(m,["name"]))&&p2(n,["model"],r),null!=(i=p5(m,["name"]))&&p2(n,["endpoint"],i),n)),s}function mK(e,t){let n={},r=p5(e,["sdkHttpResponse"]);null!=r&&p2(n,["sdkHttpResponse"],r);let i=p5(e,["name"]);null!=i&&p2(n,["name"],i);let s=p5(e,["state"]);null!=s&&p2(n,["state"],fG(s));let a=p5(e,["createTime"]);null!=a&&p2(n,["createTime"],a);let o=p5(e,["startTime"]);null!=o&&p2(n,["startTime"],o);let l=p5(e,["endTime"]);null!=l&&p2(n,["endTime"],l);let u=p5(e,["updateTime"]);null!=u&&p2(n,["updateTime"],u);let c=p5(e,["error"]);null!=c&&p2(n,["error"],c);let h=p5(e,["description"]);null!=h&&p2(n,["description"],h);let d=p5(e,["baseModel"]);null!=d&&p2(n,["baseModel"],d);let p=p5(e,["tunedModel"]);null!=p&&p2(n,["tunedModel"],p);let f=p5(e,["preTunedModel"]);null!=f&&p2(n,["preTunedModel"],f);let m=p5(e,["supervisedTuningSpec"]);null!=m&&p2(n,["supervisedTuningSpec"],m);let g=p5(e,["preferenceOptimizationSpec"]);null!=g&&p2(n,["preferenceOptimizationSpec"],g);let y=p5(e,["tuningDataStats"]);null!=y&&p2(n,["tuningDataStats"],y);let v=p5(e,["encryptionSpec"]);null!=v&&p2(n,["encryptionSpec"],v);let b=p5(e,["partnerModelTuningSpec"]);null!=b&&p2(n,["partnerModelTuningSpec"],b);let x=p5(e,["customBaseModel"]);null!=x&&p2(n,["customBaseModel"],x);let w=p5(e,["experiment"]);null!=w&&p2(n,["experiment"],w);let E=p5(e,["labels"]);null!=E&&p2(n,["labels"],E);let _=p5(e,["outputUri"]);null!=_&&p2(n,["outputUri"],_);let I=p5(e,["pipelineJob"]);null!=I&&p2(n,["pipelineJob"],I);let C=p5(e,["serviceAccount"]);null!=C&&p2(n,["serviceAccount"],C);let T=p5(e,["tunedModelDisplayName"]);null!=T&&p2(n,["tunedModelDisplayName"],T);let S=p5(e,["veoTuningSpec"]);return null!=S&&p2(n,["veoTuningSpec"],S),n}function mW(e,t){let n={},r=p5(e,["gcsUri"]);null!=r&&p2(n,["validationDatasetUri"],r);let i=p5(e,["vertexDatasetResource"]);return null!=i&&p2(n,["validationDatasetUri"],i),n}class mJ extends p0{constructor(e){super(),this.apiClient=e,this.get=async e=>await this.getInternal(e),this.list=async(e={})=>new f1(tO.PAGED_ITEM_TUNING_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.tune=async e=>{var t;if(this.apiClient.isVertexAI())if(e.baseModel.startsWith("projects/")){let n={tunedModelName:e.baseModel};(null==(t=e.config)?void 0:t.preTunedModelCheckpointId)&&(n.checkpointId=e.config.preTunedModelCheckpointId);let r=Object.assign(Object.assign({},e),{preTunedModel:n});return r.baseModel=void 0,await this.tuneInternal(r)}else{let t=Object.assign({},e);return await this.tuneInternal(t)}{let t=Object.assign({},e),n=await this.tuneMldevInternal(t),r="";return void 0!==n.metadata&&void 0!==n.metadata.tunedModel?r=n.metadata.tunedModel:void 0!==n.name&&n.name.includes("/operations/")&&(r=n.name.split("/operations/")[0]),{name:r,state:e9.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,r,i;let s="",a={};if(this.apiClient.isVertexAI()){let r,i,o=(r={},null!=(i=p5(e,["name"]))&&p2(r,["_url","name"],i),r);return s=p1("{name}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>mK(e))}{let t,n,o=(t={},null!=(n=p5(e,["name"]))&&p2(t,["_url","name"],n),t);return s=p1("{name}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>m$(e))}}async listInternal(e){var t,n,r,i;let s="",a={};if(this.apiClient.isVertexAI()){let r,i,o,l,u,c=(r={},null!=(i=p5(e,["config"]))&&(o=p5(i,["pageSize"]),void 0!==r&&null!=o&&p2(r,["_query","pageSize"],o),l=p5(i,["pageToken"]),void 0!==r&&null!=l&&p2(r,["_query","pageToken"],l),u=p5(i,["filter"]),void 0!==r&&null!=u&&p2(r,["_query","filter"],u)),r);return s=p1("tuningJobs",c._url),a=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=p5(e,["sdkHttpResponse"]);null!=r&&p2(n,["sdkHttpResponse"],r);let i=p5(e,["nextPageToken"]);null!=i&&p2(n,["nextPageToken"],i);let s=p5(e,["tuningJobs"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>mK(e))),p2(n,["tuningJobs"],e)}return n}(e),n=new fu;return Object.assign(n,t),n})}{let t,n,o,l,u,c=(t={},null!=(n=p5(e,["config"]))&&(o=p5(n,["pageSize"]),void 0!==t&&null!=o&&p2(t,["_query","pageSize"],o),l=p5(n,["pageToken"]),void 0!==t&&null!=l&&p2(t,["_query","pageToken"],l),u=p5(n,["filter"]),void 0!==t&&null!=u&&p2(t,["_query","filter"],u)),t);return s=p1("tunedModels",c._url),a=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=p5(e,["sdkHttpResponse"]);null!=r&&p2(n,["sdkHttpResponse"],r);let i=p5(e,["nextPageToken"]);null!=i&&p2(n,["nextPageToken"],i);let s=p5(e,["tunedModels"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>m$(e))),p2(n,["tuningJobs"],e)}return n}(e),n=new fu;return Object.assign(n,t),n})}}async cancel(e){var t,n,r,i;let s="",a={};if(this.apiClient.isVertexAI()){let r,i,o=(r={},null!=(i=p5(e,["name"]))&&p2(r,["_url","name"],i),r);s=p1("{name}:cancel",o._url),a=o._query,delete o._url,delete o._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}else{let t,n,o=(t={},null!=(n=p5(e,["name"]))&&p2(t,["_url","name"],n),t);s=p1("{name}:cancel",o._url),a=o._query,delete o._url,delete o._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal})}}async tuneInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let s,a,o,l,u,c=(s={},null!=(a=p5(e,["baseModel"]))&&p2(s,["baseModel"],a),null!=(o=p5(e,["preTunedModel"]))&&p2(s,["preTunedModel"],o),null!=(l=p5(e,["trainingDataset"]))&&function(e,t,n){let r=p5(n,["config","method"]);if(void 0===r&&(r="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===r){let n=p5(e,["gcsUri"]);void 0!==t&&null!=n&&p2(t,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===r){let n=p5(e,["gcsUri"]);void 0!==t&&null!=n&&p2(t,["preferenceOptimizationSpec","trainingDatasetUri"],n)}let i=p5(n,["config","method"]);if(void 0===i&&(i="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===i){let n=p5(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&p2(t,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===i){let n=p5(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&p2(t,["preferenceOptimizationSpec","trainingDatasetUri"],n)}if(void 0!==p5(e,["examples"]))throw Error("examples parameter is not supported in Vertex AI.")}(l,s,e),null!=(u=p5(e,["config"]))&&function(e,t,n){let r=p5(n,["config","method"]);if(void 0===r&&(r="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===r){let n=p5(e,["validationDataset"]);void 0!==t&&null!=n&&p2(t,["supervisedTuningSpec"],mW(n))}else if("PREFERENCE_TUNING"===r){let n=p5(e,["validationDataset"]);void 0!==t&&null!=n&&p2(t,["preferenceOptimizationSpec"],mW(n))}let i=p5(e,["tunedModelDisplayName"]);void 0!==t&&null!=i&&p2(t,["tunedModelDisplayName"],i);let s=p5(e,["description"]);void 0!==t&&null!=s&&p2(t,["description"],s);let a=p5(n,["config","method"]);if(void 0===a&&(a="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===a){let n=p5(e,["epochCount"]);void 0!==t&&null!=n&&p2(t,["supervisedTuningSpec","hyperParameters","epochCount"],n)}else if("PREFERENCE_TUNING"===a){let n=p5(e,["epochCount"]);void 0!==t&&null!=n&&p2(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],n)}let o=p5(n,["config","method"]);if(void 0===o&&(o="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===o){let n=p5(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&p2(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],n)}else if("PREFERENCE_TUNING"===o){let n=p5(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&p2(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],n)}let l=p5(n,["config","method"]);if(void 0===l&&(l="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===l){let n=p5(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&p2(t,["supervisedTuningSpec","exportLastCheckpointOnly"],n)}else if("PREFERENCE_TUNING"===l){let n=p5(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&p2(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],n)}let u=p5(n,["config","method"]);if(void 0===u&&(u="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===u){let n=p5(e,["adapterSize"]);void 0!==t&&null!=n&&p2(t,["supervisedTuningSpec","hyperParameters","adapterSize"],n)}else if("PREFERENCE_TUNING"===u){let n=p5(e,["adapterSize"]);void 0!==t&&null!=n&&p2(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],n)}if(void 0!==p5(e,["batchSize"]))throw Error("batchSize parameter is not supported in Vertex AI.");if(void 0!==p5(e,["learningRate"]))throw Error("learningRate parameter is not supported in Vertex AI.");let c=p5(e,["labels"]);void 0!==t&&null!=c&&p2(t,["labels"],c);let h=p5(e,["beta"]);void 0!==t&&null!=h&&p2(t,["preferenceOptimizationSpec","hyperParameters","beta"],h)}(u,s,e),s);return r=p1("tuningJobs",c._url),i=c._query,delete c._url,delete c._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(c),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>mK(e))}throw Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s,a,o,l,u,c=(s={},null!=(a=p5(e,["baseModel"]))&&p2(s,["baseModel"],a),null!=(o=p5(e,["preTunedModel"]))&&p2(s,["preTunedModel"],o),null!=(l=p5(e,["trainingDataset"]))&&function(e,t){if(void 0!==p5(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==p5(e,["vertexDatasetResource"]))throw Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=p5(e,["examples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),p2({},["examples","examples"],e)}}(l),null!=(u=p5(e,["config"]))&&function(e,t,n){if(void 0!==p5(e,["validationDataset"]))throw Error("validationDataset parameter is not supported in Gemini API.");let r=p5(e,["tunedModelDisplayName"]);if(void 0!==t&&null!=r&&p2(t,["displayName"],r),void 0!==p5(e,["description"]))throw Error("description parameter is not supported in Gemini API.");let i=p5(e,["epochCount"]);void 0!==t&&null!=i&&p2(t,["tuningTask","hyperparameters","epochCount"],i);let s=p5(e,["learningRateMultiplier"]);if(null!=s&&p2({},["tuningTask","hyperparameters","learningRateMultiplier"],s),void 0!==p5(e,["exportLastCheckpointOnly"]))throw Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==p5(e,["preTunedModelCheckpointId"]))throw Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(void 0!==p5(e,["adapterSize"]))throw Error("adapterSize parameter is not supported in Gemini API.");let a=p5(e,["batchSize"]);void 0!==t&&null!=a&&p2(t,["tuningTask","hyperparameters","batchSize"],a);let o=p5(e,["learningRate"]);if(void 0!==t&&null!=o&&p2(t,["tuningTask","hyperparameters","learningRate"],o),void 0!==p5(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");if(void 0!==p5(e,["beta"]))throw Error("beta parameter is not supported in Gemini API.")}(u,s),s);return r=p1("tunedModels",c._url),i=c._query,delete c._url,delete c._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(c),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,r,i,s,a;return t={},null!=(n=p5(e,["sdkHttpResponse"]))&&p2(t,["sdkHttpResponse"],n),null!=(r=p5(e,["name"]))&&p2(t,["name"],r),null!=(i=p5(e,["metadata"]))&&p2(t,["metadata"],i),null!=(s=p5(e,["done"]))&&p2(t,["done"],s),null!=(a=p5(e,["error"]))&&p2(t,["error"],a),t})}}}class mY{async download(e,t){throw Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}let mX="x-goog-upload-status";async function mQ(e,t,n){var r;let i=await m0(e,t,n),s=await (null==i?void 0:i.json());if((null==(r=null==i?void 0:i.headers)?void 0:r[mX])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return s.file}async function mZ(e,t,n){var r;let i=await m0(e,t,n),s=await (null==i?void 0:i.json());if((null==(r=null==i?void 0:i.headers)?void 0:r[mX])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");let a=p4(s),o=new fE;return Object.assign(o,a),o}async function m0(e,t,n){var r,i;let s=0,a=0,o=new p3(new Response),l="upload";for(s=e.size;a<s;){let u=Math.min(8388608,s-a),c=e.slice(a,a+u);a+u>=s&&(l+=", finalize");let h=0,d=1e3;for(;h<3&&(null==(r=null==(o=await n.request({path:"",body:c,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(a),"Content-Length":String(u)}}}))?void 0:o.headers)||!r[mX]);)h++,await function(e){return new Promise(t=>setTimeout(t,e))}(d),d*=2;if(a+=u,(null==(i=null==o?void 0:o.headers)?void 0:i[mX])!=="active")break;if(s<=a)throw Error("All content has been uploaded, but the upload status is not finalized.")}return o}async function m1(e){return{size:e.size,type:e.type}}class m2{async upload(e,t,n){if("string"==typeof e)throw Error("File path is not supported in browser uploader.");return await mQ(e,t,n)}async uploadToFileSearchStore(e,t,n){if("string"==typeof e)throw Error("File path is not supported in browser uploader.");return await mZ(e,t,n)}async stat(e){if("string"!=typeof e)return await m1(e);throw Error("File path is not supported in browser uploader.")}}class m5{create(e,t,n){return new m6(e,t,n)}}class m6{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.send(e)}close(){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.close()}}let m4="x-goog-api-key";class m3{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(null===e.get(m4)){if(this.apiKey.startsWith("auth_tokens/"))throw Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw Error("API key is missing. Please provide a valid API key.");e.append(m4,this.apiKey)}}}class m8{constructor(e){var t;if(null==e.apiKey)throw Error("An API Key must be set when running in a browser");if(e.project||e.location)throw Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=null!=(t=e.vertexai)&&t,this.apiKey=e.apiKey;const n=function(e,t,n,s){return(null==e?void 0:e.baseUrl)?e.baseUrl:t?null!=i?i:n:null!=r?r:s}(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion;const s=new m3(this.apiKey);this.apiClient=new mC({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:"gl-node/web",uploader:new m2,downloader:new mY}),this.models=new mq(this.apiClient),this.live=new mj(this.apiClient,s,new m5),this.batches=new f2(this.apiClient),this.chats=new me(this.models,this.apiClient),this.caches=new f6(this.apiClient),this.files=new mr(this.apiClient),this.operations=new mB(this.apiClient),this.authTokens=new mG(this.apiClient),this.tunings=new mJ(this.apiClient),this.fileSearchStores=new mH(this.apiClient)}}let m7={default:"",professional:"Write in a professional, polished tone. Use clear, confident language suitable for business audiences. Avoid slang and keep it sophisticated.",casual:"Write in a casual, friendly tone. Use conversational language like you're talking to a friend. Feel relaxed and approachable.",funny:"Write in a humorous, witty tone. Use puns, jokes, or playful language. Make readers smile or laugh while still showcasing the product.",inspiring:"Write in an inspiring, motivational tone. Use uplifting language that empowers and encourages. Create an emotional connection.",urgent:"Write with urgency and FOMO (fear of missing out). Use action words, limited-time language, and create excitement. Make readers feel they need to act now.",minimalist:"Write in a minimalist, clean tone. Use short, impactful phrases. Less is more - be concise and let the image speak."},m9=async(e,t,n)=>{let r=t1.default.env.NEXT_PUBLIC_GEMINI_API_KEY||"";if(!r)throw Error("GEMINI_API_KEY environment variable is not set");let i=new m8({apiKey:r});try{let r=`
      You are a lifestyle and editorial photographer capturing authentic, candid moments.
      Task: Create a photorealistic LIFESTYLE image featuring someone wearing the EXACT garment shown in the reference image.
      
      CRITICAL STYLE DIRECTION - LIFESTYLE NOT PORTRAIT:
      - This is NOT a model photoshoot or fashion portrait. Avoid posed, model-centric shots where the person stares at the camera.
      - Create a CANDID MOMENT - the person should be engaged in an activity, interacting with their environment, or captured mid-action.
      - The person should feel like a character in a story, not a model on display.
      - Show more of the environment and scene - the setting is just as important as the person.
      - Use wider framing or environmental portraits rather than tight headshots.
      - The person can be looking away, walking, laughing, reaching for something, sitting casually, etc.
      
      GARMENT INSTRUCTIONS:
      1. The reference image contains a specific piece of apparel (t-shirt/hoodie/top).
      2. PRINT VISIBILITY: First, analyze where the main graphic/print/design is located on the garment:
         - If the design is on the FRONT of the garment: Position the person so the front print is visible (but they don't need to face the camera directly).
         - If the design is on the BACK of the garment: Position the person with their back partially or fully visible.
         - The print/design should be visible but naturally integrated into the scene.
      3. Dress a realistic person in this EXACT garment. ${"male"===n?"The model should be male.":"female"===n?"The model should be female.":""}
      4. CRITICAL: Preserve the cut, style, fabric texture, color, and graphic design of the uploaded garment perfectly. Do not generate a generic t-shirt.
      
      SCENE & MOOD:
      5. Setting description: ${t}
      6. Add lifestyle elements: other people in background, environmental details, props that fit the scene, movement.
      7. Lighting should feel natural and authentic to the setting - golden hour, overcast, natural window light, etc.
      8. Capture a genuine moment - someone living their life, not posing for a photo.
      9. Do not add any text overlays, watermarks, or extra graphics.
    `,s=await i.models.generateContent({model:"gemini-3-pro-image-preview",contents:{parts:[{text:r},{inlineData:{mimeType:"image/png",data:e}}]},config:{imageConfig:{aspectRatio:"3:4",imageSize:"2K"}}});for(let e of s.candidates?.[0]?.content?.parts||[])if(e.inlineData&&e.inlineData.data)return`data:${e.inlineData.mimeType};base64,${e.inlineData.data}`;throw Error("No image generated.")}catch(e){throw console.error("Error generating mockup:",e),e}},ge=async e=>{let t=t1.default.env.NEXT_PUBLIC_GEMINI_API_KEY||"";if(!t)throw Error("GEMINI_API_KEY environment variable is not set");let n=new m8({apiKey:t});try{let t={type:eG.ARRAY,items:{type:eG.OBJECT,properties:{title:{type:eG.STRING,description:"A short, catchy title for the style (2-4 words)"},description:{type:eG.STRING,description:"A detailed scene description for the mockup prompt including background, lighting, and mood"},reasoning:{type:eG.STRING,description:"Brief explanation of why this style matches the garment"}},required:["title","description","reasoning"]}},r=`
      Analyze this garment image carefully. Consider:
      - The garment type (t-shirt, hoodie, tank top, etc.)
      - Color palette and any graphics/designs
      - Overall aesthetic (streetwear, casual, athletic, vintage, etc.)
      - Target demographic and use cases
      
      Based on your analysis, suggest 5 unique LIFESTYLE photography scenes that would 
      best showcase this specific garment for social media marketing.
      
      IMPORTANT - LIFESTYLE FOCUS:
      - Suggest scenes where a person is DOING something, not just posing
      - Include activities, environments, and candid moments
      - Think editorial/documentary style, not model photoshoots
      - The person should feel like they're living their life, captured in a moment
      
      Each suggestion should include:
      1. A catchy title (e.g., "Morning Coffee Run", "Weekend Market Stroll")
      2. A detailed LIFESTYLE scene description including:
         - What activity the person is doing
         - The environmental setting with specific details
         - Lighting and time of day
         - Mood and energy (relaxed, adventurous, cozy, etc.)
      3. Brief reasoning on why this lifestyle context complements the garment
      
      Be creative and specific to THIS garment - don't give generic suggestions.
      Consider color harmony, target audience, and lifestyle scenarios that fit the vibe.
    `,i=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:r},{inlineData:{mimeType:"image/png",data:e}}]},config:{responseMimeType:"application/json",responseSchema:t}})).text||"[]";return JSON.parse(i)}catch(e){return console.error("Error analyzing garment:",e),[]}},gt=async(e,t,n)=>{let r=t1.default.env.NEXT_PUBLIC_GEMINI_API_KEY||"";if(!r)throw Error("GEMINI_API_KEY environment variable is not set");let i=new m8({apiKey:r});try{let r={type:eG.OBJECT,properties:{facebook:{type:eG.ARRAY,items:{type:eG.STRING,description:"A friendly, engaging caption suitable for Facebook audience."},description:"5 different Facebook caption options with varied tones and styles."},instagram:{type:eG.ARRAY,items:{type:eG.STRING,description:"A trendy, visual-focused caption with 5-10 relevant hashtags for Instagram."},description:"5 different Instagram caption options with varied tones and styles."}},required:["facebook","instagram"]},s="";n?.customTone?s=`TONE INSTRUCTION: ${n.customTone}`:n?.tone&&"default"!==n.tone&&(s=`TONE INSTRUCTION: ${m7[n.tone]}`);let a=n?.context?`ADDITIONAL CONTEXT: ${n.context}`:"",o=`
      Look at this fashion lifestyle image.
      Write 5 different social media caption options for EACH platform for this new apparel launch.
      The vibe is: ${e}.
      ${s?`
      ${s}`:""}
      ${a?`
      ${a}`:""}
      
      For each platform, create 5 UNIQUE captions with different approaches:
      1. One that's short and punchy
      2. One that tells a story or creates a mood
      3. One that's question-based to drive engagement
      4. One that highlights the product features
      5. One that's trendy/playful with personality
      
      Facebook captions: Engaging, encourage clicks or shares, conversational tone.
      Instagram captions: Aesthetic, use emojis, include 5-10 relevant hashtags each.
      
      Make each caption feel distinct and give the user real variety to choose from.
    `,l=(await i.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:o},{inlineData:{mimeType:"image/png",data:t.split(",")[1]}}]},config:{responseMimeType:"application/json",responseSchema:r}})).text||"{}";return JSON.parse(l)}catch(e){return console.error("Error generating captions:",e),{facebook:["Check out our latest drop! ","New season, new style. This piece is everything we've been dreaming about.","What's your go-to look for the weekend? We've got you covered.","Premium comfort meets modern design. Feel the difference.","POV: You just found your new favorite fit. You're welcome. "],instagram:["Fresh fit alert  Link in bio. #ootd #fashion #style #newdrop #streetwear","Main character energy only  This look hits different. #fashioninspo #outfitoftheday #stylegoals #lookbook #trending","What would you pair this with? Drop your ideas below  #stylequestion #fashiontalk #ootdshare #getcreative #communityvibes","Crafted for comfort. Designed to turn heads.  #qualityfashion #premiumwear #comfortmeetsstyle #wardrobe #musthave","No cap, this might be our best drop yet  #nocap #bestdrop #firefit #streetstyle #hypebeast"]}}};function gn(){let e=pH.currentUser;if(!e)throw Error("No authenticated user. Please sign in.");return e.uid}let gr=()=>uo(pG,"users",gn(),"mockups"),gi=e=>{let t=gn();return`mockups/${t}/${e}.png`},gs=async(e,t,n,r)=>{var i,s,a,o;let l,u,c=gn(),h=c0(pz,gi(e)),d=(e=>{let t=e.includes(",")?e.split(",")[1]:e,n=e.includes("data:")?e.split(";")[0].split(":")[1]:"image/png",r=atob(t),i=Array(r.length);for(let e=0;e<r.length;e++)i[e]=r.charCodeAt(e);return new Blob([new Uint8Array(i)],{type:n})})(t);await (i=h,s={contentType:"image/png",customMetadata:{styleDescription:n,designId:r,userId:c}},c$(i=nI(i),d,s));let p={id:e,imageUrl:await cQ(h),styleDescription:n,designId:r,createdAt:new Date},f=ul(gr(),e);return await (a=f,o={...p,createdAt:il.fromDate(p.createdAt)},a=is(a,us),l=is(a.firestore,up),u=u0(a.converter,o,void 0),u9(l,[uS(uT(l),"setDoc",a._key,u,null!==a.converter,void 0).toMutation(a._key,s4.none())])),p},ga=async()=>{let e=uz(gr(),uJ("createdAt","desc"));return(await u3(e)).docs.map(e=>{let t=e.data();return{id:e.id,imageUrl:t.imageUrl,styleDescription:t.styleDescription,designId:t.designId,createdAt:t.createdAt?.toDate()||new Date}})},go=async e=>{let t=c0(pz,gi(e));try{await cZ(t)}catch(e){if("storage/object-not-found"!==e.code)throw e}let n=ul(gr(),e);await u8(n)},gl=tW("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),gu=tW("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),gc=tW("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),gh=tW("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),gd=tW("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]),gp=tW("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),gf=tW("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),gm=tW("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),gg=tW("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),gy=tW("images",[["path",{d:"m22 11-1.296-1.296a2.4 2.4 0 0 0-3.408 0L11 16",key:"9kzy35"}],["path",{d:"M4 8a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2",key:"1t0f0t"}],["circle",{cx:"13",cy:"7",r:"1",fill:"currentColor",key:"1obus6"}],["rect",{x:"8",y:"2",width:"14",height:"14",rx:"2",key:"1gvhby"}]]),gv=tW("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),gb=tW("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),gx=tW("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),gw=tW("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),gE=tW("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),g_=tW("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),gI=tW("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),gC=["Walking through a busy city street, grabbing coffee, morning golden hour light, urban lifestyle","Relaxing at an outdoor caf, reading or on phone, dappled sunlight through trees, candid moment","Hiking on a scenic trail, pausing to take in the view, natural adventure setting, active lifestyle","Hanging out with friends at a rooftop gathering, laughing and chatting, warm evening light","Browsing at a weekend farmers market or street fair, casual and relaxed, vibrant atmosphere"],gT="socialstitch_mockups",gS="socialstitch_suggestions",gN="socialstitch_selected_ids",gA="mockups",gk=()=>new Promise((e,t)=>{let n=indexedDB.open("socialstitch_mockups_db",1);n.onerror=()=>t(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(gA)||t.createObjectStore(gA)}}),gO=async(e,t)=>{try{let n=(await gk()).transaction([gA],"readwrite").objectStore(gA);await new Promise((r,i)=>{let s=n.put({designId:e,mockups:t},e);s.onsuccess=()=>r(),s.onerror=()=>i(s.error)})}catch(e){throw console.error("Failed to save mockups to IndexedDB:",e),e}},gR=async e=>{try{let t=(await gk()).transaction([gA],"readonly").objectStore(gA);return new Promise((n,r)=>{let i=t.get(e);i.onsuccess=()=>{let t=i.result;t&&t.designId===e?n(t.mockups||null):n(null)},i.onerror=()=>r(i.error)})}catch(e){return console.error("Failed to load mockups from IndexedDB:",e),null}},gD=({design:e,onMockupsSelected:t,onBack:n})=>{let[r,i]=(0,tG.useState)(""),[s,a]=(0,tG.useState)(!1),[o,l]=(0,tG.useState)([]),[u,c]=(0,tG.useState)(!0);(0,tG.useEffect)(()=>{(async()=>{c(!0);try{let t=await gR(e.id);if(t&&t.length>0){l(t),c(!1);return}let n=sessionStorage.getItem(gT);if(n){let t=JSON.parse(n);if(t.designId===e.id&&t.mockups?.length>0){l(t.mockups);try{await gO(e.id,t.mockups)}catch(e){console.warn("Failed to migrate to IndexedDB:",e)}}}}catch(e){console.error("Failed to load saved mockups:",e)}finally{c(!1)}})()},[e.id]);let[h,d]=(0,tG.useState)(new Set);(0,tG.useEffect)(()=>{if(!u)try{let t=sessionStorage.getItem(gN);if(t){let n=JSON.parse(t);if(n.designId===e.id){let e=new Set(o.map(e=>e.id)),t=(n.ids||[]).filter(t=>e.has(t));d(new Set(t))}}}catch(e){console.error("Failed to load selected IDs:",e)}},[u,e.id,o]);let[p,f]=(0,tG.useState)(null),[m,g]=(0,tG.useState)(new Set),[y,v]=(0,tG.useState)(null),[b,x]=(0,tG.useState)(()=>{try{let t=sessionStorage.getItem(gS);if(t){let n=JSON.parse(t);if(n.designId===e.id)return n.suggestions||[]}}catch(e){console.error("Failed to load saved suggestions:",e)}return[]}),[w,E]=(0,tG.useState)(()=>{try{let t=sessionStorage.getItem(gS);if(t){let n=JSON.parse(t);if(n.designId===e.id&&n.suggestions?.length>0)return!1}}catch(e){}return!0}),[_,I]=(0,tG.useState)(null),[C,T]=(0,tG.useState)(2),[S,N]=(0,tG.useState)(new Map),[A,k]=(0,tG.useState)(null),[O,R]=(0,tG.useState)([]),[D,j]=(0,tG.useState)(!0),[P,M]=(0,tG.useState)(!1),[U,L]=(0,tG.useState)(!0);(0,tG.useEffect)(()=>{u||0===o.length||(async()=>{try{await gO(e.id,o)}catch(t){console.error("Failed to save mockups to IndexedDB:",t);try{sessionStorage.setItem(gT,JSON.stringify({designId:e.id,mockups:o}))}catch(t){if("QuotaExceededError"===t.name){console.error("SessionStorage quota exceeded. Consider using IndexedDB.");try{let t=o.map(e=>({id:e.id,styleDescription:e.styleDescription}));sessionStorage.setItem(gT,JSON.stringify({designId:e.id,mockups:t,metadataOnly:!0}))}catch(e){console.error("Failed to save even metadata:",e)}}else console.error("Failed to save mockups to sessionStorage:",t)}}})()},[o,e.id,u]),(0,tG.useEffect)(()=>{try{sessionStorage.setItem(gN,JSON.stringify({designId:e.id,ids:Array.from(h)}))}catch(e){console.error("Failed to save selected IDs:",e)}},[h,e.id]),(0,tG.useEffect)(()=>{let e=new Set(o.map(e=>e.id));d(t=>{let n=new Set(Array.from(t).filter(t=>e.has(t)));return n.size!==t.size?n:t})},[o]),(0,tG.useEffect)(()=>{if(b.length>0)try{sessionStorage.setItem(gS,JSON.stringify({designId:e.id,suggestions:b}))}catch(e){console.error("Failed to save suggestions:",e)}},[b,e.id]),(0,tG.useEffect)(()=>{(async()=>{j(!0);try{let e=await ga();R(e)}catch(e){console.error("Failed to load mockup history:",e)}finally{j(!1)}})()},[]),(0,tG.useEffect)(()=>{(async()=>{try{let t=sessionStorage.getItem(gS);if(t){let n=JSON.parse(t);if(n.designId===e.id&&n.suggestions?.length>0)return}}catch(e){}E(!0);try{let t=await ge(e.base64);x(t)}catch(e){console.error("Failed to fetch AI suggestions:",e)}finally{E(!1)}})()},[e.base64,e.id]);let F=async()=>{let e=window.aistudio;e&&(await e.hasSelectedApiKey()||await e.openSelectKey())},V=e=>S.get(e)||"both",q=(e,t)=>{N(n=>{let r=new Map(n);return r.set(e,t),r})},B=e=>{g(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},G=e=>{d(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},z=[" The person is walking through the scene, captured mid-stride."," The person is laughing or smiling while looking away from camera, candid moment."," Wide environmental shot showing more of the setting, person is smaller in frame doing an activity."," The person is sitting casually, relaxed and interacting with something in their hands."],H=async t=>{f(null),await F(),a(!0),v({current:1,total:1});try{let n=V(t),r="both"===n?Math.random()>.5?"male":"female":n,i=await m9(e.base64,t,r),s="male"===r?"":"",a=crypto.randomUUID(),o=`${t} ${s}`,u={id:a,imageUrl:i,styleDescription:o};l(e=>[...e,u]),d(e=>new Set([...e,u.id])),M(!0);try{let t=await gs(a,i,o,e.id);R(e=>[t,...e])}catch(e){console.error("Failed to save mockup to cloud:",e)}finally{M(!1)}}catch(e){if(e.message&&e.message.includes("Requested entity was not found")){let e=window.aistudio;e&&(await e.openSelectKey(),f("Please select a valid API Key from a paid project and try again."))}else f("Failed to generate mockup. Please try again.")}finally{a(!1),v(null)}},$=async()=>{if(0===m.size)return;f(null),await F(),a(!0);let t=Array.from(m),n=[];for(let e of t){let t=V(e);for(let r=0;r<C;r++){let i;i="both"===t?1===C?Math.random()>.5?"male":"female":r<Math.ceil(C/2)?"male":"female":t,n.push({style:e,gender:i,variationIndex:r})}}v({current:0,total:n.length});try{let t=await Promise.allSettled(n.map(async t=>{let n=z[t.variationIndex%z.length],r=t.style+n,i=await m9(e.base64,r,t.gender);v(e=>e?{...e,current:e.current+1}:null);let s="male"===t.gender?"":"";return{id:crypto.randomUUID(),imageUrl:i,styleDescription:`${t.style} ${s}`}})),r=t.filter(e=>"fulfilled"===e.status).map(e=>e.value),i=t.filter(e=>"rejected"===e.status).length;if(r.length>0){l(e=>[...e,...r]),d(e=>new Set([...e,...r.map(e=>e.id)])),M(!0);try{let t=await Promise.allSettled(r.map(t=>gs(t.id,t.imageUrl,t.styleDescription,e.id))),n=t.filter(e=>"fulfilled"===e.status).map(e=>e.value);n.length>0&&R(e=>[...n,...e]);let i=t.filter(e=>"rejected"===e.status).length;i>0&&console.warn(`${i} mockup(s) failed to save to cloud`)}catch(e){console.error("Failed to save mockups to cloud:",e)}finally{M(!1)}}i>0&&f(`${i} mockup(s) failed to generate.`),g(new Set)}catch(e){if(e.message&&e.message.includes("Requested entity was not found")){let e=window.aistudio;e&&(await e.openSelectKey(),f("Please select a valid API Key from a paid project and try again."))}else f("Failed to generate mockups. Please try again.")}finally{a(!1),v(null)}},K=async()=>{try{sessionStorage.removeItem(gS)}catch(e){}x([]),E(!0);try{let t=await ge(e.base64);x(t)}catch(e){console.error("Failed to fetch AI suggestions:",e)}finally{E(!1)}},W=async e=>{try{await go(e),R(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Failed to delete mockup from history:",e)}};return(0,tB.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6 items-start",children:[(0,tB.jsxs)("div",{className:"lg:col-span-2 bg-white p-5 rounded-2xl shadow-sm border border-slate-200",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-4 mb-5 pb-5 border-b border-slate-100",children:[(0,tB.jsxs)("div",{className:"relative",children:[(0,tB.jsx)("img",{src:e.previewUrl,alt:"Original Design",className:"w-14 h-14 object-cover bg-slate-100 rounded-xl border border-slate-200"}),(0,tB.jsx)("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 bg-emerald-500 rounded-full flex items-center justify-center",children:(0,tB.jsx)(gf,{size:10,className:"text-white",strokeWidth:3})})]}),(0,tB.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,tB.jsx)("h3",{className:"font-semibold text-slate-800 text-sm",children:"Your Garment"}),(0,tB.jsx)("button",{onClick:n,className:"text-xs text-indigo-600 hover:text-indigo-700 font-medium",children:"Change upload"})]}),(0,tB.jsxs)("div",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200/50 rounded-full",children:[(0,tB.jsx)(gh,{size:12,className:"text-amber-500"}),(0,tB.jsx)("span",{className:"text-xs font-medium text-amber-700",children:"Pro"})]})]}),(0,tB.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,tB.jsx)("h4",{className:"font-semibold text-slate-700 text-sm flex items-center gap-2",children:w?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(tX,{size:14,className:"animate-spin text-indigo-500"}),(0,tB.jsx)("span",{children:"Analyzing garment..."})]}):b.length>0?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(gd,{size:14,className:"text-amber-500"}),(0,tB.jsx)("span",{children:"AI-Suggested Styles"}),(0,tB.jsx)("button",{onClick:K,disabled:w,className:"ml-1 p-1 rounded-md text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 transition-all",title:"Get new suggestions",children:(0,tB.jsx)(gc,{size:12})})]}):"Choose a Vibe"}),m.size>0&&(0,tB.jsxs)("span",{className:"text-xs font-medium text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-full",children:[m.size," selected"]})]}),w?(0,tB.jsx)("div",{className:"space-y-2 mb-5",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,tB.jsx)("div",{className:"w-full p-3 rounded-xl bg-slate-50 border border-slate-100",style:{animationDelay:`${100*t}ms`},children:(0,tB.jsxs)("div",{className:"flex items-start gap-3",children:[(0,tB.jsx)("div",{className:"w-5 h-5 rounded bg-slate-200 animate-pulse"}),(0,tB.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,tB.jsx)("div",{className:"h-4 w-24 bg-slate-200 rounded animate-pulse"}),(0,tB.jsx)("div",{className:"h-3 w-full bg-slate-100 rounded animate-pulse"})]})]})},t))}):b.length>0?(0,tB.jsxs)("div",{className:"space-y-2 mb-5 stagger-children",children:[b.map((e,t)=>{let n=m.has(e.description);return(0,tB.jsxs)("div",{className:"group relative",children:[(0,tB.jsx)("div",{onClick:()=>!s&&B(e.description),className:`
                      w-full text-left p-3 rounded-xl border-2 transition-all text-sm cursor-pointer
                      ${n?"border-indigo-500 bg-indigo-50 shadow-sm shadow-indigo-500/10":"border-slate-200 hover:border-indigo-300 hover:bg-slate-50"}
                    `,children:(0,tB.jsxs)("div",{className:"flex items-start gap-3",children:[(0,tB.jsx)("div",{className:`
                          mt-0.5 w-5 h-5 rounded-md flex-shrink-0 flex items-center justify-center border-2 transition-all
                          ${n?"bg-indigo-600 border-indigo-600 text-white scale-110":"border-slate-300 group-hover:border-indigo-400"}
                        `,children:n&&(0,tB.jsx)(gf,{size:12,strokeWidth:3})}),(0,tB.jsx)("div",{className:"flex-1 min-w-0",children:(0,tB.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,tB.jsxs)("div",{className:"flex-1",children:[(0,tB.jsx)("span",{className:`font-semibold block mb-0.5 transition-colors ${n?"text-indigo-700":"text-slate-700"}`,children:e.title}),(0,tB.jsx)("span",{className:"text-slate-500 text-xs line-clamp-2 leading-relaxed",children:e.description}),n&&(0,tB.jsxs)("div",{className:"flex items-center gap-1 mt-2",onClick:e=>e.stopPropagation(),children:[(0,tB.jsx)("span",{className:"text-[10px] text-slate-400 mr-1",children:"Model:"}),(0,tB.jsx)("button",{type:"button",onClick:()=>q(e.description,"male"),className:`p-1 rounded transition-all ${"male"===V(e.description)?"bg-indigo-600 text-white":"bg-slate-100 text-slate-500 hover:bg-slate-200"}`,title:"Male model",children:(0,tB.jsx)(gb,{size:12})}),(0,tB.jsx)("button",{type:"button",onClick:()=>q(e.description,"female"),className:`p-1 rounded transition-all ${"female"===V(e.description)?"bg-pink-500 text-white":"bg-slate-100 text-slate-500 hover:bg-slate-200"}`,title:"Female model",children:(0,tB.jsx)(gb,{size:12})}),(0,tB.jsx)("button",{type:"button",onClick:()=>q(e.description,"both"),className:`p-1 rounded transition-all ${"both"===V(e.description)?"bg-purple-500 text-white":"bg-slate-100 text-slate-500 hover:bg-slate-200"}`,title:"One of each",children:(0,tB.jsx)(gx,{size:12})})]})]}),(0,tB.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,tB.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),I(_===t?null:t)},className:"p-1.5 hover:bg-slate-100 rounded-lg transition-colors opacity-50 hover:opacity-100",title:"Why this style?",children:(0,tB.jsx)(gp,{size:14,className:"text-slate-400"})}),(0,tB.jsx)("button",{type:"button",onClick:t=>{t.stopPropagation(),H(e.description)},disabled:s,className:"p-1.5 rounded-lg transition-all text-indigo-500 opacity-0 group-hover:opacity-100 hover:bg-indigo-100",title:"Quick generate this style",children:(0,tB.jsx)(gu,{size:14})})]})]})})]})}),_===t&&(0,tB.jsxs)("div",{className:"mt-2 p-3 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200/50 rounded-xl text-xs text-amber-700 animate-in slide-in-from-top-1",children:[(0,tB.jsx)("span",{className:"font-semibold text-amber-800",children:"Why this works: "}),e.reasoning]})]},t)}),(0,tB.jsxs)("details",{className:"mt-3 group/details",children:[(0,tB.jsxs)("summary",{className:"text-xs text-slate-400 cursor-pointer hover:text-slate-600 transition-colors flex items-center gap-1",children:[(0,tB.jsx)(gv,{size:10,className:"transition-transform group-open/details:rotate-90"}),"Or try a preset style..."]}),(0,tB.jsx)("div",{className:"space-y-2 mt-3",children:gC.map((e,t)=>{let n=m.has(e);return(0,tB.jsx)("div",{onClick:()=>!s&&B(e),className:`
                        w-full text-left p-3 rounded-xl border-2 transition-all text-sm cursor-pointer group
                        ${n?"border-indigo-500 bg-indigo-50":"border-slate-200 hover:border-indigo-300 hover:bg-slate-50"}
                      `,children:(0,tB.jsxs)("div",{className:"flex items-center gap-3",children:[(0,tB.jsx)("div",{className:`
                            w-5 h-5 rounded-md flex-shrink-0 flex items-center justify-center border-2 transition-all
                            ${n?"bg-indigo-600 border-indigo-600 text-white":"border-slate-300 group-hover:border-indigo-400"}
                          `,children:n&&(0,tB.jsx)(gf,{size:12,strokeWidth:3})}),(0,tB.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,tB.jsx)("span",{className:"text-slate-600 text-xs block",children:e}),n&&(0,tB.jsxs)("div",{className:"flex items-center gap-1 mt-2",onClick:e=>e.stopPropagation(),children:[(0,tB.jsx)("span",{className:"text-[10px] text-slate-400 mr-1",children:"Model:"}),(0,tB.jsx)("button",{type:"button",onClick:()=>q(e,"male"),className:`p-1 rounded transition-all ${"male"===V(e)?"bg-indigo-600 text-white":"bg-slate-100 text-slate-500 hover:bg-slate-200"}`,title:"Male model",children:(0,tB.jsx)(gb,{size:12})}),(0,tB.jsx)("button",{type:"button",onClick:()=>q(e,"female"),className:`p-1 rounded transition-all ${"female"===V(e)?"bg-pink-500 text-white":"bg-slate-100 text-slate-500 hover:bg-slate-200"}`,title:"Female model",children:(0,tB.jsx)(gb,{size:12})}),(0,tB.jsx)("button",{type:"button",onClick:()=>q(e,"both"),className:`p-1 rounded transition-all ${"both"===V(e)?"bg-purple-500 text-white":"bg-slate-100 text-slate-500 hover:bg-slate-200"}`,title:"One of each",children:(0,tB.jsx)(gx,{size:12})})]})]}),(0,tB.jsx)("button",{type:"button",onClick:t=>{t.stopPropagation(),H(e)},disabled:s,className:"p-1.5 rounded-lg transition-all text-indigo-500 opacity-0 group-hover:opacity-100 hover:bg-indigo-100",title:"Quick generate this style",children:(0,tB.jsx)(gu,{size:14})})]})},t)})})]}),m.size>0&&(0,tB.jsxs)("div",{className:"mt-4 p-3 bg-slate-50 rounded-xl border border-slate-200",children:[(0,tB.jsxs)("div",{className:"flex items-center justify-between",children:[(0,tB.jsx)("span",{className:"text-xs font-medium text-slate-600",children:"Variations per style"}),(0,tB.jsx)("div",{className:"flex gap-1",children:[1,2,3,4].map(e=>(0,tB.jsx)("button",{type:"button",onClick:()=>T(e),className:`w-7 h-7 rounded-lg text-xs font-semibold transition-all ${C===e?"bg-indigo-600 text-white shadow-sm":"bg-white text-slate-600 border border-slate-200 hover:border-indigo-300"}`,children:e},e))})]}),(0,tB.jsx)("p",{className:"text-[10px] text-slate-400 mt-1.5",children:1===C?"Generate 1 image per style":`Generate ${C} variations to compare and choose the best`})]}),(0,tB.jsxs)("button",{onClick:$,disabled:s||0===m.size,className:`
                w-full mt-3 py-3 px-4 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all
                ${m.size>0?"bg-gradient-to-r from-indigo-600 to-indigo-500 text-white shadow-lg shadow-indigo-500/25 hover:shadow-xl hover:shadow-indigo-500/30 hover:-translate-y-0.5":"bg-slate-100 text-slate-400 cursor-not-allowed"}
              `,children:[(0,tB.jsx)(gy,{size:18}),m.size>0?`Generate ${m.size} Style${m.size>1?"s":""} \xd7 ${C} var${C>1?"s":""}`:"Select styles to generate"]})]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)("div",{className:"space-y-2 mb-5",children:gC.map((e,t)=>{let n=m.has(e);return(0,tB.jsx)("div",{onClick:()=>!s&&B(e),className:`
                      w-full text-left p-3 rounded-xl border-2 transition-all text-sm cursor-pointer group
                      ${n?"border-indigo-500 bg-indigo-50":"border-slate-200 hover:border-indigo-300 hover:bg-slate-50"}
                    `,children:(0,tB.jsxs)("div",{className:"flex items-center gap-3",children:[(0,tB.jsx)("div",{className:`
                          w-5 h-5 rounded-md flex-shrink-0 flex items-center justify-center border-2 transition-all
                          ${n?"bg-indigo-600 border-indigo-600 text-white":"border-slate-300 group-hover:border-indigo-400"}
                        `,children:n&&(0,tB.jsx)(gf,{size:12,strokeWidth:3})}),(0,tB.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,tB.jsx)("span",{className:"text-slate-600 text-xs block",children:e}),n&&(0,tB.jsxs)("div",{className:"flex items-center gap-1 mt-2",onClick:e=>e.stopPropagation(),children:[(0,tB.jsx)("span",{className:"text-[10px] text-slate-400 mr-1",children:"Model:"}),(0,tB.jsx)("button",{type:"button",onClick:()=>q(e,"male"),className:`p-1 rounded transition-all ${"male"===V(e)?"bg-indigo-600 text-white":"bg-slate-100 text-slate-500 hover:bg-slate-200"}`,title:"Male model",children:(0,tB.jsx)(gb,{size:12})}),(0,tB.jsx)("button",{type:"button",onClick:()=>q(e,"female"),className:`p-1 rounded transition-all ${"female"===V(e)?"bg-pink-500 text-white":"bg-slate-100 text-slate-500 hover:bg-slate-200"}`,title:"Female model",children:(0,tB.jsx)(gb,{size:12})}),(0,tB.jsx)("button",{type:"button",onClick:()=>q(e,"both"),className:`p-1 rounded transition-all ${"both"===V(e)?"bg-purple-500 text-white":"bg-slate-100 text-slate-500 hover:bg-slate-200"}`,title:"One of each",children:(0,tB.jsx)(gx,{size:12})})]})]}),(0,tB.jsx)("button",{type:"button",onClick:t=>{t.stopPropagation(),H(e)},disabled:s,className:"p-1.5 rounded-lg transition-all text-indigo-500 opacity-0 group-hover:opacity-100 hover:bg-indigo-100",title:"Quick generate this style",children:(0,tB.jsx)(gu,{size:14})})]})},t)})}),m.size>0&&(0,tB.jsxs)("div",{className:"mb-3 p-3 bg-slate-50 rounded-xl border border-slate-200",children:[(0,tB.jsxs)("div",{className:"flex items-center justify-between",children:[(0,tB.jsx)("span",{className:"text-xs font-medium text-slate-600",children:"Variations per style"}),(0,tB.jsx)("div",{className:"flex gap-1",children:[1,2,3,4].map(e=>(0,tB.jsx)("button",{type:"button",onClick:()=>T(e),className:`w-7 h-7 rounded-lg text-xs font-semibold transition-all ${C===e?"bg-indigo-600 text-white shadow-sm":"bg-white text-slate-600 border border-slate-200 hover:border-indigo-300"}`,children:e},e))})]}),(0,tB.jsx)("p",{className:"text-[10px] text-slate-400 mt-1.5",children:1===C?"Generate 1 image per style":`Generate ${C} variations to compare and choose the best`})]}),(0,tB.jsxs)("button",{onClick:$,disabled:s||0===m.size,className:`
                w-full py-3 px-4 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all
                ${m.size>0?"bg-gradient-to-r from-indigo-600 to-indigo-500 text-white shadow-lg shadow-indigo-500/25 hover:shadow-xl hover:shadow-indigo-500/30 hover:-translate-y-0.5":"bg-slate-100 text-slate-400 cursor-not-allowed"}
              `,children:[(0,tB.jsx)(gy,{size:18}),m.size>0?`Generate ${m.size} Style${m.size>1?"s":""} \xd7 ${C} var${C>1?"s":""}`:"Select styles to generate"]})]}),(0,tB.jsxs)("div",{className:"relative my-5",children:[(0,tB.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,tB.jsx)("div",{className:"w-full border-t border-slate-200"})}),(0,tB.jsx)("div",{className:"relative flex justify-center",children:(0,tB.jsx)("span",{className:"px-3 bg-white text-xs text-slate-400 font-medium",children:"Or describe your own"})})]}),(0,tB.jsxs)("div",{className:"flex gap-2",children:[(0,tB.jsx)("input",{type:"text",value:r,onChange:e=>i(e.target.value),placeholder:"e.g. Cyberpunk neon city night...",className:"flex-1 border-2 border-slate-200 rounded-xl px-4 py-2.5 text-sm focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-400 outline-none transition-all placeholder:text-slate-400",onKeyDown:e=>{"Enter"===e.key&&r&&!s&&(H(r),i(""))}}),(0,tB.jsx)("button",{onClick:()=>{H(r),i("")},disabled:!r||s,className:"bg-slate-800 text-white p-2.5 rounded-xl hover:bg-slate-900 disabled:opacity-30 disabled:cursor-not-allowed transition-all",title:"Generate mockup",children:(0,tB.jsx)(gu,{size:20})})]})]}),(0,tB.jsxs)("div",{className:"lg:col-span-3 bg-gradient-to-b from-slate-50 to-slate-100/50 rounded-2xl min-h-[500px] flex flex-col relative overflow-hidden border border-slate-200",children:[s&&(0,tB.jsx)("div",{className:"absolute inset-0 bg-white/90 backdrop-blur-sm z-10 flex flex-col items-center justify-center",children:(0,tB.jsxs)("div",{className:"text-center",children:[(0,tB.jsx)("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center mx-auto mb-5 shadow-lg shadow-indigo-500/30",children:(0,tB.jsx)(tX,{className:"animate-spin text-white",size:36})}),(0,tB.jsxs)("p",{className:"font-display font-semibold text-slate-800 text-lg mb-1",children:["Generating ",y&&y.total>1?"Mockups":"Mockup","..."]}),y&&(0,tB.jsxs)("div",{className:"mt-4 w-48 mx-auto",children:[(0,tB.jsxs)("div",{className:"flex justify-between text-xs text-slate-500 mb-1.5",children:[(0,tB.jsx)("span",{children:"Progress"}),(0,tB.jsxs)("span",{className:"font-semibold text-indigo-600",children:[y.current," / ",y.total]})]}),(0,tB.jsx)("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden",children:(0,tB.jsx)("div",{className:"h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all duration-500",style:{width:`${y.current/y.total*100}%`}})})]}),(0,tB.jsx)("p",{className:"text-xs text-slate-400 mt-4",children:"Using Gemini 3 Pro for best results"})]})}),u&&!s&&(0,tB.jsx)("div",{className:"flex-1 flex items-center justify-center text-center p-8",children:(0,tB.jsxs)("div",{children:[(0,tB.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-slate-100 flex items-center justify-center mx-auto mb-4",children:(0,tB.jsx)(tX,{size:28,className:"text-slate-400 animate-spin"})}),(0,tB.jsx)("p",{className:"font-semibold text-slate-500 mb-1",children:"Loading saved mockups..."})]})}),!u&&0===o.length&&!s&&!p&&(0,tB.jsx)("div",{className:`flex items-center justify-center text-center p-8 ${0===O.length&&!D?"flex-1":"py-12"}`,children:(0,tB.jsxs)("div",{children:[(0,tB.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-slate-100 flex items-center justify-center mx-auto mb-4",children:(0,tB.jsx)(gl,{size:28,className:"text-slate-300"})}),(0,tB.jsx)("p",{className:"font-semibold text-slate-500 mb-1",children:"Select styles and generate mockups"}),(0,tB.jsx)("p",{className:"text-xs text-slate-400 max-w-[200px] mx-auto leading-relaxed",children:"Click the arrow to quick-generate, or select multiple and batch generate"})]})}),p&&!s&&(0,tB.jsx)("div",{className:"p-4 mx-4 mt-4 bg-red-50 border border-red-200 rounded-xl text-center text-red-600 text-sm",children:p}),o.length>0&&(0,tB.jsxs)("div",{className:"flex-1 overflow-auto p-4",children:[(0,tB.jsxs)("div",{className:"flex items-center justify-between mb-4 px-1",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[(0,tB.jsx)(gy,{size:14,className:"text-slate-400"}),(0,tB.jsxs)("span",{className:"font-medium",children:[o.length," mockup",o.length>1?"s":""]}),(0,tB.jsx)("span",{className:"text-slate-300",children:""}),(0,tB.jsxs)("span",{className:"text-indigo-600 font-semibold",children:[h.size," selected"]})]}),(0,tB.jsxs)("div",{className:"flex gap-2 text-xs",children:[(0,tB.jsx)("button",{onClick:()=>{d(new Set(o.map(e=>e.id)))},className:"text-indigo-600 font-medium hover:text-indigo-700",children:"Select all"}),(0,tB.jsx)("span",{className:"text-slate-300",children:"|"}),(0,tB.jsx)("button",{onClick:()=>{d(new Set)},className:"text-slate-500 hover:text-slate-700",children:"Deselect all"})]})]}),(0,tB.jsx)("div",{className:"grid grid-cols-2 gap-3 stagger-children",children:o.map(e=>{let t=h.has(e.id);return(0,tB.jsxs)("div",{className:`
                      relative group rounded-xl overflow-hidden bg-white shadow-sm border-2 transition-all cursor-pointer hover-lift
                      ${t?"border-indigo-500 shadow-md shadow-indigo-500/10":"border-transparent hover:border-slate-200"}
                    `,onClick:()=>G(e.id),children:[(0,tB.jsx)("img",{src:e.imageUrl,alt:e.styleDescription,className:"w-full aspect-square object-cover"}),(0,tB.jsx)("div",{className:`
                      absolute top-2.5 left-2.5 w-6 h-6 rounded-lg flex items-center justify-center transition-all
                      ${t?"bg-indigo-600 text-white shadow-md":"bg-white/90 backdrop-blur-sm border-2 border-slate-300 group-hover:border-indigo-400"}
                    `,children:t&&(0,tB.jsx)(gf,{size:14,strokeWidth:3})}),(0,tB.jsxs)("div",{className:"absolute top-2.5 right-2.5 flex gap-1.5 opacity-0 group-hover:opacity-100 transition-all",children:[(0,tB.jsx)("button",{onClick:t=>{t.stopPropagation(),k(e)},className:"w-6 h-6 rounded-lg bg-white/90 backdrop-blur-sm text-slate-700 flex items-center justify-center hover:bg-white hover:scale-110 transition-all shadow-sm",title:"View larger",children:(0,tB.jsx)(gw,{size:12})}),(0,tB.jsx)("button",{onClick:t=>{var n;t.stopPropagation(),n=e.id,l(e=>e.filter(e=>e.id!==n)),d(e=>{let t=new Set(e);return t.delete(n),t})},className:"w-6 h-6 rounded-lg bg-red-500/90 backdrop-blur-sm text-white flex items-center justify-center hover:bg-red-600 hover:scale-110 transition-all",title:"Remove mockup",children:(0,tB.jsx)(gm,{size:14})})]}),(0,tB.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-3 bg-gradient-to-t from-black/80 via-black/40 to-transparent",children:(0,tB.jsx)("p",{className:"text-white text-xs line-clamp-2 font-medium",children:e.styleDescription})})]},e.id)})})]}),(0,tB.jsxs)("div",{className:"border-t border-slate-200 mt-auto",children:[(0,tB.jsxs)("button",{onClick:()=>L(!U),className:"w-full p-4 flex items-center justify-between hover:bg-slate-50 transition-colors",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[(0,tB.jsx)(tY,{size:14,className:"text-slate-400"}),(0,tB.jsx)("span",{className:"font-medium",children:"Previously Generated"}),!D&&(0,tB.jsxs)("span",{className:"text-xs text-slate-400",children:["(",O.length,")"]}),P&&(0,tB.jsxs)("span",{className:"flex items-center gap-1 text-xs text-indigo-500",children:[(0,tB.jsx)(tX,{size:10,className:"animate-spin"}),"Saving..."]})]}),(0,tB.jsx)(g_,{size:16,className:`text-slate-400 transition-transform ${U?"rotate-90":""}`})]}),U&&(0,tB.jsx)("div",{className:"px-4 pb-4",children:D?(0,tB.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[...Array(6)].map((e,t)=>(0,tB.jsx)("div",{className:"aspect-square rounded-lg bg-slate-100 animate-pulse"},t))}):0===O.length?(0,tB.jsx)("div",{className:"text-center py-6 text-sm text-slate-400",children:"No previously generated mockups"}):(0,tB.jsx)("div",{className:"grid grid-cols-3 gap-2 max-h-64 overflow-y-auto",children:O.map(e=>{var t;let n,r,i,s,a=o.some(t=>t.id===e.id);return(0,tB.jsxs)("div",{className:"relative group aspect-square rounded-lg overflow-hidden bg-white border border-slate-200 hover:border-indigo-300 transition-all",children:[(0,tB.jsx)("img",{src:e.imageUrl,alt:e.styleDescription,className:"w-full h-full object-cover"}),(0,tB.jsxs)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-all flex items-center justify-center gap-1 opacity-0 group-hover:opacity-100",children:[(0,tB.jsx)("button",{onClick:()=>(e=>{if(o.some(t=>t.id===e.id))return void d(t=>new Set([...t,e.id]));let t={id:e.id,imageUrl:e.imageUrl,styleDescription:e.styleDescription};l(e=>[...e,t]),d(t=>new Set([...t,e.id]))})(e),className:`
                                p-2 rounded-lg transition-all
                                ${a?"bg-emerald-500 text-white":"bg-white text-slate-700 hover:bg-indigo-500 hover:text-white"}
                              `,title:a?"Already in carousel":"Add to carousel",children:a?(0,tB.jsx)(gf,{size:16}):(0,tB.jsx)(gI,{size:16})}),(0,tB.jsx)("button",{onClick:()=>W(e.id),className:"p-2 rounded-lg bg-white text-slate-700 hover:bg-red-500 hover:text-white transition-all",title:"Delete from history",children:(0,tB.jsx)(tJ,{size:16})})]}),a&&(0,tB.jsx)("div",{className:"absolute top-1 right-1 w-5 h-5 rounded-full bg-emerald-500 flex items-center justify-center",children:(0,tB.jsx)(gf,{size:10,className:"text-white",strokeWidth:3})}),(0,tB.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-1.5 bg-gradient-to-t from-black/70 to-transparent",children:(0,tB.jsx)("p",{className:"text-white text-[10px] truncate",children:(t=e.createdAt,r=Math.floor((n=new Date().getTime()-t.getTime())/6e4),i=Math.floor(n/36e5),s=Math.floor(n/864e5),r<1?"Just now":r<60?`${r}m ago`:i<24?`${i}h ago`:s<7?`${s}d ago`:t.toLocaleDateString())})})]},e.id)})})})]}),o.length>0&&(0,tB.jsxs)("div",{className:"p-4 bg-white border-t border-slate-200 flex justify-between items-center",children:[(0,tB.jsx)("div",{className:"text-sm text-slate-600",children:0===h.size?(0,tB.jsxs)("span",{className:"text-amber-600 flex items-center gap-1.5",children:[(0,tB.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-amber-500 animate-pulse"}),"Select at least one mockup"]}):1===h.size?(0,tB.jsxs)("span",{children:["Post as a ",(0,tB.jsx)("strong",{className:"text-slate-800",children:"single image"})]}):(0,tB.jsxs)("span",{children:["Post as a ",(0,tB.jsx)("strong",{className:"text-indigo-600",children:"carousel"})," (",h.size," images)"]})}),(0,tB.jsxs)("div",{className:"flex gap-2",children:[(0,tB.jsxs)("button",{onClick:()=>l([]),className:"flex items-center gap-2 px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-xl text-sm font-medium transition-colors",children:[(0,tB.jsx)(gc,{size:14}),"Start Over"]}),(0,tB.jsxs)("button",{onClick:()=>{let e=o.filter(e=>h.has(e.id));e.length>0&&t(e)},disabled:0===h.size,className:`
                  px-5 py-2 rounded-xl text-sm font-semibold flex items-center gap-2 transition-all
                  ${h.size>0?"bg-gradient-to-r from-indigo-600 to-indigo-500 text-white shadow-md shadow-indigo-500/20 hover:shadow-lg hover:-translate-y-0.5":"bg-slate-100 text-slate-400 cursor-not-allowed"}
                `,children:[(0,tB.jsx)(gg,{size:16}),"Use ",h.size>0?`${h.size} Selected`:"Selected"]})]})]})]}),A&&(0,tB.jsxs)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>k(null),children:[(0,tB.jsx)("button",{onClick:()=>k(null),className:"absolute top-4 right-4 w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 text-white flex items-center justify-center transition-all",children:(0,tB.jsx)(gm,{size:24})}),o.length>1&&(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)("button",{onClick:e=>{e.stopPropagation();let t=o.findIndex(e=>e.id===A.id),n=0===t?o.length-1:t-1;k(o[n])},className:"absolute left-4 w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 text-white flex items-center justify-center transition-all",children:(0,tB.jsx)(gE,{size:24})}),(0,tB.jsx)("button",{onClick:e=>{e.stopPropagation();let t=o.findIndex(e=>e.id===A.id),n=t===o.length-1?0:t+1;k(o[n])},className:"absolute right-4 w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 text-white flex items-center justify-center transition-all",children:(0,tB.jsx)(g_,{size:24})})]}),(0,tB.jsxs)("div",{className:"relative max-w-4xl max-h-[85vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,tB.jsx)("img",{src:A.imageUrl,alt:A.styleDescription,className:"max-w-full max-h-[75vh] object-contain rounded-xl shadow-2xl"}),(0,tB.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,tB.jsxs)("div",{className:"text-white",children:[(0,tB.jsx)("p",{className:"text-sm font-medium",children:A.styleDescription}),(0,tB.jsxs)("p",{className:"text-xs text-white/60 mt-1",children:[o.findIndex(e=>e.id===A.id)+1," of ",o.length]})]}),(0,tB.jsx)("div",{className:"flex gap-2",children:(0,tB.jsxs)("button",{onClick:()=>{G(A.id)},className:`
                    px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-all
                    ${h.has(A.id)?"bg-indigo-600 text-white":"bg-white/10 text-white hover:bg-white/20"}
                  `,children:[(0,tB.jsx)(gf,{size:16}),h.has(A.id)?"Selected":"Select"]})})]})]})]})]})};function gj(){let e=pH.currentUser;if(!e)throw Error("No authenticated user. Please sign in.");return e.uid}let gP={facebook:{connected:!1,username:""},instagram:{connected:!1,username:""}};function gM(e){return new Promise(t=>{let n=gj(),r=encodeURIComponent(window.location.origin),i=`${pK("authStart")}?sessionId=${n}&platform=${e}&redirectUrl=${r}`,s=window.screenX+(window.outerWidth-600)/2,a=window.screenY+(window.outerHeight-700)/2,o=window.open(i,"SocialStitch OAuth",`width=600,height=700,left=${s},top=${a},scrollbars=yes`);if(!o){console.error("Popup blocked. Please allow popups for this site."),t(!1);return}let l=!1,u="",c=setInterval(()=>{try{let e=o.location.href;if(e&&e!==u&&e.includes(window.location.origin)){u=e;let n=new URLSearchParams(new URL(e).search);if(n.get("auth_success")){l=!0,clearInterval(c),o.close(),t(!0);return}if(n.get("auth_error")){let e=n.get("auth_error");console.error("OAuth error:",e),l=!0,clearInterval(c),o.close(),t(!1);return}}}catch{}o.closed&&!l&&(clearInterval(c),setTimeout(()=>{l||t(!1)},1e3))},300);setTimeout(()=>{l||(clearInterval(c),o.closed||o.close(),t(!1))},3e5)})}async function gU(){try{let e=gj(),t=await fetch(`${pK("getConnectedAccounts")}?sessionId=${e}`);if(!t.ok)throw Error("Failed to fetch accounts");let n=await t.json();return{facebook:n.accounts?.facebook||gP.facebook,instagram:n.accounts?.instagram||gP.instagram}}catch(e){return console.error("Error fetching connected accounts:",e),gP}}async function gL(e){try{let t=gj();return(await fetch(pK("disconnectAccount"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:t,platform:e})})).ok}catch(e){return console.error("Error disconnecting account:",e),!1}}async function gF(e){try{let t=await fetch(e),n=await t.blob();return new Promise((e,t)=>{let r=new FileReader;r.onloadend=()=>e(r.result),r.onerror=t,r.readAsDataURL(n)})}catch(e){throw console.error("Error converting image to base64:",e),e}}async function gV(e,t,n){try{let r=Array.isArray(t)?t:[t],i=r.length>1,s=[];for(let e of r)if(e.startsWith("blob:")||e.startsWith("data:")||e.includes("localhost")){console.log("Converting image to base64 for upload...");let t=await gF(e);s.push(t)}else s.push(e);let a={sessionId:gj(),caption:n};if(i)a.imagesBase64=s;else{let e=s[0];e.startsWith("data:")||e.length>500?a.imageBase64=e:a.imageUrl=e}let o=await fetch(pK(i?"facebook"===e?"postCarouselToFacebook":"postCarouselToInstagram":"facebook"===e?"postToFacebook":"postToInstagram"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),l=await o.json();if(!o.ok)return{success:!1,error:l.error||"Failed to post"};return{success:!0,postId:l.postId}}catch(e){return console.error("Error posting to social:",e),{success:!1,error:"Network error. Please try again."}}}function gq(){return null!==window.opener&&window.opener!==window}let gB="scheduledPosts";function gG(){let e=pH.currentUser;if(!e)throw Error("No authenticated user. Please sign in.");return e.uid}function gz(e){let t=e.data();return{id:e.id,sessionId:t.sessionId,platforms:t.platforms,scheduledFor:t.scheduledFor.toDate(),status:t.status,captions:t.captions,imageUrls:t.imageUrls,mockupData:t.mockupData,createdAt:t.createdAt.toDate(),publishedAt:t.publishedAt?t.publishedAt.toDate():void 0,error:t.error}}async function gH(e){let t=gG(),n=[];for(let s=0;s<e.length;s++){var r,i;let a=e[s];if(a.startsWith("https://storage.googleapis.com")||a.startsWith("https://firebasestorage.googleapis.com")){n.push(a);continue}let o=c0(pz,`scheduled/${t}/${Date.now()}_${s}.jpg`),l=a;a.startsWith("data:")||(l=`data:image/jpeg;base64,${a}`),await (r=o,i=l,function(e,t,n="raw",r){e._throwIfRoot("uploadString");let i=cI(n,t),s={...r};return null==s.contentType&&null!=i.contentType&&(s.contentType=i.contentType),c$(e,i.data,s)}(r=nI(r),i,"data_url",void 0));let u=await cQ(o);n.push(u)}return n}async function g$(e){let t=gG(),n=await gH(e.imageUrls),r={sessionId:t,platforms:e.platforms.map(e=>String(e)),scheduledFor:il.fromDate(e.scheduledFor),status:"scheduled",captions:{facebook:String(e.captions.facebook||""),instagram:String(e.captions.instagram||"")},imageUrls:n.map(e=>String(e)),createdAt:il.now()};return{id:(await u7(uo(pG,gB),r)).id,sessionId:t,platforms:e.platforms,scheduledFor:e.scheduledFor,status:"scheduled",captions:e.captions,imageUrls:n,mockupData:e.mockupData,createdAt:new Date}}async function gK(e,t){let n=ul(pG,gB,e),r={};t.scheduledFor&&(r.scheduledFor=il.fromDate(t.scheduledFor)),t.captions&&(r.captions=t.captions),t.platforms&&(r.platforms=t.platforms),t.status&&(r.status=t.status),void 0!==t.error&&(r.error=t.error),await function(e,t,n,...r){var i,s,a;let o,l,u;e=is(e,us);let c=is(e.firestore,up),h=uT(c);return u9(c,[("string"==typeof(t=nI(t))||t instanceof ug?function(e,t,n,r,i,s){let a=e.Cc(1,t,n),o=[uD(t,r,n)],l=[i];if(s.length%2!=0)throw new rB(rq.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(uD(t,s[e])),l.push(s[e+1]);let u=[],c=se.empty();for(let e=o.length-1;e>=0;--e)if(!uU(u,o[e])){let t=o[e],n=l[e];n=nI(n);let r=a.yc(t);if(n instanceof uN)u.push(t);else{let e=uA(n,r);null!=e&&(u.push(t),c.set(t,e))}}return new uE(c,new iT(u),a.fieldTransforms)}(h,"updateDoc",e._key,t,void 0,r):(i="updateDoc",s=e._key,a=t,uR("Data must be an object, but it was:",o=h.Cc(1,i,s),a),l=[],u=se.empty(),ib(a,(e,t)=>{let n=uP(i,e,s);t=nI(t);let r=o.yc(n);if(t instanceof uN)l.push(n);else{let e=uA(t,r);null!=e&&(l.push(n),u.set(n,e))}}),new uE(u,new iT(l),o.fieldTransforms))).toMutation(e._key,s4.exists(!0))])}(n,r)}async function gW(e,t){await gK(e,{scheduledFor:t,status:"scheduled",error:void 0})}async function gJ(e){let t=ul(pG,gB,e);await u8(t)}function gY(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}async function gX(e,t){await gK(e,{status:"scheduled",scheduledFor:t||new Date(Date.now()+6e4),error:void 0})}async function gQ(e){let t=gG(),n=await gH(e.imageUrls),r=new Date,i={sessionId:t,platforms:e.platforms.map(e=>String(e)),scheduledFor:il.fromDate(r),status:"published",captions:{facebook:String(e.captions.facebook||""),instagram:String(e.captions.instagram||"")},imageUrls:n.map(e=>String(e)),createdAt:il.now(),publishedAt:il.now()};return{id:(await u7(uo(pG,gB),i)).id,sessionId:t,platforms:e.platforms,scheduledFor:r,status:"published",captions:e.captions,imageUrls:n,mockupData:e.mockupData,createdAt:r,publishedAt:r}}var gZ=tG,g0=Object.defineProperty,g1=(e,t,n)=>{let r;return(r="symbol"!=typeof t?t+"":t)in e?g0(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n};let g2={x:0,y:0,width:0,height:0,unit:"px"},g5=(e,t,n)=>Math.min(Math.max(e,t),n),g6=(e,t)=>e===t||e.width===t.width&&e.height===t.height&&e.x===t.x&&e.y===t.y&&e.unit===t.unit;function g4(e,t,n){return"%"===e.unit?{...g2,...e,unit:"%"}:{unit:"%",x:e.x?e.x/t*100:0,y:e.y?e.y/n*100:0,width:e.width?e.width/t*100:0,height:e.height?e.height/n*100:0}}function g3(e,t,n){return e.unit?"px"===e.unit?{...g2,...e,unit:"px"}:{unit:"px",x:e.x?e.x*t/100:0,y:e.y?e.y*n/100:0,width:e.width?e.width*t/100:0,height:e.height?e.height*n/100:0}:{...g2,...e,unit:"px"}}function g8(e,t,n,r,i,s=0,a=0,o=r,l=i){let u={...e},c=Math.min(s,r),h=Math.min(a,i),d=Math.min(o,r),p=Math.min(l,i);t&&(t>1?(h=(c=a?a*t:c)/t,d=o*t):(c=(h=s?s/t:h)*t,p=l/t)),u.y<0&&(u.height=Math.max(u.height+u.y,h),u.y=0),u.x<0&&(u.width=Math.max(u.width+u.x,c),u.x=0);let f=r-(u.x+u.width);f<0&&(u.x=Math.min(u.x,r-c),u.width+=f);let m=i-(u.y+u.height);if(m<0&&(u.y=Math.min(u.y,i-h),u.height+=m),u.width<c&&(("sw"===n||"nw"==n)&&(u.x-=c-u.width),u.width=c),u.height<h&&(("nw"===n||"ne"==n)&&(u.y-=h-u.height),u.height=h),u.width>d&&(("sw"===n||"nw"==n)&&(u.x-=d-u.width),u.width=d),u.height>p&&(("nw"===n||"ne"==n)&&(u.y-=p-u.height),u.height=p),t){let e=u.width/u.height;if(e<t){let e=Math.max(u.width/t,h);("nw"===n||"ne"==n)&&(u.y-=e-u.height),u.height=e}else if(e>t){let e=Math.max(u.height*t,c);("sw"===n||"nw"==n)&&(u.x-=e-u.width),u.width=e}}return u}let g7={capture:!0,passive:!1},g9=0,ye=class e extends gZ.PureComponent{constructor(){super(...arguments),g1(this,"docMoveBound",!1),g1(this,"mouseDownOnCrop",!1),g1(this,"dragStarted",!1),g1(this,"evData",{startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0}),g1(this,"componentRef",(0,gZ.createRef)()),g1(this,"mediaRef",(0,gZ.createRef)()),g1(this,"resizeObserver"),g1(this,"initChangeCalled",!1),g1(this,"instanceId",`rc-${g9++}`),g1(this,"state",{cropIsActive:!1,newCropIsBeingDrawn:!1}),g1(this,"onCropPointerDown",e=>{let{crop:t,disabled:n}=this.props,r=this.getBox();if(!t)return;let i=g3(t,r.width,r.height);if(n)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});let s=e.target.dataset.ord,a=e.clientX,o=e.clientY,l=i.x,u=i.y;if(s){let t=e.clientX-r.x,n=e.clientY-r.y,c=0,h=0;"ne"===s||"e"==s?(c=t-(i.x+i.width),h=n-i.y,l=i.x,u=i.y+i.height):"se"===s||"s"===s?(c=t-(i.x+i.width),h=n-(i.y+i.height),l=i.x,u=i.y):"sw"===s||"w"==s?(c=t-i.x,h=n-(i.y+i.height),l=i.x+i.width,u=i.y):("nw"===s||"n"==s)&&(c=t-i.x,h=n-i.y,l=i.x+i.width,u=i.y+i.height),a=l+r.x+c,o=u+r.y+h}this.evData={startClientX:a,startClientY:o,startCropX:l,startCropY:u,clientX:e.clientX,clientY:e.clientY,isResize:!!s,ord:s},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})}),g1(this,"onComponentPointerDown",e=>{let{crop:t,disabled:n,locked:r,keepSelection:i,onChange:s}=this.props,a=this.getBox();if(n||r||i&&t)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});let o=e.clientX-a.x,l=e.clientY-a.y,u={unit:"px",x:o,y:l,width:0,height:0};this.evData={startClientX:e.clientX,startClientY:e.clientY,startCropX:o,startCropY:l,clientX:e.clientX,clientY:e.clientY,isResize:!0},this.mouseDownOnCrop=!0,s(g3(u,a.width,a.height),g4(u,a.width,a.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})}),g1(this,"onDocPointerMove",e=>{let t,{crop:n,disabled:r,onChange:i,onDragStart:s}=this.props,a=this.getBox();if(r||!n||!this.mouseDownOnCrop)return;e.cancelable&&e.preventDefault(),this.dragStarted||(this.dragStarted=!0,s&&s(e));let{evData:o}=this;o.clientX=e.clientX,o.clientY=e.clientY,g6(n,t=o.isResize?this.resizeCrop():this.dragCrop())||i(g3(t,a.width,a.height),g4(t,a.width,a.height))}),g1(this,"onComponentKeyDown",t=>{let{crop:n,disabled:r,onChange:i,onComplete:s}=this.props;if(r)return;let a=t.key,o=!1;if(!n)return;let l=this.getBox(),u=this.makePixelCrop(l),c=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?e.nudgeStepLarge:t.shiftKey?e.nudgeStepMedium:e.nudgeStep;if("ArrowLeft"===a?(u.x-=c,o=!0):"ArrowRight"===a?(u.x+=c,o=!0):"ArrowUp"===a?(u.y-=c,o=!0):"ArrowDown"===a&&(u.y+=c,o=!0),o){t.cancelable&&t.preventDefault(),u.x=g5(u.x,0,l.width-u.width),u.y=g5(u.y,0,l.height-u.height);let e=g3(u,l.width,l.height),n=g4(u,l.width,l.height);i(e,n),s&&s(e,n)}}),g1(this,"onHandlerKeyDown",(t,n)=>{var r,i;let s,{aspect:a=0,crop:o,disabled:l,minWidth:u=0,minHeight:c=0,maxWidth:h,maxHeight:d,onChange:p,onComplete:f}=this.props,m=this.getBox();if(l||!o||"ArrowUp"!==t.key&&"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key)return;t.stopPropagation(),t.preventDefault();let g=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?e.nudgeStepLarge:t.shiftKey?e.nudgeStepMedium:e.nudgeStep,y=g8((r=g3(o,m.width,m.height),i=t.key,s={...r},"ArrowLeft"===i?"nw"===n?(s.x-=g,s.y-=g,s.width+=g,s.height+=g):"w"===n?(s.x-=g,s.width+=g):"sw"===n?(s.x-=g,s.width+=g,s.height+=g):"ne"===n?(s.y+=g,s.width-=g,s.height-=g):"e"===n?s.width-=g:"se"===n&&(s.width-=g,s.height-=g):"ArrowRight"===i&&("nw"===n?(s.x+=g,s.y+=g,s.width-=g,s.height-=g):"w"===n?(s.x+=g,s.width-=g):"sw"===n?(s.x+=g,s.width-=g,s.height-=g):"ne"===n?(s.y-=g,s.width+=g,s.height+=g):"e"===n?s.width+=g:"se"===n&&(s.width+=g,s.height+=g)),"ArrowUp"===i?"nw"===n?(s.x-=g,s.y-=g,s.width+=g,s.height+=g):"n"===n?(s.y-=g,s.height+=g):"ne"===n?(s.y-=g,s.width+=g,s.height+=g):"sw"===n?(s.x+=g,s.width-=g,s.height-=g):"s"===n?s.height-=g:"se"===n&&(s.width-=g,s.height-=g):"ArrowDown"===i&&("nw"===n?(s.x+=g,s.y+=g,s.width-=g,s.height-=g):"n"===n?(s.y+=g,s.height-=g):"ne"===n?(s.y+=g,s.width-=g,s.height-=g):"sw"===n?(s.x-=g,s.width+=g,s.height+=g):"s"===n?s.height+=g:"se"===n&&(s.width+=g,s.height+=g)),s),a,n,m.width,m.height,u,c,h,d);if(!g6(o,y)){let e=g4(y,m.width,m.height);p(y,e),f&&f(y,e)}}),g1(this,"onDocPointerDone",e=>{let{crop:t,disabled:n,onComplete:r,onDragEnd:i}=this.props,s=this.getBox();this.unbindDocMove(),!(n||!t)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,i&&i(e),r&&r(g3(t,s.width,s.height),g4(t,s.width,s.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))}),g1(this,"onDragFocus",()=>{var e;null==(e=this.componentRef.current)||e.scrollTo(0,0)})}get document(){return document}getBox(){let e=this.mediaRef.current;if(!e)return{x:0,y:0,width:0,height:0};let{x:t,y:n,width:r,height:i}=e.getBoundingClientRect();return{x:t,y:n,width:r,height:i}}componentDidUpdate(e){let{crop:t,onComplete:n}=this.props;if(n&&!e.crop&&t){let{width:e,height:r}=this.getBox();e&&r&&n(g3(t,e,r),g4(t,e,r))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,g7),this.document.addEventListener("pointerup",this.onDocPointerDone,g7),this.document.addEventListener("pointercancel",this.onDocPointerDone,g7),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,g7),this.document.removeEventListener("pointerup",this.onDocPointerDone,g7),this.document.removeEventListener("pointercancel",this.onDocPointerDone,g7),this.docMoveBound=!1)}getCropStyle(){let{crop:e}=this.props;if(e)return{top:`${e.y}${e.unit}`,left:`${e.x}${e.unit}`,width:`${e.width}${e.unit}`,height:`${e.height}${e.unit}`}}dragCrop(){let{evData:e}=this,t=this.getBox(),n=this.makePixelCrop(t),r=e.clientX-e.startClientX,i=e.clientY-e.startClientY;return n.x=g5(e.startCropX+r,0,t.width-n.width),n.y=g5(e.startCropY+i,0,t.height-n.height),n}getPointRegion(e,t,n,r){let i,{evData:s}=this,a=s.clientX-e.x,o=s.clientY-e.y;return i=r&&t?"nw"===t||"n"===t||"ne"===t:o<s.startCropY,(n&&t?"nw"===t||"w"===t||"sw"===t:a<s.startCropX)?i?"nw":"sw":i?"ne":"se"}resolveMinDimensions(e,t,n=0,r=0){let i=Math.min(n,e.width),s=Math.min(r,e.height);return t&&(i||s)?t>1?i?[i,i/t]:[s*t,s]:s?[s*t,s]:[i,i/t]:[i,s]}resizeCrop(){let{evData:t}=this,{aspect:n=0,maxWidth:r,maxHeight:i}=this.props,s=this.getBox(),[a,o]=this.resolveMinDimensions(s,n,this.props.minWidth,this.props.minHeight),l=this.makePixelCrop(s),u=this.getPointRegion(s,t.ord,a,o),c=t.ord||u,h=t.clientX-t.startClientX,d=t.clientY-t.startClientY;(a&&"nw"===c||"w"===c||"sw"===c)&&(h=Math.min(h,-a)),(o&&"nw"===c||"n"===c||"ne"===c)&&(d=Math.min(d,-o));let p={unit:"px",x:0,y:0,width:0,height:0};"ne"===u?(p.x=t.startCropX,p.width=h,n?p.height=p.width/n:p.height=Math.abs(d),p.y=t.startCropY-p.height):"se"===u?(p.x=t.startCropX,p.y=t.startCropY,p.width=h,n?p.height=p.width/n:p.height=d):"sw"===u?(p.x=t.startCropX+h,p.y=t.startCropY,p.width=Math.abs(h),n?p.height=p.width/n:p.height=d):"nw"===u&&(p.x=t.startCropX+h,p.width=Math.abs(h),n?(p.height=p.width/n,p.y=t.startCropY-p.height):(p.height=Math.abs(d),p.y=t.startCropY+d));let f=g8(p,n,u,s.width,s.height,a,o,r,i);return n||e.xyOrds.indexOf(c)>-1?l=f:e.xOrds.indexOf(c)>-1?(l.x=f.x,l.width=f.width):e.yOrds.indexOf(c)>-1&&(l.y=f.y,l.height=f.height),l.x=g5(l.x,0,s.width-l.width),l.y=g5(l.y,0,s.height-l.height),l}renderCropSelection(){let{ariaLabels:t=e.defaultProps.ariaLabels,disabled:n,locked:r,renderSelectionAddon:i,ruleOfThirds:s,crop:a}=this.props,o=this.getCropStyle();if(a)return gZ.default.createElement("div",{style:o,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":t.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!n&&!r&&gZ.default.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},gZ.default.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),gZ.default.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),gZ.default.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),gZ.default.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),gZ.default.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":t.nwDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"nw"),role:"button"}),gZ.default.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":t.nDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"n"),role:"button"}),gZ.default.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":t.neDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"ne"),role:"button"}),gZ.default.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":t.eDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"e"),role:"button"}),gZ.default.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":t.seDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"se"),role:"button"}),gZ.default.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":t.sDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"s"),role:"button"}),gZ.default.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":t.swDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"sw"),role:"button"}),gZ.default.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":t.wDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"w"),role:"button"})),i&&gZ.default.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:e=>e.stopPropagation()},i(this.state)),s&&gZ.default.createElement(gZ.default.Fragment,null,gZ.default.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),gZ.default.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(e){return g3({...g2,...this.props.crop||{}},e.width,e.height)}render(){let{aspect:e,children:t,circularCrop:n,className:r,crop:i,disabled:s,locked:a,style:o,ruleOfThirds:l}=this.props,{cropIsActive:u,newCropIsBeingDrawn:c}=this.state,h=i?this.renderCropSelection():null,d=((...e)=>e.filter(e=>e&&"string"==typeof e).join(" "))("ReactCrop",r,u&&"ReactCrop--active",s&&"ReactCrop--disabled",a&&"ReactCrop--locked",c&&"ReactCrop--new-crop",i&&e&&"ReactCrop--fixed-aspect",i&&n&&"ReactCrop--circular-crop",i&&l&&"ReactCrop--rule-of-thirds",!this.dragStarted&&i&&!i.width&&!i.height&&"ReactCrop--invisible-crop",n&&"ReactCrop--no-animate");return gZ.default.createElement("div",{ref:this.componentRef,className:d,style:o},gZ.default.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},t),i?gZ.default.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},gZ.default.createElement("defs",null,gZ.default.createElement("mask",{id:`hole-${this.instanceId}`},gZ.default.createElement("rect",{width:"100%",height:"100%",fill:"white"}),n?gZ.default.createElement("ellipse",{cx:`${i.x+i.width/2}${i.unit}`,cy:`${i.y+i.height/2}${i.unit}`,rx:`${i.width/2}${i.unit}`,ry:`${i.height/2}${i.unit}`,fill:"black"}):gZ.default.createElement("rect",{x:`${i.x}${i.unit}`,y:`${i.y}${i.unit}`,width:`${i.width}${i.unit}`,height:`${i.height}${i.unit}`,fill:"black"}))),gZ.default.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,h)}};g1(ye,"xOrds",["e","w"]),g1(ye,"yOrds",["n","s"]),g1(ye,"xyOrds",["nw","ne","se","sw"]),g1(ye,"nudgeStep",1),g1(ye,"nudgeStepMedium",10),g1(ye,"nudgeStepLarge",100),g1(ye,"defaultProps",{ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}});let yt=tW("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),yn=tW("rectangle-vertical",[["rect",{width:"12",height:"20",x:"6",y:"2",rx:"2",key:"1oxtiu"}]]),yr=tW("rectangle-horizontal",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}]]),yi=tW("smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),ys=tW("crop",[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]]),ya=[{id:"square",label:"1:1",ratio:1,icon:(0,tB.jsx)(yt,{size:16}),description:"Square"},{id:"portrait",label:"4:5",ratio:.8,icon:(0,tB.jsx)(yn,{size:16}),description:"Portrait"},{id:"landscape",label:"1.91:1",ratio:1.91,icon:(0,tB.jsx)(yr,{size:16}),description:"Landscape"},{id:"stories",label:"9:16",ratio:9/16,icon:(0,tB.jsx)(yi,{size:16}),description:"Stories"}];function yo(e,t,n){var r,i;let s,a;return s=g3(r={unit:"%",width:90},e,t),r.width&&(s.height=s.width/n),r.height&&(s.width=s.height*n),s.y+s.height>t&&(s.height=t-s.y,s.width=s.height*n),s.x+s.width>e&&(s.width=e-s.x,s.height=s.width/n),(a=g3(i="%"===r.unit?g4(s,e,t):s,e,t)).x=(e-a.width)/2,a.y=(t-a.height)/2,"%"===i.unit?g4(a,e,t):a}async function yl(e,t,n,r){return new Promise((i,s)=>{let a=new Image;a.crossOrigin="anonymous",a.onload=()=>{let e=document.createElement("canvas"),o=e.getContext("2d");if(!o)return void s(Error("No 2d context"));let l=a.naturalWidth/n,u=a.naturalHeight/r;e.width=t.width*l,e.height=t.height*u,o.drawImage(a,t.x*l,t.y*u,t.width*l,t.height*u,0,0,e.width,e.height),i(e.toDataURL("image/jpeg",.95))},a.onerror=()=>s(Error("Failed to load image")),a.src=e})}let yu=({mockups:e,onSave:t,onClose:n})=>{let[r,i]=(0,tG.useState)(0),[s,a]=(0,tG.useState)(ya[0]),[o,l]=(0,tG.useState)(new Map),[u,c]=(0,tG.useState)(new Map),[h,d]=(0,tG.useState)(new Map),[p,f]=(0,tG.useState)(!1),[m,g]=(0,tG.useState)(new Set),y=(0,tG.useRef)(null),v=e[r],b=(0,tG.useRef)(s.ratio);(0,tG.useEffect)(()=>{if(b.current!==s.ratio&&h.size>0){b.current=s.ratio;let e=new Map,t=new Map;h.forEach((n,r)=>{let i=yo(n.width,n.height,s.ratio);e.set(r,i);let a={unit:"px",x:i.x/100*n.width,y:i.y/100*n.height,width:i.width/100*n.width,height:i.height/100*n.height};t.set(r,a)}),l(e),c(t)}},[s.ratio,h]);let x=async()=>{f(!0);try{let n=await Promise.all(e.map(async e=>{let t=u.get(e.id),n=h.get(e.id);if(t&&t.width&&t.height&&n){let r=await yl(e.imageUrl,t,n.width,n.height);return{...e,imageUrl:r}}return e}));t(n)}catch(e){console.error("Failed to crop images:",e)}finally{f(!1)}};return(0,tB.jsxs)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:[(0,tB.jsx)("div",{className:"hidden",children:e.map(e=>(0,tB.jsx)("img",{src:e.imageUrl,alt:"",onLoad:t=>((e,t)=>{let n=e.currentTarget,r={width:n.naturalWidth,height:n.naturalHeight};if(!h.has(t)){d(e=>new Map(e).set(t,r)),g(e=>new Set(e).add(t));let e=yo(r.width,r.height,s.ratio);l(n=>n.has(t)?n:new Map(n).set(t,e));let n={unit:"px",x:e.x/100*r.width,y:e.y/100*r.height,width:e.width/100*r.width,height:e.height/100*r.height};c(e=>e.has(t)?e:new Map(e).set(t,n))}})(t,e.id),crossOrigin:"anonymous"},`preload-${e.id}`))}),(0,tB.jsxs)("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col shadow-2xl",children:[(0,tB.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-slate-200",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-3",children:[(0,tB.jsx)("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center",children:(0,tB.jsx)(ys,{size:20,className:"text-white"})}),(0,tB.jsxs)("div",{children:[(0,tB.jsx)("h2",{className:"font-display font-semibold text-slate-800",children:"Crop Images"}),(0,tB.jsx)("p",{className:"text-xs text-slate-500",children:"Choose an aspect ratio for all images"})]})]}),(0,tB.jsx)("button",{onClick:n,className:"w-8 h-8 rounded-lg hover:bg-slate-100 flex items-center justify-center transition-colors",children:(0,tB.jsx)(gm,{size:20,className:"text-slate-500"})})]}),(0,tB.jsx)("div",{className:"p-4 bg-slate-50 border-b border-slate-200",children:(0,tB.jsx)("div",{className:"flex items-center gap-2 justify-center",children:ya.map(e=>(0,tB.jsxs)("button",{onClick:()=>a(e),className:`
                  flex items-center gap-2 px-4 py-2.5 rounded-xl font-medium text-sm transition-all
                  ${s.id===e.id?"bg-indigo-600 text-white shadow-lg shadow-indigo-500/25":"bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:text-indigo-600"}
                `,children:[e.icon,(0,tB.jsx)("span",{children:e.label}),(0,tB.jsx)("span",{className:`text-xs ${s.id===e.id?"text-indigo-200":"text-slate-400"}`,children:e.description})]},e.id))})}),(0,tB.jsxs)("div",{className:"flex-1 overflow-hidden flex flex-col items-center justify-center p-6 bg-slate-100 relative min-h-[400px]",children:[e.length>1&&(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)("button",{onClick:()=>{i(t=>t>0?t-1:e.length-1)},className:"absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-white shadow-lg text-slate-700 flex items-center justify-center hover:bg-slate-50 transition-all z-10",children:(0,tB.jsx)(gE,{size:24})}),(0,tB.jsx)("button",{onClick:()=>{i(t=>t<e.length-1?t+1:0)},className:"absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-white shadow-lg text-slate-700 flex items-center justify-center hover:bg-slate-50 transition-all z-10",children:(0,tB.jsx)(g_,{size:24})})]}),e.length>1&&(0,tB.jsxs)("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 bg-white/90 backdrop-blur-sm px-3 py-1.5 rounded-full text-sm font-medium text-slate-700 shadow-sm z-10",children:[r+1," / ",e.length]}),(0,tB.jsx)("div",{className:"max-w-full max-h-[50vh] overflow-hidden rounded-xl shadow-lg",children:(0,tB.jsx)(ye,{crop:o.get(v.id),onChange:e=>{l(t=>new Map(t).set(v.id,e))},onComplete:e=>{y.current&&(c(t=>new Map(t).set(v.id,e)),d(e=>new Map(e).set(v.id,{width:y.current.width,height:y.current.height})))},aspect:s.ratio,className:"max-h-[50vh]",children:(0,tB.jsx)("img",{ref:y,src:v.imageUrl,alt:`Crop ${r+1}`,onLoad:e=>{let t=e.currentTarget,n=v.id,r={width:t.width,height:t.height};d(e=>new Map(e).set(n,r)),g(e=>new Set(e).add(n)),l(e=>{if(e.has(n))return e;let r=yo(t.width,t.height,s.ratio);return new Map(e).set(n,r)}),c(e=>{if(e.has(n))return e;let r=yo(t.width,t.height,s.ratio),i={unit:"px",x:r.x/100*t.width,y:r.y/100*t.height,width:r.width/100*t.width,height:r.height/100*t.height};return new Map(e).set(n,i)})},className:"max-h-[50vh] max-w-full",crossOrigin:"anonymous"},v.id)})}),e.length>1&&(0,tB.jsx)("div",{className:"flex gap-2 mt-4 overflow-x-auto py-2",children:e.map((e,t)=>{let n=u.has(e.id);return(0,tB.jsxs)("button",{onClick:()=>i(t),className:`
                      relative flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 transition-all bg-white
                      ${t===r?"border-indigo-500 shadow-md shadow-indigo-500/20":"border-transparent hover:border-slate-300 opacity-70 hover:opacity-100"}
                    `,children:[(0,tB.jsx)("img",{src:e.imageUrl,alt:`Thumbnail ${t+1}`,className:"w-full h-full object-cover"}),n&&(0,tB.jsx)("div",{className:"absolute top-1 right-1 w-4 h-4 rounded-full bg-emerald-500 flex items-center justify-center",children:(0,tB.jsx)(gf,{size:10,className:"text-white",strokeWidth:3})})]},e.id)})})]}),(0,tB.jsxs)("div",{className:"p-4 border-t border-slate-200 flex items-center justify-between bg-white",children:[(0,tB.jsxs)("p",{className:"text-sm text-slate-500",children:[(0,tB.jsx)("span",{className:"font-medium text-slate-700",children:s.label})," ratio will be applied to all ",e.length," image",e.length>1?"s":""]}),(0,tB.jsxs)("div",{className:"flex gap-3",children:[(0,tB.jsx)("button",{onClick:n,className:"px-5 py-2.5 rounded-xl font-medium text-slate-600 hover:bg-slate-100 transition-colors",children:"Cancel"}),(0,tB.jsx)("button",{onClick:x,disabled:p,className:"px-5 py-2.5 rounded-xl font-semibold text-white bg-gradient-to-r from-indigo-600 to-purple-600 shadow-lg shadow-indigo-500/25 hover:shadow-xl hover:-translate-y-0.5 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:translate-y-0 flex items-center gap-2",children:p?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Processing..."]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(gf,{size:18}),"Apply Crop"]})})]})]})]})]})},yc=tW("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),yh=tW("facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]),yd=tW("instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]),yp=tW("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),yf=[{hour:9,minute:0,label:"9:00 AM",reason:"Morning engagement peak"},{hour:12,minute:0,label:"12:00 PM",reason:"Lunch break browsing"},{hour:17,minute:0,label:"5:00 PM",reason:"End of workday"},{hour:19,minute:0,label:"7:00 PM",reason:"Evening prime time"}],ym=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],yg=["January","February","March","April","May","June","July","August","September","October","November","December"],yy=({isOpen:e,onClose:t,onSchedule:n,platforms:r,mockups:i,captions:s})=>{let a,o,l,[u,c]=(0,tG.useState)(null),[h,d]=(0,tG.useState)(null),[p,f]=(0,tG.useState)(""),[m,g]=(0,tG.useState)(new Date),[y,v]=(0,tG.useState)(!1),[b,x]=(0,tG.useState)(!1),[w,E]=(0,tG.useState)("date");if((0,tG.useEffect)(()=>{e&&(c(null),d(null),f(""),g(new Date),v(!1),x(!1),E("date"))},[e]),!e)return null;let _=new Date;_.setHours(0,0,0,0);let{daysInMonth:I,startingDay:C,year:T,month:S}=(a=m.getFullYear(),l=new Date(a,o=m.getMonth(),1),{daysInMonth:new Date(a,o+1,0).getDate(),startingDay:l.getDay(),year:a,month:o}),N=()=>{if(!u)return null;let e=h||(()=>{if(!p)return null;let[e,t]=p.split(":").map(Number);return isNaN(e)||isNaN(t)?null:{hour:e,minute:t}})();if(!e)return null;let t=new Date(u);return t.setHours(e.hour,e.minute,0,0),t},A=async()=>{let e=N();if(e){v(!0);try{await n(e,r),x(!0),setTimeout(()=>{t()},2e3)}catch(e){console.error("Failed to schedule:",e),v(!1)}}},k=e=>e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"});return b?(0,tB.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,tB.jsxs)("div",{className:"bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 text-center animate-in zoom-in duration-300",children:[(0,tB.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg shadow-emerald-500/30",children:(0,tB.jsx)(gg,{className:"w-10 h-10 text-white"})}),(0,tB.jsx)("h3",{className:"text-2xl font-display font-bold text-slate-900 mb-2",children:"Scheduled!"}),(0,tB.jsxs)("p",{className:"text-slate-500 mb-4",children:["Your post will be published on",(0,tB.jsx)("br",{}),(0,tB.jsx)("span",{className:"font-semibold text-slate-700",children:k(N())})]}),(0,tB.jsxs)("button",{onClick:t,className:"text-indigo-600 font-medium flex items-center gap-2 mx-auto hover:text-indigo-700 transition-colors",children:[(0,tB.jsx)(yc,{className:"w-4 h-4"}),"View in Calendar"]})]})}):(0,tB.jsx)("div",{className:"fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4",children:(0,tB.jsxs)("div",{className:"bg-white rounded-3xl shadow-2xl max-w-2xl w-full overflow-hidden animate-in fade-in slide-in-from-bottom-4 duration-300",children:[(0,tB.jsxs)("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-5 text-white",children:[(0,tB.jsxs)("div",{className:"flex items-center justify-between",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-3",children:[(0,tB.jsx)("div",{className:"w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center",children:(0,tB.jsx)(yc,{className:"w-5 h-5"})}),(0,tB.jsxs)("div",{children:[(0,tB.jsx)("h2",{className:"text-xl font-display font-bold",children:"Schedule Post"}),(0,tB.jsx)("p",{className:"text-indigo-200 text-sm",children:"Choose when to publish"})]})]}),(0,tB.jsx)("button",{onClick:t,className:"w-8 h-8 rounded-lg bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors",children:(0,tB.jsx)(gm,{className:"w-5 h-5"})})]}),(0,tB.jsx)("div",{className:"flex items-center gap-2 mt-5",children:["date","time","confirm"].map((e,t)=>(0,tB.jsxs)(tG.default.Fragment,{children:[(0,tB.jsxs)("div",{className:`
                  flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium transition-all
                  ${w===e?"bg-white text-indigo-600":["date","time","confirm"].indexOf(w)>t?"bg-white/30 text-white":"bg-white/10 text-indigo-200"}
                `,children:[(0,tB.jsx)("span",{className:"w-5 h-5 rounded-full bg-current/20 flex items-center justify-center text-xs",children:t+1}),(0,tB.jsx)("span",{className:"capitalize",children:e})]}),t<2&&(0,tB.jsx)("div",{className:"flex-1 h-0.5 bg-white/20 rounded"})]},e))})]}),(0,tB.jsxs)("div",{className:"p-6",children:["date"===w&&(0,tB.jsxs)("div",{className:"animate-in fade-in duration-200",children:[(0,tB.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,tB.jsx)("button",{onClick:()=>g(new Date(T,S-1)),className:"p-2 rounded-lg hover:bg-slate-100 transition-colors",children:(0,tB.jsx)(gE,{className:"w-5 h-5 text-slate-600"})}),(0,tB.jsxs)("h3",{className:"text-lg font-display font-semibold text-slate-800",children:[yg[S]," ",T]}),(0,tB.jsx)("button",{onClick:()=>g(new Date(T,S+1)),className:"p-2 rounded-lg hover:bg-slate-100 transition-colors",children:(0,tB.jsx)(g_,{className:"w-5 h-5 text-slate-600"})})]}),(0,tB.jsxs)("div",{className:"grid grid-cols-7 gap-1 mb-4",children:[ym.map(e=>(0,tB.jsx)("div",{className:"text-center text-xs font-semibold text-slate-400 py-2",children:e},e)),Array.from({length:C}).map((e,t)=>(0,tB.jsx)("div",{},`empty-${t}`)),Array.from({length:I}).map((e,t)=>{let n=t+1,r=new Date(T,S,n),i=r<_,s=u?.getDate()===n&&u?.getMonth()===S&&u?.getFullYear()===T,a=r.toDateString()===new Date().toDateString();return(0,tB.jsxs)("button",{onClick:()=>{let e;(e=new Date(T,S,n))>=_&&(c(e),E("time"))},disabled:i,className:`
                        relative p-2 rounded-xl text-sm font-medium transition-all
                        ${i?"text-slate-300 cursor-not-allowed":"hover:bg-indigo-50 cursor-pointer"}
                        ${s?"bg-indigo-600 text-white hover:bg-indigo-700":""}
                        ${a&&!s?"ring-2 ring-indigo-300 ring-inset":""}
                      `,children:[n,a&&!s&&(0,tB.jsx)("div",{className:"absolute bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-indigo-500"})]},n)})]}),u&&(0,tB.jsx)("button",{onClick:()=>E("time"),className:"w-full py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg shadow-indigo-500/25",children:"Continue to Time Selection"})]}),"time"===w&&(0,tB.jsxs)("div",{className:"animate-in fade-in duration-200",children:[(0,tB.jsxs)("button",{onClick:()=>E("date"),className:"flex items-center gap-1 text-sm text-slate-500 hover:text-slate-700 mb-4 transition-colors",children:[(0,tB.jsx)(gE,{className:"w-4 h-4"}),"Back to date"]}),(0,tB.jsx)("div",{className:"bg-indigo-50 rounded-xl p-4 mb-6",children:(0,tB.jsxs)("p",{className:"text-sm text-indigo-600 font-medium flex items-center gap-2",children:[(0,tB.jsx)(yc,{className:"w-4 h-4"}),u?.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})]})}),(0,tB.jsxs)("h4",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide mb-3 flex items-center gap-2",children:[(0,tB.jsx)(gd,{className:"w-4 h-4 text-amber-500"}),"Suggested Times"]}),(0,tB.jsx)("div",{className:"grid grid-cols-2 gap-3 mb-6",children:yf.map(e=>{let t=h?.hour===e.hour&&h?.minute===e.minute;return(0,tB.jsxs)("button",{onClick:()=>{d({hour:e.hour,minute:e.minute}),f("")},className:`
                        time-slot p-4 rounded-xl border-2 text-left
                        ${t?"border-indigo-500 bg-indigo-50":"border-slate-200 hover:border-indigo-300 hover:bg-slate-50"}
                      `,children:[(0,tB.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,tB.jsx)(tY,{className:`w-4 h-4 ${t?"text-indigo-600":"text-slate-400"}`}),(0,tB.jsx)("span",{className:`font-semibold ${t?"text-indigo-600":"text-slate-700"}`,children:e.label})]}),(0,tB.jsx)("p",{className:"text-xs text-slate-500",children:e.reason})]},e.label)})}),(0,tB.jsxs)("div",{className:"relative mb-6",children:[(0,tB.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,tB.jsx)("div",{className:"w-full border-t border-slate-200"})}),(0,tB.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,tB.jsx)("span",{className:"px-3 bg-white text-slate-400",children:"or choose custom time"})})]}),(0,tB.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,tB.jsx)(tY,{className:"w-5 h-5 text-slate-400"}),(0,tB.jsx)("input",{type:"time",value:p,onChange:e=>{f(e.target.value),d(null)},className:`
                    flex-1 px-4 py-3 rounded-xl border-2 outline-none transition-all
                    ${p?"border-indigo-500 bg-indigo-50":"border-slate-200 focus:border-indigo-400"}
                  `})]}),(0,tB.jsx)("button",{onClick:()=>{N()&&E("confirm")},disabled:!h&&!p,className:"w-full py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg shadow-indigo-500/25 disabled:opacity-50 disabled:cursor-not-allowed",children:"Review & Confirm"})]}),"confirm"===w&&(0,tB.jsxs)("div",{className:"animate-in fade-in duration-200",children:[(0,tB.jsxs)("button",{onClick:()=>E("time"),className:"flex items-center gap-1 text-sm text-slate-500 hover:text-slate-700 mb-4 transition-colors",children:[(0,tB.jsx)(gE,{className:"w-4 h-4"}),"Back to time"]}),(0,tB.jsx)("div",{className:"bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl p-5 mb-6 border border-indigo-100",children:(0,tB.jsxs)("div",{className:"flex items-start gap-4",children:[(0,tB.jsx)("div",{className:"w-12 h-12 rounded-xl bg-white shadow-sm flex items-center justify-center",children:(0,tB.jsx)(yc,{className:"w-6 h-6 text-indigo-600"})}),(0,tB.jsxs)("div",{children:[(0,tB.jsx)("p",{className:"text-sm text-slate-500 mb-1",children:"Scheduled for"}),(0,tB.jsx)("p",{className:"text-lg font-display font-bold text-slate-800",children:k(N())})]})]})}),(0,tB.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,tB.jsx)("span",{className:"text-sm text-slate-500",children:"Posting to:"}),(0,tB.jsxs)("div",{className:"flex items-center gap-2",children:[r.includes("instagram")&&(0,tB.jsxs)("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-pink-50 rounded-full",children:[(0,tB.jsx)(yd,{className:"w-4 h-4 text-pink-600"}),(0,tB.jsx)("span",{className:"text-sm font-medium text-pink-600",children:"Instagram"})]}),r.includes("facebook")&&(0,tB.jsxs)("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-50 rounded-full",children:[(0,tB.jsx)(yh,{className:"w-4 h-4 text-blue-600"}),(0,tB.jsx)("span",{className:"text-sm font-medium text-blue-600",children:"Facebook"})]})]})]}),(0,tB.jsx)("div",{className:"bg-slate-50 rounded-xl p-4 mb-6",children:(0,tB.jsxs)("div",{className:"flex gap-4",children:[i[0]&&(0,tB.jsx)("img",{src:i[0].imageUrl,alt:"Preview",className:"w-20 h-20 rounded-lg object-cover"}),(0,tB.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,tB.jsx)("p",{className:"text-sm text-slate-600 line-clamp-3",children:s.instagram||s.facebook}),i.length>1&&(0,tB.jsxs)("p",{className:"text-xs text-slate-400 mt-2",children:["+",i.length-1," more image",i.length>2?"s":""]})]})]})}),(0,tB.jsx)("button",{onClick:A,disabled:y,className:"w-full py-4 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg shadow-indigo-500/25 flex items-center justify-center gap-2 disabled:opacity-70",children:y?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Scheduling..."]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(yp,{className:"w-5 h-5"}),"Schedule Post"]})})]})]})]})})},yv=tW("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),yb=tW("unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]),yx=tW("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),yw=tW("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),yE=tW("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),y_=tW("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),yI=tW("grip-vertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),yC=tW("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),yT=tW("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),yS=tW("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var yN=e.i(74080);let yA="u">typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function yk(e){let t=Object.prototype.toString.call(e);return"[object Window]"===t||"[object global]"===t}function yO(e){return"nodeType"in e}function yR(e){var t,n;return e?yk(e)?e:yO(e)&&null!=(t=null==(n=e.ownerDocument)?void 0:n.defaultView)?t:window:window}function yD(e){let{Document:t}=yR(e);return e instanceof t}function yj(e){return!yk(e)&&e instanceof yR(e).HTMLElement}function yP(e){return e instanceof yR(e).SVGElement}function yM(e){return e?yk(e)?e.document:yO(e)?yD(e)?e:yj(e)||yP(e)?e.ownerDocument:document:document:document}let yU=yA?tG.useLayoutEffect:tG.useEffect;function yL(e){let t=(0,tG.useRef)(e);return yU(()=>{t.current=e}),(0,tG.useCallback)(function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return null==t.current?void 0:t.current(...n)},[])}function yF(e,t){void 0===t&&(t=[e]);let n=(0,tG.useRef)(e);return yU(()=>{n.current!==e&&(n.current=e)},t),n}function yV(e,t){let n=(0,tG.useRef)();return(0,tG.useMemo)(()=>{let t=e(n.current);return n.current=t,t},[...t])}function yq(e){let t=yL(e),n=(0,tG.useRef)(null),r=(0,tG.useCallback)(e=>{e!==n.current&&(null==t||t(e,n.current)),n.current=e},[]);return[n,r]}function yB(e){let t=(0,tG.useRef)();return(0,tG.useEffect)(()=>{t.current=e},[e]),t.current}let yG={};function yz(e,t){return(0,tG.useMemo)(()=>{if(t)return t;let n=null==yG[e]?0:yG[e]+1;return yG[e]=n,e+"-"+n},[e,t])}function yH(e){return function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.reduce((t,n)=>{for(let[r,i]of Object.entries(n)){let n=t[r];null!=n&&(t[r]=n+e*i)}return t},{...t})}}let y$=yH(1),yK=yH(-1);function yW(e){if(!e)return!1;let{KeyboardEvent:t}=yR(e.target);return t&&e instanceof t}function yJ(e){if(function(e){if(!e)return!1;let{TouchEvent:t}=yR(e.target);return t&&e instanceof t}(e)){if(e.touches&&e.touches.length){let{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){let{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return"clientX"in e&&"clientY"in e?{x:e.clientX,y:e.clientY}:null}let yY=Object.freeze({Translate:{toString(e){if(!e)return;let{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;let{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[yY.Translate.toString(e),yY.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),yX="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]",yQ={display:"none"};function yZ(e){let{id:t,value:n}=e;return tG.default.createElement("div",{id:t,style:yQ},n)}function y0(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;return tG.default.createElement("div",{id:t,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":r,"aria-atomic":!0},n)}let y1=(0,tG.createContext)(null),y2={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},y5={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function y6(e){var t;let n,{announcements:r=y5,container:i,hiddenTextDescribedById:s,screenReaderInstructions:a=y2}=e,{announce:o,announcement:l}=function(){let[e,t]=(0,tG.useState)("");return{announce:(0,tG.useCallback)(e=>{null!=e&&t(e)},[]),announcement:e}}(),u=yz("DndLiveRegion"),[c,h]=(0,tG.useState)(!1);if((0,tG.useEffect)(()=>{h(!0)},[]),t=(0,tG.useMemo)(()=>({onDragStart(e){let{active:t}=e;o(r.onDragStart({active:t}))},onDragMove(e){let{active:t,over:n}=e;r.onDragMove&&o(r.onDragMove({active:t,over:n}))},onDragOver(e){let{active:t,over:n}=e;o(r.onDragOver({active:t,over:n}))},onDragEnd(e){let{active:t,over:n}=e;o(r.onDragEnd({active:t,over:n}))},onDragCancel(e){let{active:t,over:n}=e;o(r.onDragCancel({active:t,over:n}))}}),[o,r]),n=(0,tG.useContext)(y1),(0,tG.useEffect)(()=>{if(!n)throw Error("useDndMonitor must be used within a children of <DndContext>");return n(t)},[t,n]),!c)return null;let d=tG.default.createElement(tG.default.Fragment,null,tG.default.createElement(yZ,{id:s,value:a.draggable}),tG.default.createElement(y0,{id:u,announcement:l}));return i?(0,yN.createPortal)(d,i):d}function y4(){}function y3(e,t){return(0,tG.useMemo)(()=>({sensor:e,options:null!=t?t:{}}),[e,t])}(ep=tR||(tR={})).DragStart="dragStart",ep.DragMove="dragMove",ep.DragEnd="dragEnd",ep.DragCancel="dragCancel",ep.DragOver="dragOver",ep.RegisterDroppable="registerDroppable",ep.SetDroppableDisabled="setDroppableDisabled",ep.UnregisterDroppable="unregisterDroppable";let y8=Object.freeze({x:0,y:0});function y7(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function y9(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function ve(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function vt(e){let{left:t,top:n,height:r,width:i}=e;return[{x:t,y:n},{x:t+i,y:n},{x:t,y:n+r},{x:t+i,y:n+r}]}function vn(e,t){if(!e||0===e.length)return null;let[n]=e;return t?n[t]:n}function vr(e,t,n){return void 0===t&&(t=e.left),void 0===n&&(n=e.top),{x:t+.5*e.width,y:n+.5*e.height}}let vi=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e,i=vr(t,t.left,t.top),s=[];for(let e of r){let{id:t}=e,r=n.get(t);if(r){let n=y7(vr(r),i);s.push({id:t,data:{droppableContainer:e,value:n}})}}return s.sort(y9)},vs=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e,i=[];for(let e of r){let{id:r}=e,s=n.get(r);if(s){let n=function(e,t){let n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),i=Math.min(t.left+t.width,e.left+e.width),s=Math.min(t.top+t.height,e.top+e.height);if(r<i&&n<s){let a=t.width*t.height,o=e.width*e.height,l=(i-r)*(s-n);return Number((l/(a+o-l)).toFixed(4))}return 0}(s,t);n>0&&i.push({id:r,data:{droppableContainer:e,value:n}})}}return i.sort(ve)};function va(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:y8}let vo=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((e,t)=>({...e,top:e.top+ +t.y,bottom:e.bottom+ +t.y,left:e.left+ +t.x,right:e.right+ +t.x}),{...e})},vl={ignoreTransform:!1};function vu(e,t){void 0===t&&(t=vl);let n=e.getBoundingClientRect();if(t.ignoreTransform){let{transform:t,transformOrigin:r}=yR(e).getComputedStyle(e);t&&(n=function(e,t,n){let r=function(e){if(e.startsWith("matrix3d(")){let t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}if(e.startsWith("matrix(")){let t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}(t);if(!r)return e;let{scaleX:i,scaleY:s,x:a,y:o}=r,l=e.left-a-(1-i)*parseFloat(n),u=e.top-o-(1-s)*parseFloat(n.slice(n.indexOf(" ")+1)),c=i?e.width/i:e.width,h=s?e.height/s:e.height;return{width:c,height:h,top:u,right:l+c,bottom:u+h,left:l}}(n,t,r))}let{top:r,left:i,width:s,height:a,bottom:o,right:l}=n;return{top:r,left:i,width:s,height:a,bottom:o,right:l}}function vc(e){return vu(e,{ignoreTransform:!0})}function vh(e,t){let n=[];return e?function r(i){var s,a;let o;if(null!=t&&n.length>=t||!i)return n;if(yD(i)&&null!=i.scrollingElement&&!n.includes(i.scrollingElement))return n.push(i.scrollingElement),n;if(!yj(i)||yP(i)||n.includes(i))return n;let l=yR(e).getComputedStyle(i);return(i!==e&&(void 0===(s=l)&&(s=yR(i).getComputedStyle(i)),o=/(auto|scroll|overlay)/,["overflow","overflowX","overflowY"].some(e=>{let t=s[e];return"string"==typeof t&&o.test(t)}))&&n.push(i),void 0===(a=l)&&(a=yR(i).getComputedStyle(i)),"fixed"===a.position)?n:r(i.parentNode)}(e):n}function vd(e){let[t]=vh(e,1);return null!=t?t:null}function vp(e){return yA&&e?yk(e)?e:yO(e)?yD(e)||e===yM(e).scrollingElement?window:yj(e)?e:null:null:null}function vf(e){return yk(e)?e.scrollX:e.scrollLeft}function vm(e){return yk(e)?e.scrollY:e.scrollTop}function vg(e){return{x:vf(e),y:vm(e)}}function vy(e){return!!yA&&!!e&&e===document.scrollingElement}function vv(e){let t={x:0,y:0},n=vy(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},i=e.scrollTop<=t.y,s=e.scrollLeft<=t.x;return{isTop:i,isLeft:s,isBottom:e.scrollTop>=r.y,isRight:e.scrollLeft>=r.x,maxScroll:r,minScroll:t}}(ef=tD||(tD={}))[ef.Forward=1]="Forward",ef[ef.Backward=-1]="Backward";let vb={x:.2,y:.2};function vx(e){return e.reduce((e,t)=>y$(e,vg(t)),y8)}let vw=[["x",["left","right"],function(e){return e.reduce((e,t)=>e+vf(t),0)}],["y",["top","bottom"],function(e){return e.reduce((e,t)=>e+vm(t),0)}]];class vE{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const n=vh(t),r=vx(n);for(const[t,i,s]of(this.rect={...e},this.width=e.width,this.height=e.height,vw))for(const e of i)Object.defineProperty(this,e,{get:()=>{let i=s(n),a=r[t]-i;return this.rect[e]+a},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class v_{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var t;return null==(t=this.target)?void 0:t.removeEventListener(...e)})},this.target=e}add(e,t,n){var r;null==(r=this.target)||r.addEventListener(e,t,n),this.listeners.push([e,t,n])}}function vI(e,t){let n=Math.abs(e.x),r=Math.abs(e.y);return"number"==typeof t?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t&&r>t.y}function vC(e){e.preventDefault()}function vT(e){e.stopPropagation()}(em=tj||(tj={})).Click="click",em.DragStart="dragstart",em.Keydown="keydown",em.ContextMenu="contextmenu",em.Resize="resize",em.SelectionChange="selectionchange",em.VisibilityChange="visibilitychange",(eg=tP||(tP={})).Space="Space",eg.Down="ArrowDown",eg.Right="ArrowRight",eg.Left="ArrowLeft",eg.Up="ArrowUp",eg.Esc="Escape",eg.Enter="Enter",eg.Tab="Tab";let vS={start:[tP.Space,tP.Enter],cancel:[tP.Esc],end:[tP.Space,tP.Enter,tP.Tab]},vN=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case tP.Right:return{...n,x:n.x+25};case tP.Left:return{...n,x:n.x-25};case tP.Down:return{...n,y:n.y+25};case tP.Up:return{...n,y:n.y-25}}};class vA{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new v_(yM(t)),this.windowListeners=new v_(yR(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(tj.Resize,this.handleCancel),this.windowListeners.add(tj.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(tj.Keydown,this.handleKeyDown))}handleStart(){let{activeNode:e,onStart:t}=this.props,n=e.node.current;n&&function(e,t){if(void 0===t&&(t=vu),!e)return;let{top:n,left:r,bottom:i,right:s}=t(e);vd(e)&&(i<=0||s<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}(n),t(y8)}handleKeyDown(e){if(yW(e)){let{active:t,context:n,options:r}=this.props,{keyboardCodes:i=vS,coordinateGetter:s=vN,scrollBehavior:a="smooth"}=r,{code:o}=e;if(i.end.includes(o))return void this.handleEnd(e);if(i.cancel.includes(o))return void this.handleCancel(e);let{collisionRect:l}=n.current,u=l?{x:l.left,y:l.top}:y8;this.referenceCoordinates||(this.referenceCoordinates=u);let c=s(e,{active:t,context:n.current,currentCoordinates:u});if(c){let t=yK(c,u),r={x:0,y:0},{scrollableAncestors:i}=n.current;for(let n of i){let i=e.code,{isTop:s,isRight:o,isLeft:l,isBottom:u,maxScroll:h,minScroll:d}=vv(n),p=function(e){if(e===document.scrollingElement){let{innerWidth:e,innerHeight:t}=window;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}let{top:t,left:n,right:r,bottom:i}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:i,width:e.clientWidth,height:e.clientHeight}}(n),f={x:Math.min(i===tP.Right?p.right-p.width/2:p.right,Math.max(i===tP.Right?p.left:p.left+p.width/2,c.x)),y:Math.min(i===tP.Down?p.bottom-p.height/2:p.bottom,Math.max(i===tP.Down?p.top:p.top+p.height/2,c.y))},m=i===tP.Right&&!o||i===tP.Left&&!l,g=i===tP.Down&&!u||i===tP.Up&&!s;if(m&&f.x!==c.x){let e=n.scrollLeft+t.x,s=i===tP.Right&&e<=h.x||i===tP.Left&&e>=d.x;if(s&&!t.y)return void n.scrollTo({left:e,behavior:a});s?r.x=n.scrollLeft-e:r.x=i===tP.Right?n.scrollLeft-h.x:n.scrollLeft-d.x,r.x&&n.scrollBy({left:-r.x,behavior:a});break}if(g&&f.y!==c.y){let e=n.scrollTop+t.y,s=i===tP.Down&&e<=h.y||i===tP.Up&&e>=d.y;if(s&&!t.x)return void n.scrollTo({top:e,behavior:a});s?r.y=n.scrollTop-e:r.y=i===tP.Down?n.scrollTop-h.y:n.scrollTop-d.y,r.y&&n.scrollBy({top:-r.y,behavior:a});break}}this.handleMove(e,y$(yK(c,this.referenceCoordinates),r))}}}handleMove(e,t){let{onMove:n}=this.props;e.preventDefault(),n(t)}handleEnd(e){let{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){let{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function vk(e){return!!(e&&"distance"in e)}function vO(e){return!!(e&&"delay"in e)}vA.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=vS,onActivation:i}=t,{active:s}=n,{code:a}=e.nativeEvent;if(r.start.includes(a)){let t=s.activatorNode.current;return(!t||e.target===t)&&(e.preventDefault(),null==i||i({event:e.nativeEvent}),!0)}return!1}}];class vR{constructor(e,t,n){var r;void 0===n&&(n=function(e){let{EventTarget:t}=yR(e);return e instanceof t?e:yM(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:i}=e,{target:s}=i;this.props=e,this.events=t,this.document=yM(s),this.documentListeners=new v_(this.document),this.listeners=new v_(n),this.windowListeners=new v_(yR(s)),this.initialCoordinates=null!=(r=yJ(i))?r:y8,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){let{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:n}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(tj.Resize,this.handleCancel),this.windowListeners.add(tj.DragStart,vC),this.windowListeners.add(tj.VisibilityChange,this.handleCancel),this.windowListeners.add(tj.ContextMenu,vC),this.documentListeners.add(tj.Keydown,this.handleKeydown),t){if(null!=n&&n({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(vO(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(vk(t))return void this.handlePending(t)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){let{active:n,onPending:r}=this.props;r(n,e,this.initialCoordinates,t)}handleStart(){let{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(tj.Click,vT,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(tj.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;let{activated:n,initialCoordinates:r,props:i}=this,{onMove:s,options:{activationConstraint:a}}=i;if(!r)return;let o=null!=(t=yJ(e))?t:y8,l=yK(r,o);if(!n&&a){if(vk(a)){if(null!=a.tolerance&&vI(l,a.tolerance))return this.handleCancel();if(vI(l,a.distance))return this.handleStart()}return vO(a)&&vI(l,a.tolerance)?this.handleCancel():void this.handlePending(a,l)}e.cancelable&&e.preventDefault(),s(o)}handleEnd(){let{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){let{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===tP.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}let vD={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class vj extends vR{constructor(e){const{event:t}=e;super(e,vD,yM(t.target))}}vj.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!!n.isPrimary&&0===n.button&&(null==r||r({event:n}),!0)}}];(ey=tM||(tM={}))[ey.RightClick=2]="RightClick";(ev=tU||(tU={}))[ev.Pointer=0]="Pointer",ev[ev.DraggableRect=1]="DraggableRect",(eb=tL||(tL={}))[eb.TreeOrder=0]="TreeOrder",eb[eb.ReversedTreeOrder=1]="ReversedTreeOrder";let vP={x:{[tD.Backward]:!1,[tD.Forward]:!1},y:{[tD.Backward]:!1,[tD.Forward]:!1}};(ex=tF||(tF={}))[ex.Always=0]="Always",ex[ex.BeforeDragging=1]="BeforeDragging",ex[ex.WhileDragging=2]="WhileDragging",(tV||(tV={})).Optimized="optimized";let vM=new Map;function vU(e,t){return yV(n=>e?n||("function"==typeof t?t(e):e):null,[t,e])}function vL(e){let{callback:t,disabled:n}=e,r=yL(t),i=(0,tG.useMemo)(()=>{if(n||"u"<typeof window||void 0===window.ResizeObserver)return;let{ResizeObserver:e}=window;return new e(r)},[n]);return(0,tG.useEffect)(()=>()=>null==i?void 0:i.disconnect(),[i]),i}function vF(e){return new vE(vu(e),e)}function vV(e,t,n){void 0===t&&(t=vF);let[r,i]=(0,tG.useState)(null);function s(){i(r=>{if(!e)return null;if(!1===e.isConnected){var i;return null!=(i=null!=r?r:n)?i:null}let s=t(e);return JSON.stringify(r)===JSON.stringify(s)?r:s})}let a=function(e){let{callback:t,disabled:n}=e,r=yL(t),i=(0,tG.useMemo)(()=>{if(n||"u"<typeof window||void 0===window.MutationObserver)return;let{MutationObserver:e}=window;return new e(r)},[r,n]);return(0,tG.useEffect)(()=>()=>null==i?void 0:i.disconnect(),[i]),i}({callback(t){if(e)for(let n of t){let{type:t,target:r}=n;if("childList"===t&&r instanceof HTMLElement&&r.contains(e)){s();break}}}}),o=vL({callback:s});return yU(()=>{s(),e?(null==o||o.observe(e),null==a||a.observe(document.body,{childList:!0,subtree:!0})):(null==o||o.disconnect(),null==a||a.disconnect())},[e]),r}let vq=[];function vB(e,t){void 0===t&&(t=[]);let n=(0,tG.useRef)(null);return(0,tG.useEffect)(()=>{n.current=null},t),(0,tG.useEffect)(()=>{let t=e!==y8;t&&!n.current&&(n.current=e),!t&&n.current&&(n.current=null)},[e]),n.current?yK(e,n.current):y8}function vG(e){return(0,tG.useMemo)(()=>{let t,n;return e?(t=e.innerWidth,{top:0,left:0,right:t,bottom:n=e.innerHeight,width:t,height:n}):null},[e])}let vz=[],vH=[{sensor:vj,options:{}},{sensor:vA,options:{}}],v$={current:{}},vK={draggable:{measure:vc},droppable:{measure:vc,strategy:tF.WhileDragging,frequency:tV.Optimized},dragOverlay:{measure:vu}};class vW extends Map{get(e){var t;return null!=e&&null!=(t=super.get(e))?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,n;return null!=(t=null==(n=this.get(e))?void 0:n.node.current)?t:void 0}}let vJ={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new vW,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:y4},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:vK,measureDroppableContainers:y4,windowRect:null,measuringScheduled:!1},vY={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:y4,draggableNodes:new Map,over:null,measureDroppableContainers:y4},vX=(0,tG.createContext)(vY),vQ=(0,tG.createContext)(vJ);function vZ(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new vW}}}function v0(e,t){switch(t.type){case tR.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case tR.DragMove:if(null==e.draggable.active)return e;return{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case tR.DragEnd:case tR.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case tR.RegisterDroppable:{let{element:n}=t,{id:r}=n,i=new vW(e.droppable.containers);return i.set(r,n),{...e,droppable:{...e.droppable,containers:i}}}case tR.SetDroppableDisabled:{let{id:n,key:r,disabled:i}=t,s=e.droppable.containers.get(n);if(!s||r!==s.key)return e;let a=new vW(e.droppable.containers);return a.set(n,{...s,disabled:i}),{...e,droppable:{...e.droppable,containers:a}}}case tR.UnregisterDroppable:{let{id:n,key:r}=t,i=e.droppable.containers.get(n);if(!i||r!==i.key)return e;let s=new vW(e.droppable.containers);return s.delete(n),{...e,droppable:{...e.droppable,containers:s}}}default:return e}}function v1(e){let{disabled:t}=e,{active:n,activatorEvent:r,draggableNodes:i}=(0,tG.useContext)(vX),s=yB(r),a=yB(null==n?void 0:n.id);return(0,tG.useEffect)(()=>{if(!t&&!r&&s&&null!=a){if(!yW(s)||document.activeElement===s.target)return;let e=i.get(a);if(!e)return;let{activatorNode:t,node:n}=e;(t.current||n.current)&&requestAnimationFrame(()=>{for(let e of[t.current,n.current]){if(!e)continue;let t=e.matches(yX)?e:e.querySelector(yX);if(t){t.focus();break}}})}},[r,t,i,a,s]),null}let v2=(0,tG.createContext)({...y8,scaleX:1,scaleY:1});(ew=tq||(tq={}))[ew.Uninitialized=0]="Uninitialized",ew[ew.Initializing=1]="Initializing",ew[ew.Initialized=2]="Initialized";let v5=(0,tG.memo)(function(e){var t,n,r,i,s,a,o,l;let u,c,h,d,p,f,m,g,{id:y,accessibility:v,autoScroll:b=!0,children:x,sensors:w=vH,collisionDetection:E=vs,measuring:_,modifiers:I,...C}=e,[T,S]=(0,tG.useReducer)(v0,void 0,vZ),[N,A]=function(){let[e]=(0,tG.useState)(()=>new Set),t=(0,tG.useCallback)(t=>(e.add(t),()=>e.delete(t)),[e]);return[(0,tG.useCallback)(t=>{let{type:n,event:r}=t;e.forEach(e=>{var t;return null==(t=e[n])?void 0:t.call(e,r)})},[e]),t]}(),[k,O]=(0,tG.useState)(tq.Uninitialized),R=k===tq.Initialized,{draggable:{active:D,nodes:j,translate:P},droppable:{containers:M}}=T,U=null!=D?j.get(D):null,L=(0,tG.useRef)({initial:null,translated:null}),F=(0,tG.useMemo)(()=>{var e;return null!=D?{id:D,data:null!=(e=null==U?void 0:U.data)?e:v$,rect:L}:null},[D,U]),V=(0,tG.useRef)(null),[q,B]=(0,tG.useState)(null),[G,z]=(0,tG.useState)(null),H=yF(C,Object.values(C)),$=yz("DndDescribedBy",y),K=(0,tG.useMemo)(()=>M.getEnabled(),[M]),W=(0,tG.useMemo)(()=>({draggable:{...vK.draggable,...null==_?void 0:_.draggable},droppable:{...vK.droppable,...null==_?void 0:_.droppable},dragOverlay:{...vK.dragOverlay,...null==_?void 0:_.dragOverlay}}),[null==_?void 0:_.draggable,null==_?void 0:_.droppable,null==_?void 0:_.dragOverlay]),{droppableRects:J,measureDroppableContainers:Y,measuringScheduled:X}=function(e,t){let{dragging:n,dependencies:r,config:i}=t,[s,a]=(0,tG.useState)(null),{frequency:o,measure:l,strategy:u}=i,c=(0,tG.useRef)(e),h=function(){switch(u){case tF.Always:return!1;case tF.BeforeDragging:return n;default:return!n}}(),d=yF(h),p=(0,tG.useCallback)(function(e){void 0===e&&(e=[]),d.current||a(t=>null===t?e:t.concat(e.filter(e=>!t.includes(e))))},[d]),f=(0,tG.useRef)(null),m=yV(t=>{if(h&&!n)return vM;if(!t||t===vM||c.current!==e||null!=s){let t=new Map;for(let n of e){if(!n)continue;if(s&&s.length>0&&!s.includes(n.id)&&n.rect.current){t.set(n.id,n.rect.current);continue}let e=n.node.current,r=e?new vE(l(e),e):null;n.rect.current=r,r&&t.set(n.id,r)}return t}return t},[e,s,n,h,l]);return(0,tG.useEffect)(()=>{c.current=e},[e]),(0,tG.useEffect)(()=>{h||p()},[n,h]),(0,tG.useEffect)(()=>{s&&s.length>0&&a(null)},[JSON.stringify(s)]),(0,tG.useEffect)(()=>{h||"number"!=typeof o||null!==f.current||(f.current=setTimeout(()=>{p(),f.current=null},o))},[o,h,p,...r]),{droppableRects:m,measureDroppableContainers:p,measuringScheduled:null!=s}}(K,{dragging:R,dependencies:[P.x,P.y],config:W.droppable}),Q=yV(e=>{var t;return null==D?null:null!=(t=null!=p?p:e)?t:null},[p=(d=null!=D?j.get(D):void 0)?d.node.current:null,D]),Z=(0,tG.useMemo)(()=>G?yJ(G):null,[G]),ee=(u=(null==q?void 0:q.autoScrollEnabled)===!1,c="object"==typeof b?!1===b.enabled:!1===b,h=R&&!u&&!c,"object"==typeof b?{...b,enabled:h}:{enabled:h}),et=vU(Q,W.draggable.measure);!function(e){let{activeNode:t,measure:n,initialRect:r,config:i=!0}=e,s=(0,tG.useRef)(!1),{x:a,y:o}="boolean"==typeof i?{x:i,y:i}:i;yU(()=>{if(!a&&!o||!t){s.current=!1;return}if(s.current||!r)return;let e=null==t?void 0:t.node.current;if(!e||!1===e.isConnected)return;let i=va(n(e),r);if(a||(i.x=0),o||(i.y=0),s.current=!0,Math.abs(i.x)>0||Math.abs(i.y)>0){let t=vd(e);t&&t.scrollBy({top:i.y,left:i.x})}},[t,a,o,r,n])}({activeNode:null!=D?j.get(D):null,config:ee.layoutShiftCompensation,initialRect:et,measure:W.draggable.measure});let en=vV(Q,W.draggable.measure,et),er=vV(Q?Q.parentElement:null),ei=(0,tG.useRef)({activatorEvent:null,active:null,activeNode:Q,collisionRect:null,collisions:null,droppableRects:J,draggableNodes:j,draggingNode:null,draggingNodeRect:null,droppableContainers:M,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),es=M.getNodeFor(null==(t=ei.current.over)?void 0:t.id),ea=function(e){let{measure:t}=e,[n,r]=(0,tG.useState)(null),i=vL({callback:(0,tG.useCallback)(e=>{for(let{target:n}of e)if(yj(n)){r(e=>{let r=t(n);return e?{...e,width:r.width,height:r.height}:r});break}},[t])}),[s,a]=yq((0,tG.useCallback)(e=>{let n=function(e){if(!e)return null;if(e.children.length>1)return e;let t=e.children[0];return yj(t)?t:e}(e);null==i||i.disconnect(),n&&(null==i||i.observe(n)),r(n?t(n):null)},[t,i]));return(0,tG.useMemo)(()=>({nodeRef:s,rect:n,setRef:a}),[n,s,a])}({measure:W.dragOverlay.measure}),eo=null!=(n=ea.nodeRef.current)?n:Q,el=R?null!=(r=ea.rect)?r:en:null,eu=!!(ea.nodeRef.current&&ea.rect),ec=(f=vU(s=eu?null:en),va(s,f)),eh=vG(eo?yR(eo):null),ed=(a=R?null!=es?es:Q:null,m=(0,tG.useRef)(a),g=yV(e=>a?e&&e!==vq&&a&&m.current&&a.parentNode===m.current.parentNode?e:vh(a):vq,[a]),(0,tG.useEffect)(()=>{m.current=a},[a]),g),ep=function(e,t){void 0===t&&(t=vu);let[n]=e,r=vG(n?yR(n):null),[i,s]=(0,tG.useState)(vz);function a(){s(()=>e.length?e.map(e=>vy(e)?r:new vE(t(e),e)):vz)}let o=vL({callback:a});return yU(()=>{null==o||o.disconnect(),a(),e.forEach(e=>null==o?void 0:o.observe(e))},[e]),i}(ed),ef=function(e,t){let{transform:n,...r}=t;return null!=e&&e.length?e.reduce((e,t)=>t({transform:e,...r}),n):n}(I,{transform:{x:P.x-ec.x,y:P.y-ec.y,scaleX:1,scaleY:1},activatorEvent:G,active:F,activeNodeRect:en,containerNodeRect:er,draggingNodeRect:el,over:ei.current.over,overlayNodeRect:ea.rect,scrollableAncestors:ed,scrollableAncestorRects:ep,windowRect:eh}),em=Z?y$(Z,P):null,eg=function(e){let[t,n]=(0,tG.useState)(null),r=(0,tG.useRef)(e),i=(0,tG.useCallback)(e=>{let t=vp(e.target);t&&n(e=>e?(e.set(t,vg(t)),new Map(e)):null)},[]);return(0,tG.useEffect)(()=>{let t=r.current;if(e!==t){s(t);let a=e.map(e=>{let t=vp(e);return t?(t.addEventListener("scroll",i,{passive:!0}),[t,vg(t)]):null}).filter(e=>null!=e);n(a.length?new Map(a):null),r.current=e}return()=>{s(e),s(t)};function s(e){e.forEach(e=>{let t=vp(e);null==t||t.removeEventListener("scroll",i)})}},[i,e]),(0,tG.useMemo)(()=>e.length?t?Array.from(t.values()).reduce((e,t)=>y$(e,t),y8):vx(e):y8,[e,t])}(ed),ey=vB(eg),ev=vB(eg,[en]),eb=y$(ef,ey),ex=el?vo(el,ef):null,ew=F&&ex?E({active:F,collisionRect:ex,droppableRects:J,droppableContainers:K,pointerCoordinates:em}):null,eE=vn(ew,"id"),[e_,eI]=(0,tG.useState)(null),eC=(o=eu?ef:y$(ef,ev),l=null!=(i=null==e_?void 0:e_.rect)?i:null,{...o,scaleX:l&&en?l.width/en.width:1,scaleY:l&&en?l.height/en.height:1}),eT=(0,tG.useRef)(null),eS=(0,tG.useCallback)((e,t)=>{let{sensor:n,options:r}=t;if(null==V.current)return;let i=j.get(V.current);if(!i)return;let s=e.nativeEvent,a=new n({active:V.current,activeNode:i,event:s,options:r,context:ei,onAbort(e){if(!j.get(e))return;let{onDragAbort:t}=H.current,n={id:e};null==t||t(n),N({type:"onDragAbort",event:n})},onPending(e,t,n,r){if(!j.get(e))return;let{onDragPending:i}=H.current,s={id:e,constraint:t,initialCoordinates:n,offset:r};null==i||i(s),N({type:"onDragPending",event:s})},onStart(e){let t=V.current;if(null==t)return;let n=j.get(t);if(!n)return;let{onDragStart:r}=H.current,i={activatorEvent:s,active:{id:t,data:n.data,rect:L}};(0,yN.unstable_batchedUpdates)(()=>{null==r||r(i),O(tq.Initializing),S({type:tR.DragStart,initialCoordinates:e,active:t}),N({type:"onDragStart",event:i}),B(eT.current),z(s)})},onMove(e){S({type:tR.DragMove,coordinates:e})},onEnd:o(tR.DragEnd),onCancel:o(tR.DragCancel)});function o(e){return async function(){let{active:t,collisions:n,over:r,scrollAdjustedTranslate:i}=ei.current,a=null;if(t&&i){let{cancelDrop:o}=H.current;a={activatorEvent:s,active:t,collisions:n,delta:i,over:r},e===tR.DragEnd&&"function"==typeof o&&await Promise.resolve(o(a))&&(e=tR.DragCancel)}V.current=null,(0,yN.unstable_batchedUpdates)(()=>{S({type:e}),O(tq.Uninitialized),eI(null),B(null),z(null),eT.current=null;let t=e===tR.DragEnd?"onDragEnd":"onDragCancel";if(a){let e=H.current[t];null==e||e(a),N({type:t,event:a})}})}}eT.current=a},[j]),eN=(0,tG.useCallback)((e,t)=>(n,r)=>{let i=n.nativeEvent,s=j.get(r);null!==V.current||!s||i.dndKit||i.defaultPrevented||!0===e(n,t.options,{active:s})&&(i.dndKit={capturedBy:t.sensor},V.current=r,eS(n,t))},[j,eS]),eA=(0,tG.useMemo)(()=>w.reduce((e,t)=>{let{sensor:n}=t;return[...e,...n.activators.map(e=>({eventName:e.eventName,handler:eN(e.handler,t)}))]},[]),[w,eN]);(0,tG.useEffect)(()=>{if(!yA)return;let e=w.map(e=>{let{sensor:t}=e;return null==t.setup?void 0:t.setup()});return()=>{for(let t of e)null==t||t()}},w.map(e=>{let{sensor:t}=e;return t})),yU(()=>{en&&k===tq.Initializing&&O(tq.Initialized)},[en,k]),(0,tG.useEffect)(()=>{let{onDragMove:e}=H.current,{active:t,activatorEvent:n,collisions:r,over:i}=ei.current;if(!t||!n)return;let s={active:t,activatorEvent:n,collisions:r,delta:{x:eb.x,y:eb.y},over:i};(0,yN.unstable_batchedUpdates)(()=>{null==e||e(s),N({type:"onDragMove",event:s})})},[eb.x,eb.y]),(0,tG.useEffect)(()=>{let{active:e,activatorEvent:t,collisions:n,droppableContainers:r,scrollAdjustedTranslate:i}=ei.current;if(!e||null==V.current||!t||!i)return;let{onDragOver:s}=H.current,a=r.get(eE),o=a&&a.rect.current?{id:a.id,rect:a.rect.current,data:a.data,disabled:a.disabled}:null,l={active:e,activatorEvent:t,collisions:n,delta:{x:i.x,y:i.y},over:o};(0,yN.unstable_batchedUpdates)(()=>{eI(o),null==s||s(l),N({type:"onDragOver",event:l})})},[eE]),yU(()=>{ei.current={activatorEvent:G,active:F,activeNode:Q,collisionRect:ex,collisions:ew,droppableRects:J,draggableNodes:j,draggingNode:eo,draggingNodeRect:el,droppableContainers:M,over:e_,scrollableAncestors:ed,scrollAdjustedTranslate:eb},L.current={initial:el,translated:ex}},[F,Q,ew,ex,j,eo,el,J,M,e_,ed,eb]),function(e){let t,{acceleration:n,activator:r=tU.Pointer,canScroll:i,draggingRect:s,enabled:a,interval:o=5,order:l=tL.TreeOrder,pointerCoordinates:u,scrollableAncestors:c,scrollableAncestorRects:h,delta:d,threshold:p}=e,f=function(e){let{delta:t,disabled:n}=e,r=yB(t);return yV(e=>{if(n||!r||!e)return vP;let i={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[tD.Backward]:e.x[tD.Backward]||-1===i.x,[tD.Forward]:e.x[tD.Forward]||1===i.x},y:{[tD.Backward]:e.y[tD.Backward]||-1===i.y,[tD.Forward]:e.y[tD.Forward]||1===i.y}}},[n,t,r])}({delta:d,disabled:!a}),[m,g]=(t=(0,tG.useRef)(null),[(0,tG.useCallback)((e,n)=>{t.current=setInterval(e,n)},[]),(0,tG.useCallback)(()=>{null!==t.current&&(clearInterval(t.current),t.current=null)},[])]),y=(0,tG.useRef)({x:0,y:0}),v=(0,tG.useRef)({x:0,y:0}),b=(0,tG.useMemo)(()=>{switch(r){case tU.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case tU.DraggableRect:return s}},[r,s,u]),x=(0,tG.useRef)(null),w=(0,tG.useCallback)(()=>{let e=x.current;if(!e)return;let t=y.current.x*v.current.x,n=y.current.y*v.current.y;e.scrollBy(t,n)},[]),E=(0,tG.useMemo)(()=>l===tL.TreeOrder?[...c].reverse():c,[l,c]);(0,tG.useEffect)(()=>{if(!a||!c.length||!b)return void g();for(let e of E){if((null==i?void 0:i(e))===!1)continue;let t=h[c.indexOf(e)];if(!t)continue;let{direction:r,speed:s}=function(e,t,n,r,i){let{top:s,left:a,right:o,bottom:l}=n;void 0===r&&(r=10),void 0===i&&(i=vb);let{isTop:u,isBottom:c,isLeft:h,isRight:d}=vv(e),p={x:0,y:0},f={x:0,y:0},m={height:t.height*i.y,width:t.width*i.x};return!u&&s<=t.top+m.height?(p.y=tD.Backward,f.y=r*Math.abs((t.top+m.height-s)/m.height)):!c&&l>=t.bottom-m.height&&(p.y=tD.Forward,f.y=r*Math.abs((t.bottom-m.height-l)/m.height)),!d&&o>=t.right-m.width?(p.x=tD.Forward,f.x=r*Math.abs((t.right-m.width-o)/m.width)):!h&&a<=t.left+m.width&&(p.x=tD.Backward,f.x=r*Math.abs((t.left+m.width-a)/m.width)),{direction:p,speed:f}}(e,t,b,n,p);for(let e of["x","y"])f[e][r[e]]||(s[e]=0,r[e]=0);if(s.x>0||s.y>0){g(),x.current=e,m(w,o),y.current=s,v.current=r;return}}y.current={x:0,y:0},v.current={x:0,y:0},g()},[n,w,i,g,a,o,JSON.stringify(b),JSON.stringify(f),m,c,E,h,JSON.stringify(p)])}({...ee,delta:P,draggingRect:ex,pointerCoordinates:em,scrollableAncestors:ed,scrollableAncestorRects:ep});let ek=(0,tG.useMemo)(()=>({active:F,activeNode:Q,activeNodeRect:en,activatorEvent:G,collisions:ew,containerNodeRect:er,dragOverlay:ea,draggableNodes:j,droppableContainers:M,droppableRects:J,over:e_,measureDroppableContainers:Y,scrollableAncestors:ed,scrollableAncestorRects:ep,measuringConfiguration:W,measuringScheduled:X,windowRect:eh}),[F,Q,en,G,ew,er,ea,j,M,J,e_,Y,ed,ep,W,X,eh]),eO=(0,tG.useMemo)(()=>({activatorEvent:G,activators:eA,active:F,activeNodeRect:en,ariaDescribedById:{draggable:$},dispatch:S,draggableNodes:j,over:e_,measureDroppableContainers:Y}),[G,eA,F,en,S,$,j,e_,Y]);return tG.default.createElement(y1.Provider,{value:A},tG.default.createElement(vX.Provider,{value:eO},tG.default.createElement(vQ.Provider,{value:ek},tG.default.createElement(v2.Provider,{value:eC},x)),tG.default.createElement(v1,{disabled:(null==v?void 0:v.restoreFocus)===!1})),tG.default.createElement(y6,{...v,hiddenTextDescribedById:$}))}),v6=(0,tG.createContext)(null),v4="button",v3={timeout:25},v8={position:"fixed",touchAction:"none"},v7=e=>yW(e)?"transform 250ms ease":void 0;function v9(e,t,n){let r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function be(e){return null!==e&&e>=0}(e,t)=>{let{as:n,activatorEvent:r,adjustScale:i,children:s,className:a,rect:o,style:l,transform:u,transition:c=v7}=e;if(!o)return null;let h=i?u:{...u,scaleX:1,scaleY:1},d={...v8,width:o.width,height:o.height,top:o.top,left:o.left,transform:yY.Transform.toString(h),transformOrigin:i&&r?function(e,t){let n=yJ(e);if(!n)return"0 0";let r={x:(n.x-t.left)/t.width*100,y:(n.y-t.top)/t.height*100};return r.x+"% "+r.y+"%"}(r,o):void 0,transition:"function"==typeof c?c(r):c,...l};return tG.default.createElement(n,{className:a,style:d,ref:t},s)},s={styles:{active:{opacity:"0"}}};let bt={scaleX:1,scaleY:1},bn=e=>{var t,n,r,i;let s,a,o,{rects:l,activeNodeRect:u,activeIndex:c,overIndex:h,index:d}=e,p=null!=(t=l[c])?t:u;if(!p)return null;let f=(n=l,r=d,i=c,s=n[r],a=n[r-1],o=n[r+1],s&&(a||o)?i<r?a?s.left-(a.left+a.width):o.left-(s.left+s.width):o?o.left-(s.left+s.width):s.left-(a.left+a.width):0);if(d===c){let e=l[h];return e?{x:c<h?e.left+e.width-(p.left+p.width):e.left-p.left,y:0,...bt}:null}return d>c&&d<=h?{x:-p.width-f,y:0,...bt}:d<c&&d>=h?{x:p.width+f,y:0,...bt}:{x:0,y:0,...bt}},br=e=>{let{rects:t,activeIndex:n,overIndex:r,index:i}=e,s=v9(t,r,n),a=t[i],o=s[i];return o&&a?{x:o.left-a.left,y:o.top-a.top,scaleX:o.width/a.width,scaleY:o.height/a.height}:null},bi="Sortable",bs=tG.default.createContext({activeIndex:-1,containerId:bi,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:br,disabled:{draggable:!1,droppable:!1}});function ba(e){let{children:t,id:n,items:r,strategy:i=br,disabled:s=!1}=e,{active:a,dragOverlay:o,droppableRects:l,over:u,measureDroppableContainers:c}=(0,tG.useContext)(vQ),h=yz(bi,n),d=null!==o.rect,p=(0,tG.useMemo)(()=>r.map(e=>"object"==typeof e&&"id"in e?e.id:e),[r]),f=null!=a,m=a?p.indexOf(a.id):-1,g=u?p.indexOf(u.id):-1,y=(0,tG.useRef)(p),v=!function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(p,y.current),b=-1!==g&&-1===m||v,x="boolean"==typeof s?{draggable:s,droppable:s}:s;yU(()=>{v&&f&&c(p)},[v,p,f,c]),(0,tG.useEffect)(()=>{y.current=p},[p]);let w=(0,tG.useMemo)(()=>({activeIndex:m,containerId:h,disabled:x,disableTransforms:b,items:p,overIndex:g,useDragOverlay:d,sortedRects:p.reduce((e,t,n)=>{let r=l.get(t);return r&&(e[n]=r),e},Array(p.length)),strategy:i}),[m,h,x.draggable,x.droppable,b,p,g,l,d,i]);return tG.default.createElement(bs.Provider,{value:w},t)}let bo=e=>{let{id:t,items:n,activeIndex:r,overIndex:i}=e;return v9(n,r,i).indexOf(t)},bl=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:i,items:s,newIndex:a,previousItems:o,previousContainerId:l,transition:u}=e;return!!u&&!!r&&(o===s||i!==a)&&(!!n||a!==i&&t===l)},bu={duration:200,easing:"ease"},bc="transform",bh=yY.Transition.toString({property:bc,duration:0,easing:"linear"}),bd={roleDescription:"sortable"};function bp(e){if(!e)return!1;let t=e.data.current;return!!t&&"sortable"in t&&"object"==typeof t.sortable&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable}let bf=[tP.Down,tP.Right,tP.Up,tP.Left],bm=(e,t)=>{let{context:{active:n,collisionRect:r,droppableRects:i,droppableContainers:s,over:a,scrollableAncestors:o}}=t;if(bf.includes(e.code)){if(e.preventDefault(),!n||!r)return;let t=[];s.getEnabled().forEach(n=>{if(!n||null!=n&&n.disabled)return;let s=i.get(n.id);if(s)switch(e.code){case tP.Down:r.top<s.top&&t.push(n);break;case tP.Up:r.top>s.top&&t.push(n);break;case tP.Left:r.left>s.left&&t.push(n);break;case tP.Right:r.left<s.left&&t.push(n)}});let c=(e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e,i=vt(t),s=[];for(let e of r){let{id:t}=e,r=n.get(t);if(r){let n=vt(r),a=Number((i.reduce((e,t,r)=>e+y7(n[r],t),0)/4).toFixed(4));s.push({id:t,data:{droppableContainer:e,value:a}})}}return s.sort(y9)})({active:n,collisionRect:r,droppableRects:i,droppableContainers:t,pointerCoordinates:null}),h=vn(c,"id");if(h===(null==a?void 0:a.id)&&c.length>1&&(h=c[1].id),null!=h){let e=s.get(n.id),t=s.get(h),a=t?i.get(t.id):null,c=null==t?void 0:t.node.current;if(c&&a&&e&&t){var l,u;let n=vh(c).some((e,t)=>o[t]!==e),i=bg(e,t),s=(l=e,u=t,!!bp(l)&&!!bp(u)&&!!bg(l,u)&&l.data.current.sortable.index<u.data.current.sortable.index),h=n||!i?{x:0,y:0}:{x:s?r.width-a.width:0,y:s?r.height-a.height:0},d={x:a.left,y:a.top};return h.x&&h.y?d:yK(d,h)}}}};function bg(e,t){return!!bp(e)&&!!bp(t)&&e.data.current.sortable.containerId===t.data.current.sortable.containerId}let by=[{value:"default",label:"Default",emoji:""},{value:"professional",label:"Professional",emoji:""},{value:"casual",label:"Casual",emoji:""},{value:"funny",label:"Funny",emoji:""},{value:"inspiring",label:"Inspiring",emoji:""},{value:"urgent",label:"Urgent/FOMO",emoji:""},{value:"minimalist",label:"Minimalist",emoji:""}],bv=({mockup:e,index:t,isSelected:n,onSelect:r})=>{let{attributes:i,listeners:s,setNodeRef:a,transform:o,transition:l,isDragging:u}=function(e){var t,n,r,i;let{animateLayoutChanges:s=bl,attributes:a,disabled:o,data:l,getNewIndex:u=bo,id:c,strategy:h,resizeObserverConfig:d,transition:p=bu}=e,{items:f,containerId:m,activeIndex:g,disabled:y,disableTransforms:v,sortedRects:b,overIndex:x,useDragOverlay:w,strategy:E}=(0,tG.useContext)(bs),_=(t=o,n=y,"boolean"==typeof t?{draggable:t,droppable:!1}:{draggable:null!=(r=null==t?void 0:t.draggable)?r:n.draggable,droppable:null!=(i=null==t?void 0:t.droppable)?i:n.droppable}),I=f.indexOf(c),C=(0,tG.useMemo)(()=>({sortable:{containerId:m,index:I,items:f},...l}),[m,l,I,f]),T=(0,tG.useMemo)(()=>f.slice(f.indexOf(c)),[f,c]),{rect:S,node:N,isOver:A,setNodeRef:k}=function(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:i}=e,s=yz("Droppable"),{active:a,dispatch:o,over:l,measureDroppableContainers:u}=(0,tG.useContext)(vX),c=(0,tG.useRef)({disabled:n}),h=(0,tG.useRef)(!1),d=(0,tG.useRef)(null),p=(0,tG.useRef)(null),{disabled:f,updateMeasurementsFor:m,timeout:g}={...v3,...i},y=yF(null!=m?m:r),v=vL({callback:(0,tG.useCallback)(()=>{if(!h.current){h.current=!0;return}null!=p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{u(Array.isArray(y.current)?y.current:[y.current]),p.current=null},g)},[g]),disabled:f||!a}),[b,x]=yq((0,tG.useCallback)((e,t)=>{v&&(t&&(v.unobserve(t),h.current=!1),e&&v.observe(e))},[v])),w=yF(t);return(0,tG.useEffect)(()=>{v&&b.current&&(v.disconnect(),h.current=!1,v.observe(b.current))},[b,v]),(0,tG.useEffect)(()=>(o({type:tR.RegisterDroppable,element:{id:r,key:s,disabled:n,node:b,rect:d,data:w}}),()=>o({type:tR.UnregisterDroppable,key:s,id:r})),[r]),(0,tG.useEffect)(()=>{n!==c.current.disabled&&(o({type:tR.SetDroppableDisabled,id:r,key:s,disabled:n}),c.current.disabled=n)},[r,s,n,o]),{active:a,rect:d,isOver:(null==l?void 0:l.id)===r,node:b,over:l,setNodeRef:x}}({id:c,data:C,disabled:_.droppable,resizeObserverConfig:{updateMeasurementsFor:T,...d}}),{active:O,activatorEvent:R,activeNodeRect:D,attributes:j,setNodeRef:P,listeners:M,isDragging:U,over:L,setActivatorNodeRef:F,transform:V}=function(e){let{id:t,data:n,disabled:r=!1,attributes:i}=e,s=yz("Draggable"),{activators:a,activatorEvent:o,active:l,activeNodeRect:u,ariaDescribedById:c,draggableNodes:h,over:d}=(0,tG.useContext)(vX),{role:p=v4,roleDescription:f="draggable",tabIndex:m=0}=null!=i?i:{},g=(null==l?void 0:l.id)===t,y=(0,tG.useContext)(g?v2:v6),[v,b]=yq(),[x,w]=yq(),E=(0,tG.useMemo)(()=>a.reduce((e,n)=>{let{eventName:r,handler:i}=n;return e[r]=e=>{i(e,t)},e},{}),[a,t]),_=yF(n);return yU(()=>(h.set(t,{id:t,key:s,node:v,activatorNode:x,data:_}),()=>{let e=h.get(t);e&&e.key===s&&h.delete(t)}),[h,t]),{active:l,activatorEvent:o,activeNodeRect:u,attributes:(0,tG.useMemo)(()=>({role:p,tabIndex:m,"aria-disabled":r,"aria-pressed":!!g&&p===v4||void 0,"aria-roledescription":f,"aria-describedby":c.draggable}),[r,p,m,g,f,c.draggable]),isDragging:g,listeners:r?void 0:E,node:v,over:d,setNodeRef:b,setActivatorNodeRef:w,transform:y}}({id:c,data:C,attributes:{...bd,...a},disabled:_.draggable}),q=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,tG.useMemo)(()=>e=>{t.forEach(t=>t(e))},t)}(k,P),B=!!O,G=B&&!v&&be(g)&&be(x),z=!w&&U,H=z&&G?V:null,$=G?null!=H?H:(null!=h?h:E)({rects:b,activeNodeRect:D,activeIndex:g,overIndex:x,index:I}):null,K=be(g)&&be(x)?u({id:c,items:f,activeIndex:g,overIndex:x}):I,W=null==O?void 0:O.id,J=(0,tG.useRef)({activeId:W,items:f,newIndex:K,containerId:m}),Y=f!==J.current.items,X=s({active:O,containerId:m,isDragging:U,isSorting:B,id:c,index:I,items:f,newIndex:J.current.newIndex,previousItems:J.current.items,previousContainerId:J.current.containerId,transition:p,wasDragging:null!=J.current.activeId}),Q=function(e){let{disabled:t,index:n,node:r,rect:i}=e,[s,a]=(0,tG.useState)(null),o=(0,tG.useRef)(n);return yU(()=>{if(!t&&n!==o.current&&r.current){let e=i.current;if(e){let t=vu(r.current,{ignoreTransform:!0}),n={x:e.left-t.left,y:e.top-t.top,scaleX:e.width/t.width,scaleY:e.height/t.height};(n.x||n.y)&&a(n)}}n!==o.current&&(o.current=n)},[t,n,r,i]),(0,tG.useEffect)(()=>{s&&a(null)},[s]),s}({disabled:!X,index:I,node:N,rect:S});return(0,tG.useEffect)(()=>{B&&J.current.newIndex!==K&&(J.current.newIndex=K),m!==J.current.containerId&&(J.current.containerId=m),f!==J.current.items&&(J.current.items=f)},[B,K,m,f]),(0,tG.useEffect)(()=>{if(W===J.current.activeId)return;if(null!=W&&null==J.current.activeId){J.current.activeId=W;return}let e=setTimeout(()=>{J.current.activeId=W},50);return()=>clearTimeout(e)},[W]),{active:O,activeIndex:g,attributes:j,data:C,rect:S,index:I,newIndex:K,items:f,isOver:A,isSorting:B,isDragging:U,listeners:M,node:N,overIndex:x,over:L,setNodeRef:q,setActivatorNodeRef:F,setDroppableNodeRef:k,setDraggableNodeRef:P,transform:null!=Q?Q:$,transition:Q||Y&&J.current.newIndex===I?bh:(!z||yW(R))&&p&&(B||X)?yY.Transition.toString({...p,property:bc}):void 0}}({id:e.id}),c={transform:yY.Transform.toString(o),transition:l};return(0,tB.jsxs)("div",{ref:a,style:c,className:`
        relative flex-shrink-0 w-14 h-14 rounded-lg overflow-hidden border-2 transition-all bg-slate-100 flex items-center justify-center group/thumb
        ${u?"z-50 shadow-xl scale-105 opacity-90":""}
        ${n?"border-indigo-500 shadow-md shadow-indigo-500/20":"border-transparent hover:border-slate-300 opacity-60 hover:opacity-100"}
      `,children:[(0,tB.jsx)("div",{...i,...s,className:"absolute inset-0 z-10 flex items-center justify-center bg-slate-900/0 hover:bg-slate-900/40 transition-colors cursor-grab active:cursor-grabbing",children:(0,tB.jsx)(yI,{size:16,className:"text-white opacity-0 group-hover/thumb:opacity-100 transition-opacity drop-shadow-lg"})}),(0,tB.jsx)("button",{onClick:r,className:"absolute inset-0 z-0","aria-label":`View image ${t+1}`}),(0,tB.jsx)("img",{src:e.imageUrl,alt:`Thumbnail ${t+1}`,className:"max-w-full max-h-full object-contain pointer-events-none",draggable:!1}),(0,tB.jsx)("span",{className:"absolute bottom-0.5 right-0.5 w-4 h-4 rounded text-[10px] font-bold bg-slate-800/70 text-white flex items-center justify-center",children:t+1})]})},bb=({mockups:e,onSuccess:t,onBack:n,onScheduled:r})=>{let[i,s]=(0,tG.useState)({facebook:[],instagram:[]}),[a,o]=(0,tG.useState)({facebook:0,instagram:0}),[l,u]=(0,tG.useState)({facebook:"",instagram:""}),[c,h]=(0,tG.useState)(!0),[d,p]=(0,tG.useState)(!1),[f,m]=(0,tG.useState)(!1),[g,y]=(0,tG.useState)(null),[v,b]=(0,tG.useState)("both"),[x,w]=(0,tG.useState)(0),E=e.length>1,[_,I]=(0,tG.useState)(!1),[C,T]=(0,tG.useState)(null),[S,N]=(0,tG.useState)(!1),[A,k]=(0,tG.useState)(!1),[O,R]=(0,tG.useState)(()=>{let e=localStorage.getItem("captionPresets");if(e)try{return JSON.parse(e).tone||"default"}catch{}return"default"}),[D,j]=(0,tG.useState)(()=>{let e=localStorage.getItem("captionPresets");if(e)try{return JSON.parse(e).customTone||""}catch{}return""}),[P,M]=(0,tG.useState)(()=>{let e=localStorage.getItem("captionPresets");if(e)try{return JSON.parse(e).context||""}catch{}return""}),[U,L]=(0,tG.useState)(!1),[F,V]=(0,tG.useState)(null),q=F||e,B=C?q.map(e=>C.find(t=>t.id===e.id)||e):q,G=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,tG.useMemo)(()=>[...t].filter(e=>null!=e),[...t])}(y3(vj,{activationConstraint:{distance:5}}),y3(vA,{coordinateGetter:bm})),[z,H]=(0,tG.useState)({instagram:{connected:!1,username:""},facebook:{connected:!1,username:""}}),[$,K]=(0,tG.useState)(!1),[W,J]=(0,tG.useState)(null);(0,tG.useEffect)(()=>{let e,t,n,r=(t=(e=new URLSearchParams(window.location.search)).get("auth_success"),n=e.get("auth_error"),(!gq()&&(t||n)&&window.history.replaceState({},"",window.location.pathname),t)?{success:!0,platform:t}:n?{success:!1,error:decodeURIComponent(n)}:{success:!1});r.success&&r.platform?Y():r.error&&J(r.error)},[]),(0,tG.useEffect)(()=>{Y()},[]),(0,tG.useEffect)(()=>{localStorage.setItem("captionPresets",JSON.stringify({tone:O,customTone:D,context:P}))},[O,D,P]),(0,tG.useEffect)(()=>{let t=!0;return(async()=>{try{let n=e[0],r={};D?r.customTone=D:"default"!==O&&(r.tone=O),P&&(r.context=P);let i=await gt(n.styleDescription,n.imageUrl,Object.keys(r).length>0?r:void 0);t&&(s(i),u({facebook:i.facebook[0]||"",instagram:i.instagram[0]||""}),o({facebook:0,instagram:0}),h(!1))}catch(e){console.error(e),t&&h(!1)}})(),()=>{t=!1}},[e]);let Y=async()=>{H(await gU())},X=async e=>{let t=e||("both"===v?"instagram":v);K(!0),J(null);try{await gM(t)&&await Y()}catch(e){console.error("OAuth error:",e),J("Failed to connect. Please try again.")}finally{K(!1)}},Q=async()=>{await gL(v)&&H(e=>({...e,[v]:{connected:!1,username:""}}))},Z=async()=>{p(!0),y(null);try{let e=B.map(e=>e.imageUrl),n=await gV(v,e,l[v]);n.success?(await gQ({platforms:[v],captions:l,imageUrls:e,mockupData:B}),t()):y(n.error||"Failed to post. Please try again.")}catch(e){console.error("Post error:",e),y("Network error. Please try again.")}finally{p(!1)}},ee=async()=>{if(!z.facebook.connected||!z.instagram.connected)return void y("Both accounts must be connected to post to both platforms.");m(!0),y(null);try{let e=B.map(e=>e.imageUrl),[n,r]=await Promise.allSettled([gV("facebook",e,l.facebook),gV("instagram",e,l.instagram)]),i="fulfilled"===n.status&&n.value.success,s="fulfilled"===r.status&&r.value.success;if(i&&s)await gQ({platforms:["instagram","facebook"],captions:l,imageUrls:e,mockupData:B}),t();else{let t=[],a=[];if(i)a.push("facebook");else{let e="fulfilled"===n.status?n.value.error:"Facebook posting failed";t.push(`Facebook: ${e}`)}if(s)a.push("instagram");else{let e="fulfilled"===r.status?r.value.error:"Instagram posting failed";t.push(`Instagram: ${e}`)}a.length>0&&await gQ({platforms:a,captions:l,imageUrls:e,mockupData:B}),y(t.join(". "))}}catch(e){console.error("Post error:",e),y("Network error. Please try again.")}finally{m(!1)}},et="both"===v?null:z[v],en=async(e,n)=>{let i=B.map(e=>e.imageUrl);await g$({platforms:n,scheduledFor:e,captions:l,imageUrls:i,mockupData:B}),r?r():t()},er=async()=>{L(!0);try{let t=e[0],n={};D?n.customTone=D:"default"!==O&&(n.tone=O),P&&(n.context=P);let r=await gt(t.styleDescription,t.imageUrl,n);s(r),u({facebook:r.facebook[0]||"",instagram:r.instagram[0]||""}),o({facebook:0,instagram:0}),k(!1)}catch(e){console.error("Error regenerating captions:",e)}finally{L(!1)}};return c?(0,tB.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[400px]",children:[(0,tB.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center mb-5 shadow-lg shadow-indigo-500/30",children:(0,tB.jsx)(tX,{className:"animate-spin text-white",size:28})}),(0,tB.jsx)("p",{className:"font-display font-semibold text-slate-800 text-lg",children:"Writing engaging captions..."}),(0,tB.jsx)("p",{className:"text-sm text-slate-400 mt-1",children:"Tailored for your audience"})]}):(0,tB.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,tB.jsx)("div",{className:"lg:col-span-1",children:(0,tB.jsxs)("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-slate-200 sticky top-24",children:[E&&(0,tB.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-indigo-50 rounded-full",children:[(0,tB.jsx)(gy,{size:12,className:"text-indigo-600"}),(0,tB.jsx)("span",{className:"text-xs font-semibold text-indigo-600",children:"Carousel"})]}),(0,tB.jsxs)("span",{className:"text-xs font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded-full",children:[x+1," / ",e.length]})]}),(0,tB.jsxs)("div",{className:"relative group rounded-xl overflow-hidden bg-slate-100 flex items-center justify-center min-h-[200px] max-h-[400px]",children:[(0,tB.jsx)("img",{src:B[x].imageUrl,alt:`Mockup ${x+1}`,className:"w-full h-full object-contain max-h-[400px]"}),E&&(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)("button",{onClick:()=>{w(t=>t>0?t-1:e.length-1)},className:"absolute left-2 top-1/2 -translate-y-1/2 w-9 h-9 rounded-xl bg-white/90 backdrop-blur-sm text-slate-700 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all hover:bg-white shadow-lg",children:(0,tB.jsx)(gE,{size:20})}),(0,tB.jsx)("button",{onClick:()=>{w(t=>t<e.length-1?t+1:0)},className:"absolute right-2 top-1/2 -translate-y-1/2 w-9 h-9 rounded-xl bg-white/90 backdrop-blur-sm text-slate-700 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all hover:bg-white shadow-lg",children:(0,tB.jsx)(g_,{size:20})})]})]}),E&&(0,tB.jsx)(v5,{sensors:G,collisionDetection:vi,onDragEnd:t=>{let{active:n,over:r}=t;if(r&&n.id!==r.id){let t=F||e,i=t.findIndex(e=>e.id===n.id),s=t.findIndex(e=>e.id===r.id);V(v9(t,i,s)),i===x?w(s):i<x&&s>=x?w(x-1):i>x&&s<=x&&w(x+1)}},children:(0,tB.jsx)(ba,{items:B.map(e=>e.id),strategy:bn,children:(0,tB.jsxs)("div",{className:"mt-3",children:[(0,tB.jsxs)("p",{className:"text-[10px] text-slate-400 mb-1.5 flex items-center gap-1",children:[(0,tB.jsx)(yI,{size:10}),"Drag to reorder"]}),(0,tB.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-1",children:B.map((e,t)=>(0,tB.jsx)(bv,{mockup:e,index:t,isSelected:t===x,onSelect:()=>w(t)},e.id))})]})})}),E&&(0,tB.jsx)("div",{className:"flex justify-center gap-1.5 mt-3",children:B.map((e,t)=>(0,tB.jsx)("button",{onClick:()=>w(t),className:`
                    h-1.5 rounded-full transition-all
                    ${t===x?"bg-indigo-600 w-4":"bg-slate-200 w-1.5 hover:bg-slate-300"}
                  `},t))}),(0,tB.jsxs)("button",{onClick:n,className:"w-full mt-4 py-2.5 text-sm text-slate-600 hover:text-slate-800 border border-slate-200 hover:border-slate-300 rounded-xl transition-all flex items-center justify-center gap-2",children:[(0,tB.jsx)(yE,{size:16}),"Back to Styles"]}),(0,tB.jsxs)("button",{onClick:()=>I(!0),className:"w-full mt-2 py-2.5 text-sm text-indigo-600 hover:text-indigo-700 bg-indigo-50 hover:bg-indigo-100 border border-indigo-200 hover:border-indigo-300 rounded-xl transition-all flex items-center justify-center gap-2 font-medium",children:[(0,tB.jsx)(ys,{size:16}),"Edit Images",C&&(0,tB.jsx)("span",{className:"ml-1 w-2 h-2 rounded-full bg-emerald-500",title:"Cropped"})]})]})}),(0,tB.jsxs)("div",{className:"lg:col-span-2 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden flex flex-col",children:[(0,tB.jsxs)("div",{className:"flex p-2 gap-2 bg-slate-50 border-b border-slate-100",children:[(0,tB.jsxs)("button",{onClick:()=>{b("both"),J(null),y(null)},className:`
              flex-1 py-3 flex items-center justify-center gap-2 font-semibold text-sm rounded-xl transition-all
              ${"both"===v?"bg-white text-indigo-600 shadow-sm":"text-slate-500 hover:text-slate-700 hover:bg-white/50"}
            `,children:[(0,tB.jsx)(yp,{size:18}),"Both",z.instagram.connected&&z.facebook.connected&&(0,tB.jsx)("span",{className:"w-2 h-2 rounded-full bg-emerald-500"})]}),(0,tB.jsxs)("button",{onClick:()=>{b("instagram"),J(null),y(null)},className:`
              flex-1 py-3 flex items-center justify-center gap-2 font-semibold text-sm rounded-xl transition-all
              ${"instagram"===v?"bg-white text-pink-600 shadow-sm":"text-slate-500 hover:text-slate-700 hover:bg-white/50"}
            `,children:[(0,tB.jsx)(yd,{size:18}),"Instagram",z.instagram.connected&&(0,tB.jsx)("span",{className:"w-2 h-2 rounded-full bg-emerald-500"})]}),(0,tB.jsxs)("button",{onClick:()=>{b("facebook"),J(null),y(null)},className:`
              flex-1 py-3 flex items-center justify-center gap-2 font-semibold text-sm rounded-xl transition-all
              ${"facebook"===v?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700 hover:bg-white/50"}
            `,children:[(0,tB.jsx)(yh,{size:18}),"Facebook",z.facebook.connected&&(0,tB.jsx)("span",{className:"w-2 h-2 rounded-full bg-emerald-500"})]})]}),"both"===v?(0,tB.jsxs)("div",{className:`
            px-5 py-3 border-b border-slate-100
            ${z.instagram.connected&&z.facebook.connected?"bg-gradient-to-r from-emerald-50 to-teal-50 border-emerald-100":"bg-slate-50"}
          `,children:[(0,tB.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,tB.jsx)("div",{className:"flex items-center gap-2",children:z.instagram.connected&&z.facebook.connected?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)("span",{className:"w-2 h-2 rounded-full bg-emerald-500"}),(0,tB.jsx)("span",{className:"text-sm text-slate-600 font-medium",children:"Both accounts connected"})]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(yx,{size:14,className:"text-amber-500"}),(0,tB.jsx)("span",{className:"text-sm text-slate-500",children:"Connection required"})]})})}),(0,tB.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[(0,tB.jsxs)("div",{className:"flex items-center justify-between p-2 bg-white/60 rounded-lg",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-2",children:[(0,tB.jsx)(yd,{size:14,className:"text-pink-600"}),(0,tB.jsx)("span",{className:"text-slate-600",children:"Instagram"})]}),(0,tB.jsx)("div",{className:"flex items-center gap-2",children:z.instagram.connected?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"}),(0,tB.jsx)("span",{className:"text-emerald-600 font-medium",children:z.instagram.username})]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-amber-500"}),(0,tB.jsx)("span",{className:"text-amber-600",children:"Not connected"})]})})]}),(0,tB.jsxs)("div",{className:"flex items-center justify-between p-2 bg-white/60 rounded-lg",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-2",children:[(0,tB.jsx)(yh,{size:14,className:"text-blue-600"}),(0,tB.jsx)("span",{className:"text-slate-600",children:"Facebook"})]}),(0,tB.jsx)("div",{className:"flex items-center gap-2",children:z.facebook.connected?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"}),(0,tB.jsx)("span",{className:"text-emerald-600 font-medium",children:z.facebook.username})]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-amber-500"}),(0,tB.jsx)("span",{className:"text-amber-600",children:"Not connected"})]})})]})]})]}):(0,tB.jsxs)("div",{className:`
            px-5 py-2.5 flex items-center justify-between text-sm
            ${et?.connected?"bg-gradient-to-r from-emerald-50 to-teal-50 border-b border-emerald-100":"bg-slate-50 border-b border-slate-100"}
          `,children:[(0,tB.jsx)("div",{className:"flex items-center gap-2",children:et?.connected?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)("span",{className:"w-2 h-2 rounded-full bg-emerald-500"}),(0,tB.jsxs)("span",{className:"text-slate-600",children:["Connected as ",(0,tB.jsx)("span",{className:"font-semibold text-emerald-700",children:et.username})]})]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(yx,{size:14,className:"text-amber-500"}),(0,tB.jsx)("span",{className:"text-slate-500",children:"Account not connected"})]})}),et?.connected?(0,tB.jsxs)("button",{onClick:Q,className:"text-xs text-slate-400 hover:text-red-500 flex items-center gap-1 transition-colors",children:[(0,tB.jsx)(yb,{size:12})," Disconnect"]}):(0,tB.jsx)("span",{className:"text-xs text-slate-400",children:"Required to post"})]}),W&&(0,tB.jsxs)("div",{className:"mx-6 mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-700 flex items-start gap-2",children:[(0,tB.jsx)(yx,{size:16,className:"flex-shrink-0 mt-0.5"}),(0,tB.jsxs)("div",{children:[(0,tB.jsx)("p",{className:"font-medium",children:"Connection Failed"}),(0,tB.jsx)("p",{className:"text-red-600",children:W})]})]}),g&&(0,tB.jsxs)("div",{className:"mx-6 mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-700 flex items-start gap-2",children:[(0,tB.jsx)(yx,{size:16,className:"flex-shrink-0 mt-0.5"}),(0,tB.jsxs)("div",{children:[(0,tB.jsx)("p",{className:"font-medium",children:"Posting Failed"}),(0,tB.jsx)("p",{className:"text-red-600",children:g})]})]}),(0,tB.jsxs)("div",{className:"p-5 flex-1 flex flex-col relative",children:[(0,tB.jsxs)("div",{className:"mb-5",children:[(0,tB.jsx)("label",{className:"block text-xs font-semibold text-slate-500 uppercase tracking-wide mb-3",children:"Choose a caption style"}),(0,tB.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2",children:("both"===v?i.instagram:i[v]).map((e,t)=>{let n="both"===v?a.instagram===t&&a.facebook===t:a[v]===t,r="both"===v?"indigo":"instagram"===v?"pink":"blue";return(0,tB.jsxs)("button",{onClick:()=>(e=>{if("both"===v){let t=i.instagram[e];o(t=>({...t,instagram:e,facebook:e})),u({facebook:t,instagram:t})}else{let t=i[v][e];o(t=>({...t,[v]:e})),u(e=>({...e,[v]:t}))}})(t),className:`
                      relative flex-shrink-0 w-44 p-3 rounded-xl border-2 text-left transition-all
                      ${n?"pink"===r?"border-pink-400 bg-pink-50":"blue"===r?"border-blue-400 bg-blue-50":"border-indigo-400 bg-indigo-50":"border-slate-200 bg-white hover:border-slate-300 hover:bg-slate-50"}
                    `,children:[(0,tB.jsx)("div",{className:`
                      absolute top-2 right-2 w-5 h-5 rounded-md flex items-center justify-center transition-all
                      ${n?"pink"===r?"bg-pink-500 text-white":"blue"===r?"bg-blue-500 text-white":"bg-indigo-500 text-white":"border-2 border-slate-200"}
                    `,children:n&&(0,tB.jsx)(gf,{size:12,strokeWidth:3})}),(0,tB.jsx)("p",{className:"text-xs text-slate-600 line-clamp-4 leading-relaxed pr-6",children:e})]},t)})})]}),(0,tB.jsxs)("div",{className:"mb-5",children:[(0,tB.jsxs)("button",{onClick:()=>k(!A),className:"w-full flex items-center justify-between p-3 rounded-xl border-2 border-dashed border-slate-200 hover:border-indigo-300 hover:bg-indigo-50/50 transition-all text-sm group",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-2",children:[(0,tB.jsx)(gd,{size:16,className:"text-indigo-500"}),(0,tB.jsx)("span",{className:"font-medium text-slate-700 group-hover:text-indigo-700",children:"Customize & Regenerate Captions"}),("default"!==O||D||P)&&(0,tB.jsx)("span",{className:"px-2 py-0.5 bg-indigo-100 text-indigo-600 text-xs font-medium rounded-full",children:"Customized"})]}),A?(0,tB.jsx)(yT,{size:18,className:"text-slate-400 group-hover:text-indigo-500"}):(0,tB.jsx)(yC,{size:18,className:"text-slate-400 group-hover:text-indigo-500"})]}),(0,tB.jsx)("div",{className:`
              overflow-hidden transition-all duration-300 ease-in-out
              ${A?"max-h-[500px] opacity-100 mt-3":"max-h-0 opacity-0"}
            `,children:(0,tB.jsxs)("div",{className:"p-4 bg-gradient-to-br from-slate-50 to-indigo-50/30 rounded-xl border border-slate-200 space-y-4",children:[(0,tB.jsxs)("div",{children:[(0,tB.jsx)("label",{className:"block text-xs font-semibold text-slate-500 uppercase tracking-wide mb-2",children:"Tone"}),(0,tB.jsx)("div",{className:"flex flex-wrap gap-2",children:by.map(e=>(0,tB.jsxs)("button",{onClick:()=>{R(e.value),"default"!==e.value&&j("")},className:`
                          px-3 py-1.5 rounded-full text-sm font-medium transition-all flex items-center gap-1.5
                          ${O===e.value?"bg-indigo-600 text-white shadow-md shadow-indigo-500/20":"bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:text-indigo-600"}
                        `,children:[(0,tB.jsx)("span",{children:e.emoji}),e.label]},e.value))})]}),(0,tB.jsxs)("div",{children:[(0,tB.jsxs)("label",{className:"block text-xs font-semibold text-slate-500 uppercase tracking-wide mb-2",children:["Custom Tone ",(0,tB.jsx)("span",{className:"font-normal text-slate-400",children:"(optional)"})]}),(0,tB.jsx)("input",{type:"text",value:D,onChange:e=>{j(e.target.value),e.target.value&&R("default")},placeholder:"e.g., Playful and Gen-Z friendly, Luxury and exclusive...",className:"w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-800 placeholder-slate-400 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-400 outline-none transition-all"})]}),(0,tB.jsxs)("div",{children:[(0,tB.jsxs)("label",{className:"block text-xs font-semibold text-slate-500 uppercase tracking-wide mb-2",children:["Additional Context ",(0,tB.jsx)("span",{className:"font-normal text-slate-400",children:"(optional)"})]}),(0,tB.jsx)("textarea",{value:P,onChange:e=>M(e.target.value),placeholder:"e.g., This is a limited edition summer drop, mention 20% off sale, target young professionals...",rows:2,className:"w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-800 placeholder-slate-400 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-400 outline-none resize-none transition-all"})]}),(0,tB.jsx)("button",{onClick:er,disabled:U,className:`
                    w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-sm transition-all
                    ${U?"bg-slate-200 text-slate-500 cursor-not-allowed":"bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg shadow-indigo-500/25 hover:shadow-xl hover:shadow-indigo-500/30 hover:-translate-y-0.5"}
                  `,children:U?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(tX,{className:"animate-spin",size:16}),"Regenerating Captions..."]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(yS,{size:16}),"Regenerate Captions"]})})]})})]}),(0,tB.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,tB.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,tB.jsx)("label",{className:"block text-xs font-semibold text-slate-500 uppercase tracking-wide",children:"Edit Caption"}),"both"===v&&(0,tB.jsxs)("span",{className:"text-xs text-indigo-600 font-medium flex items-center gap-1",children:[(0,tB.jsx)(y_,{size:12}),"Synced to both"]})]}),(0,tB.jsx)("textarea",{value:"both"===v?l.instagram:l[v],onChange:e=>{var t;return t=e.target.value,void u(e=>"both"===v?{facebook:t,instagram:t}:{...e,[v]:t})},className:"w-full flex-1 min-h-[160px] p-4 bg-slate-50 border-2 border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-400 outline-none resize-none text-sm text-slate-800 leading-relaxed placeholder-slate-400 transition-all",placeholder:"Write your caption here..."})]}),(0,tB.jsxs)("div",{className:"mt-5 flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-100",children:[(0,tB.jsx)("div",{className:"text-xs text-slate-500 space-y-1",children:"both"===v?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsxs)("p",{className:"flex items-center gap-2",children:[(0,tB.jsx)("span",{className:`w-2 h-2 rounded-full ${z.facebook.connected&&z.instagram.connected?"bg-emerald-500":"bg-amber-500 animate-pulse"}`}),(0,tB.jsx)("span",{className:z.facebook.connected&&z.instagram.connected?"text-emerald-600 font-medium":"text-amber-600",children:z.facebook.connected&&z.instagram.connected?"Ready to publish to both":"Connection required"})]}),(0,tB.jsxs)("p",{className:"flex items-center gap-2",children:[(0,tB.jsx)(yd,{size:12,className:"text-pink-600"}),(0,tB.jsx)(yh,{size:12,className:"text-blue-600"}),(0,tB.jsx)("span",{children:"Both platforms"}),E&&(0,tB.jsxs)("span",{className:"text-indigo-600 font-medium flex items-center gap-1 ml-1",children:[" ",(0,tB.jsx)(gy,{size:10})," ",e.length," images"]})]})]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsxs)("p",{className:"flex items-center gap-2",children:[(0,tB.jsx)("span",{className:`w-2 h-2 rounded-full ${et?.connected?"bg-emerald-500":"bg-amber-500 animate-pulse"}`}),(0,tB.jsx)("span",{className:et?.connected?"text-emerald-600 font-medium":"text-amber-600",children:et?.connected?"Ready to publish":"Connection required"})]}),(0,tB.jsxs)("p",{className:"flex items-center gap-2",children:["instagram"===v?(0,tB.jsx)(yd,{size:12}):(0,tB.jsx)(yh,{size:12}),(0,tB.jsx)("span",{className:"capitalize",children:v}),E&&(0,tB.jsxs)("span",{className:"text-indigo-600 font-medium flex items-center gap-1 ml-1",children:[" ",(0,tB.jsx)(gy,{size:10})," ",e.length," images"]})]})]})}),(0,tB.jsxs)("div",{className:"flex items-center gap-3",children:[(0,tB.jsxs)("button",{onClick:()=>N(!0),disabled:"both"===v&&(!l.facebook.trim()||!l.instagram.trim())||"both"!==v&&!l[v].trim(),className:"flex items-center gap-2 px-5 py-2.5 rounded-xl font-semibold text-slate-700 bg-white border-2 border-slate-200 hover:border-indigo-300 hover:bg-indigo-50 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,tB.jsx)(tY,{size:16}),"Schedule"]}),"both"===v?z.facebook.connected&&z.instagram.connected?(0,tB.jsx)("button",{onClick:ee,disabled:f||!l.facebook.trim()||!l.instagram.trim(),className:"flex items-center gap-2 px-6 py-2.5 rounded-xl font-semibold text-white transition-all bg-gradient-to-r from-indigo-600 to-purple-600 shadow-lg shadow-indigo-500/25 hover:shadow-xl hover:shadow-indigo-500/30 hover:-translate-y-0.5 disabled:bg-slate-300 disabled:cursor-not-allowed disabled:shadow-none disabled:translate-y-0",children:f?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(tX,{className:"animate-spin",size:16}),"Publishing to Both..."]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(yp,{size:16}),"Post Now"]})}):(0,tB.jsx)("span",{className:"text-xs text-slate-400",children:"Connect both accounts to post"}):et?.connected?(0,tB.jsx)("button",{onClick:Z,disabled:d||f||!l[v].trim(),className:`
                      flex items-center gap-2 px-6 py-2.5 rounded-xl font-semibold text-white transition-all
                      ${d||f||!l[v].trim()?"bg-slate-300 cursor-not-allowed":"instagram"===v?"bg-gradient-to-r from-purple-500 via-pink-500 to-orange-400 shadow-lg shadow-pink-500/25 hover:shadow-xl hover:shadow-pink-500/30 hover:-translate-y-0.5":"bg-blue-600 shadow-lg shadow-blue-500/25 hover:bg-blue-700 hover:shadow-xl hover:-translate-y-0.5"}
                    `,children:d?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(tX,{className:"animate-spin",size:16}),"Publishing..."]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(yp,{size:16}),"Post Now"]})}):(0,tB.jsx)("button",{onClick:()=>X(),disabled:$,className:"flex items-center gap-2 px-5 py-2.5 rounded-xl font-semibold text-white shadow-md transition-all bg-slate-800 hover:bg-slate-900 disabled:opacity-70",children:$?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(tX,{className:"animate-spin",size:16}),"Connecting..."]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(yv,{size:16}),"Connect ","instagram"===v?"Instagram":"Facebook"]})})]})]}),"both"===v?(!z.facebook.connected||!z.instagram.connected)&&(0,tB.jsxs)("div",{className:"mt-4 p-4 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200/50 rounded-xl text-sm",children:[(0,tB.jsxs)("p",{className:"font-semibold text-amber-800 flex items-center gap-2 mb-2",children:[(0,tB.jsx)(yw,{size:14}),"Setup Required"]}),(0,tB.jsx)("p",{className:"text-amber-700 leading-relaxed mb-2",children:"To post to both platforms, you need to connect both your Instagram and Facebook accounts."}),(0,tB.jsxs)("div",{className:"flex gap-2 mt-3",children:[!z.instagram.connected&&(0,tB.jsxs)("button",{onClick:()=>X("instagram"),disabled:$,className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-amber-800 bg-white border border-amber-200 hover:bg-amber-50 transition-colors disabled:opacity-50",children:[(0,tB.jsx)(yd,{size:14}),"Connect Instagram"]}),!z.facebook.connected&&(0,tB.jsxs)("button",{onClick:()=>X("facebook"),disabled:$,className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-amber-800 bg-white border border-amber-200 hover:bg-amber-50 transition-colors disabled:opacity-50",children:[(0,tB.jsx)(yh,{size:14}),"Connect Facebook"]})]}),(0,tB.jsxs)("a",{href:"https://developers.facebook.com/docs/instagram-api/getting-started",target:"_blank",rel:"noopener noreferrer",className:"text-amber-700 font-medium hover:text-amber-800 mt-3 inline-flex items-center gap-1 transition-colors",children:["Learn more ",(0,tB.jsx)(yw,{size:12})]})]}):!et?.connected&&(0,tB.jsxs)("div",{className:"mt-4 p-4 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200/50 rounded-xl text-sm",children:[(0,tB.jsxs)("p",{className:"font-semibold text-amber-800 flex items-center gap-2 mb-1",children:[(0,tB.jsx)(yw,{size:14}),"Setup Required"]}),(0,tB.jsx)("p",{className:"text-amber-700 leading-relaxed",children:"instagram"===v?"Instagram posting requires a Facebook Page connected to an Instagram Business or Creator account.":"You'll need to grant access to a Facebook Page you manage."}),(0,tB.jsxs)("a",{href:"https://developers.facebook.com/docs/instagram-api/getting-started",target:"_blank",rel:"noopener noreferrer",className:"text-amber-700 font-medium hover:text-amber-800 mt-2 inline-flex items-center gap-1 transition-colors",children:["Learn more ",(0,tB.jsx)(yw,{size:12})]})]})]})]}),_&&(0,tB.jsx)(yu,{mockups:e,onSave:e=>{T(e),I(!1)},onClose:()=>I(!1)}),(0,tB.jsx)(yy,{isOpen:S,onClose:()=>N(!1),onSchedule:en,platforms:"both"===v?["instagram","facebook"]:[v],mockups:B,captions:l})]})};var bx=((eE={}).UPLOAD="UPLOAD",eE.MOCKUP_GENERATION="MOCKUP_GENERATION",eE.CAPTIONING="CAPTIONING",eE.REVIEW="REVIEW",eE.SUCCESS="SUCCESS",eE);let bw=tW("cloud-upload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]),bE=tW("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),b_=tW("pen-tool",[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]),bI=[{id:bx.UPLOAD,label:"Upload",icon:bw},{id:bx.MOCKUP_GENERATION,label:"Mockup",icon:bE},{id:bx.CAPTIONING,label:"Captions",icon:b_},{id:bx.REVIEW,label:"Review",icon:gg}],bC=({currentStep:e,onStepClick:t})=>{let n=bI.findIndex(t=>t.id===e),r=n>0?n/(bI.length-1)*100:0;return(0,tB.jsx)("div",{className:"w-full max-w-2xl mx-auto mb-10",children:(0,tB.jsxs)("div",{className:"flex justify-between items-center relative",children:[(0,tB.jsx)("div",{className:"absolute left-[5%] right-[5%] top-5 h-0.5 bg-slate-200"}),(0,tB.jsx)("div",{className:"absolute left-[5%] top-5 h-0.5 bg-gradient-to-r from-indigo-600 to-indigo-500 transition-all duration-500 ease-out",style:{width:`${.9*r}%`}}),bI.map((e,r)=>{let i=r<n?"completed":r===n?"current":"upcoming",s=e.icon,a=r<n&&t;return(0,tB.jsxs)("div",{className:`
                flex flex-col items-center relative z-10
                ${a?"cursor-pointer group":""}
              `,onClick:()=>{var i;return i=e.id,void(r<n&&t&&t(i))},children:[(0,tB.jsx)("div",{className:`
                w-10 h-10 rounded-xl flex items-center justify-center transition-all duration-300
                ${"completed"===i?"bg-gradient-to-br from-indigo-600 to-indigo-500 text-white shadow-md shadow-indigo-500/30":"current"===i?"bg-white border-2 border-indigo-500 text-indigo-600 shadow-lg animate-pulse-ring":"bg-slate-100 border-2 border-slate-200 text-slate-400"}
                ${a?"group-hover:scale-110 group-hover:shadow-lg":""}
              `,children:"completed"===i?(0,tB.jsx)(gf,{size:18,strokeWidth:3}):(0,tB.jsx)(s,{size:18})}),(0,tB.jsx)("span",{className:`
                text-xs mt-2.5 font-semibold transition-colors
                ${"completed"===i?"text-indigo-600":"current"===i?"text-slate-800":"text-slate-400"}
                ${a?"group-hover:text-indigo-700":""}
              `,children:e.label}),a&&(0,tB.jsx)("span",{className:"absolute -bottom-5 text-[10px] text-indigo-500 opacity-0 group-hover:opacity-100 transition-opacity font-medium",children:"Go back"})]},e.id)})]})})},bT=tW("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),bS={scheduled:{icon:tY,label:"Scheduled",bgColor:"bg-indigo-50",textColor:"text-indigo-700",iconColor:"text-indigo-500"},published:{icon:gg,label:"Published",bgColor:"bg-emerald-50",textColor:"text-emerald-700",iconColor:"text-emerald-500"},failed:{icon:yx,label:"Failed",bgColor:"bg-rose-50",textColor:"text-rose-700",iconColor:"text-rose-500"}},bN=({post:e,onReschedule:t,onDelete:n,onRetry:r,onAccountConnected:i,compact:s=!1})=>{let[a,o]=(0,tG.useState)(!1),[l,u]=(0,tG.useState)(null),[c,h]=(0,tG.useState)(null),[d,p]=(0,tG.useState)(!1),f=bS[e.status],m=f.icon,g=function(e){if(!e)return[];let t=[];return e.toLowerCase().includes("instagram")&&e.toLowerCase().includes("not connected")&&t.push("instagram"),e.toLowerCase().includes("facebook")&&e.toLowerCase().includes("not connected")&&t.push("facebook"),t}(e.error),y=g.length>0,v=c?g.filter(e=>!c[e]?.connected):g,b=y&&0===v.length;(0,tG.useEffect)(()=>{y&&"failed"===e.status&&(p(!0),gU().then(e=>h(e)).catch(console.error).finally(()=>p(!1)))},[y,e.status]);let x=async e=>{u(e);try{if(await gM(e)){let e=await gU();h(e),i?.()}}finally{u(null)}},w=e=>e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),E=e=>e.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return s?(0,tB.jsxs)("div",{className:`
        post-card group relative flex items-center gap-3 p-3 rounded-xl border cursor-pointer
        ${"failed"===e.status?"border-rose-200 bg-rose-50/50":"border-slate-200 bg-white hover:border-slate-300"}
        ${a?"z-40":""}
      `,children:[e.imageUrls[0]&&(0,tB.jsxs)("div",{className:"relative w-12 h-12 rounded-lg overflow-hidden bg-slate-100 flex-shrink-0",children:[(0,tB.jsx)("img",{src:e.imageUrls[0],alt:"Post preview",className:"w-full h-full object-cover"}),e.imageUrls.length>1&&(0,tB.jsxs)("div",{className:"absolute bottom-0 right-0 bg-black/60 text-white text-[10px] px-1 rounded-tl",children:[(0,tB.jsx)(gy,{size:8,className:"inline mr-0.5"}),e.imageUrls.length]})]}),(0,tB.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-1",children:[e.platforms.includes("instagram")&&(0,tB.jsx)(yd,{size:12,className:"text-pink-500"}),e.platforms.includes("facebook")&&(0,tB.jsx)(yh,{size:12,className:"text-blue-500"})]}),(0,tB.jsxs)("div",{className:`flex items-center gap-1 px-1.5 py-0.5 rounded ${f.bgColor}`,children:[(0,tB.jsx)(m,{size:10,className:f.iconColor}),(0,tB.jsx)("span",{className:`text-[10px] font-medium ${f.textColor}`,children:f.label})]})]}),(0,tB.jsx)("p",{className:"text-xs text-slate-600 line-clamp-1",children:e.captions.instagram||e.captions.facebook}),(0,tB.jsx)("p",{className:"text-[10px] text-slate-400 mt-1",children:w(e.scheduledFor)}),"failed"===e.status&&e.error&&(0,tB.jsx)("div",{className:`mt-2 p-2 rounded border ${b?"bg-emerald-50 border-emerald-100":"bg-rose-50 border-rose-100"}`,children:b?(0,tB.jsxs)("div",{className:"flex items-center justify-between",children:[(0,tB.jsxs)("p",{className:"text-[10px] text-emerald-600 font-medium flex items-center gap-1",children:[(0,tB.jsx)(gg,{size:10}),"Accounts connected! Ready to retry"]}),r&&(0,tB.jsxs)("button",{onClick:t=>{t.stopPropagation(),r(e)},className:"flex items-center gap-1 px-2 py-1 rounded bg-emerald-500 text-white text-[10px] font-medium hover:bg-emerald-600 transition-colors",children:[(0,tB.jsx)(yS,{size:10}),"Retry Now"]})]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsxs)("p",{className:"text-[10px] text-rose-600 leading-relaxed mb-1",children:[(0,tB.jsx)(yx,{size:10,className:"inline mr-1"}),e.error]}),v.length>0&&!d&&(0,tB.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:v.map(e=>(0,tB.jsxs)("button",{onClick:t=>{t.stopPropagation(),x(e)},disabled:null!==l,className:`
                            flex items-center gap-1 px-2 py-1 rounded text-[10px] font-medium transition-colors
                            ${"instagram"===e?"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:from-purple-600 hover:to-pink-600":"bg-blue-600 text-white hover:bg-blue-700"}
                            disabled:opacity-50 disabled:cursor-not-allowed
                          `,children:[l===e?(0,tB.jsx)(tX,{size:10,className:"animate-spin"}):(0,tB.jsx)(yv,{size:10}),"Connect ","instagram"===e?"Instagram":"Facebook"]},e))}),d&&(0,tB.jsxs)("div",{className:"flex items-center gap-1 mt-2 text-[10px] text-slate-500",children:[(0,tB.jsx)(tX,{size:10,className:"animate-spin"}),"Checking account status..."]})]})})]}),(t||n||r)&&(0,tB.jsxs)("div",{className:`transition-opacity ${a?"opacity-100 z-50":"opacity-0 group-hover:opacity-100"}`,children:[(0,tB.jsx)("button",{onClick:e=>{e.stopPropagation(),o(!a)},className:"p-1.5 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-600",children:(0,tB.jsx)(bT,{size:14})}),a&&(0,tB.jsxs)("div",{className:"absolute right-2 top-full mt-1 bg-white rounded-lg shadow-xl border border-slate-200 py-1 z-50 min-w-[140px]",children:["failed"===e.status&&r&&(0,tB.jsxs)("button",{onClick:t=>{t.stopPropagation(),r(e),o(!1)},className:"w-full px-3 py-2 text-left text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2",children:[(0,tB.jsx)(yS,{size:14}),"Retry"]}),"scheduled"===e.status&&t&&(0,tB.jsxs)("button",{onClick:n=>{n.stopPropagation(),t(e),o(!1)},className:"w-full px-3 py-2 text-left text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2",children:[(0,tB.jsx)(yc,{size:14}),"Reschedule"]}),n&&(0,tB.jsxs)("button",{onClick:t=>{t.stopPropagation(),n(e),o(!1)},className:"w-full px-3 py-2 text-left text-sm text-rose-600 hover:bg-rose-50 flex items-center gap-2",children:[(0,tB.jsx)(tJ,{size:14}),"Delete"]})]})]})]}):(0,tB.jsxs)("div",{className:`
      post-card bg-white rounded-2xl border overflow-hidden
      ${"failed"===e.status?"border-rose-200":"border-slate-200"}
    `,children:[e.imageUrls[0]&&(0,tB.jsxs)("div",{className:"relative aspect-square bg-slate-100",children:[(0,tB.jsx)("img",{src:e.imageUrls[0],alt:"Post preview",className:"w-full h-full object-cover"}),e.imageUrls.length>1&&(0,tB.jsxs)("div",{className:"absolute top-2 right-2 bg-black/60 text-white text-xs px-2 py-1 rounded-lg flex items-center gap-1",children:[(0,tB.jsx)(gy,{size:12}),e.imageUrls.length]}),(0,tB.jsxs)("div",{className:`absolute bottom-2 left-2 flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg ${f.bgColor}`,children:[(0,tB.jsx)(m,{size:14,className:f.iconColor}),(0,tB.jsx)("span",{className:`text-xs font-semibold ${f.textColor}`,children:f.label})]})]}),(0,tB.jsxs)("div",{className:"p-4",children:[(0,tB.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-2",children:[e.platforms.includes("instagram")&&(0,tB.jsx)("div",{className:"w-7 h-7 rounded-lg bg-gradient-to-br from-purple-500 via-pink-500 to-orange-400 flex items-center justify-center",children:(0,tB.jsx)(yd,{size:14,className:"text-white"})}),e.platforms.includes("facebook")&&(0,tB.jsx)("div",{className:"w-7 h-7 rounded-lg bg-blue-600 flex items-center justify-center",children:(0,tB.jsx)(yh,{size:14,className:"text-white"})})]}),(t||n||r)&&(0,tB.jsxs)("div",{className:"relative",children:[(0,tB.jsx)("button",{onClick:()=>o(!a),className:"p-2 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-600 transition-colors",children:(0,tB.jsx)(bT,{size:16})}),a&&(0,tB.jsxs)("div",{className:"absolute right-0 top-full mt-1 bg-white rounded-xl shadow-xl border border-slate-200 py-1 z-50 min-w-[160px]",children:["failed"===e.status&&r&&(0,tB.jsxs)("button",{onClick:()=>{r(e),o(!1)},className:"w-full px-4 py-2.5 text-left text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2",children:[(0,tB.jsx)(yS,{size:14}),"Retry Now"]}),"scheduled"===e.status&&t&&(0,tB.jsxs)("button",{onClick:()=>{t(e),o(!1)},className:"w-full px-4 py-2.5 text-left text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2",children:[(0,tB.jsx)(yc,{size:14}),"Reschedule"]}),n&&(0,tB.jsxs)("button",{onClick:()=>{n(e),o(!1)},className:"w-full px-4 py-2.5 text-left text-sm text-rose-600 hover:bg-rose-50 flex items-center gap-2",children:[(0,tB.jsx)(tJ,{size:14}),"Delete"]})]})]})]}),(0,tB.jsx)("p",{className:"text-sm text-slate-700 line-clamp-3 mb-3 leading-relaxed",children:e.captions.instagram||e.captions.facebook}),(0,tB.jsxs)("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[(0,tB.jsx)(tY,{size:12}),(0,tB.jsx)("span",{children:"published"===e.status&&e.publishedAt?`Published ${E(e.publishedAt)} at ${w(e.publishedAt)}`:`${E(e.scheduledFor)} at ${w(e.scheduledFor)}`})]}),"failed"===e.status&&e.error&&(0,tB.jsx)("div",{className:`mt-3 p-3 rounded-lg border ${b?"bg-emerald-50 border-emerald-100":"bg-rose-50 border-rose-100"}`,children:b?(0,tB.jsxs)("div",{children:[(0,tB.jsxs)("p",{className:"text-xs text-emerald-700 flex items-center gap-2 mb-3",children:[(0,tB.jsx)(gg,{size:14,className:"flex-shrink-0"}),(0,tB.jsx)("span",{className:"font-medium",children:"Accounts connected! Ready to retry"})]}),r&&(0,tB.jsxs)("button",{onClick:()=>r(e),className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-emerald-500 text-white text-sm font-medium hover:bg-emerald-600 transition-all shadow-md shadow-emerald-500/20 hover:-translate-y-0.5",children:[(0,tB.jsx)(yS,{size:14}),"Retry Post Now"]})]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsxs)("p",{className:"text-xs text-rose-700 flex items-start gap-2 mb-2",children:[(0,tB.jsx)(yx,{size:12,className:"flex-shrink-0 mt-0.5"}),e.error]}),v.length>0&&!d&&(0,tB.jsxs)("div",{className:"flex flex-wrap gap-2 mt-3 pt-3 border-t border-rose-100",children:[(0,tB.jsx)("span",{className:"text-xs text-rose-600 w-full mb-1",children:"Connect your accounts to retry:"}),v.map(e=>(0,tB.jsxs)("button",{onClick:()=>x(e),disabled:null!==l,className:`
                          flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all
                          ${"instagram"===e?"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:from-purple-600 hover:to-pink-600 shadow-md shadow-purple-500/20":"bg-blue-600 text-white hover:bg-blue-700 shadow-md shadow-blue-500/20"}
                          disabled:opacity-50 disabled:cursor-not-allowed hover:-translate-y-0.5
                        `,children:[l===e?(0,tB.jsx)(tX,{size:12,className:"animate-spin"}):"instagram"===e?(0,tB.jsx)(yd,{size:12}):(0,tB.jsx)(yh,{size:12}),"Connect ","instagram"===e?"Instagram":"Facebook"]},e))]}),d&&(0,tB.jsxs)("div",{className:"flex items-center gap-2 mt-3 text-xs text-slate-500",children:[(0,tB.jsx)(tX,{size:12,className:"animate-spin"}),"Checking account status..."]})]})})]})]})},bA=({status:e,count:t})=>(0,tB.jsx)("div",{className:`w-2 h-2 rounded-full ${{scheduled:"bg-indigo-500",published:"bg-emerald-500",failed:"bg-rose-500"}[e]}`,title:`${t||1} ${e}`}),bk=tW("calendar-clock",[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]),bO=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],bR=["January","February","March","April","May","June","July","August","September","October","November","December"],bD=({onCreatePost:e})=>{let t,n,r,[i,s]=(0,tG.useState)(new Date),[a,o]=(0,tG.useState)([]),[l,u]=(0,tG.useState)(null),[c,h]=(0,tG.useState)(!0),[d,p]=(0,tG.useState)("all"),[f,m]=(0,tG.useState)(null),[g,y]=(0,tG.useState)(null);(0,tG.useEffect)(()=>{var e;let t;h(!0);let n=(e=e=>{o(e),h(!1)},t=gG(),function(e,...t){var n;let r,i,s,a,o;e=nI(e);let l={includeMetadataChanges:!1,source:"default"},u=0;"object"!=typeof t[0]||ud(t[u])||(l=t[u++]);let c={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(ud(t[u])){let e=t[u];t[u]=e.next?.bind(e),t[u+1]=e.error?.bind(e),t[u+2]=e.complete?.bind(e)}if(e instanceof us)i=is(e.firestore,up),s=new sI(e._key.path),r={next:n=>{var r,s,a;let o,l;t[u]&&t[u]((r=i,s=e,o=(a=n).docs.get(s._key),l=new u4(r),new u2(r,l,s._key,o,new u1(a.hasPendingWrites,a.fromCache),s.converter)))},error:t[u+1],complete:t[u+2]};else{let n=is(e,ui);i=is(n.firestore,up),s=n._query;let a=new u4(i);r={next:e=>{t[u]&&t[u](new u6(i,a,n,e))},error:t[u+1],complete:t[u+2]},uq(e._query)}return n=uf(i),o=new lw(s,a=new l0(r),c),n.asyncQueue.enqueueAndForget(async()=>lg(await l8(n),o)),()=>{a.Nu(),n.asyncQueue.enqueueAndForget(async()=>ly(await l8(n),o))}}(uz(uo(pG,gB),u$("sessionId","==",t),uJ("scheduledFor","asc")),t=>{e(t.docs.map(gz))}));return()=>n()},[]);let{daysInMonth:v,startingDay:b,year:x,month:w}=(t=i.getFullYear(),r=new Date(t,n=i.getMonth(),1),{daysInMonth:new Date(t,n+1,0).getDate(),startingDay:r.getDay(),year:t,month:n}),E=function(e){let t=new Map;for(let n of e){let e=gY(n.scheduledFor);t.has(e)||t.set(e,[]),t.get(e).push(n)}return t}(a),_="all"===d?a:a.filter(e=>e.status===d),I=e=>{let t=gY(new Date(x,w,e)),n=E.get(t)||[];return"all"===d?n:n.filter(e=>e.status===d)},C=l?I(l.getDate()):[],T=a.reduce((e,t)=>(e[t.status]++,e),{scheduled:0,published:0,failed:0}),S=async e=>{confirm("Are you sure you want to delete this scheduled post?")&&await gJ(e.id)},N=e=>{m(e)},A=e=>{y(e)},k=async e=>{await gX(e.id,new Date(Date.now()+3e4)),y(null)},O=async(e,t)=>{await gX(e.id,t),y(null)},R=()=>{console.log("Account connected! You can now retry failed posts.")},D=new Date,j=D.getMonth()===w&&D.getFullYear()===x;return(0,tB.jsxs)("div",{className:"min-h-[calc(100vh-8rem)]",children:[(0,tB.jsxs)("div",{className:"mb-8",children:[(0,tB.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,tB.jsxs)("div",{children:[(0,tB.jsx)("h1",{className:"text-3xl font-display font-bold text-slate-900 mb-2",children:"Content Calendar"}),(0,tB.jsx)("p",{className:"text-slate-500",children:"Manage your scheduled posts and publishing history"})]}),e&&(0,tB.jsxs)("button",{onClick:e,className:"flex items-center gap-2 px-5 py-2.5 rounded-xl font-semibold text-white bg-gradient-to-r from-indigo-600 to-purple-600 shadow-lg shadow-indigo-500/25 hover:shadow-xl hover:shadow-indigo-500/30 hover:-translate-y-0.5 transition-all",children:[(0,tB.jsx)(gI,{size:18}),"Create Post"]})]}),(0,tB.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,tB.jsx)("button",{onClick:()=>p("scheduled"===d?"all":"scheduled"),className:`
              p-4 rounded-xl border-2 transition-all
              ${"scheduled"===d?"border-indigo-400 bg-indigo-50":"border-slate-200 bg-white hover:border-slate-300"}
            `,children:(0,tB.jsxs)("div",{className:"flex items-center gap-3",children:[(0,tB.jsx)("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${"scheduled"===d?"bg-indigo-500":"bg-indigo-100"}`,children:(0,tB.jsx)(tY,{size:18,className:"scheduled"===d?"text-white":"text-indigo-600"})}),(0,tB.jsxs)("div",{className:"text-left",children:[(0,tB.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:T.scheduled}),(0,tB.jsx)("p",{className:"text-xs text-slate-500 font-medium",children:"Scheduled"})]})]})}),(0,tB.jsx)("button",{onClick:()=>p("published"===d?"all":"published"),className:`
              p-4 rounded-xl border-2 transition-all
              ${"published"===d?"border-emerald-400 bg-emerald-50":"border-slate-200 bg-white hover:border-slate-300"}
            `,children:(0,tB.jsxs)("div",{className:"flex items-center gap-3",children:[(0,tB.jsx)("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${"published"===d?"bg-emerald-500":"bg-emerald-100"}`,children:(0,tB.jsx)(gg,{size:18,className:"published"===d?"text-white":"text-emerald-600"})}),(0,tB.jsxs)("div",{className:"text-left",children:[(0,tB.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:T.published}),(0,tB.jsx)("p",{className:"text-xs text-slate-500 font-medium",children:"Published"})]})]})}),(0,tB.jsx)("button",{onClick:()=>p("failed"===d?"all":"failed"),className:`
              p-4 rounded-xl border-2 transition-all
              ${"failed"===d?"border-rose-400 bg-rose-50":"border-slate-200 bg-white hover:border-slate-300"}
            `,children:(0,tB.jsxs)("div",{className:"flex items-center gap-3",children:[(0,tB.jsx)("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${"failed"===d?"bg-rose-500":"bg-rose-100"}`,children:(0,tB.jsx)(yx,{size:18,className:"failed"===d?"text-white":"text-rose-600"})}),(0,tB.jsxs)("div",{className:"text-left",children:[(0,tB.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:T.failed}),(0,tB.jsx)("p",{className:"text-xs text-slate-500 font-medium",children:"Failed"})]})]})})]})]}),(0,tB.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,tB.jsxs)("div",{className:"lg:col-span-2 bg-white rounded-2xl shadow-sm border border-slate-200 p-6",children:[(0,tB.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,tB.jsx)("button",{onClick:()=>{s(new Date(x,w-1)),u(null)},className:"p-2 rounded-xl hover:bg-slate-100 transition-colors",children:(0,tB.jsx)(gE,{size:20,className:"text-slate-600"})}),(0,tB.jsxs)("h2",{className:"text-xl font-display font-bold text-slate-800",children:[bR[w]," ",x]}),(0,tB.jsx)("button",{onClick:()=>{s(new Date(x,w+1)),u(null)},className:"p-2 rounded-xl hover:bg-slate-100 transition-colors",children:(0,tB.jsx)(g_,{size:20,className:"text-slate-600"})})]}),(0,tB.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-2",children:bO.map(e=>(0,tB.jsx)("div",{className:"text-center text-xs font-semibold text-slate-400 py-2",children:e},e))}),c?(0,tB.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,tB.jsxs)("div",{className:"text-center",children:[(0,tB.jsx)(tX,{className:"w-8 h-8 animate-spin text-indigo-500 mx-auto mb-3"}),(0,tB.jsx)("p",{className:"text-sm text-slate-500",children:"Loading your posts..."})]})}):(0,tB.jsxs)("div",{className:"grid grid-cols-7 gap-1 calendar-grid",children:[Array.from({length:b}).map((e,t)=>(0,tB.jsx)("div",{className:"aspect-square"},`empty-${t}`)),Array.from({length:v}).map((e,t)=>{let n=t+1,r=I(n),i=j&&D.getDate()===n,s=l?.getDate()===n&&l?.getMonth()===w&&l?.getFullYear()===x,a=new Date(x,w,n)<new Date(D.getFullYear(),D.getMonth(),D.getDate()),o=[...new Set(r.map(e=>e.status))];return(0,tB.jsxs)("button",{onClick:()=>{let e;return e=new Date(x,w,n),void(l?.getTime()===e.getTime()?u(null):u(e))},style:{animationDelay:`${15*t}ms`},className:`
                      calendar-day relative aspect-square p-1 rounded-xl flex flex-col items-center justify-start pt-2
                      ${s?"bg-indigo-600 text-white shadow-lg shadow-indigo-500/30 scale-105":i?"bg-indigo-50 text-indigo-600 ring-2 ring-indigo-300":a?"text-slate-300 hover:bg-slate-50 cursor-default":"text-slate-700 hover:bg-slate-100"}
                    `,children:[(0,tB.jsx)("span",{className:`text-sm font-medium ${s?"text-white":""}`,children:n}),r.length>0&&(0,tB.jsxs)("div",{className:"flex items-center gap-0.5 mt-1",children:[o.slice(0,3).map((e,t)=>(0,tB.jsx)(bA,{status:e,count:r.filter(t=>t.status===e).length},t)),r.length>3&&(0,tB.jsxs)("span",{className:`text-[8px] ml-0.5 ${s?"text-indigo-200":"text-slate-400"}`,children:["+",r.length-3]})]})]},n)})]}),(0,tB.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-6 pt-4 border-t border-slate-100",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-2",children:[(0,tB.jsx)("div",{className:"w-2 h-2 rounded-full bg-indigo-500"}),(0,tB.jsx)("span",{className:"text-xs text-slate-500",children:"Scheduled"})]}),(0,tB.jsxs)("div",{className:"flex items-center gap-2",children:[(0,tB.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),(0,tB.jsx)("span",{className:"text-xs text-slate-500",children:"Published"})]}),(0,tB.jsxs)("div",{className:"flex items-center gap-2",children:[(0,tB.jsx)("div",{className:"w-2 h-2 rounded-full bg-rose-500"}),(0,tB.jsx)("span",{className:"text-xs text-slate-500",children:"Failed"})]})]})]}),(0,tB.jsxs)("div",{className:"lg:col-span-1",children:[(0,tB.jsx)("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 p-5 sticky top-24",children:l?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,tB.jsxs)("div",{children:[(0,tB.jsx)("h3",{className:"font-display font-bold text-slate-800",children:l.toLocaleDateString("en-US",{weekday:"long"})}),(0,tB.jsx)("p",{className:"text-sm text-slate-500",children:l.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),(0,tB.jsx)("button",{onClick:()=>u(null),className:"p-1.5 rounded-lg hover:bg-slate-100 text-slate-400",children:(0,tB.jsx)(gm,{size:16})})]}),C.length>0?(0,tB.jsx)("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto",children:C.sort((e,t)=>e.scheduledFor.getTime()-t.scheduledFor.getTime()).map(e=>(0,tB.jsx)(bN,{post:e,compact:!0,onDelete:S,onReschedule:"scheduled"===e.status?N:void 0,onRetry:"failed"===e.status?A:void 0,onAccountConnected:R},e.id))}):(0,tB.jsxs)("div",{className:"text-center py-8",children:[(0,tB.jsx)("div",{className:"w-12 h-12 rounded-xl bg-slate-100 flex items-center justify-center mx-auto mb-3",children:(0,tB.jsx)(yc,{size:20,className:"text-slate-400"})}),(0,tB.jsx)("p",{className:"text-sm text-slate-500 mb-4",children:"No posts scheduled for this day"}),e&&new Date(l)>=new Date(D.getFullYear(),D.getMonth(),D.getDate())&&(0,tB.jsxs)("button",{onClick:e,className:"text-sm font-medium text-indigo-600 hover:text-indigo-700 flex items-center gap-1 mx-auto",children:[(0,tB.jsx)(gI,{size:14}),"Create a post"]})]})]}):(0,tB.jsxs)("div",{className:"text-center py-8",children:[(0,tB.jsx)("div",{className:"w-12 h-12 rounded-xl bg-indigo-50 flex items-center justify-center mx-auto mb-3",children:(0,tB.jsx)(yc,{size:20,className:"text-indigo-500"})}),(0,tB.jsx)("p",{className:"text-sm font-medium text-slate-700 mb-1",children:"Select a day"}),(0,tB.jsx)("p",{className:"text-xs text-slate-500",children:"Click on a day to see scheduled posts"})]})}),!l&&_.filter(e=>"scheduled"===e.status).length>0&&(0,tB.jsxs)("div",{className:"mt-4 bg-white rounded-2xl shadow-sm border border-slate-200 p-5",children:[(0,tB.jsxs)("h3",{className:"font-display font-bold text-slate-800 mb-4 flex items-center gap-2",children:[(0,tB.jsx)(tY,{size:16,className:"text-indigo-500"}),"Upcoming"]}),(0,tB.jsx)("div",{className:"space-y-3",children:_.filter(e=>"scheduled"===e.status).slice(0,5).map(e=>(0,tB.jsx)(bN,{post:e,compact:!0,onDelete:S,onReschedule:N,onAccountConnected:R},e.id))})]})]})]}),f&&(0,tB.jsx)(bj,{post:f,onClose:()=>m(null),onReschedule:async e=>{await gW(f.id,e),m(null)}}),g&&(0,tB.jsx)(bP,{post:g,onClose:()=>y(null),onPostNow:()=>k(g),onSchedule:e=>O(g,e)})]})},bj=({post:e,onClose:t,onReschedule:n})=>{let[r,i]=(0,tG.useState)(e.scheduledFor.toISOString().split("T")[0]),[s,a]=(0,tG.useState)(e.scheduledFor.toTimeString().slice(0,5)),[o,l]=(0,tG.useState)(!1),u=async()=>{let e=new Date(`${r}T${s}`);if(e<=new Date)return void alert("Please select a future date and time");l(!0);try{await n(e)}finally{l(!1)}};return(0,tB.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,tB.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 animate-in fade-in zoom-in duration-200",children:[(0,tB.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,tB.jsx)("h3",{className:"text-lg font-display font-bold text-slate-900",children:"Reschedule Post"}),(0,tB.jsx)("button",{onClick:t,className:"p-1.5 rounded-lg hover:bg-slate-100 text-slate-400",children:(0,tB.jsx)(gm,{size:18})})]}),(0,tB.jsxs)("div",{className:"space-y-4",children:[(0,tB.jsxs)("div",{children:[(0,tB.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Date"}),(0,tB.jsx)("input",{type:"date",value:r,onChange:e=>i(e.target.value),min:new Date().toISOString().split("T")[0],className:"w-full px-4 py-2.5 rounded-xl border-2 border-slate-200 focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100 outline-none transition-all"})]}),(0,tB.jsxs)("div",{children:[(0,tB.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Time"}),(0,tB.jsx)("input",{type:"time",value:s,onChange:e=>a(e.target.value),className:"w-full px-4 py-2.5 rounded-xl border-2 border-slate-200 focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100 outline-none transition-all"})]})]}),(0,tB.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,tB.jsx)("button",{onClick:t,className:"flex-1 py-2.5 rounded-xl font-medium text-slate-700 bg-slate-100 hover:bg-slate-200 transition-colors",children:"Cancel"}),(0,tB.jsx)("button",{onClick:u,disabled:o,className:"flex-1 py-2.5 rounded-xl font-medium text-white bg-indigo-600 hover:bg-indigo-700 transition-colors disabled:opacity-70 flex items-center justify-center gap-2",children:o?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(tX,{size:16,className:"animate-spin"}),"Saving..."]}):"Reschedule"})]})]})})},bP=({post:e,onClose:t,onPostNow:n,onSchedule:r})=>{let[i,s]=(0,tG.useState)("choose"),[a,o]=(0,tG.useState)(new Date().toISOString().split("T")[0]),[l,u]=(0,tG.useState)(new Date(Date.now()+36e5).toTimeString().slice(0,5)),[c,h]=(0,tG.useState)(!1),d=async()=>{h(!0);try{await n()}finally{h(!1)}},p=async()=>{let e=new Date(`${a}T${l}`);if(e<=new Date)return void alert("Please select a future date and time");h(!0);try{await r(e)}finally{h(!1)}},f=e.captions.instagram||e.captions.facebook||"",m=f.length>80?f.slice(0,80)+"...":f;return(0,tB.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,tB.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 animate-in fade-in zoom-in duration-200",children:[(0,tB.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,tB.jsx)("h3",{className:"text-lg font-display font-bold text-slate-900",children:"Retry Post"}),(0,tB.jsx)("button",{onClick:t,className:"p-1.5 rounded-lg hover:bg-slate-100 text-slate-400",children:(0,tB.jsx)(gm,{size:18})})]}),(0,tB.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-slate-50 rounded-xl mb-6",children:[e.imageUrls[0]&&(0,tB.jsx)("img",{src:e.imageUrls[0],alt:"Post preview",className:"w-14 h-14 rounded-lg object-cover"}),(0,tB.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,tB.jsx)("p",{className:"text-sm text-slate-700 line-clamp-2",children:m}),(0,tB.jsx)("div",{className:"flex items-center gap-2 mt-1",children:e.platforms.map(e=>(0,tB.jsx)("span",{className:`text-xs px-1.5 py-0.5 rounded ${"instagram"===e?"bg-pink-100 text-pink-600":"bg-blue-100 text-blue-600"}`,children:"instagram"===e?"Instagram":"Facebook"},e))})]})]}),"choose"===i?(0,tB.jsxs)("div",{className:"space-y-3",children:[(0,tB.jsxs)("button",{onClick:d,disabled:c,className:"w-full flex items-center gap-3 p-4 rounded-xl border-2 border-emerald-200 bg-emerald-50 hover:bg-emerald-100 hover:border-emerald-300 transition-all group",children:[(0,tB.jsx)("div",{className:"w-10 h-10 rounded-xl bg-emerald-500 flex items-center justify-center group-hover:scale-105 transition-transform",children:c?(0,tB.jsx)(tX,{size:20,className:"text-white animate-spin"}):(0,tB.jsx)(gh,{size:20,className:"text-white"})}),(0,tB.jsxs)("div",{className:"text-left",children:[(0,tB.jsx)("p",{className:"font-semibold text-slate-900",children:"Post Now"}),(0,tB.jsx)("p",{className:"text-xs text-slate-500",children:"Publish immediately"})]})]}),(0,tB.jsxs)("button",{onClick:()=>s("schedule"),disabled:c,className:"w-full flex items-center gap-3 p-4 rounded-xl border-2 border-slate-200 hover:bg-slate-50 hover:border-slate-300 transition-all group",children:[(0,tB.jsx)("div",{className:"w-10 h-10 rounded-xl bg-indigo-500 flex items-center justify-center group-hover:scale-105 transition-transform",children:(0,tB.jsx)(bk,{size:20,className:"text-white"})}),(0,tB.jsxs)("div",{className:"text-left",children:[(0,tB.jsx)("p",{className:"font-semibold text-slate-900",children:"Schedule for Later"}),(0,tB.jsx)("p",{className:"text-xs text-slate-500",children:"Pick a specific date and time"})]})]})]}):(0,tB.jsxs)("div",{className:"space-y-4",children:[(0,tB.jsx)("button",{onClick:()=>s("choose"),className:"text-sm text-indigo-600 hover:text-indigo-700 flex items-center gap-1 mb-2",children:" Back to options"}),(0,tB.jsxs)("div",{children:[(0,tB.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Date"}),(0,tB.jsx)("input",{type:"date",value:a,onChange:e=>o(e.target.value),min:new Date().toISOString().split("T")[0],className:"w-full px-4 py-2.5 rounded-xl border-2 border-slate-200 focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100 outline-none transition-all"})]}),(0,tB.jsxs)("div",{children:[(0,tB.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Time"}),(0,tB.jsx)("input",{type:"time",value:l,onChange:e=>u(e.target.value),className:"w-full px-4 py-2.5 rounded-xl border-2 border-slate-200 focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100 outline-none transition-all"})]}),(0,tB.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,tB.jsx)("button",{onClick:t,className:"flex-1 py-2.5 rounded-xl font-medium text-slate-700 bg-slate-100 hover:bg-slate-200 transition-colors",children:"Cancel"}),(0,tB.jsx)("button",{onClick:p,disabled:c,className:"flex-1 py-2.5 rounded-xl font-medium text-white bg-indigo-600 hover:bg-indigo-700 transition-colors disabled:opacity-70 flex items-center justify-center gap-2",children:c?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(tX,{size:16,className:"animate-spin"}),"Scheduling..."]}):"Schedule"})]})]}),"choose"===i&&(0,tB.jsx)("button",{onClick:t,className:"w-full mt-4 py-2.5 rounded-xl font-medium text-slate-500 hover:text-slate-700 hover:bg-slate-100 transition-colors",children:"Cancel"})]})})},bM=tW("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),bU=({onCreatePost:e})=>{let[t,n]=(0,tG.useState)([]),[r,i]=(0,tG.useState)(!0),[s,a]=(0,tG.useState)(new Set),[o,l]=(0,tG.useState)(new Set),[u,c]=(0,tG.useState)(null),[h,d]=(0,tG.useState)(null);(0,tG.useEffect)(()=>{p()},[]),(0,tG.useEffect)(()=>{if(h){let e=setTimeout(()=>d(null),3e3);return()=>clearTimeout(e)}},[h]);let p=async()=>{i(!0);try{let e=await ga();n(e)}catch(e){console.error("Failed to load mockups:",e),d({message:"Failed to load images",type:"error"})}finally{i(!1)}},f=async(e,t)=>{t?.stopPropagation(),a(t=>new Set(t).add(e.id));try{var n,r,i,s,o;let t,a,l,u=pH.currentUser?.uid;if(!u)throw Error("Not authenticated");let c=c0(pz,`mockups/${u}/${e.id}.png`),h=await (n=c,r=n=nI(n),i=void 0,r._throwIfRoot("getBlob"),s=r.storage,o=r._location,t=cm(o.fullServerUrl(),s.host,s._protocol)+"?alt=media",(a=new cM(t,"GET",(e,t)=>t,s.maxOperationRetryTime)).errorHandler=cF(o),void 0!==i&&(a.headers.Range=`bytes=0-${i}`,a.successCodes=[200,206]),l=a,r.storage.makeRequestWithTokens(l,cz).then(e=>void 0!==i?e.slice(0,i):e)),p=window.URL.createObjectURL(h),f=document.createElement("a");f.href=p;let m=e.styleDescription.slice(0,30).replace(/[^a-z0-9]/gi,"_").toLowerCase();f.download=`mockup_${m}_${e.id.slice(0,8)}.png`,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(p),d({message:"Image downloaded successfully",type:"success"})}catch(e){console.error("Download failed:",e),d({message:"Failed to download image",type:"error"})}finally{a(t=>{let n=new Set(t);return n.delete(e.id),n})}},m=async(e,t)=>{if(t?.stopPropagation(),confirm("Are you sure you want to delete this image? This cannot be undone.")){l(t=>new Set(t).add(e.id));try{await go(e.id),n(t=>t.filter(t=>t.id!==e.id)),d({message:"Image deleted successfully",type:"success"}),u?.id===e.id&&c(null)}catch(e){console.error("Delete failed:",e),d({message:"Failed to delete image",type:"error"})}finally{l(t=>{let n=new Set(t);return n.delete(e.id),n})}}},g=e=>new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}).format(e);return(0,tB.jsxs)("div",{className:"min-h-[calc(100vh-8rem)]",children:[h&&(0,tB.jsx)("div",{className:"fixed top-20 right-4 z-50 animate-in slide-in-from-top-2 fade-in duration-300",children:(0,tB.jsxs)("div",{className:`
            flex items-center gap-2 px-4 py-3 rounded-xl shadow-lg
            ${"success"===h.type?"bg-emerald-500 text-white":"bg-rose-500 text-white"}
          `,children:["success"===h.type?(0,tB.jsx)(gg,{size:18}):(0,tB.jsx)(yx,{size:18}),(0,tB.jsx)("span",{className:"font-medium text-sm",children:h.message})]})}),(0,tB.jsxs)("div",{className:"mb-8",children:[(0,tB.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,tB.jsxs)("div",{children:[(0,tB.jsx)("h1",{className:"text-3xl font-display font-bold text-slate-900 mb-2",children:"Image Gallery"}),(0,tB.jsx)("p",{className:"text-slate-500",children:"Browse and download your generated mockups"})]}),e&&(0,tB.jsxs)("button",{onClick:e,className:"flex items-center gap-2 px-5 py-2.5 rounded-xl font-semibold text-white bg-gradient-to-r from-indigo-600 to-purple-600 shadow-lg shadow-indigo-500/25 hover:shadow-xl hover:shadow-indigo-500/30 hover:-translate-y-0.5 transition-all",children:[(0,tB.jsx)(bE,{size:18}),"Create Mockup"]})]}),(0,tB.jsx)("div",{className:"flex items-center gap-4",children:(0,tB.jsxs)("div",{className:"px-4 py-2 bg-white rounded-xl border border-slate-200 shadow-sm",children:[(0,tB.jsx)("span",{className:"text-2xl font-bold text-slate-900",children:t.length}),(0,tB.jsx)("span",{className:"text-sm text-slate-500 ml-2",children:1===t.length?"Image":"Images"})]})})]}),r?(0,tB.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,tB.jsxs)("div",{className:"text-center",children:[(0,tB.jsx)(tX,{className:"w-10 h-10 animate-spin text-indigo-500 mx-auto mb-4"}),(0,tB.jsx)("p",{className:"text-slate-500",children:"Loading your images..."})]})}):0===t.length?(0,tB.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,tB.jsx)("div",{className:"w-20 h-20 rounded-2xl bg-slate-100 flex items-center justify-center mb-6",children:(0,tB.jsx)(bE,{size:40,className:"text-slate-300"})}),(0,tB.jsx)("h3",{className:"text-xl font-display font-bold text-slate-700 mb-2",children:"No images yet"}),(0,tB.jsx)("p",{className:"text-slate-500 mb-6 text-center max-w-md",children:"Generated mockups will appear here. Create your first post to get started!"}),e&&(0,tB.jsxs)("button",{onClick:e,className:"flex items-center gap-2 px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-indigo-600 to-purple-600 shadow-lg shadow-indigo-500/25 hover:shadow-xl hover:shadow-indigo-500/30 hover:-translate-y-0.5 transition-all",children:[(0,tB.jsx)(bE,{size:18}),"Create Your First Mockup"]})]}):(0,tB.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5",children:t.map((e,t)=>(0,tB.jsxs)("div",{onClick:()=>c(e),style:{animationDelay:`${50*t}ms`},className:"group bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden cursor-pointer hover:shadow-lg hover:border-slate-300 hover:-translate-y-1 transition-all duration-300 animate-in fade-in slide-in-from-bottom-4",children:[(0,tB.jsxs)("div",{className:"relative aspect-square bg-slate-100 overflow-hidden",children:[(0,tB.jsx)("img",{src:e.imageUrl,alt:e.styleDescription,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",loading:"lazy"}),(0,tB.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:(0,tB.jsxs)("div",{className:"absolute bottom-3 left-3 right-3 flex items-center justify-end gap-2",children:[(0,tB.jsx)("button",{onClick:t=>f(e,t),disabled:s.has(e.id),className:"p-2.5 rounded-xl bg-white/90 backdrop-blur-sm text-slate-700 hover:bg-white hover:text-indigo-600 transition-colors shadow-lg disabled:opacity-70",title:"Download",children:s.has(e.id)?(0,tB.jsx)(tX,{size:18,className:"animate-spin"}):(0,tB.jsx)(bM,{size:18})}),(0,tB.jsx)("button",{onClick:t=>m(e,t),disabled:o.has(e.id),className:"p-2.5 rounded-xl bg-white/90 backdrop-blur-sm text-slate-700 hover:bg-rose-500 hover:text-white transition-colors shadow-lg disabled:opacity-70",title:"Delete",children:o.has(e.id)?(0,tB.jsx)(tX,{size:18,className:"animate-spin"}):(0,tB.jsx)(tJ,{size:18})})]})})]}),(0,tB.jsxs)("div",{className:"p-4",children:[(0,tB.jsx)("p",{className:"text-sm font-medium text-slate-700 line-clamp-2 mb-2 min-h-[2.5rem]",children:e.styleDescription}),(0,tB.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-slate-400",children:[(0,tB.jsx)(yc,{size:12}),(0,tB.jsx)("span",{children:g(e.createdAt)})]})]})]},e.id))}),u&&(0,tB.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200",onClick:()=>c(null),children:(0,tB.jsxs)("div",{className:"relative max-w-4xl w-full max-h-[90vh] bg-white rounded-2xl shadow-2xl overflow-hidden animate-in zoom-in-95 duration-300",onClick:e=>e.stopPropagation(),children:[(0,tB.jsx)("button",{onClick:()=>c(null),className:"absolute top-4 right-4 z-10 p-2 rounded-xl bg-black/50 backdrop-blur-sm text-white hover:bg-black/70 transition-colors",children:(0,tB.jsx)(gm,{size:20})}),(0,tB.jsx)("div",{className:"relative bg-slate-900 flex items-center justify-center max-h-[70vh] overflow-hidden",children:(0,tB.jsx)("img",{src:u.imageUrl,alt:u.styleDescription,className:"max-w-full max-h-[70vh] object-contain"})}),(0,tB.jsx)("div",{className:"p-6 bg-white",children:(0,tB.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,tB.jsxs)("div",{className:"flex-1",children:[(0,tB.jsx)("h3",{className:"text-lg font-display font-bold text-slate-900 mb-2",children:u.styleDescription}),(0,tB.jsxs)("div",{className:"flex items-center gap-1.5 text-sm text-slate-500",children:[(0,tB.jsx)(yc,{size:14}),(0,tB.jsx)("span",{children:g(u.createdAt)})]})]}),(0,tB.jsxs)("div",{className:"flex items-center gap-2",children:[(0,tB.jsx)("button",{onClick:()=>f(u),disabled:s.has(u.id),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl font-medium text-white bg-indigo-600 hover:bg-indigo-700 transition-colors disabled:opacity-70",children:s.has(u.id)?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(tX,{size:16,className:"animate-spin"}),"Downloading..."]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(bM,{size:16}),"Download"]})}),(0,tB.jsx)("button",{onClick:()=>m(u),disabled:o.has(u.id),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl font-medium text-rose-600 bg-rose-50 hover:bg-rose-100 transition-colors disabled:opacity-70",children:o.has(u.id)?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(tX,{size:16,className:"animate-spin"}),"Deleting..."]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)(tJ,{size:16}),"Delete"]})})]})]})})]})})]})},bL=new dN;async function bF(){return(await pc(pH,bL)).user}async function bV(){await nI(pH).signOut()}let bq=(0,tG.createContext)(null);function bB({children:e}){let[t,n]=(0,tG.useState)(null),[r,i]=(0,tG.useState)(!0);(0,tG.useEffect)(()=>{var e;let t=(e=e=>{n(e),i(!1)},nI(pH).onAuthStateChanged(e,void 0,void 0));return()=>t()},[]);let s=async()=>{try{await bF()}catch(e){throw console.error("Sign in failed:",e),e}},a=async()=>{try{await bV()}catch(e){throw console.error("Sign out failed:",e),e}};return(0,tB.jsx)(bq.Provider,{value:{user:t,loading:r,signIn:s,signOut:a},children:e})}function bG(){let e=(0,tG.useContext)(bq);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}let bz=tW("shirt",[["path",{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z",key:"1wgbhj"}]]);function bH(){let{signIn:e}=bG(),[t,n]=(0,tG.useState)(!1),[r,i]=(0,tG.useState)(null),s=async()=>{n(!0),i(null);try{await e()}catch(e){i("Failed to sign in. Please try again."),console.error("Sign in error:",e)}finally{n(!1)}};return(0,tB.jsxs)("div",{className:"min-h-screen flex flex-col bg-gradient-subtle",children:[(0,tB.jsxs)("header",{className:"bg-white/80 backdrop-blur-md border-b border-slate-200/50",children:[(0,tB.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-500/5 via-transparent to-pink-500/5"}),(0,tB.jsxs)("div",{className:"max-w-6xl mx-auto px-4 h-16 flex items-center justify-between relative",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-3",children:[(0,tB.jsx)("div",{className:"w-9 h-9 rounded-xl bg-gradient-to-br from-indigo-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-indigo-500/25",children:(0,tB.jsx)(bz,{size:20,className:"text-white",strokeWidth:2.5})}),(0,tB.jsxs)("h1",{className:"text-xl font-display font-bold tracking-tight text-slate-900",children:["Social",(0,tB.jsx)("span",{className:"bg-gradient-to-r from-indigo-600 to-indigo-500 bg-clip-text text-transparent",children:"Stitch"})]})]}),(0,tB.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-amber-50 border border-amber-200/50",children:[(0,tB.jsx)(gd,{size:14,className:"text-amber-500"}),(0,tB.jsx)("span",{className:"text-xs font-medium text-amber-700",children:"AI-Powered Marketing"})]})]})]}),(0,tB.jsx)("main",{className:"flex-1 flex items-center justify-center px-4 py-12",children:(0,tB.jsxs)("div",{className:"max-w-md w-full",children:[(0,tB.jsxs)("div",{className:"text-center mb-10",children:[(0,tB.jsx)("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-indigo-500 to-indigo-600 flex items-center justify-center mx-auto mb-6 shadow-xl shadow-indigo-500/30",children:(0,tB.jsx)(bz,{size:40,className:"text-white",strokeWidth:2})}),(0,tB.jsx)("h2",{className:"text-3xl font-display font-bold text-slate-900 mb-3",children:"Welcome to SocialStitch"}),(0,tB.jsx)("p",{className:"text-lg text-slate-500 leading-relaxed",children:"Create stunning t-shirt mockups with AI-generated photography and captions."})]}),(0,tB.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl shadow-slate-200/50 border border-slate-200/50 p-8",children:[(0,tB.jsx)("h3",{className:"text-lg font-semibold text-slate-900 text-center mb-6",children:"Sign in to continue"}),r&&(0,tB.jsx)("div",{className:"mb-4 p-3 rounded-xl bg-red-50 border border-red-200 text-red-700 text-sm text-center",children:r}),(0,tB.jsxs)("button",{onClick:s,disabled:t,className:"w-full flex items-center justify-center gap-3 px-6 py-3.5 rounded-xl font-semibold text-slate-700 bg-white border-2 border-slate-200 hover:border-slate-300 hover:bg-slate-50 transition-all disabled:opacity-70 disabled:cursor-not-allowed",children:[t?(0,tB.jsx)(tX,{size:20,className:"animate-spin"}):(0,tB.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[(0,tB.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,tB.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,tB.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,tB.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),t?"Signing in...":"Continue with Google"]}),(0,tB.jsx)("p",{className:"mt-6 text-center text-xs text-slate-400",children:"By signing in, you agree to our Terms of Service and Privacy Policy."})]}),(0,tB.jsxs)("div",{className:"mt-8 grid grid-cols-3 gap-4",children:[(0,tB.jsxs)("div",{className:"text-center",children:[(0,tB.jsx)("div",{className:"w-10 h-10 rounded-xl bg-indigo-100 flex items-center justify-center mx-auto mb-2",children:(0,tB.jsx)("span",{className:"text-lg",children:""})}),(0,tB.jsx)("p",{className:"text-xs font-medium text-slate-600",children:"AI Mockups"})]}),(0,tB.jsxs)("div",{className:"text-center",children:[(0,tB.jsx)("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center mx-auto mb-2",children:(0,tB.jsx)("span",{className:"text-lg",children:""})}),(0,tB.jsx)("p",{className:"text-xs font-medium text-slate-600",children:"Smart Captions"})]}),(0,tB.jsxs)("div",{className:"text-center",children:[(0,tB.jsx)("div",{className:"w-10 h-10 rounded-xl bg-emerald-100 flex items-center justify-center mx-auto mb-2",children:(0,tB.jsx)("span",{className:"text-lg",children:""})}),(0,tB.jsx)("p",{className:"text-xs font-medium text-slate-600",children:"Schedule Posts"})]})]})]})}),(0,tB.jsx)("footer",{className:"bg-white/50 backdrop-blur-sm border-t border-slate-200/50 py-6",children:(0,tB.jsx)("div",{className:"max-w-6xl mx-auto px-4 text-center text-slate-400 text-sm",children:(0,tB.jsxs)("p",{children:[" ",new Date().getFullYear()," SocialStitch. Built with React & Google Gemini."]})})})]})}let b$=tW("check-check",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]),bK=tW("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),bW=tW("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),bJ=tW("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),bY="socialstitch_session";function bX(){let e=new URLSearchParams(window.location.search);if(gq()&&(e.get("auth_success")||e.get("auth_error"))){let t=e.get("auth_success"),n=e.get("auth_error");return(0,tB.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100",children:(0,tB.jsx)("div",{className:"text-center p-8",children:t?(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-emerald-400 to-teal-500 text-white rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg",children:(0,tB.jsx)(gg,{size:32})}),(0,tB.jsx)("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Connected Successfully!"}),(0,tB.jsx)("p",{className:"text-slate-500",children:"You can close this window now."})]}):(0,tB.jsxs)(tB.Fragment,{children:[(0,tB.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-500 text-white rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg",children:(0,tB.jsx)("span",{className:"text-2xl",children:""})}),(0,tB.jsx)("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Connection Failed"}),(0,tB.jsx)("p",{className:"text-slate-500",children:n?decodeURIComponent(n):"Please try again."})]})})})}return(0,tB.jsx)(bB,{children:(0,tB.jsx)(bQ,{})})}function bQ(){let{user:e,loading:t,signOut:n}=bG(),[r,i]=(0,tG.useState)("workflow"),[s,a]=(0,tG.useState)(bx.UPLOAD),[o,l]=(0,tG.useState)(null),[u,c]=(0,tG.useState)([]),[h,d]=(0,tG.useState)(!1),p=(0,tG.useCallback)((e,t,n)=>{if(e===bx.SUCCESS)return void sessionStorage.removeItem(bY);try{let r={currentStep:e,design:t?{id:t.id,base64:t.base64,previewUrl:t.previewUrl}:null,selectedMockups:n};sessionStorage.setItem(bY,JSON.stringify(r))}catch(e){console.error("Failed to persist session:",e)}},[]);if((0,tG.useEffect)(()=>{if(e)try{let e=sessionStorage.getItem(bY);if(e){let t=JSON.parse(e);t.currentStep&&t.currentStep!==bx.SUCCESS&&(a(t.currentStep),t.design&&l({id:t.design.id,file:new File([],"restored"),previewUrl:t.design.previewUrl,base64:t.design.base64}),t.selectedMockups?.length&&c(t.selectedMockups),d(!0))}}catch(e){console.error("Failed to restore session:",e),sessionStorage.removeItem(bY)}},[e]),t)return(0,tB.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-subtle",children:(0,tB.jsxs)("div",{className:"text-center",children:[(0,tB.jsx)(tX,{className:"w-10 h-10 animate-spin text-indigo-500 mx-auto mb-4"}),(0,tB.jsx)("p",{className:"text-slate-500",children:"Loading..."})]})});if(!e)return(0,tB.jsx)(bH,{});let f=()=>{l(null),c([]),a(bx.UPLOAD),sessionStorage.removeItem(bY),d(!1)};return(0,tB.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,tB.jsxs)("header",{className:"bg-white/80 backdrop-blur-md border-b border-slate-200/50 sticky top-0 z-50",children:[(0,tB.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-500/5 via-transparent to-pink-500/5"}),(0,tB.jsxs)("div",{className:"max-w-6xl mx-auto px-4 h-16 flex items-center justify-between relative",children:[(0,tB.jsxs)("div",{className:"flex items-center gap-3",children:[(0,tB.jsx)("div",{className:"w-9 h-9 rounded-xl bg-gradient-to-br from-indigo-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-indigo-500/25",children:(0,tB.jsx)(bz,{size:20,className:"text-white",strokeWidth:2.5})}),(0,tB.jsxs)("h1",{className:"text-xl font-display font-bold tracking-tight text-slate-900",children:["Social",(0,tB.jsx)("span",{className:"bg-gradient-to-r from-indigo-600 to-indigo-500 bg-clip-text text-transparent",children:"Stitch"})]})]}),(0,tB.jsxs)("div",{className:"flex items-center gap-3",children:[(0,tB.jsxs)("div",{className:"flex items-center bg-slate-100 rounded-full p-1 border border-slate-200",children:[(0,tB.jsxs)("button",{onClick:()=>i("workflow"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium transition-all ${"workflow"===r?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[(0,tB.jsx)(bW,{size:12}),"Create"]}),(0,tB.jsxs)("button",{onClick:()=>i("calendar"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium transition-all ${"calendar"===r?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[(0,tB.jsx)(yc,{size:12}),"Calendar"]}),(0,tB.jsxs)("button",{onClick:()=>i("gallery"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium transition-all ${"gallery"===r?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[(0,tB.jsx)(gy,{size:12}),"Gallery"]})]}),"workflow"===r&&h&&s!==bx.SUCCESS&&(0,tB.jsxs)("button",{onClick:f,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-slate-100 hover:bg-slate-200 border border-slate-200 text-xs font-medium text-slate-600 transition-colors",children:[(0,tB.jsx)(bK,{size:12}),"Start Fresh"]}),(0,tB.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-amber-50 border border-amber-200/50",children:[(0,tB.jsx)(gd,{size:14,className:"text-amber-500"}),(0,tB.jsx)("span",{className:"text-xs font-medium text-amber-700",children:"AI-Powered Marketing"})]}),(0,tB.jsxs)("div",{className:"flex items-center gap-2 pl-3 border-l border-slate-200",children:[e.photoURL&&(0,tB.jsx)("img",{src:e.photoURL,alt:e.displayName||"User",className:"w-7 h-7 rounded-full border border-slate-200"}),(0,tB.jsx)("button",{onClick:n,className:"flex items-center gap-1.5 px-2 py-1.5 rounded-lg hover:bg-slate-100 text-xs font-medium text-slate-500 hover:text-slate-700 transition-colors",title:"Sign out",children:(0,tB.jsx)(bJ,{size:14})})]})]})]})]}),(0,tB.jsxs)("main",{className:"flex-1 bg-gradient-subtle py-12 px-4",children:["calendar"===r&&(0,tB.jsx)("div",{className:"max-w-6xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500",children:(0,tB.jsx)(bD,{onCreatePost:()=>{i("workflow"),f()}})}),"gallery"===r&&(0,tB.jsx)("div",{className:"max-w-6xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500",children:(0,tB.jsx)(bU,{onCreatePost:()=>{i("workflow"),f()}})}),"workflow"===r&&(0,tB.jsxs)(tB.Fragment,{children:[s!==bx.SUCCESS&&(0,tB.jsx)(bC,{currentStep:s,onStepClick:e=>{let t=[bx.UPLOAD,bx.MOCKUP_GENERATION,bx.CAPTIONING,bx.REVIEW],n=t.indexOf(s);t.indexOf(e)<n&&(a(e),p(e,o,u))}}),(0,tB.jsxs)("div",{className:"max-w-6xl mx-auto",children:[s===bx.UPLOAD&&(0,tB.jsxs)("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,tB.jsxs)("div",{className:"text-center mb-10",children:[(0,tB.jsx)("h2",{className:"text-3xl font-display font-bold text-slate-900 mb-4",children:"Start with your design"}),(0,tB.jsx)("p",{className:"text-lg text-slate-500 max-w-2xl mx-auto leading-relaxed",children:"Upload your t-shirt graphic (PNG recommended). Our Gemini AI models will handle the photography and copywriting."})]}),(0,tB.jsx)(pZ,{onUpload:e=>{l(e),a(bx.MOCKUP_GENERATION),p(bx.MOCKUP_GENERATION,e,u)}})]}),s===bx.MOCKUP_GENERATION&&o&&(0,tB.jsx)("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500",children:(0,tB.jsx)(gD,{design:o,onMockupsSelected:e=>{c(e),a(bx.CAPTIONING),p(bx.CAPTIONING,o,e)},onBack:f})}),s===bx.CAPTIONING&&u.length>0&&(0,tB.jsx)("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500",children:(0,tB.jsx)(bb,{mockups:u,onSuccess:()=>{a(bx.SUCCESS),sessionStorage.removeItem(bY),d(!1)},onBack:()=>a(bx.MOCKUP_GENERATION),onScheduled:()=>{i("calendar"),f()}})}),s===bx.SUCCESS&&(0,tB.jsxs)("div",{className:"max-w-md mx-auto text-center animate-in zoom-in duration-500 py-12 relative",children:[(0,tB.jsx)("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[...Array(12)].map((e,t)=>(0,tB.jsx)("div",{className:"confetti rounded-full",style:{left:`${10+7*t}%`,backgroundColor:["#6366f1","#f59e0b","#10b981","#f472b6","#14b8a6"][t%5],animationDelay:`${.15*t}s`,width:`${8+t%3*4}px`,height:`${8+t%3*4}px`}},t))}),(0,tB.jsx)("div",{className:"relative animate-success-bounce",children:(0,tB.jsx)("div",{className:"w-24 h-24 bg-gradient-to-br from-emerald-400 to-teal-500 text-white rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-xl shadow-emerald-500/30 animate-float",children:(0,tB.jsx)(b$,{size:48})})}),(0,tB.jsx)("h2",{className:"text-3xl font-display font-bold text-slate-900 mb-4",children:"Posted Successfully!"}),(0,tB.jsx)("p",{className:"text-slate-500 mb-8 leading-relaxed",children:"Your content has been published to your selected social channels."}),(0,tB.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,tB.jsx)("button",{onClick:f,className:"bg-gradient-to-r from-indigo-600 to-indigo-500 text-white px-8 py-3 rounded-xl font-semibold hover:from-indigo-700 hover:to-indigo-600 transition-all shadow-lg shadow-indigo-500/25 hover:shadow-xl hover:shadow-indigo-500/30 hover:-translate-y-0.5",children:"Create Another Post"}),(0,tB.jsxs)("button",{onClick:()=>{i("calendar"),f()},className:"bg-white text-slate-700 px-8 py-3 rounded-xl font-semibold border-2 border-slate-200 hover:border-slate-300 hover:bg-slate-50 transition-all flex items-center justify-center gap-2",children:[(0,tB.jsx)(yc,{size:18}),"View Calendar"]})]})]})]})]})]}),(0,tB.jsx)("footer",{className:"bg-white/50 backdrop-blur-sm border-t border-slate-200/50 py-6 mt-auto",children:(0,tB.jsx)("div",{className:"max-w-6xl mx-auto px-4 text-center text-slate-400 text-sm",children:(0,tB.jsxs)("p",{children:[" ",new Date().getFullYear()," SocialStitch. Built with React & Google Gemini."]})})})]})}e.s(["default",()=>bX],20613)},48137,e=>{e.n(e.i(20613))}]);